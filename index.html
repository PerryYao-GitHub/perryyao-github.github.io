<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="...">
<meta property="og:type" content="website">
<meta property="og:title" content="Perry&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Perry&#39;s Blog">
<meta property="og:description" content="...">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Perry Yao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Perry's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Perry's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">tech & muse & sleep</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/16/tech/swagger/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/16/tech/swagger/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-05-16 18:27:15" itemprop="dateCreated datePublished" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="üìù-Swagger-ÂèåÁôªÂΩïÊ®°ÂºèË∞ÉËØïÊìç‰ΩúÁ¨îËÆ∞ÔºàCookie-JWTÔºâ"><a href="#üìù-Swagger-ÂèåÁôªÂΩïÊ®°ÂºèË∞ÉËØïÊìç‰ΩúÁ¨îËÆ∞ÔºàCookie-JWTÔºâ" class="headerlink" title="üìù Swagger ÂèåÁôªÂΩïÊ®°ÂºèË∞ÉËØïÊìç‰ΩúÁ¨îËÆ∞ÔºàCookie + JWTÔºâ"></a>üìù Swagger ÂèåÁôªÂΩïÊ®°ÂºèË∞ÉËØïÊìç‰ΩúÁ¨îËÆ∞ÔºàCookie + JWTÔºâ</h1><h2 id="‚úÖ-‰∏Ä„ÄÅÈÖçÁΩÆ-Swagger-ÊîØÊåÅ-Cookie-Âíå-JWT"><a href="#‚úÖ-‰∏Ä„ÄÅÈÖçÁΩÆ-Swagger-ÊîØÊåÅ-Cookie-Âíå-JWT" class="headerlink" title="‚úÖ ‰∏Ä„ÄÅÈÖçÁΩÆ Swagger ÊîØÊåÅ Cookie Âíå JWT"></a>‚úÖ ‰∏Ä„ÄÅÈÖçÁΩÆ Swagger ÊîØÊåÅ Cookie Âíå JWT</h2><p>Âú®‰Ω†ÁöÑ Spring Boot È°πÁõÆ‰∏≠Ê∑ªÂä†Â¶Ç‰∏ãÈÖçÁΩÆÁ±ªÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.Components;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.OpenAPI;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.info.Info;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.security.SecurityRequirement;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.security.SecurityScheme;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">customOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Cookie ËÆ§ËØÅÔºöJSESSIONID</span></span><br><span class="line">        <span class="type">SecurityScheme</span> <span class="variable">cookieScheme</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityScheme</span>()</span><br><span class="line">                .type(SecurityScheme.Type.APIKEY)</span><br><span class="line">                .in(SecurityScheme.In.COOKIE)</span><br><span class="line">                .name(<span class="string">&quot;JSESSIONID&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// JWT Bearer Token ËÆ§ËØÅ</span></span><br><span class="line">        <span class="type">SecurityScheme</span> <span class="variable">bearerScheme</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityScheme</span>()</span><br><span class="line">                .type(SecurityScheme.Type.HTTP)</span><br><span class="line">                .scheme(<span class="string">&quot;bearer&quot;</span>)</span><br><span class="line">                .bearerFormat(<span class="string">&quot;JWT&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">                .info(<span class="keyword">new</span> <span class="title class_">Info</span>().title(<span class="string">&quot;PYOJ ÂêéÂè∞Êé•Âè£ÊñáÊ°£&quot;</span>).version(<span class="string">&quot;v1.0&quot;</span>))</span><br><span class="line">                .components(<span class="keyword">new</span> <span class="title class_">Components</span>()</span><br><span class="line">                        .addSecuritySchemes(<span class="string">&quot;cookieAuth&quot;</span>, cookieScheme)</span><br><span class="line">                        .addSecuritySchemes(<span class="string">&quot;bearerAuth&quot;</span>, bearerScheme))</span><br><span class="line">                .addSecurityItem(<span class="keyword">new</span> <span class="title class_">SecurityRequirement</span>()</span><br><span class="line">                        .addList(<span class="string">&quot;cookieAuth&quot;</span>)</span><br><span class="line">                        .addList(<span class="string">&quot;bearerAuth&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="‚úÖ-‰∫å„ÄÅÁôªÂΩïÊé•Âè£ÂáÜÂ§á"><a href="#‚úÖ-‰∫å„ÄÅÁôªÂΩïÊé•Âè£ÂáÜÂ§á" class="headerlink" title="‚úÖ ‰∫å„ÄÅÁôªÂΩïÊé•Âè£ÂáÜÂ§á"></a>‚úÖ ‰∫å„ÄÅÁôªÂΩïÊé•Âè£ÂáÜÂ§á</h2><p>‰Ω†ÁöÑÈ°πÁõÆ‰∏≠Â∫îËØ•ÊúâÁ±ª‰ºº‰ª•‰∏ã‰∏§‰∏™ÁôªÂΩïÊé•Âè£Ôºö</p>
<ul>
<li><p><strong>Session ÁôªÂΩïÊé•Âè£</strong>ÔºàËÆæÁΩÆ CookieÔºâÔºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /api/user/login</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>JWT ÁôªÂΩïÊé•Âè£</strong>ÔºàËøîÂõû tokenÔºâÔºö</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="‚úÖ-‰∏â„ÄÅSwagger-Ë∞ÉËØïÊìç‰ΩúÊ≠•È™§"><a href="#‚úÖ-‰∏â„ÄÅSwagger-Ë∞ÉËØïÊìç‰ΩúÊ≠•È™§" class="headerlink" title="‚úÖ ‰∏â„ÄÅSwagger Ë∞ÉËØïÊìç‰ΩúÊ≠•È™§"></a>‚úÖ ‰∏â„ÄÅSwagger Ë∞ÉËØïÊìç‰ΩúÊ≠•È™§</h2><h3 id="üç™-ÊñπÂºè‰∏ÄÔºö‰ΩøÁî®-Cookie-ÁôªÂΩï"><a href="#üç™-ÊñπÂºè‰∏ÄÔºö‰ΩøÁî®-Cookie-ÁôªÂΩï" class="headerlink" title="üç™ ÊñπÂºè‰∏ÄÔºö‰ΩøÁî® Cookie ÁôªÂΩï"></a>üç™ ÊñπÂºè‰∏ÄÔºö‰ΩøÁî® Cookie ÁôªÂΩï</h3><ol>
<li><p>ÊâìÂºÄ Swagger È°µÈù¢ÔºàÂ¶Ç <a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui.html%EF%BC%89">http://localhost:8080/swagger-ui.htmlÔºâ</a></p>
</li>
<li><p>Ë∞ÉÁî® <code>/api/user/login</code> ÊàêÂäüÂêéÔºåÂ§çÂà∂ÂìçÂ∫îÂ§¥‰∏≠ÁöÑ <code>Set-Cookie</code>ÔºåÂ¶ÇÔºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: JSESSIONID=xxxxxxx; Path=/; HttpOnly</span><br></pre></td></tr></table></figure>
</li>
<li><p>ÁÇπÂáªÈ°µÈù¢Âè≥‰∏äËßí <strong>Authorize</strong> ÊåâÈíÆ</p>
</li>
<li><p>Âú® cookie ËæìÂÖ•Ê°Ü‰∏≠Â°´ÂÖ•Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSESSIONID=xxxxxxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>ÁÇπÂáª <strong>Authorize ‚Üí Close</strong></p>
</li>
<li><p>Êé•‰∏ãÊù•ËØ∑Ê±ÇÊâÄÊúâÈúÄË¶ÅÁôªÂΩïÁä∂ÊÄÅÁöÑÊé•Âè£ÔºàÂ¶Ç <code>/user/update</code>ÔºâÂ∞±‰ºöËá™Âä®Â∏¶‰∏ä cookie</p>
</li>
</ol>
<hr>
<h3 id="üîê-ÊñπÂºè‰∫åÔºö‰ΩøÁî®-JWT-ÁôªÂΩï"><a href="#üîê-ÊñπÂºè‰∫åÔºö‰ΩøÁî®-JWT-ÁôªÂΩï" class="headerlink" title="üîê ÊñπÂºè‰∫åÔºö‰ΩøÁî® JWT ÁôªÂΩï"></a>üîê ÊñπÂºè‰∫åÔºö‰ΩøÁî® JWT ÁôªÂΩï</h3><ol>
<li><p>Ë∞ÉÁî® <code>/api/user/jwt-login</code> Ëé∑Âèñ tokenÔºö</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOi...&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ÁÇπÂáª Swagger È°µÈù¢Âè≥‰∏äËßí <strong>Authorize</strong></p>
</li>
<li><p>Âú® Bearer Token Ê°Ü‰∏≠Â°´ÂÖ•Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bearer eyJhbGciOi...</span><br></pre></td></tr></table></figure>
</li>
<li><p>ÁÇπÂáª <strong>Authorize ‚Üí Close</strong></p>
</li>
<li><p>ÊâÄÊúâÈúÄË¶ÅËÆ§ËØÅÁöÑÊé•Âè£‰ºöËá™Âä®Êê∫Â∏¶Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer eyJhbGciOi...</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="‚úÖ-Âõõ„ÄÅÂª∫ËÆÆÂÆûË∑µ"><a href="#‚úÖ-Âõõ„ÄÅÂª∫ËÆÆÂÆûË∑µ" class="headerlink" title="‚úÖ Âõõ„ÄÅÂª∫ËÆÆÂÆûË∑µ"></a>‚úÖ Âõõ„ÄÅÂª∫ËÆÆÂÆûË∑µ</h2><ul>
<li>ÂâçÊúüÂºÄÂèëÂèØ‰ª•‰øùÁïô‰∏§‰∏™Êé•Âè£Ôºå‰æø‰∫éÂØπÊØîË∞ÉËØï</li>
<li>Áîü‰∫ßÁéØÂ¢ÉÂª∫ËÆÆÈÄâÊã©‰∏ÄÁßçÁôªÂΩïÊñπÂºèÂπ∂Áªü‰∏ÄËÆ§ËØÅÈÄªËæë</li>
<li>Swagger UI Êú¨Ë∫´‰∏ç‰ºöËá™Âä®‰øùÂ≠ò CookieÔºåÂºÄÂèë‰∏≠Ë∞ÉËØïÈúÄÊâãÂä®Â§çÂà∂</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/23/tech/wsl2_docker_install_guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/23/tech/wsl2_docker_install_guide/" class="post-title-link" itemprop="url">Install Docker in WSL2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-23T00:00:00+08:00">2025-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="üê≥-WSL2-‰∏≠ÂÆâË£Ö-Docker-ÂÖ®ÊµÅÁ®ãÁ¨îËÆ∞ÔºàÁ∫Ø‰∫åËøõÂà∂ÂÆâË£ÖÊñπÂºèÔºâ"><a href="#üê≥-WSL2-‰∏≠ÂÆâË£Ö-Docker-ÂÖ®ÊµÅÁ®ãÁ¨îËÆ∞ÔºàÁ∫Ø‰∫åËøõÂà∂ÂÆâË£ÖÊñπÂºèÔºâ" class="headerlink" title="üê≥ WSL2 ‰∏≠ÂÆâË£Ö Docker ÂÖ®ÊµÅÁ®ãÁ¨îËÆ∞ÔºàÁ∫Ø‰∫åËøõÂà∂ÂÆâË£ÖÊñπÂºèÔºâ"></a>üê≥ WSL2 ‰∏≠ÂÆâË£Ö Docker ÂÖ®ÊµÅÁ®ãÁ¨îËÆ∞ÔºàÁ∫Ø‰∫åËøõÂà∂ÂÆâË£ÖÊñπÂºèÔºâ</h1><blockquote>
<p>Êú¨ÊñáËÆ∞ÂΩï‰∫ÜÂú® WSL2ÔºàUbuntu 20.04ÔºâÁéØÂ¢É‰∏ãÔºåÈÄöËøá<strong>‰∫åËøõÂà∂ÊñπÂºè</strong>ÂÆâË£Ö Docker ÁöÑÂÆåÊï¥Ê≠•È™§ÂèäÁõ∏ÂÖ≥Ê¶ÇÂøµËß£Êûê„ÄÇÈÄÇÁî®‰∫éÊó†ÈúÄ‰æùËµñ Docker DesktopÔºåÊâìÈÄ†ËΩªÈáè„ÄÅÈ´òÊïàÁöÑÂºÄÂèëÁéØÂ¢É„ÄÇ</p>
</blockquote>
<hr>
<h2 id="üì¶-‰∏Ä„ÄÅÂÆâË£ÖÊµÅÁ®ãÊ¶ÇËø∞"><a href="#üì¶-‰∏Ä„ÄÅÂÆâË£ÖÊµÅÁ®ãÊ¶ÇËø∞" class="headerlink" title="üì¶ ‰∏Ä„ÄÅÂÆâË£ÖÊµÅÁ®ãÊ¶ÇËø∞"></a>üì¶ ‰∏Ä„ÄÅÂÆâË£ÖÊµÅÁ®ãÊ¶ÇËø∞</h2><h3 id="1Ô∏è‚É£-‰∏ãËΩΩÂÆâË£ÖÂåÖ"><a href="#1Ô∏è‚É£-‰∏ãËΩΩÂÆâË£ÖÂåÖ" class="headerlink" title="1Ô∏è‚É£ ‰∏ãËΩΩÂÆâË£ÖÂåÖ"></a>1Ô∏è‚É£ ‰∏ãËΩΩÂÆâË£ÖÂåÖ</h3><ul>
<li>ËÆøÈóÆÈòøÈáå‰∫ëÈïúÂÉèÁ´ô‰∏ãËΩΩ Docker ‰∫åËøõÂà∂ÂåÖÔºö</li>
<li>Âú∞ÂùÄÔºö<a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/">https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/docker-24.0.7.tgz</span><br></pre></td></tr></table></figure>

<h3 id="2Ô∏è‚É£-Ëß£ÂéãÂπ∂ÂÆâË£Ö"><a href="#2Ô∏è‚É£-Ëß£ÂéãÂπ∂ÂÆâË£Ö" class="headerlink" title="2Ô∏è‚É£ Ëß£ÂéãÂπ∂ÂÆâË£Ö"></a>2Ô∏è‚É£ Ëß£ÂéãÂπ∂ÂÆâË£Ö</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf docker-24.0.7.tgz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> docker/* /usr/local/bin/</span><br></pre></td></tr></table></figure>

<p>Ê≠§Ê≠•È™§Â∞Ü <code>docker</code> Âíå <code>dockerd</code> Á≠âÊ†∏ÂøÉÂèØÊâßË°åÊñá‰ª∂Â§çÂà∂Âà∞Á≥ªÁªüË∑ØÂæÑ‰∏ã„ÄÇ</p>
<hr>
<h2 id="‚öôÔ∏è-‰∫å„ÄÅÈÖçÁΩÆÈïúÂÉèÂä†ÈÄüÂô®"><a href="#‚öôÔ∏è-‰∫å„ÄÅÈÖçÁΩÆÈïúÂÉèÂä†ÈÄüÂô®" class="headerlink" title="‚öôÔ∏è ‰∫å„ÄÅÈÖçÁΩÆÈïúÂÉèÂä†ÈÄüÂô®"></a>‚öôÔ∏è ‰∫å„ÄÅÈÖçÁΩÆÈïúÂÉèÂä†ÈÄüÂô®</h2><p>ÂàõÂª∫ÈÖçÁΩÆÊñá‰ª∂ <code>/etc/docker/daemon.json</code>Ôºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [&quot;https://&lt;‰Ω†ÁöÑÈòøÈáå‰∫ëID&gt;.mirror.aliyuncs.com&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>‰ΩúÁî®ÔºöÂä†ÈÄüÊãâÂèñ Docker ÈïúÂÉèÔºåËß£ÂÜ≥ÂõΩÂÜÖÁΩëÁªúÈóÆÈ¢ò„ÄÇ</p>
</blockquote>
<p>ACR‰ºö‰∏∫ÊØè‰∏Ä‰∏™Ë¥¶Âè∑ÔºàÈòøÈáå‰∫ëË¥¶Âè∑ÊàñRAMÁî®Êà∑ÔºâÁîüÊàê‰∏Ä‰∏™ÈïúÂÉèÂä†ÈÄüÂô®Âú∞ÂùÄÔºåÈÖçÁΩÆÈïúÂÉèÂä†ÈÄüÂô®ÂâçÔºåÊÇ®ÈúÄË¶ÅËé∑ÂèñÈïúÂÉèÂä†ÈÄüÂô®Âú∞ÂùÄ„ÄÇ</p>
<ol>
<li>ÁôªÂΩï<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/?spm=a2c4g.11186623.0.0.75121d82E0FDn8">ÂÆπÂô®ÈïúÂÉèÊúçÂä°ÊéßÂà∂Âè∞</a>„ÄÇ</li>
<li>Âú®Â∑¶‰æßÂØºËà™Ê†èÈÄâÊã©<em><strong>*ÈïúÂÉèÂ∑•ÂÖ∑** &gt; **ÈïúÂÉèÂä†ÈÄüÂô®*</strong></em></li>
<li>Âú®<strong>ÈïúÂÉèÂä†ÈÄüÂô®</strong>È°µÈù¢Ëé∑Âèñ<strong>Âä†ÈÄüÂô®Âú∞ÂùÄ</strong>„ÄÇ</li>
</ol>
<hr>
<h2 id="üöÄ-‰∏â„ÄÅÂêØÂä®-Docker-ÂÆàÊä§ËøõÁ®ã"><a href="#üöÄ-‰∏â„ÄÅÂêØÂä®-Docker-ÂÆàÊä§ËøõÁ®ã" class="headerlink" title="üöÄ ‰∏â„ÄÅÂêØÂä® Docker ÂÆàÊä§ËøõÁ®ã"></a>üöÄ ‰∏â„ÄÅÂêØÂä® Docker ÂÆàÊä§ËøõÁ®ã</h2><p>Áî±‰∫é WSL2 ÈªòËÆ§Êó† systemdÔºåÈúÄÊâãÂä®ÂêØÂä® <code>dockerd</code>Ôºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dockerd &gt; /tmp/dockerd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>ÊàñËÄÖÁºñÂÜôÂêØÂä®ËÑöÊú¨ <code>start-docker.sh</code> Êñπ‰æø‰ΩøÁî®„ÄÇ</p>
<hr>
<h2 id="üë§-Âõõ„ÄÅÈÖçÁΩÆÁî®Êà∑ÊùÉÈôê"><a href="#üë§-Âõõ„ÄÅÈÖçÁΩÆÁî®Êà∑ÊùÉÈôê" class="headerlink" title="üë§ Âõõ„ÄÅÈÖçÁΩÆÁî®Êà∑ÊùÉÈôê"></a>üë§ Âõõ„ÄÅÈÖçÁΩÆÁî®Êà∑ÊùÉÈôê</h2><p>ÈÅøÂÖçÊØèÊ¨°ËøêË°å Docker ÂëΩ‰ª§ÈÉΩÈúÄË¶Å sudoÔºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"><span class="built_in">exec</span> su -l <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="‚úÖ-‰∫î„ÄÅÈ™åËØÅ-Docker-ÊòØÂê¶ÂÆâË£ÖÊàêÂäü"><a href="#‚úÖ-‰∫î„ÄÅÈ™åËØÅ-Docker-ÊòØÂê¶ÂÆâË£ÖÊàêÂäü" class="headerlink" title="‚úÖ ‰∫î„ÄÅÈ™åËØÅ Docker ÊòØÂê¶ÂÆâË£ÖÊàêÂäü"></a>‚úÖ ‰∫î„ÄÅÈ™åËØÅ Docker ÊòØÂê¶ÂÆâË£ÖÊàêÂäü</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üß†-ÂÖ≠„ÄÅÂÖ≥ÈîÆÊ¶ÇÂøµËß£Êûê"><a href="#üß†-ÂÖ≠„ÄÅÂÖ≥ÈîÆÊ¶ÇÂøµËß£Êûê" class="headerlink" title="üß† ÂÖ≠„ÄÅÂÖ≥ÈîÆÊ¶ÇÂøµËß£Êûê"></a>üß† ÂÖ≠„ÄÅÂÖ≥ÈîÆÊ¶ÇÂøµËß£Êûê</h2><h3 id="1Ô∏è‚É£-dockerd-‚Äî‚Äî-Docker-DaemonÔºàÂÆàÊä§ËøõÁ®ãÔºâ"><a href="#1Ô∏è‚É£-dockerd-‚Äî‚Äî-Docker-DaemonÔºàÂÆàÊä§ËøõÁ®ãÔºâ" class="headerlink" title="1Ô∏è‚É£ dockerd ‚Äî‚Äî Docker DaemonÔºàÂÆàÊä§ËøõÁ®ãÔºâ"></a>1Ô∏è‚É£ <code>dockerd</code> ‚Äî‚Äî Docker DaemonÔºàÂÆàÊä§ËøõÁ®ãÔºâ</h3><ul>
<li>Ë¥üË¥£ÁÆ°ÁêÜÂÆπÂô®„ÄÅÈïúÂÉè„ÄÅÁΩëÁªúÁ≠âÊâÄÊúâÂêéÂè∞ÊúçÂä°</li>
<li>ÂøÖÈ°ªËøêË°å <code>dockerd</code>ÔºåÂÆ¢Êà∑Á´Ø <code>docker</code> ÂëΩ‰ª§ÊâçËÉΩÂ∑•‰Ωú</li>
</ul>
<h3 id="2Ô∏è‚É£-var-run-docker-sock"><a href="#2Ô∏è‚É£-var-run-docker-sock" class="headerlink" title="2Ô∏è‚É£ /var/run/docker.sock"></a>2Ô∏è‚É£ <code>/var/run/docker.sock</code></h3><ul>
<li>Docker ÂÆ¢Êà∑Á´Ø‰∏éÂÆàÊä§ËøõÁ®ãÈÄö‰ø°ÁöÑ Unix Socket Êñá‰ª∂</li>
<li>ÊùÉÈôê‰∏çË∂≥‰ºöÂØºËá¥ <code>permission denied</code> ÈîôËØØ</li>
</ul>
<h3 id="3Ô∏è‚É£-daemon-json"><a href="#3Ô∏è‚É£-daemon-json" class="headerlink" title="3Ô∏è‚É£ daemon.json"></a>3Ô∏è‚É£ <code>daemon.json</code></h3><ul>
<li>Docker ÁöÑ‰∏ªÈÖçÁΩÆÊñá‰ª∂ÔºåÈÄöÂ∏∏Áî®‰∫éËÆæÁΩÆÈïúÂÉèÂä†ÈÄüÂô®„ÄÅÊó•ÂøóÈ©±Âä®Á≠â</li>
<li>‰ΩçÁΩÆÔºö<code>/etc/docker/daemon.json</code></li>
</ul>
<h3 id="4Ô∏è‚É£-ÈïúÂÉèÂä†ÈÄüÂô®"><a href="#4Ô∏è‚É£-ÈïúÂÉèÂä†ÈÄüÂô®" class="headerlink" title="4Ô∏è‚É£ ÈïúÂÉèÂä†ÈÄüÂô®"></a>4Ô∏è‚É£ ÈïúÂÉèÂä†ÈÄüÂô®</h3><ul>
<li>ÂõΩÂÜÖËÆøÈóÆ Docker Hub ÁºìÊÖ¢ÔºåÈÄöËøáÈòøÈáå‰∫ë„ÄÅÁΩëÊòìÁ≠âÊèê‰æõÁöÑÂä†ÈÄüÊúçÂä°ÔºåÂ§ßÂπÖÊèêÂçáÈïúÂÉèÊãâÂèñÈÄüÂ∫¶</li>
</ul>
<hr>
<h2 id="üìå-‰∏É„ÄÅÂ∏∏Áî®ÂëΩ‰ª§ÊÄªÁªì"><a href="#üìå-‰∏É„ÄÅÂ∏∏Áî®ÂëΩ‰ª§ÊÄªÁªì" class="headerlink" title="üìå ‰∏É„ÄÅÂ∏∏Áî®ÂëΩ‰ª§ÊÄªÁªì"></a>üìå ‰∏É„ÄÅÂ∏∏Áî®ÂëΩ‰ª§ÊÄªÁªì</h2><table>
<thead>
<tr>
<th>ÂëΩ‰ª§</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td><code>sudo dockerd &amp;</code></td>
<td>ÂêØÂä® Docker ÂêéÂè∞ÊúçÂä°</td>
</tr>
<tr>
<td><code>docker ps</code></td>
<td>Êü•ÁúãËøêË°å‰∏≠ÁöÑÂÆπÂô®</td>
</tr>
<tr>
<td><code>docker images</code></td>
<td>Êü•ÁúãÊú¨Âú∞ÈïúÂÉè</td>
</tr>
<tr>
<td><code>docker run hello-world</code></td>
<td>ÊµãËØï Docker ÊòØÂê¶Ê≠£Â∏∏ËøêË°å</td>
</tr>
<tr>
<td><code>docker stop &lt;ÂÆπÂô®ID&gt;</code></td>
<td>ÂÅúÊ≠¢ÂÆπÂô®</td>
</tr>
<tr>
<td><code>docker rm &lt;ÂÆπÂô®ID&gt;</code></td>
<td>Âà†Èô§ÂÆπÂô®</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>Êú¨ÊñáÊ°£ÈÄÇÁî®‰∫é‰∏™‰∫∫ÂºÄÂèëÁéØÂ¢ÉÔºåÁîü‰∫ßÁéØÂ¢ÉÂª∫ËÆÆÁªìÂêà systemd Êàñ‰ΩøÁî® Docker Desktop„ÄÇ</p>
</blockquote>
<h2 id="ËÑöÊú¨"><a href="#ËÑöÊú¨" class="headerlink" title="ËÑöÊú¨"></a>ËÑöÊú¨</h2><p><code>docker_start.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dockerd &gt; /tmp/dockerd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>



<p>Ê≥®: ‰∏Ä‰∏ãËÑöÊú¨‰∏çÂêàÈÄÇÂõΩÂÜÖÁΩëÁªúÁéØÂ¢É, APT get‰∏çÂà∞, ÂÖ∂‰∏≠ÂÆâË£ÖÁöÑÂ§ö‰∏™Â∫îÁî®:</p>
<p><code>docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></p>
<p>ÂùáÊ∂µÁõñÂú®ÈòøÈáå‰∫ëÈïúÂÉèÁöÑ‰∫åËøõÂà∂Á®ãÂ∫èÂéãÁº©ÂåÖ‰∏≠</p>
<p><code>wsl2_docker_install.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># WSL2 ÂÆâË£Ö Docker Engine ËÑöÊú¨ (ÈÄÇÁî®‰∫é Ubuntu)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üö® Ê∏ÖÁêÜÊóßÁâàÊú¨ Docker...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge -y docker.io docker-doc docker-compose docker-compose-v2 docker-engine docker containerd runc</span><br><span class="line"><span class="built_in">sudo</span> apt autoremove -y</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;‚úÖ ÂÆâË£Ö‰æùËµñ...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y ca-certificates curl gnupg lsb-release</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üîë Ê∑ªÂä† Docker ÂÆòÊñπ GPG ÂØÜÈí•...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üì¶ Ê∑ªÂä† Docker APT Ê∫ê...&quot;</span></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üöÄ ÂºÄÂßãÂÆâË£Ö Docker Engine...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;‚úÖ Docker ÂÆâË£ÖÂÆåÊàêÔºÅ&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;‚ö° ÈÖçÁΩÆÈòøÈáå‰∫ëÈïúÂÉèÂä†ÈÄüÂô®...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [&quot;https://&lt;‰Ω†ÁöÑÈòøÈáå‰∫ëID&gt;.mirror.aliyuncs.com&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üö® Ê≥®ÊÑèÔºöWSL2 Êó†Ê≥ï‰ΩøÁî® systemd ÂêØÂä® Docker ÊúçÂä°&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üëâ ËØ∑‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§ÊâãÂä®ÂêØÂä® Docker ÂÆàÊä§ËøõÁ®ãÔºö&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sudo dockerd &gt; /tmp/dockerd.log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;üí° ÂêØÂä®ÂêéÔºå‰ΩøÁî® &#x27;docker ps&#x27; ËøõË°åÈ™åËØÅ&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/12/tech/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/12/tech/linux/" class="post-title-link" itemprop="url">Linux Common Operations</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-12T00:00:00+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="üêß-Linux-Â∏∏ËßÅÊìç‰ΩúÂØπÁÖßÊâãÂÜåÔºàÁ±ªÊØî-Windows-Á≥ªÁªüÔºâ"><a href="#üêß-Linux-Â∏∏ËßÅÊìç‰ΩúÂØπÁÖßÊâãÂÜåÔºàÁ±ªÊØî-Windows-Á≥ªÁªüÔºâ" class="headerlink" title="üêß Linux Â∏∏ËßÅÊìç‰ΩúÂØπÁÖßÊâãÂÜåÔºàÁ±ªÊØî Windows Á≥ªÁªüÔºâ"></a>üêß Linux Â∏∏ËßÅÊìç‰ΩúÂØπÁÖßÊâãÂÜåÔºàÁ±ªÊØî Windows Á≥ªÁªüÔºâ</h1><blockquote>
<p>Êú¨ÊñáÊó®Âú®Â∏ÆÂä©ÁÜüÊÇâ Windows Á≥ªÁªüÁöÑÁî®Êà∑Âø´ÈÄüÊéåÊè° Linux ‰∏≠ÁöÑÂ∏∏Áî®Á≥ªÁªüÊìç‰ΩúÔºåÂêåÊó∂Ë°•ÂÖÖÂ∏∏Áî®ÂëΩ‰ª§ÁöÑÂê´‰πâ‰æø‰∫éËÆ∞ÂøÜ„ÄÇ</p>
</blockquote>
<hr>
<h2 id="üß†-Âü∫Á°Ä‰ø°ÊÅØÊü•Áúã"><a href="#üß†-Âü∫Á°Ä‰ø°ÊÅØÊü•Áúã" class="headerlink" title="üß† Âü∫Á°Ä‰ø°ÊÅØÊü•Áúã"></a>üß† Âü∫Á°Ä‰ø°ÊÅØÊü•Áúã</h2><h3 id="Êü•ÁúãÂΩìÂâçÁî®Êà∑ÂêçÔºàwhoami-‚Üí-who-am-iÔºâ"><a href="#Êü•ÁúãÂΩìÂâçÁî®Êà∑ÂêçÔºàwhoami-‚Üí-who-am-iÔºâ" class="headerlink" title="Êü•ÁúãÂΩìÂâçÁî®Êà∑ÂêçÔºàwhoami ‚Üí who am iÔºâ"></a>Êü•ÁúãÂΩìÂâçÁî®Êà∑ÂêçÔºàwhoami ‚Üí who am iÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">whoami</span>  <span class="comment"># ÊòæÁ§∫ÂΩìÂâçÁôªÂΩïÁî®Êà∑Ôºàwho am IÔºâ</span></span><br></pre></td></tr></table></figure>

<h3 id="Êü•ÁúãÂΩìÂâçÊâÄÂú®Ë∑ØÂæÑÔºàpwd-‚Üí-print-working-directoryÔºâ"><a href="#Êü•ÁúãÂΩìÂâçÊâÄÂú®Ë∑ØÂæÑÔºàpwd-‚Üí-print-working-directoryÔºâ" class="headerlink" title="Êü•ÁúãÂΩìÂâçÊâÄÂú®Ë∑ØÂæÑÔºàpwd ‚Üí print working directoryÔºâ"></a>Êü•ÁúãÂΩìÂâçÊâÄÂú®Ë∑ØÂæÑÔºàpwd ‚Üí print working directoryÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span>  <span class="comment"># ÊòæÁ§∫ÂΩìÂâçÊâÄÂú®ÁöÑÁªùÂØπË∑ØÂæÑ</span></span><br></pre></td></tr></table></figure>

<h3 id="Êü•ÁúãÁ≥ªÁªü‰ø°ÊÅØÔºàuname-‚Üí-unix-nameÔºâ"><a href="#Êü•ÁúãÁ≥ªÁªü‰ø°ÊÅØÔºàuname-‚Üí-unix-nameÔºâ" class="headerlink" title="Êü•ÁúãÁ≥ªÁªü‰ø°ÊÅØÔºàuname ‚Üí unix nameÔºâ"></a>Êü•ÁúãÁ≥ªÁªü‰ø°ÊÅØÔºàuname ‚Üí unix nameÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -a         <span class="comment"># Êü•ÁúãÂÜÖÊ†∏ÁâàÊú¨„ÄÅÊû∂ÊûÑ</span></span><br><span class="line">lsb_release -a   <span class="comment"># Êü•ÁúãÂèëË°åÁâà‰ø°ÊÅØ</span></span><br><span class="line">hostnamectl      <span class="comment"># ÊòæÁ§∫‰∏ªÊú∫ÂêçÂíåÁ≥ªÁªüÁâàÊú¨Á≠â‰ø°ÊÅØ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üìÅ-Êñá‰ª∂‰∏éÁõÆÂΩïÊìç‰Ωú"><a href="#üìÅ-Êñá‰ª∂‰∏éÁõÆÂΩïÊìç‰Ωú" class="headerlink" title="üìÅ Êñá‰ª∂‰∏éÁõÆÂΩïÊìç‰Ωú"></a>üìÅ Êñá‰ª∂‰∏éÁõÆÂΩïÊìç‰Ωú</h2><h3 id="Êü•ÁúãÁõÆÂΩïÂÜÖÂÆπÔºàls-‚Üí-list-segmentsÔºâ"><a href="#Êü•ÁúãÁõÆÂΩïÂÜÖÂÆπÔºàls-‚Üí-list-segmentsÔºâ" class="headerlink" title="Êü•ÁúãÁõÆÂΩïÂÜÖÂÆπÔºàls ‚Üí list segmentsÔºâ"></a>Êü•ÁúãÁõÆÂΩïÂÜÖÂÆπÔºàls ‚Üí list segmentsÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -lh      <span class="comment"># ÂàóÂá∫ÂΩìÂâçÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂ÔºåÂ∏¶Âçï‰ΩçÂíåÊó∂Èó¥</span></span><br><span class="line"><span class="built_in">ls</span> -a       <span class="comment"># ÊòæÁ§∫ÊâÄÊúâÊñá‰ª∂ÔºåÂåÖÊã¨ÈöêËóèÊñá‰ª∂Ôºà‰ª•.ÂºÄÂ§¥Ôºâ</span></span><br><span class="line"><span class="built_in">ls</span> -R       <span class="comment"># ÈÄíÂΩíÂàóÂá∫ÊâÄÊúâÂ≠êÁõÆÂΩïÂÜÖÂÆπ</span></span><br></pre></td></tr></table></figure>

<h3 id="Â§çÂà∂-ÁßªÂä®-Âà†Èô§-Êñá‰ª∂"><a href="#Â§çÂà∂-ÁßªÂä®-Âà†Èô§-Êñá‰ª∂" class="headerlink" title="Â§çÂà∂ &#x2F; ÁßªÂä® &#x2F; Âà†Èô§ Êñá‰ª∂"></a>Â§çÂà∂ &#x2F; ÁßªÂä® &#x2F; Âà†Èô§ Êñá‰ª∂</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> file1 file2       <span class="comment"># cp ‚Üí copyÔºåÂ§çÂà∂Êñá‰ª∂</span></span><br><span class="line"><span class="built_in">cp</span> -r dir1 dir2      <span class="comment"># ÈÄíÂΩíÂ§çÂà∂Êï¥‰∏™ÁõÆÂΩï</span></span><br><span class="line"><span class="built_in">mv</span> file newname      <span class="comment"># mv ‚Üí moveÔºåÁßªÂä®ÊàñÈáçÂëΩÂêçÊñá‰ª∂</span></span><br><span class="line"><span class="built_in">rm</span> file.txt          <span class="comment"># rm ‚Üí removeÔºåÂà†Èô§Êñá‰ª∂</span></span><br><span class="line"><span class="built_in">rm</span> -r folder/        <span class="comment"># ÈÄíÂΩíÂà†Èô§Êñá‰ª∂Â§π</span></span><br></pre></td></tr></table></figure>

<h3 id="‰øÆÊîπÊñá‰ª∂ÊùÉÈôêÔºàchmod-‚Üí-change-modeÔºâ"><a href="#‰øÆÊîπÊñá‰ª∂ÊùÉÈôêÔºàchmod-‚Üí-change-modeÔºâ" class="headerlink" title="‰øÆÊîπÊñá‰ª∂ÊùÉÈôêÔºàchmod ‚Üí change modeÔºâ"></a>‰øÆÊîπÊñá‰ª∂ÊùÉÈôêÔºàchmod ‚Üí change modeÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x run.sh      <span class="comment"># Â¢ûÂä†ÊâßË°åÊùÉÈôê</span></span><br><span class="line"><span class="built_in">chmod</span> 644 file.txt   <span class="comment"># ËÆæÂÆöÂÖ∑‰ΩìÊùÉÈôêÔºàrw-r--r--Ôºâ</span></span><br></pre></td></tr></table></figure>

<h3 id="7-‰øÆÊîπÂΩíÂ±ûÁî®Êà∑ÂíåÁªÑÔºàchown-‚Üí-change-ownerÔºâ"><a href="#7-‰øÆÊîπÂΩíÂ±ûÁî®Êà∑ÂíåÁªÑÔºàchown-‚Üí-change-ownerÔºâ" class="headerlink" title="7. ‰øÆÊîπÂΩíÂ±ûÁî®Êà∑ÂíåÁªÑÔºàchown ‚Üí change ownerÔºâ"></a>7. ‰øÆÊîπÂΩíÂ±ûÁî®Êà∑ÂíåÁªÑÔºàchown ‚Üí change ownerÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> yifan file.txt  <span class="comment"># ÊääÊñá‰ª∂ÂΩíÂ±ûÊõ¥Êîπ‰∏∫ yifan</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üìã-Êñá‰ª∂Êü•Áúã‰∏éÁºñËæë"><a href="#üìã-Êñá‰ª∂Êü•Áúã‰∏éÁºñËæë" class="headerlink" title="üìã Êñá‰ª∂Êü•Áúã‰∏éÁºñËæë"></a>üìã Êñá‰ª∂Êü•Áúã‰∏éÁºñËæë</h2><h3 id="Âø´ÈÄüÊü•ÁúãÊñá‰ª∂ÂÜÖÂÆπ"><a href="#Âø´ÈÄüÊü•ÁúãÊñá‰ª∂ÂÜÖÂÆπ" class="headerlink" title="Âø´ÈÄüÊü•ÁúãÊñá‰ª∂ÂÜÖÂÆπ"></a>Âø´ÈÄüÊü•ÁúãÊñá‰ª∂ÂÜÖÂÆπ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> file.txt         <span class="comment"># cat ‚Üí concatenateÔºå‰∏ÄÊ¨°ÊÄßÊü•ÁúãÂÖ®ÈÉ®ÂÜÖÂÆπ</span></span><br><span class="line">less file.txt        <span class="comment"># ÂàÜÈ°µÊü•ÁúãÔºåÂèØ‰∏ä‰∏ãÁøªÈ°µ</span></span><br><span class="line"><span class="built_in">head</span> -n 10 file.txt  <span class="comment"># ÊòæÁ§∫Ââç 10 Ë°å</span></span><br><span class="line"><span class="built_in">tail</span> -n 10 file.txt  <span class="comment"># ÊòæÁ§∫Âêé 10 Ë°å</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> $(find dir1 dir2 -<span class="built_in">type</span> f) <span class="comment"># ÊâìÂç∞Âá∫ dir1 dir2 ÁõÆÂΩï‰∏ãÊâÄÊúâÊñá‰ª∂ÁöÑÂÜÖÂÆπ (ÈÄíÂΩíËøõË°å)</span></span><br><span class="line"></span><br><span class="line">find dir1 dir2 -<span class="built_in">type</span> f | <span class="keyword">while</span> <span class="built_in">read</span> file; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===== <span class="variable">$file</span> =====&quot;</span></span><br><span class="line">  <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> <span class="comment"># Âú®Êñá‰ª∂‰∏éÊñá‰ª∂‰πãÈó¥Âä†‰∏ä ===== Êñá‰ª∂Âêç =====</span></span><br><span class="line"></span><br><span class="line">find dir1 dir2 -<span class="built_in">type</span> f -name <span class="string">&quot;*.java&quot;</span> | <span class="keyword">while</span> <span class="built_in">read</span> file; <span class="keyword">do</span> <span class="comment"># ÈôêÂà∂Êñá‰ª∂Á±ªÂûã</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===== <span class="variable">$file</span> =====&quot;</span></span><br><span class="line">  <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="ÁºñËæëÊñá‰ª∂"><a href="#ÁºñËæëÊñá‰ª∂" class="headerlink" title="ÁºñËæëÊñá‰ª∂"></a>ÁºñËæëÊñá‰ª∂</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nano file.txt        <span class="comment"># ÁªàÁ´ØÂÜÖÁÆÄÂçïÁºñËæëÂô®</span></span><br><span class="line">vim file.txt         <span class="comment"># È´òÁ∫ßÁºñËæëÂô®Ôºàvi improvedÔºâ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üíª-Á≥ªÁªüËµÑÊ∫êÁÆ°ÁêÜ"><a href="#üíª-Á≥ªÁªüËµÑÊ∫êÁÆ°ÁêÜ" class="headerlink" title="üíª Á≥ªÁªüËµÑÊ∫êÁÆ°ÁêÜ"></a>üíª Á≥ªÁªüËµÑÊ∫êÁÆ°ÁêÜ</h2><h3 id="Êü•ÁúãËøõÁ®ãÔºàtop-‚Üí-table-of-processesÔºâ"><a href="#Êü•ÁúãËøõÁ®ãÔºàtop-‚Üí-table-of-processesÔºâ" class="headerlink" title="Êü•ÁúãËøõÁ®ãÔºàtop ‚Üí table of processesÔºâ"></a>Êü•ÁúãËøõÁ®ãÔºàtop ‚Üí table of processesÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top        <span class="comment"># ÂÆûÊó∂ÊòæÁ§∫Á≥ªÁªüËøõÁ®ãÂíåËµÑÊ∫êÂç†Áî®</span></span><br><span class="line">htop       <span class="comment"># Êõ¥ÂèãÂ•Ω„ÄÅÂõæÂΩ¢ÂåñÁöÑ top</span></span><br><span class="line">ps aux     <span class="comment"># ÊòæÁ§∫ÊâÄÊúâËøõÁ®ãËØ¶ÁªÜ‰ø°ÊÅØÔºàps ‚Üí process statusÔºâ</span></span><br></pre></td></tr></table></figure>

<h3 id="Êü•ÁúãÁ´ØÂè£ÂíåËøûÊé•Ôºàss-‚Üí-socket-statisticsÔºâ"><a href="#Êü•ÁúãÁ´ØÂè£ÂíåËøûÊé•Ôºàss-‚Üí-socket-statisticsÔºâ" class="headerlink" title="Êü•ÁúãÁ´ØÂè£ÂíåËøûÊé•Ôºàss ‚Üí socket statisticsÔºâ"></a>Êü•ÁúãÁ´ØÂè£ÂíåËøûÊé•Ôºàss ‚Üí socket statisticsÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ss -tulnp</span><br><span class="line"><span class="comment"># -p: Ë°®Á§∫ÊòæÁ§∫ ÁõëÂê¨ËØ•Á´ØÂè£ÁöÑËøõÁ®ãÔºàPID/ÂêçÁß∞Ôºâ</span></span><br><span class="line"><span class="comment"># -nÔºö‰∏çËß£ÊûêÊúçÂä°ÂêçÁß∞Ôºà‰æãÂ¶ÇÊòæÁ§∫ 3306 ËÄå‰∏çÊòØ mysqlÔºâ</span></span><br><span class="line"><span class="comment"># -lÔºöÂè™ÊòæÁ§∫ÁõëÂê¨Áä∂ÊÄÅÔºàListenÔºâ</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ss -tuln           <span class="comment"># ÊòæÁ§∫ÁõëÂê¨ÁöÑ TCP/UDP Á´ØÂè£</span></span><br><span class="line">lsof -i:8080       <span class="comment"># Êü•ÁúãÂì™‰∏™ËøõÁ®ãÂç†Áî®Á´ØÂè£Ôºàlsof ‚Üí list open filesÔºâ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üíø-Á£ÅÁõò‰∏éÁ©∫Èó¥"><a href="#üíø-Á£ÅÁõò‰∏éÁ©∫Èó¥" class="headerlink" title="üíø Á£ÅÁõò‰∏éÁ©∫Èó¥"></a>üíø Á£ÅÁõò‰∏éÁ©∫Èó¥</h2><h3 id="Êü•ÁúãÁ£ÅÁõò‰ΩøÁî®ÊÉÖÂÜµÔºàdf-‚Üí-disk-freeÔºâ"><a href="#Êü•ÁúãÁ£ÅÁõò‰ΩøÁî®ÊÉÖÂÜµÔºàdf-‚Üí-disk-freeÔºâ" class="headerlink" title="Êü•ÁúãÁ£ÅÁõò‰ΩøÁî®ÊÉÖÂÜµÔºàdf ‚Üí disk freeÔºâ"></a>Êü•ÁúãÁ£ÅÁõò‰ΩøÁî®ÊÉÖÂÜµÔºàdf ‚Üí disk freeÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h  <span class="comment"># Êü•ÁúãÊØè‰∏™ÊåÇËΩΩÁÇπÁöÑÁ£ÅÁõò‰ΩøÁî®ÊÉÖÂÜµ</span></span><br></pre></td></tr></table></figure>

<h3 id="Êü•ÁúãÁõÆÂΩïÂ§ßÂ∞èÔºàdu-‚Üí-disk-usageÔºâ"><a href="#Êü•ÁúãÁõÆÂΩïÂ§ßÂ∞èÔºàdu-‚Üí-disk-usageÔºâ" class="headerlink" title="Êü•ÁúãÁõÆÂΩïÂ§ßÂ∞èÔºàdu ‚Üí disk usageÔºâ"></a>Êü•ÁúãÁõÆÂΩïÂ§ßÂ∞èÔºàdu ‚Üí disk usageÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -sh .    <span class="comment"># ÂΩìÂâçÁõÆÂΩïÊÄªÂ§ßÂ∞è</span></span><br><span class="line"><span class="built_in">du</span> -sh *    <span class="comment"># ÂΩìÂâçÁõÆÂΩï‰∏ãÂêÑÊñá‰ª∂/ÁõÆÂΩïÂ§ßÂ∞è</span></span><br></pre></td></tr></table></figure>

<h3 id="Êü•ÁúãÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ"><a href="#Êü•ÁúãÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ" class="headerlink" title="Êü•ÁúãÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ"></a>Êü•ÁúãÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h  <span class="comment"># ÊòæÁ§∫ÂÜÖÂ≠òÂíå swap ‰ΩøÁî®ÊÉÖÂÜµ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üß©-ËΩØ‰ª∂ÂåÖÁÆ°ÁêÜ"><a href="#üß©-ËΩØ‰ª∂ÂåÖÁÆ°ÁêÜ" class="headerlink" title="üß© ËΩØ‰ª∂ÂåÖÁÆ°ÁêÜ"></a>üß© ËΩØ‰ª∂ÂåÖÁÆ°ÁêÜ</h2><h3 id="ÂÆâË£ÖÁ®ãÂ∫èÔºàapt-‚Üí-advanced-package-toolÔºâ"><a href="#ÂÆâË£ÖÁ®ãÂ∫èÔºàapt-‚Üí-advanced-package-toolÔºâ" class="headerlink" title="ÂÆâË£ÖÁ®ãÂ∫èÔºàapt ‚Üí advanced package toolÔºâ"></a>ÂÆâË£ÖÁ®ãÂ∫èÔºàapt ‚Üí advanced package toolÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install &lt;ËΩØ‰ª∂Âêç&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Êü•ÁúãÂ∑≤ÂÆâË£ÖÁöÑËΩØ‰ª∂"><a href="#Êü•ÁúãÂ∑≤ÂÆâË£ÖÁöÑËΩØ‰ª∂" class="headerlink" title="Êü•ÁúãÂ∑≤ÂÆâË£ÖÁöÑËΩØ‰ª∂"></a>Êü•ÁúãÂ∑≤ÂÆâË£ÖÁöÑËΩØ‰ª∂</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l  <span class="comment"># ÂàóÂá∫ÊâÄÊúâÂÆâË£ÖÁöÑËΩØ‰ª∂ÂåÖ</span></span><br></pre></td></tr></table></figure>

<h3 id="Âç∏ËΩΩÁ®ãÂ∫è"><a href="#Âç∏ËΩΩÁ®ãÂ∫è" class="headerlink" title="Âç∏ËΩΩÁ®ãÂ∫è"></a>Âç∏ËΩΩÁ®ãÂ∫è</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove &lt;ËΩØ‰ª∂Âêç&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="‚öôÔ∏è-ÊúçÂä°‰∏éÂêØÂä®È°πÁÆ°ÁêÜ"><a href="#‚öôÔ∏è-ÊúçÂä°‰∏éÂêØÂä®È°πÁÆ°ÁêÜ" class="headerlink" title="‚öôÔ∏è ÊúçÂä°‰∏éÂêØÂä®È°πÁÆ°ÁêÜ"></a>‚öôÔ∏è ÊúçÂä°‰∏éÂêØÂä®È°πÁÆ°ÁêÜ</h2><h3 id="Êü•ÁúãÊúçÂä°Áä∂ÊÄÅÔºàsystemctl-‚Üí-system-controlÔºâ"><a href="#Êü•ÁúãÊúçÂä°Áä∂ÊÄÅÔºàsystemctl-‚Üí-system-controlÔºâ" class="headerlink" title="Êü•ÁúãÊúçÂä°Áä∂ÊÄÅÔºàsystemctl ‚Üí system controlÔºâ"></a>Êü•ÁúãÊúçÂä°Áä∂ÊÄÅÔºàsystemctl ‚Üí system controlÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status mysql</span><br></pre></td></tr></table></figure>

<h3 id="ÂêØÂä®-ÂÅúÊ≠¢-ÈáçÂêØÊúçÂä°"><a href="#ÂêØÂä®-ÂÅúÊ≠¢-ÈáçÂêØÊúçÂä°" class="headerlink" title="ÂêØÂä® &#x2F; ÂÅúÊ≠¢ &#x2F; ÈáçÂêØÊúçÂä°"></a>ÂêØÂä® &#x2F; ÂÅúÊ≠¢ &#x2F; ÈáçÂêØÊúçÂä°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart redis</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üåê-ÁΩëÁªúÁõ∏ÂÖ≥"><a href="#üåê-ÁΩëÁªúÁõ∏ÂÖ≥" class="headerlink" title="üåê ÁΩëÁªúÁõ∏ÂÖ≥"></a>üåê ÁΩëÁªúÁõ∏ÂÖ≥</h2><h3 id="Êü•Áúã-IP-Âú∞ÂùÄ"><a href="#Êü•Áúã-IP-Âú∞ÂùÄ" class="headerlink" title="Êü•Áúã IP Âú∞ÂùÄ"></a>Êü•Áúã IP Âú∞ÂùÄ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip a           <span class="comment"># Êü•ÁúãËØ¶ÁªÜ IP ‰ø°ÊÅØ</span></span><br><span class="line">hostname -I    <span class="comment"># Âø´ÈÄüÊü•Áúã‰∏ªÊú∫ IP</span></span><br></pre></td></tr></table></figure>

<h3 id="ÊµãËØïÁΩëÁªúËøûÊé•"><a href="#ÊµãËØïÁΩëÁªúËøûÊé•" class="headerlink" title="ÊµãËØïÁΩëÁªúËøûÊé•"></a>ÊµãËØïÁΩëÁªúËøûÊé•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br><span class="line">curl -I https://google.com</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="‚úÖ-Êé®ËçêÂ∑•ÂÖ∑Ê±áÊÄª"><a href="#‚úÖ-Êé®ËçêÂ∑•ÂÖ∑Ê±áÊÄª" class="headerlink" title="‚úÖ Êé®ËçêÂ∑•ÂÖ∑Ê±áÊÄª"></a>‚úÖ Êé®ËçêÂ∑•ÂÖ∑Ê±áÊÄª</h2><table>
<thead>
<tr>
<th>Â∑•ÂÖ∑</th>
<th>ÂëΩ‰ª§</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td>htop</td>
<td><code>sudo apt install htop</code></td>
<td>ËøõÁ®ãÊü•ÁúãÂô®ÔºåÊõø‰ª£ top</td>
</tr>
<tr>
<td>ncdu</td>
<td><code>sudo apt install ncdu</code></td>
<td>ÂõæÂΩ¢ÂåñÊü•ÁúãÁõÆÂΩïÂ§ßÂ∞è</td>
</tr>
<tr>
<td>tree</td>
<td><code>sudo apt install tree</code></td>
<td>‰ª•Ê†ëÂΩ¢ÁªìÊûÑÊòæÁ§∫ÁõÆÂΩï</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>Êú¨ÊñáÁî± ChatGPT Êï¥ÁêÜÁîüÊàêÔºåÈÄÇÂêàÂàù‰∏≠È´òÁ∫ß Linux ‰ΩøÁî®ËÄÖÁ±ªÊØî Windows ÁÜüÁªÉÊéåÊè°Á≥ªÁªüÂ∏∏ËßÅÊìç‰Ωú„ÄÇ</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/12/tech/vmware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/12/tech/vmware/" class="post-title-link" itemprop="url">VMware</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-12T00:00:00+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h2 id="üß±-‰∏Ä„ÄÅÂÆâË£ÖËôöÊãüÊú∫"><a href="#üß±-‰∏Ä„ÄÅÂÆâË£ÖËôöÊãüÊú∫" class="headerlink" title="üß± ‰∏Ä„ÄÅÂÆâË£ÖËôöÊãüÊú∫"></a>üß± ‰∏Ä„ÄÅÂÆâË£ÖËôöÊãüÊú∫</h2><p>‰Ω†ÈÄâÊã©‰ΩøÁî® <strong>VMware Workstation Pro</strong>ÔºàÁé∞Â∑≤ÂÖçË¥πÔºâÔºå‰Ωú‰∏∫ËøêË°åËôöÊãüÁ≥ªÁªüÁöÑÂ∑•ÂÖ∑Ôºö</p>
<ul>
<li>‚úÖ VMware ÊòØ‰∏Ä‰∏™ÂäüËÉΩÂÖ®Èù¢ÁöÑËôöÊãüÊú∫ÁÆ°ÁêÜÂπ≥Âè∞</li>
<li>‚úÖ ÊîØÊåÅÂÆâË£ÖÂú® D ÁõòÔºà‰Ω†Â∑≤ÁªèÂÆåÊàêÔºâ</li>
<li>‚úÖ ËôöÊãüÁ≥ªÁªüÔºàÂ¶Ç UbuntuÔºâÁöÑÈïúÂÉèÂíåÊñá‰ª∂ÂèØ‰ª•Áã¨Á´ãÊîæÁΩÆÔºàÂ¶Ç D:\VMs\Ubuntu18-devÔºâ</li>
<li>‚úÖ ÊàêÂäü‰ªé <a target="_blank" rel="noopener" href="https://releases.ubuntu.com/">Ubuntu Releases</a> ‰∏ãËΩΩÂπ∂‰ΩøÁî® ISO ÂÆâË£Ö Ubuntu 18.04</li>
</ul>
<hr>
<h2 id="‚öôÔ∏è-‰∫å„ÄÅËôöÊãüÊú∫ÈÖçÁΩÆ"><a href="#‚öôÔ∏è-‰∫å„ÄÅËôöÊãüÊú∫ÈÖçÁΩÆ" class="headerlink" title="‚öôÔ∏è ‰∫å„ÄÅËôöÊãüÊú∫ÈÖçÁΩÆ"></a>‚öôÔ∏è ‰∫å„ÄÅËôöÊãüÊú∫ÈÖçÁΩÆ</h2><p>‰Ω†ÂÆåÊàêÂπ∂‰∫ÜËß£‰∫Ü‰ª•‰∏ãÈÖçÁΩÆÊìç‰ΩúÔºö</p>
<ul>
<li>‚úÖ ÂÆâË£Ö Ubuntu 18.04 Á≥ªÁªüÔºåÂπ∂‰∫ÜËß£ËôöÊãüÁ°¨‰ª∂ÔºàCPU„ÄÅÂÜÖÂ≠ò„ÄÅÁ£ÅÁõòÁ≠âÔºâÈÖçÁΩÆÂª∫ËÆÆÔºö<ul>
<li>‰Ω†Êú¨Êú∫‰∏∫ 8 Ê†∏ÔºåËôöÊãüÊú∫ÂàÜÈÖç 2~4 Ê†∏ËæÉ‰∏∫ÂêàÁêÜ</li>
</ul>
</li>
<li>‚úÖ ÂÆâË£Ö VMware ToolsÔºåÂÆûÁé∞ÂàÜËæ®ÁéáËá™ÈÄÇÂ∫î„ÄÅÊãñÊãΩÂ§çÂà∂„ÄÅÂÖ±‰∫´Ââ™Ë¥¥ÊùøÁ≠â</li>
<li>‚úÖ Â≠¶‰ºö‰ΩøÁî® GUI ËÆæÁΩÆÂõæÊ†áÂ§ßÂ∞è„ÄÅÂêØÁî® fractional scaling ÊîπÂèò UI Áº©ÊîæÊØî‰æã</li>
<li>‚úÖ Â≠¶‰ºöÂÆâÂÖ®ÂÖ≥Êú∫Âíå‰øÆÊîπËôöÊãüÊú∫ CPU ÈÖçÁΩÆÔºàÈúÄÂÖ≥Êú∫ÂêéËÆæÁΩÆÔºâ</li>
</ul>
<hr>
<h2 id="üë§-‰∏â„ÄÅLinux-Á≥ªÁªüÁî®Êà∑ÈóÆÈ¢ò"><a href="#üë§-‰∏â„ÄÅLinux-Á≥ªÁªüÁî®Êà∑ÈóÆÈ¢ò" class="headerlink" title="üë§ ‰∏â„ÄÅLinux Á≥ªÁªüÁî®Êà∑ÈóÆÈ¢ò"></a>üë§ ‰∏â„ÄÅLinux Á≥ªÁªüÁî®Êà∑ÈóÆÈ¢ò</h2><p>‰Ω†ÊèêÂá∫‰∫ÜÈùûÂ∏∏Ê†∏ÂøÉÁöÑÈóÆÈ¢òÔºåÁêÜËß£‰∫Ü Linux ‰∏é Windows Âú®Áî®Êà∑ÁÆ°ÁêÜ‰∏äÁöÑÂ∑ÆÂºÇÔºö</p>
<ul>
<li>‚úÖ ÊØè‰∏™Áî®Êà∑ÈÉΩÊúâÁã¨Á´ãÁöÑ home ÁõÆÂΩïÔºàÂ¶Ç <code>/home/ypy</code>Ôºâ</li>
<li>‚úÖ ÊôÆÈÄöÁî®Êà∑ÈúÄ‰ΩøÁî® <code>sudo</code> Êù•ÊâßË°åÁ≥ªÁªüÁ∫ß‰ªªÂä°ÔºàÂ¶ÇÂÆâË£ÖËΩØ‰ª∂Ôºâ</li>
<li>‚úÖ root ÊòØÊúÄÈ´òÊùÉÈôêÁî®Êà∑Ôºå‰ΩÜ Ubuntu ÈªòËÆ§Á¶ÅÁî® root ÂØÜÁ†ÅÔºåÊé®Ëçê‰ΩøÁî® <code>sudo -i</code> ËøõÂÖ• root shell</li>
<li>‚úÖ ‰ΩøÁî® <code>whoami</code>, <code>id</code>, <code>cat /etc/passwd</code> Êù•Êü•ÁúãÁî®Êà∑‰ø°ÊÅØ</li>
<li>‚úÖ ËΩØ‰ª∂ÂÆâË£ÖÈÄöÂ∏∏ÊòØ‚ÄúÂÖ®Â±Ä‰∏ÄÊ¨°ÂÆâË£ÖÔºåÊâÄÊúâÁî®Êà∑ÂÖ±‰∫´‚ÄùÔºåÈùûÊØè‰∫∫ÂÆâË£Ö‰∏Ä‰ªΩ</li>
</ul>
<hr>
<h2 id="üìÅ-Âõõ„ÄÅLinux-Á≥ªÁªüÂ∏∏Áî®ÔºàÈáçË¶ÅÔºâÊñá‰ª∂Â§π"><a href="#üìÅ-Âõõ„ÄÅLinux-Á≥ªÁªüÂ∏∏Áî®ÔºàÈáçË¶ÅÔºâÊñá‰ª∂Â§π" class="headerlink" title="üìÅ Âõõ„ÄÅLinux Á≥ªÁªüÂ∏∏Áî®ÔºàÈáçË¶ÅÔºâÊñá‰ª∂Â§π"></a>üìÅ Âõõ„ÄÅLinux Á≥ªÁªüÂ∏∏Áî®ÔºàÈáçË¶ÅÔºâÊñá‰ª∂Â§π</h2><p>‰Ω†Â§ç‰π†Âπ∂ÁêÜËß£‰∫Ü Linux Êñá‰ª∂Á≥ªÁªüÁöÑÊ†ëÁä∂ÁªìÊûÑÔºå‰ª• <code>/</code> ‰∏∫Ê†πÔºö</p>
<table>
<thead>
<tr>
<th>ÁõÆÂΩï</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td><code>/home</code></td>
<td>Áî®Êà∑‰∏ªÁõÆÂΩïÔºåÂºÄÂèëËÄÖÊó•Â∏∏‰ΩøÁî®Âå∫Âüü</td>
</tr>
<tr>
<td><code>/usr/bin</code></td>
<td>ÂèØÊâßË°åÁ®ãÂ∫è‰ΩçÁΩÆ</td>
</tr>
<tr>
<td><code>/etc</code></td>
<td>ÈÖçÁΩÆÊñá‰ª∂‰ΩçÁΩÆ</td>
</tr>
<tr>
<td><code>/var/lib</code></td>
<td>Â∫îÁî®Êï∞ÊçÆÔºàÂ¶ÇÊï∞ÊçÆÂ∫ìÔºâ</td>
</tr>
<tr>
<td><code>/tmp</code></td>
<td>‰∏¥Êó∂Êñá‰ª∂</td>
</tr>
<tr>
<td><code>/root</code></td>
<td>root Áî®Êà∑ÁöÑ home ÁõÆÂΩï</td>
</tr>
<tr>
<td><code>/opt</code></td>
<td>ÂèØÈÄâÂÆâË£ÖÁõÆÂΩïÔºàÁ¨¨‰∏âÊñπÁ®ãÂ∫èÔºâ</td>
</tr>
</tbody></table>
<p>‰Ω†‰πüÂ≠¶‰ºö‰∫ÜÂú® <strong>ÂõæÂΩ¢ÁïåÈù¢‰∏≠ËÆøÈóÆÊ†πÁõÆÂΩï</strong>ÔºàÁÇπÂáª‚ÄúÂÖ∂‰ªñ‰ΩçÁΩÆ‚Äù ‚Üí ‚ÄúComputer‚ÄùÔºâ„ÄÇ</p>
<hr>
<h2 id="üß∞-‰∫î„ÄÅLinux-ÂÆâË£ÖËΩØ‰ª∂ÈóÆÈ¢ò"><a href="#üß∞-‰∫î„ÄÅLinux-ÂÆâË£ÖËΩØ‰ª∂ÈóÆÈ¢ò" class="headerlink" title="üß∞ ‰∫î„ÄÅLinux ÂÆâË£ÖËΩØ‰ª∂ÈóÆÈ¢ò"></a>üß∞ ‰∫î„ÄÅLinux ÂÆâË£ÖËΩØ‰ª∂ÈóÆÈ¢ò</h2><p>‰Ω†ÈùûÂ∏∏Ê∑±ÂÖ•Âú∞Êé¢ËÆ®‰∫Ü Ubuntu Â¶Ç‰ΩïÈÅøÂÖç Windows ‰∏≠‚ÄúÂç∏ËΩΩ‰∏çÂπ≤ÂáÄ‚ÄùÁöÑÈóÆÈ¢òÔºåÂπ∂ÁêÜËß£‰∫ÜÔºö</p>
<ul>
<li><p>‚úÖ Ubuntu ‰ΩøÁî® <code>apt</code> ÂåÖÁÆ°ÁêÜÂô®ËøõË°åËΩØ‰ª∂ÂÆâË£Ö‰∏éÂç∏ËΩΩ</p>
</li>
<li><p>‚úÖ ÊâÄÊúâÁ®ãÂ∫è‰ºöÁªü‰∏ÄË£ÖÂÖ•Ê†áÂáÜÁõÆÂΩïÔºàÊó†‰π±Êîæ„ÄÅÊó†Ê≥®ÂÜåË°®Ôºâ</p>
</li>
<li><p>‚úÖ Âç∏ËΩΩËΩØ‰ª∂ÂèØ‰ª•‰ΩøÁî®Ôºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove ËΩØ‰ª∂Âêç      <span class="comment"># Âç∏ËΩΩÁ®ãÂ∫è‰ΩÜ‰øùÁïôÈÖçÁΩÆ</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge ËΩØ‰ª∂Âêç       <span class="comment"># ËøûÈÖçÁΩÆ‰∏ÄÂπ∂Ê∏ÖÈô§</span></span><br><span class="line"><span class="built_in">sudo</span> apt autoremove         <span class="comment"># Ê∏ÖÈô§Êó†Áî®‰æùËµñ</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>‚úÖ ‰Ω†‰∫≤ÊâãÂÆåÊàê‰∫ÜÔºö</p>
<ul>
<li>Âç∏ËΩΩ Firefox</li>
<li>ÂÆâË£Ö Google ChromeÔºàÈÄöËøáÂÆòÁΩë <code>.deb</code> ÂÆâË£ÖÂåÖÊàñ <code>wget + dpkg</code>Ôºâ</li>
</ul>
</li>
</ul>
<hr>
<h2 id="üîß-ÂÖ≠„ÄÅÈÖçÁΩÆ-GitÔºàËøûÊé•-GitHubÔºâ"><a href="#üîß-ÂÖ≠„ÄÅÈÖçÁΩÆ-GitÔºàËøûÊé•-GitHubÔºâ" class="headerlink" title="üîß ÂÖ≠„ÄÅÈÖçÁΩÆ GitÔºàËøûÊé• GitHubÔºâ"></a>üîß ÂÖ≠„ÄÅÈÖçÁΩÆ GitÔºàËøûÊé• GitHubÔºâ</h2><p>‰Ω†ÁêÜËß£‰∫ÜËøúÁ®ãÂºÄÂèë‰∏≠ Git ÁöÑÈáçË¶ÅÊÄßÔºåÂπ∂Âú®ËôöÊãüÊú∫‰∏≠ÂÆåÊàê‰∫Ü‰ª•‰∏ãÈÖçÁΩÆÔºö</p>
<ul>
<li><p>‚úÖ ÂÆâË£Ö GitÔºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install git</span><br></pre></td></tr></table></figure>
</li>
<li><p>‚úÖ ËÆæÁΩÆ Git Áî®Êà∑‰ø°ÊÅØÔºàÊèê‰∫§Áî®ÔºâÔºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;peiyouyao&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;peiyouyao@gmail.com&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>‚úÖ ÁîüÊàê SSH ÂØÜÈí•ÂØπÔºàed25519ÔºâÔºåÁî®‰∫éËøûÊé• GitHubÔºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;‰Ω†ÁöÑÈÇÆÁÆ±&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>‚úÖ ÊàêÂäüÂ∞ÜÂÖ¨Èí•Ê∑ªÂä†Âà∞ GitHubÔºàSettings ‚Üí SSH KeysÔºâ</p>
</li>
<li><p>‚úÖ ÊµãËØïËøûÊé•ÊàêÂäüÔºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>‚úÖ ÊîØÊåÅÂú®ËôöÊãüÊú∫‰∏≠‰ΩøÁî® SSH ÂÖãÈöÜ„ÄÅÊèê‰∫§„ÄÅÊé®ÈÄÅ GitHub ‰ªìÂ∫ì</p>
</li>
</ul>
<h2 id="ÂÆâË£ÖSSHÊúçÂä°"><a href="#ÂÆâË£ÖSSHÊúçÂä°" class="headerlink" title="ÂÆâË£ÖSSHÊúçÂä°"></a>ÂÆâË£ÖSSHÊúçÂä°</h2><table>
<thead>
<tr>
<th>Ê≠•È™§</th>
<th>ÂëΩ‰ª§ÔºàÂú®ËôöÊãüÊú∫‰∏≠Ôºâ</th>
</tr>
</thead>
<tbody><tr>
<td>Ê£ÄÊü• IP</td>
<td><code>ip a</code></td>
</tr>
<tr>
<td>ÂÆâË£Ö SSH ÊúçÂä°</td>
<td><code>sudo apt install openssh-server</code></td>
</tr>
<tr>
<td>ÂêØÂä®ÊúçÂä°</td>
<td><code>sudo systemctl start ssh</code></td>
</tr>
<tr>
<td>ËÆæÁΩÆÂºÄÊú∫ÂêØÂä®</td>
<td><code>sudo systemctl enable ssh</code></td>
</tr>
<tr>
<td>Ê£ÄÊü•Áä∂ÊÄÅ</td>
<td><code>sudo systemctl status ssh</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/12/tech/wsl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/12/tech/wsl/" class="post-title-link" itemprop="url">WSL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-12T00:00:00+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="üêß-WSL-ÂÆâË£Ö‰∏éÈÖçÁΩÆÁ¨îËÆ∞"><a href="#üêß-WSL-ÂÆâË£Ö‰∏éÈÖçÁΩÆÁ¨îËÆ∞" class="headerlink" title="üêß WSL ÂÆâË£Ö‰∏éÈÖçÁΩÆÁ¨îËÆ∞"></a>üêß WSL ÂÆâË£Ö‰∏éÈÖçÁΩÆÁ¨îËÆ∞</h1><hr>
<h2 id="‚úÖ-‰∏Ä„ÄÅWSL-ÁöÑÂÆâË£Ö‰∏éËØ¥Êòé"><a href="#‚úÖ-‰∏Ä„ÄÅWSL-ÁöÑÂÆâË£Ö‰∏éËØ¥Êòé" class="headerlink" title="‚úÖ ‰∏Ä„ÄÅWSL ÁöÑÂÆâË£Ö‰∏éËØ¥Êòé"></a>‚úÖ ‰∏Ä„ÄÅWSL ÁöÑÂÆâË£Ö‰∏éËØ¥Êòé</h2><h3 id="üìå-‰∏∫‰ªÄ‰πà‰ΩøÁî®-WSLÔºö"><a href="#üìå-‰∏∫‰ªÄ‰πà‰ΩøÁî®-WSLÔºö" class="headerlink" title="üìå ‰∏∫‰ªÄ‰πà‰ΩøÁî® WSLÔºö"></a>üìå ‰∏∫‰ªÄ‰πà‰ΩøÁî® WSLÔºö</h3><ul>
<li>ÂÆòÊñπÈõÜÊàêÔºåËµÑÊ∫êËΩªÔºåÂç†Áî®Â∞ëÔºåÂêØÂä®Âø´</li>
<li>ÂÖºÂÆπÂ§ßÈÉ®ÂàÜ Linux ÂëΩ‰ª§„ÄÅÂºÄÂèëÂ∑•ÂÖ∑</li>
<li>ÊîØÊåÅ GUIÔºàWSLgÔºâÔºåÂèØËøêË°å Linux ÂõæÂΩ¢Á®ãÂ∫è</li>
<li>ÂèØÁõ¥Êé•ËÆøÈóÆ Windows Êñá‰ª∂Á≥ªÁªüÔºà<code>/mnt/c/...</code>Ôºâ</li>
</ul>
<h3 id="üì¶-ÂÆâË£ÖÂëΩ‰ª§ÔºàÁÆ°ÁêÜÂëò-PowerShellÔºâÔºö"><a href="#üì¶-ÂÆâË£ÖÂëΩ‰ª§ÔºàÁÆ°ÁêÜÂëò-PowerShellÔºâÔºö" class="headerlink" title="üì¶ ÂÆâË£ÖÂëΩ‰ª§ÔºàÁÆ°ÁêÜÂëò PowerShellÔºâÔºö"></a>üì¶ ÂÆâË£ÖÂëΩ‰ª§ÔºàÁÆ°ÁêÜÂëò PowerShellÔºâÔºö</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--install</span></span><br></pre></td></tr></table></figure>

<p>ÈªòËÆ§ÂÆâË£Ö UbuntuÔºàÊúÄÊñ∞ÁâàÔºâ+ WSL2 Âπ≥Âè∞„ÄÇ</p>
<hr>
<h2 id="‚úÖ-‰∫å„ÄÅÂÆâË£Ö-Ubuntu-ËôöÊãüÊú∫Ëá≥-D-Áõò"><a href="#‚úÖ-‰∫å„ÄÅÂÆâË£Ö-Ubuntu-ËôöÊãüÊú∫Ëá≥-D-Áõò" class="headerlink" title="‚úÖ ‰∫å„ÄÅÂÆâË£Ö Ubuntu ËôöÊãüÊú∫Ëá≥ D Áõò"></a>‚úÖ ‰∫å„ÄÅÂÆâË£Ö Ubuntu ËôöÊãüÊú∫Ëá≥ D Áõò</h2><blockquote>
<p>‰∏∫ËäÇÁúÅÁ©∫Èó¥ÔºåÈÅøÂÖçÈªòËÆ§ÂÆâË£ÖÂú® C:\Users\AppData</p>
</blockquote>
<h3 id="üß©-Ê≠•È™§Ôºö"><a href="#üß©-Ê≠•È™§Ôºö" class="headerlink" title="üß© Ê≠•È™§Ôºö"></a>üß© Ê≠•È™§Ôºö</h3><ol>
<li>‰∏ãËΩΩ Ubuntu Appx ÂÆâË£ÖÂåÖÔºö<ul>
<li><a target="_blank" rel="noopener" href="https://aka.ms/wslubuntu2004">https://aka.ms/wslubuntu2004</a></li>
</ul>
</li>
<li>Ëß£ÂéãÂπ∂ÊâãÂä®Ê≥®ÂÜåÔºö</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Â∞Ü .appx ÊîπÂêç‰∏∫ .zip Âπ∂Ëß£Âéã</span></span><br><span class="line">Rename-Item .\Ubuntu_*.appx ubuntu.zip</span><br><span class="line">Expand-Archive .\ubuntu.zip .\</span><br><span class="line">.\ubuntu.exe</span><br></pre></td></tr></table></figure>

<p>ËÆæÁΩÆÁî®Êà∑ÂêçÂØÜÁ†ÅÔºåÂç≥ÂàùÂßãÂåñÊàêÂäü„ÄÇ</p>
<hr>
<h2 id="‚úÖ-‰∏â„ÄÅWSL-ËôöÊãüÊú∫ÂàùÂßãÂåñÈÖçÁΩÆÔºàÊé®ËçêÂÆâË£ÖËÑöÊú¨Ôºâ"><a href="#‚úÖ-‰∏â„ÄÅWSL-ËôöÊãüÊú∫ÂàùÂßãÂåñÈÖçÁΩÆÔºàÊé®ËçêÂÆâË£ÖËÑöÊú¨Ôºâ" class="headerlink" title="‚úÖ ‰∏â„ÄÅWSL ËôöÊãüÊú∫ÂàùÂßãÂåñÈÖçÁΩÆÔºàÊé®ËçêÂÆâË£ÖËÑöÊú¨Ôºâ"></a>‚úÖ ‰∏â„ÄÅWSL ËôöÊãüÊú∫ÂàùÂßãÂåñÈÖçÁΩÆÔºàÊé®ËçêÂÆâË£ÖËÑöÊú¨Ôºâ</h2><h3 id="‚öôÔ∏è-Êõ¥Êñ∞-Âü∫Á°ÄÂ∑•ÂÖ∑ÂÆâË£ÖÔºö"><a href="#‚öôÔ∏è-Êõ¥Êñ∞-Âü∫Á°ÄÂ∑•ÂÖ∑ÂÆâË£ÖÔºö" class="headerlink" title="‚öôÔ∏è Êõ¥Êñ∞ &amp; Âü∫Á°ÄÂ∑•ÂÖ∑ÂÆâË£ÖÔºö"></a>‚öôÔ∏è Êõ¥Êñ∞ &amp; Âü∫Á°ÄÂ∑•ÂÖ∑ÂÆâË£ÖÔºö</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y git curl wget unzip vim net-tools htop</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="‚úÖ-Âõõ„ÄÅGit-SSH-ÈÖçÁΩÆ"><a href="#‚úÖ-Âõõ„ÄÅGit-SSH-ÈÖçÁΩÆ" class="headerlink" title="‚úÖ Âõõ„ÄÅGit + SSH ÈÖçÁΩÆ"></a>‚úÖ Âõõ„ÄÅGit + SSH ÈÖçÁΩÆ</h2><h3 id="1Ô∏è‚É£-Git-ÂÆâË£Ö‰∏éÂÖ®Â±ÄÈÖçÁΩÆÔºö"><a href="#1Ô∏è‚É£-Git-ÂÆâË£Ö‰∏éÂÖ®Â±ÄÈÖçÁΩÆÔºö" class="headerlink" title="1Ô∏è‚É£ Git ÂÆâË£Ö‰∏éÂÖ®Â±ÄÈÖçÁΩÆÔºö"></a>1Ô∏è‚É£ Git ÂÆâË£Ö‰∏éÂÖ®Â±ÄÈÖçÁΩÆÔºö</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install git -y</span><br><span class="line"></span><br><span class="line">git config --global user.name <span class="string">&quot;xxx&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line">git config --global core.editor <span class="string">&quot;vim&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2Ô∏è‚É£-SSH-ÂØÜÈí•ÁîüÊàê‰∏éÈÖçÁΩÆÔºö"><a href="#2Ô∏è‚É£-SSH-ÂØÜÈí•ÁîüÊàê‰∏éÈÖçÁΩÆÔºö" class="headerlink" title="2Ô∏è‚É£ SSH ÂØÜÈí•ÁîüÊàê‰∏éÈÖçÁΩÆÔºö"></a>2Ô∏è‚É£ SSH ÂØÜÈí•ÁîüÊàê‰∏éÈÖçÁΩÆÔºö</h3><h4 id="ÁîüÊàê-SSH-ÂØÜÈí•ÔºàÊú¨Âú∞Âíå-WSL-ÂêÑËá™ÁîüÊàêÔºâÔºö"><a href="#ÁîüÊàê-SSH-ÂØÜÈí•ÔºàÊú¨Âú∞Âíå-WSL-ÂêÑËá™ÁîüÊàêÔºâÔºö" class="headerlink" title="ÁîüÊàê SSH ÂØÜÈí•ÔºàÊú¨Âú∞Âíå WSL ÂêÑËá™ÁîüÊàêÔºâÔºö"></a>ÁîüÊàê SSH ÂØÜÈí•ÔºàÊú¨Âú∞Âíå WSL ÂêÑËá™ÁîüÊàêÔºâÔºö</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>ÊåâÊèêÁ§∫‰∏ÄË∑ØÂõûËΩ¶ÔºåÈªòËÆ§‰øùÂ≠òÂú®Ôºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/.ssh/id_ed25519</span><br><span class="line">~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>

<h4 id="Â∞ÜÂÖ¨Èí•Ê∑ªÂä†Âà∞-GitHubÔºö"><a href="#Â∞ÜÂÖ¨Èí•Ê∑ªÂä†Âà∞-GitHubÔºö" class="headerlink" title="Â∞ÜÂÖ¨Èí•Ê∑ªÂä†Âà∞ GitHubÔºö"></a>Â∞ÜÂÖ¨Èí•Ê∑ªÂä†Âà∞ GitHubÔºö</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>

<p>Â§çÂà∂Á≤òË¥¥Ëá≥ GitHub ‚Üí <code>Settings &gt; SSH and GPG Keys &gt; New Key</code></p>
<hr>
<h3 id="3Ô∏è‚É£-Âú®-Windows-‰∏ªÊú∫ÈÖçÁΩÆ-SSH-ËøûÊé•-Ubuntu-ËôöÊãüÊú∫"><a href="#3Ô∏è‚É£-Âú®-Windows-‰∏ªÊú∫ÈÖçÁΩÆ-SSH-ËøûÊé•-Ubuntu-ËôöÊãüÊú∫" class="headerlink" title="3Ô∏è‚É£ Âú® Windows ‰∏ªÊú∫ÈÖçÁΩÆ SSH ËøûÊé• Ubuntu ËôöÊãüÊú∫"></a>3Ô∏è‚É£ Âú® Windows ‰∏ªÊú∫ÈÖçÁΩÆ SSH ËøûÊé• Ubuntu ËôöÊãüÊú∫</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÁºñËæë C:\Users\&lt;‰Ω†&gt;\.ssh\config</span></span><br><span class="line">Host ubuntu-wsl</span><br><span class="line">    HostName 172.27.xxx.xxx         <span class="comment"># Áî® `ip addr show eth0` Ëé∑Âèñ</span></span><br><span class="line">    User ypy</span><br><span class="line">    IdentityFile C:/Users/&lt;‰Ω†&gt;/.ssh/id_ed25519</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="‚úÖ-‰∫î„ÄÅËøúÁ®ã-VSCode-ÂºÄÂèëÊé®ËçêÂÅöÊ≥ï"><a href="#‚úÖ-‰∫î„ÄÅËøúÁ®ã-VSCode-ÂºÄÂèëÊé®ËçêÂÅöÊ≥ï" class="headerlink" title="‚úÖ ‰∫î„ÄÅËøúÁ®ã VSCode ÂºÄÂèëÊé®ËçêÂÅöÊ≥ï"></a>‚úÖ ‰∫î„ÄÅËøúÁ®ã VSCode ÂºÄÂèëÊé®ËçêÂÅöÊ≥ï</h2><ul>
<li>ÂÆâË£Ö VSCode</li>
<li>ÂÆâË£ÖÊâ©Â±ïÔºö<code>Remote - SSH</code> + <code>WSL</code></li>
<li>Áî® <code>ssh ubuntu-wsl</code> ÊµãËØïËøûÊé•</li>
<li>ÊàêÂäüËøûÊé•ÂêéÔºå‰ΩøÁî® VSCode ÁöÑ Remote SSH Ëá™Âä®ÂêåÊ≠•ÂºÄÂèëÁéØÂ¢É</li>
</ul>
<hr>
<h2 id="‚úÖ-ÂÖ≠„ÄÅSSH-ÊúçÂä°ÂêØÂä®ÂëΩ‰ª§Ôºà‰∏ç‰ΩøÁî®-systemctlÔºâ"><a href="#‚úÖ-ÂÖ≠„ÄÅSSH-ÊúçÂä°ÂêØÂä®ÂëΩ‰ª§Ôºà‰∏ç‰ΩøÁî®-systemctlÔºâ" class="headerlink" title="‚úÖ ÂÖ≠„ÄÅSSH ÊúçÂä°ÂêØÂä®ÂëΩ‰ª§Ôºà‰∏ç‰ΩøÁî® systemctlÔºâ"></a>‚úÖ ÂÖ≠„ÄÅSSH ÊúçÂä°ÂêØÂä®ÂëΩ‰ª§Ôºà‰∏ç‰ΩøÁî® systemctlÔºâ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install openssh-server -y</span><br><span class="line"><span class="built_in">sudo</span> service ssh start    <span class="comment"># ÂêØÂä® sshd</span></span><br><span class="line">ps -ef | grep sshd        <span class="comment"># Êü•ÁúãÊúçÂä°Áä∂ÊÄÅ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="üìÅ-ÈôÑÔºöÂ∏∏Áî®Ë∑ØÂæÑÂ∞èÊäÑ"><a href="#üìÅ-ÈôÑÔºöÂ∏∏Áî®Ë∑ØÂæÑÂ∞èÊäÑ" class="headerlink" title="üìÅ ÈôÑÔºöÂ∏∏Áî®Ë∑ØÂæÑÂ∞èÊäÑ"></a>üìÅ ÈôÑÔºöÂ∏∏Áî®Ë∑ØÂæÑÂ∞èÊäÑ</h2><table>
<thead>
<tr>
<th>Ë∑ØÂæÑ</th>
<th>Áî®ÈÄî</th>
</tr>
</thead>
<tbody><tr>
<td><code>~/.ssh/authorized_keys</code></td>
<td>Â≠òÂÇ®ÂÖÅËÆ∏ÁôªÂΩïÁöÑÂÖ¨Èí•</td>
</tr>
<tr>
<td><code>/mnt/c/...</code></td>
<td>ËÆøÈóÆ Windows C Áõò</td>
</tr>
<tr>
<td><code>\\wsl$\Ubuntu</code></td>
<td>Windows ËÆøÈóÆ Linux Êñá‰ª∂Á≥ªÁªü</td>
</tr>
<tr>
<td><code>~/WorkStation/...</code></td>
<td>‰Ω†ÁöÑÂºÄÂèëÂ∑•‰ΩúÂå∫ÁõÆÂΩï</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/01/tech/rpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/01/tech/rpc/" class="post-title-link" itemprop="url">PyRPC Framework</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-02-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-02-01T00:00:00+08:00">2025-02-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<blockquote>
<p>In this blog, I will give an elaborate instruction to the process of how to construct a whole RPC framework with Java. </p>
<p>It is also a record of project <a target="_blank" rel="noopener" href="https://github.com/PerryYao-GitHub/demo-pyrpc">demo-pyrpc</a> and <a target="_blank" rel="noopener" href="https://github.com/PerryYao-GitHub/demo-rpc">demo-rpc</a>, the former one is an update on the last one.</p>
</blockquote>
<h1 id="pyRPC-Framework"><a href="#pyRPC-Framework" class="headerlink" title="pyRPC Framework"></a>pyRPC Framework</h1><h2 id="What-is-RPC"><a href="#What-is-RPC" class="headerlink" title="What is RPC?"></a>What is RPC?</h2><p>RPC (Remote Procedure Call) ËøúÁ®ãËøáÁ®ãË∞ÉÁî®, ÊòØ‰∏ÄÁßçËÆ°ÁÆóÊú∫ÈÄö‰ø°ÂçèËÆÆ, ÂÖÅËÆ∏Á®ãÂ∫èÂú®‰∏çÂêåËÆ°ÁÆóÊú∫‰πãÈó¥ÈÄö‰ø°Âíå‰∫§‰∫í, Â∞±ÂÉèÊú¨Âú∞Ë∞ÉÁî®‰∏ÄÊ†∑.</p>
<h2 id="Consumer-Provider-Model"><a href="#Consumer-Provider-Model" class="headerlink" title="Consumer &#x2F; Provider Model"></a>Consumer &#x2F; Provider Model</h2><p>RPC Ê°ÜÊû∂Êú¨Ë∫´‰∏çÊòØ‰∏Ä‰∏™Áã¨Á´ãËøêË°åÁöÑÊúçÂä°, ËÄåÊòØ‰∏Ä‰∏™Ë¢´ Consumer (Ë∞ÉÁî®Êñπ) Âíå Provider (ÊúçÂä°Êèê‰æõÊñπ) ÂºïÂÖ•ÁöÑÂ∫ì (SDK). RPC Ê°ÜÊû∂ÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØ‰∏∫ÂºÄÂèëËÄÖÊèê‰æõËøúÁ®ãÊúçÂä°Ë∞ÉÁî®ÁöÑËÉΩÂäõ; ÂêåÊó∂ÊäΩË±°ÁΩëÁªúÈÄö‰ø°, Â∫èÂàóÂåñ&#x2F;ÂèçÂ∫èÂàóÂåñÁ≠âÂ∫ïÂ±ÇÁªÜËäÇ. </p>
<p>RPC ÂÆåÊàêÈÄö‰ø°ÁöÑ‰∏ªË¶ÅËøáÁ®ã‰∏∫:</p>
<h3 id="ÂÖ±‰∫´Ê®°Âùó-common-example"><a href="#ÂÖ±‰∫´Ê®°Âùó-common-example" class="headerlink" title="ÂÖ±‰∫´Ê®°Âùó (common-example)"></a>ÂÖ±‰∫´Ê®°Âùó (common-example)</h3><ul>
<li>ÂÖ±‰∫´Ê®°Âùó (SDK), ‰∏çÂú®ÊúçÂä°Âô®‰∏äËøêË°å, ÁªôÂêÑ‰∏™ÂºÄÂèëÁªÑ‰ª∂Êèê‰æõËßÑËåÉÂåñÁöÑÊï∞ÊçÆÁ±ªÂûãÂíåÊé•Âè£</li>
<li>Êúâ‰∏§‰∏™ÂÆû‰ΩìÁ±ª: <code>User</code> and <code>Music</code>, Âê´ÊúâÂü∫Êú¨Êï∞ÊçÆÁ±ªÂûãÂíåÈõÜÂêàÊï∞ÊçÆÁ±ªÂûã</li>
<li>ËßÑÂÆö‰∏§‰∏™Êé•Âè£: <code>UserService</code> and <code>MusicService</code>, ÂåÖÂê´ <code>getUserById</code> and <code>getMusicById</code> ÊñπÊ≥ï</li>
</ul>
<h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><ul>
<li>ÈúÄÂºïÂÖ• common-example &amp; pyrpc</li>
<li>Ê®°ÊãüÊúçÂä°Ê∂àË¥πËÄÖ, ËøêË°åÂú®ÊúçÂä°Âô®‰∏ä</li>
</ul>
<h4 id="zero-ÂàùÂßãÂåñ-Consumer-Á´ØÈÖçÁΩÆ"><a href="#zero-ÂàùÂßãÂåñ-Consumer-Á´ØÈÖçÁΩÆ" class="headerlink" title=":zero:ÂàùÂßãÂåñ Consumer Á´ØÈÖçÁΩÆ"></a>:zero:ÂàùÂßãÂåñ Consumer Á´ØÈÖçÁΩÆ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RpcApplication.init();</span><br></pre></td></tr></table></figure>

<p>‰∏ªË¶ÅÊòØËØªÂèñ Consumer Á´ØÁöÑÈÖçÁΩÆ‰ø°ÊÅØ. </p>
<h4 id="one-Consumer-‰ΩøÁî®Âä®ÊÄÅ‰ª£ÁêÜÂ∑•ÂéÇ-ServiceProxyFactory-Ëé∑Âèñ‰ª£ÁêÜÂØπË±°"><a href="#one-Consumer-‰ΩøÁî®Âä®ÊÄÅ‰ª£ÁêÜÂ∑•ÂéÇ-ServiceProxyFactory-Ëé∑Âèñ‰ª£ÁêÜÂØπË±°" class="headerlink" title=":one:Consumer ‰ΩøÁî®Âä®ÊÄÅ‰ª£ÁêÜÂ∑•ÂéÇ ServiceProxyFactory Ëé∑Âèñ‰ª£ÁêÜÂØπË±°"></a>:one:Consumer ‰ΩøÁî®Âä®ÊÄÅ‰ª£ÁêÜÂ∑•ÂéÇ <code>ServiceProxyFactory</code> Ëé∑Âèñ‰ª£ÁêÜÂØπË±°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserService userService = ServiceProxyFactory.getProxy(UserService.class);</span><br></pre></td></tr></table></figure>

<p>ÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÂØπ <code>userService</code> ÂÉèÂú®Êú¨Âú∞‰∏ÄÊ†∑Ë∞ÉÁî®ÂÖ∂‰∏≠ÁöÑÊñπÊ≥ï.</p>
<p>ÂÖ∂‰∏≠ <code>ServiceProxyFactory</code> ÂÜÖÈÉ®Â≠òÂÇ®‰∫Ü <code>ServiceProxy</code> ÁöÑÂÆû‰æã (‰ΩøÁî® static ÁöÑÂçï‰æãÂ≠òÂÇ®, ÈÅøÂÖçËøáÂ§öÁöÑÂØπË±°ÂàõÂª∫). </p>
<h4 id="two-ServiceProxy-Â∏ÆÂä©-Consumer-ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÂ∞ÅË£Ö-ÂèëÈÄÅ-Âπ∂Êé•ÂèóÂìçÂ∫î"><a href="#two-ServiceProxy-Â∏ÆÂä©-Consumer-ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÂ∞ÅË£Ö-ÂèëÈÄÅ-Âπ∂Êé•ÂèóÂìçÂ∫î" class="headerlink" title=":two:ServiceProxy Â∏ÆÂä© Consumer ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÂ∞ÅË£Ö, ÂèëÈÄÅ, Âπ∂Êé•ÂèóÂìçÂ∫î"></a>:two:<code>ServiceProxy</code> Â∏ÆÂä© Consumer ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÂ∞ÅË£Ö, ÂèëÈÄÅ, Âπ∂Êé•ÂèóÂìçÂ∫î</h4><p>Âú® <code>ServiceProxy</code> ‰∏≠, ÊâßË°å‰∫Ü‰ª•‰∏ãÂÖ≥ÈîÆÂÜÖÂÆπ:</p>
<ol>
<li><p>Â∞ÜË∞ÉÁî®ËÄÖË∞ÉÁî®ÁöÑÊñπÊ≥ï, ‰º†ÂÖ•ÁöÑÂèÇÊï∞Â∞ÅË£ÖÊàêÊ†áÂáÜÂåñÁöÑ <code>RpcRequest rpcRequest</code></p>
</li>
<li><p>‰ΩøÁî®Â∫èÂàóÂåñÂô®Â∫èÂàóÂåñ <code>rpcRequest</code></p>
</li>
<li><p>Âêë Provider ÁöÑÁöÑ RPC ÊúçÂä°Á´ØÁÇπÂèëÈÄÅËØ∑Ê±Ç</p>
</li>
<li><p>ÂæÖËé∑Âèñ RPC ÁöÑÂìçÂ∫îÊï∞ÊçÆÂêé, ÂèçÂ∫èÂàóÂåñÂÆÉ, Â∞ÜÂÖ∂ËΩ¨ÂåñÊàê <code>RpcResponse rpcResponse</code>, Âπ∂ÊäΩÂèñÂÖ∂‰∏≠ÁöÑÊï∞ÊçÆÂ≠óÊÆµ (ËøôÊâçÊòØ Consumer ÁúüÊ≠£ÊÉ≥ÊãøÂà∞ÁöÑ‰∏úË•ø)</p>
</li>
</ol>
<h3 id="Provider-provider-example"><a href="#Provider-provider-example" class="headerlink" title="Provider (provider-example)"></a>Provider (provider-example)</h3><ul>
<li>ÈúÄÂºïÂÖ• common-example &amp; pyrpc</li>
<li>Ê®°ÊãüÊúçÂä°Êèê‰æõËÄÖ, ËøêË°åÂú®ÊúçÂä°Âô®‰∏ä</li>
<li>ÂÆÉÂÆûÁé∞‰∫ÜÂÖ±‰∫´Ê®°Âùó‰∏≠ÁöÑ <code>UserService</code> and <code>MusicService</code></li>
</ul>
<h4 id="zero-Provider-ÁöÑÂàùÂßãÂåñÊµÅÁ®ã"><a href="#zero-Provider-ÁöÑÂàùÂßãÂåñÊµÅÁ®ã" class="headerlink" title=":zero:Provider ÁöÑÂàùÂßãÂåñÊµÅÁ®ã"></a>:zero:Provider ÁöÑÂàùÂßãÂåñÊµÅÁ®ã</h4><ol>
<li><p>ËØªÂÖ•ÈÖçÁΩÆ‰ø°ÊÅØ</p>
</li>
<li><p>ÊääËá™Â∑±ÊÉ≥Êèê‰æõÁöÑÊúçÂä°Ê≥®ÂÜåÂà∞ <code>RpcLocalRegistry</code> (Êú¨Âú∞Ê≥®ÂÜå‰∏≠ÂøÉ)</p>
</li>
<li><p>ÂºÄÂêØ‰∏Ä‰∏™Web ÊúçÂä°Âô®, ÁõëÂê¨ RPC ËØ∑Ê±Ç</p>
</li>
</ol>
<h4 id="one-RpcServerÂ∏ÆÂä©-Provider-ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÊé•Êî∂-Ëß£Êûê-Âπ∂ÂèëÈÄÅÂìçÂ∫î"><a href="#one-RpcServerÂ∏ÆÂä©-Provider-ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÊé•Êî∂-Ëß£Êûê-Âπ∂ÂèëÈÄÅÂìçÂ∫î" class="headerlink" title=":one:RpcServerÂ∏ÆÂä© Provider ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÊé•Êî∂, Ëß£Êûê, Âπ∂ÂèëÈÄÅÂìçÂ∫î"></a>:one:<code>RpcServer</code>Â∏ÆÂä© Provider ÂÆåÊàêÂØπËØ∑Ê±ÇÁöÑÊé•Êî∂, Ëß£Êûê, Âπ∂ÂèëÈÄÅÂìçÂ∫î</h4><p>RPC Ê°ÜÊû∂Â∏ÆÂä© Provider Êé•ÂèóÂπ∂Â§ÑÁêÜËØ∑Ê±ÇÁöÑÊ†∏ÂøÉÈÄªËæëÂú® <code>server</code> ÂåÖ‰∏≠, Âç≥ÂºÄÂêØ‰∏Ä‰∏™ Web ÊúçÂä°Âô®Êù•Â§ÑÁêÜÂèëÈÄÅËøáÊù•ÁöÑ RPC ËØ∑Ê±Ç, Âπ∂ÊääÁªìÊûúÂèëÈÄÅÂõûÂéª; ËÄåÂÖ∂‰∏≠ÁöÑÂ§ÑÁêÜËØ∑Ê±ÇÁöÑÈÄªËæë, ÂàôÂçïÁã¨Â∞ÅË£ÖÂú® <code>ServerHandler</code> ‰∏≠. </p>
<p><code>RpcServer</code> ‰∏≠ÁöÑÈÄªËæëÊòØ‰∏Ä‰∏™ÂºÇÊ≠•Â§ÑÁêÜÊ®°Âûã. ÂΩìÊúâËØ∑Ê±ÇËøáÊù•Êó∂, ÈÅµÂæ™‰ª•‰∏ãÊ≠•È™§: ËØ∑Ê±ÇËß£Êûê -&gt; ÊúçÂä°ÊñπÊ≥ïË∞ÉÁî® -&gt; ÁªìÊûúÂ∞ÅË£Ö -&gt; ÂìçÂ∫îËøîÂõû. </p>
<h3 id="RPC-pyrpc"><a href="#RPC-pyrpc" class="headerlink" title="RPC (pyrpc)"></a>RPC (pyrpc)</h3><p>ËøûÊé• Consumer Âíå Provider ÈÄö‰ø°ÁöÑÊû¢Á∫Ω, Êé•‰∏ãÊù•ÈáçÁÇπ‰ªãÁªç.</p>
<h2 id="Main-Components-in-pyRPC"><a href="#Main-Components-in-pyRPC" class="headerlink" title="Main Components in pyRPC"></a>Main Components in pyRPC</h2><h3 id="Êï∞ÊçÆÁªÑ‰ª∂ÂíåÈÖçÁΩÆÁªÑ‰ª∂-com-ypy-pyrpc-model-com-ypy-pyrpc-config"><a href="#Êï∞ÊçÆÁªÑ‰ª∂ÂíåÈÖçÁΩÆÁªÑ‰ª∂-com-ypy-pyrpc-model-com-ypy-pyrpc-config" class="headerlink" title="Êï∞ÊçÆÁªÑ‰ª∂ÂíåÈÖçÁΩÆÁªÑ‰ª∂: com.ypy.pyrpc.model &amp; com.ypy.pyrpc.config"></a>Êï∞ÊçÆÁªÑ‰ª∂ÂíåÈÖçÁΩÆÁªÑ‰ª∂: <code>com.ypy.pyrpc.model</code> &amp; <code>com.ypy.pyrpc.config</code></h3><p>ÂÖ∂‰∏≠ÂÆö‰πâ‰∫Ü <code>RpcRequest</code>, <code>RpcResponse</code>, <code>ServiceMetaInfo</code>, <code>ServiceRegisterInfo</code> Á≠âÂü∫Êú¨Êï∞ÊçÆÁ±ªÂûã.</p>
<p>‰ª•ÂèäRPCÊ°ÜÊû∂ÁöÑÈÖçÁΩÆÊï∞ÊçÆÁ±ªÂûã (<code>RpcConfig</code> and <code>RpcConfig.RegistryConfig</code>) Âíå‰∏Ä‰∏™Áî®‰∫éËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÂ∑•ÂÖ∑Á±ª (<code>RpcConfigReader</code>).</p>
<p>Êú¨Ê°ÜÊû∂ÁöÑÈÖçÁΩÆ‰ø°ÊÅØÂèØ‰ª•ÂÜôÂÖ•<code>resources/application.properties</code>, ÂÆåÊï¥ÁöÑÈÖçÁΩÆ‰ø°ÊÅØÂ¶Ç‰∏ã:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pyrpc.serverHost=127.0.0.1</span><br><span class="line">pyrpc.serverPort=8081</span><br><span class="line">pyrpc.serverType=http || tcp</span><br><span class="line">pyrpc.mock=false || true</span><br><span class="line">pyrpc.registry.registry=no || etcd</span><br><span class="line">pyrpc.registry.addr=http://127.0.0.1:2375</span><br><span class="line">pyrpc.registry.username=xxx</span><br><span class="line">pyrpc.registry.password=yyy</span><br><span class="line">pyrpc.registry.timeout=10000</span><br><span class="line">pyrpc.serializer=jdk || json || kryo</span><br><span class="line">pyrpc.loadbalancer=round-robin || random || consistent-hash</span><br><span class="line">pyrpc.retry=no || fixed-interval</span><br><span class="line">pyrpc.tolerance=fail-fast || fail-safe</span><br></pre></td></tr></table></figure>

<p><em>*ÂÖ∂‰∏≠ || ÂàÜÂâ≤‰∫ÜÂèØ‰æõÈÄâÊã©ÁöÑÈªòËÆ§ÂÆûÁé∞Á±ªÁöÑ key</em></p>
<p>Âú® <code>resources/META-INF/prrpc/</code> ‰∏≠, Êúâ <code>custom/</code> Âíå <code>system/</code> ‰∏§‰∏™ÁõÆÂΩï, ÂÖ∂‰∏≠ <code>system/</code> ‰∏≠ÁöÑÊñá‰ª∂Â¶Ç‰∏ã:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com.ypy.pyrpc.spi.loadbalancer.Loadbalancer</span><br><span class="line">com.ypy.pyrpc.spi.registry.Registry</span><br><span class="line">com.ypy.pyrpc.spi.retry.Retry</span><br><span class="line">com.ypy.pyrpc.spi.serializer.Serializer</span><br><span class="line">com.ypy.pyrpc.spi.tolerance.Tolerance</span><br></pre></td></tr></table></figure>

<p>ÂàÜÂà´ÂØπÂ∫î‰∫ÜÊèê‰æõ SPI Ëá™ÂÆö‰πâÂäüËÉΩÂÆûÁé∞Á±ªÁöÑÊé•Âè£Âêç, Âú®Áõ∏ÂØπÂ∫îÁöÑÊñá‰ª∂ÂÜÖ, ÂèØ‰ª•ÂÜôÂÖ•ÂäüËÉΩÂÆûÁé∞Á±ª‰ª•ÂèäÂÖ∂ÂØπÂ∫îÁöÑ key. Ê°ÜÊû∂‰∏≠ÁöÑÈªòËÆ§ÂÆûÁé∞Á±ª‰ª•Âèä key Â¶Ç‰∏ã:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">round-robin=com.ypy.pyrpc.spi.loadbalancer.impl.RoundRobinLoadbalancer</span><br><span class="line">random=com.ypy.pyrpc.spi.loadbalancer.impl.RandomLoadbalancer</span><br><span class="line">consistent-hash=com.ypy.pyrpc.spi.loadbalancer.impl.ConsistentHashLoadbalancer</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no=com.ypy.pyrpc.spi.registry.impl.NoRegistry</span><br><span class="line">etcd=com.ypy.pyrpc.spi.registry.impl.EtcdRegistry</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no=com.ypy.pyrpc.spi.retry.impl.NoRetry</span><br><span class="line">fixed-interval=com.ypy.pyrpc.spi.retry.impl.FixedIntervalRetry</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdk=com.ypy.pyrpc.spi.serializer.impl.JdkSerializer</span><br><span class="line">json=com.ypy.pyrpc.spi.serializer.impl.JsonSerializer</span><br><span class="line">kryo=com.ypy.pyrpc.spi.serializer.impl.KryoSerializer</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fail-fast=com.ypy.pyrpc.spi.tolerance.impl.FailFastTolerance</span><br><span class="line">fail-safe=com.ypy.pyrpc.spi.tolerance.impl.FailSafeTolerance</span><br></pre></td></tr></table></figure>

<h3 id="ÂêØÂä®ÁªÑ‰ª∂-com-ypy-pyrpc-bootstrap"><a href="#ÂêØÂä®ÁªÑ‰ª∂-com-ypy-pyrpc-bootstrap" class="headerlink" title="ÂêØÂä®ÁªÑ‰ª∂ com.ypy.pyrpc.bootstrap"></a>ÂêØÂä®ÁªÑ‰ª∂ <code>com.ypy.pyrpc.bootstrap</code></h3><p><strong>:star:Consumer ÂêØÂä®Á±ª <code>ConsumerBootstrap</code></strong></p>
<p>Â∏ÆÂä© Consumer ÂàùÂßãÂåñ, ÂÖ∂Âü∫Êú¨ÈÄªËæëÊòØË∞ÉÁî® <code>com.ypy.pyrpc.app.RpcApplication</code>, Êù•ÂÆåÊàêÂØπÈÖçÁΩÆ‰ø°ÊÅØÁöÑËØªÂèñ. Êú¨Ë¥®‰∏äÂè™ÊòØÂØπ <code>com.ypy.pyrpc.app.RpcApplication</code> ËøõË°å‰∫Ü‰∏ÄÂ±ÇÂ∞ÅË£Ö, ËßÑËåÉ‰∫Ü‰ª£Á†ÅÁªìÊûÑ.</p>
<p><strong>:star:Provider ÂêØÂä®Á±ª <code>ProviderBoostrap</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderBootstrap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(List&lt;ServiceRegisterInfo&gt; serviceRegisterInfoList)</span> &#123;</span><br><span class="line">        RpcApplication.init();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">RpcConfig</span> <span class="variable">rpcConfig</span> <span class="operator">=</span> RpcApplication.getRpcConfig();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ServiceRegisterInfo&lt;?&gt; serviceRegisterInfo : serviceRegisterInfoList) &#123;</span><br><span class="line">            RpcLocalRegistry.register(serviceRegisterInfo.getServiceInterfaceName(), serviceRegisterInfo.getServiceImplClass());</span><br><span class="line"></span><br><span class="line">            RpcConfig.<span class="type">RegistryConfig</span> <span class="variable">registryConfig</span> <span class="operator">=</span> rpcConfig.getRegistryConfig();</span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> RegistryFactory.getInstance(registryConfig.getRegistry());</span><br><span class="line">            <span class="type">ServiceMetaInfo</span> <span class="variable">serviceMetaInfo</span> <span class="operator">=</span> ServiceMetaInfo.builder()</span><br><span class="line">                    .serviceName(serviceRegisterInfo.getServiceInterfaceName())</span><br><span class="line">                    .serviceVersion(RpcConstant.DEFAULT_SERVICE_VERSION) <span class="comment">// todo</span></span><br><span class="line">                    .serviceHost(rpcConfig.getServerHost())</span><br><span class="line">                    .servicePost(rpcConfig.getServerPort())</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                registry.register(serviceMetaInfo);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(serviceRegisterInfo.getServiceInterfaceName() + <span class="string">&quot; register failed&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">RpcServer</span> <span class="variable">rpcServer</span> <span class="operator">=</span> RpcServerFactory.getInstance(RpcApplication.getRpcConfig().getServerType());</span><br><span class="line">        rpcServer.start(rpcConfig.getServerPort());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>‰ΩøÁî® <code>RpcApplication.init()</code> ÂàùÂßãÂåñ RPC Ê°ÜÊû∂, ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØ</li>
<li>Êää <code>serviceRegisterInfoList</code> ‰∏≠ÁöÑÊúçÂä°Ê≥®ÂÜåÂà∞Êú¨Âú∞Ê≥®ÂÜå‰∏≠ÂøÉ (<code>RpcLocalRegistry</code>)</li>
<li>Ê†πÊçÆÂÖ®Â±ÄÈÖçÁΩÆ, ÈÄöËøáÊ≥®ÂÜå‰∏≠ÂøÉ‰ª£ÁêÜÂ∑•ÂéÇ (<code>RegistryFactory</code>) Ëé∑ÂèñÁõ∏ÂØπÂ∫îÁöÑÊ≥®ÂÜå‰∏≠ÂøÉÂØπË±°, ÊääÊúçÂä°ÂÜôÂÖ•Ê≥®ÂÜå‰∏≠ÂøÉ</li>
<li>ÂºÄÂêØPRC Web ÊúçÂä°Âô®, Âú®Áõ∏Â∫îÁöÑÁ´ØÂè£‰∏ìÈó®Â§ÑÁêÜRPCËØ∑Ê±Ç</li>
</ul>
<p><em>Ê≥®ÊÑè: ÊääÊúçÂä°Ê≥®ÂÜåÂà∞Êú¨Âú∞ÂíåÊääÊúçÂä°Ê≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉÊòØ‰∏çÂêåÁöÑ</em></p>
<ul>
<li>Êú¨Âú∞Ê≥®ÂÜå: ÊääÊúçÂä°Êé•Âè£‰ø°ÊÅØÂíåÊúçÂä°ÂÆûÁé∞Á±ª‰ª•Âçï‰æãÊ®°ÂºèÂ≠òÂÖ• <code>RpcLocalRegistry</code>, Êñπ‰æøÂ§ÑÁêÜRPCËØ∑Ê±ÇÊó∂Ë∞ÉÁî®</li>
<li>Ê≥®ÂÜå‰∏≠ÂøÉ: ÊääÊúçÂä°ÁöÑ‰ø°ÊÅØ (<code>com.ypy.pyrpc.model.ServiceMetaInfo</code>, ‰∏ªË¶ÅÂåÖÂê´ÊúçÂä°ÂêçÂíåÊúçÂä°Êèê‰æõËÄÖÁöÑÂú∞ÂùÄ) Â≠òÂÖ•‰∏Ä‰∏™ÈîÆÂÄºÂûãÊï∞ÊçÆÂ∫ì (‰æãÂ¶Ç ETCD Êàñ Redis), Ëøô‰∏™Êï∞ÊçÆÂ∫ìÊúçÂä°ÊòØÁã¨Á´ã‰∏éÊâÄÊúâ Provider ÁöÑ, Âõ†Ê≠§‰ΩÜ‰∏çÂêåÁöÑ Provider Êèê‰æõ‰∏çÂêåÁöÑÊúçÂä°Êó∂, Ê≥®ÂÜå‰∏≠ÂøÉÂÖÖÂΩì‰∫Ü‰∏Ä‰∏™ ‚Äú‰ø°ÊÅØÈõÜÊï£Âú∞‚Äù: RPC Ê°ÜÊû∂Â∏ÆÂä© Consumer Âú®Ê≥®ÂÜå‰∏≠ÂøÉËé∑ÂèñÊúçÂä°ÁöÑÂú∞ÂùÄ, Âπ∂ÊåëÈÄâÂêàÈÄÇÁöÑÊúçÂä°ËäÇÁÇπ; ÂΩìÂÖÅËÆ∏Â§ö‰∏™ Provider Êèê‰æõÁõ∏ÂêåÊúçÂä°Êó∂, ÂèØ‰ª•‰ΩøÁî®Ë¥üËΩΩÂùáË°°ÂáèÂ∞ëÊúçÂä°Âô®ÂéãÂäõ</li>
</ul>
<h3 id="ÂÖ®Â±ÄÁªÑ‰ª∂-com-ypy-pyrpc-app"><a href="#ÂÖ®Â±ÄÁªÑ‰ª∂-com-ypy-pyrpc-app" class="headerlink" title="ÂÖ®Â±ÄÁªÑ‰ª∂ com.ypy.pyrpc.app"></a>ÂÖ®Â±ÄÁªÑ‰ª∂ <code>com.ypy.pyrpc.app</code></h3><p><strong>:star:RPCÂàùÂßãÂåñÂ∑•ÂÖ∑Á±ª<code>RpcApplication</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcApplication</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RpcConfig rpcConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init RpcConfig</span></span><br><span class="line"><span class="comment">     * and Registry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newRpcConfig</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(RpcConfig newRpcConfig)</span> &#123;</span><br><span class="line">        <span class="comment">// config</span></span><br><span class="line">        rpcConfig = newRpcConfig;</span><br><span class="line">        log.info(<span class="string">&quot;RpcApplication initialized with config: &#123;&#125;&quot;</span>, rpcConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// registry</span></span><br><span class="line">        RpcConfig.<span class="type">RegistryConfig</span> <span class="variable">registryConfig</span> <span class="operator">=</span> rpcConfig.getRegistryConfig();</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> RegistryFactory.getInstance(registryConfig.getRegistry());</span><br><span class="line">        registry.init(registryConfig);</span><br><span class="line">        log.info(<span class="string">&quot;Registry initialized with config: &#123;&#125;&quot;</span>, registryConfig);</span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> <span class="title class_">Thread</span>(registry::destroy));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        RpcConfig newRpcConfig;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            newRpcConfig = RpcConfigReader.loadConfig(RpcConstant.DEFAULT_CONFIG_PREFIX);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Failed to load configuration file. Using default config.&quot;</span>, e);</span><br><span class="line">            newRpcConfig = <span class="keyword">new</span> <span class="title class_">RpcConfig</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        init(newRpcConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RpcConfig <span class="title function_">getRpcConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rpcConfig == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (RpcApplication.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (rpcConfig == <span class="literal">null</span>) init();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rpcConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â∑•ÂÖ∑Á±ª, ÊòØRPCÊ°ÜÊû∂ÂàùÂßãÂåñÁöÑÂÖ¨ÂÖ±ÈÄªËæë, ÂÖ∂‰∏≠ÈÉΩÊòØÈùôÊÄÅÊñπÊ≥ïÂíåÈùôÊÄÅÊàêÂëòÂèòÈáè. Áª¥Êä§‰∫Ü‰∏Ä‰∏™ÈùôÊÄÅÁöÑ <code>RpcConfig</code> ÂÆû‰æã, ÂÆÉÂåÖÂê´‰∫Ü RPC ÁöÑÂÖ®ÈÉ®ÈÖçÁΩÆ‰ø°ÊÅØ. ‰ª£Á†Å‰∏≠‰ΩøÁî®Â∑•ÂÖ∑Á±ª <code>com.ypy.pyrpc.config.RpcConfigReader</code> ‰∏≠ÁöÑÈùôÊÄÅÊñπÊ≥ï<code>loadConfig</code> ËØªÂèñÁ®ãÂ∫èÂëòÂú®È°πÁõÆ <code>/resourses/application.properties</code> ‰∏≠ÂÜôÁöÑÈÖçÁΩÆ‰ø°ÊÅØ. </p>
<p><strong>:star:Êú¨Âú∞Ê≥®ÂÜå‰∏≠ÂøÉ <code>RpcLocalRegistry</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcLocalRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Class&lt;?&gt;&gt; registeredServiceImpl = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Class&lt;?&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String serviceName, Class&lt;?&gt; serviceImpl)</span> &#123;</span><br><span class="line">        registeredServiceImpl.put(serviceName, serviceImpl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; getServiceImpl(String serviceName) &#123;</span><br><span class="line">        <span class="keyword">return</span> registeredServiceImpl.get(serviceName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeService</span><span class="params">(String serviceName)</span> &#123;</span><br><span class="line">        registeredServiceImpl.remove(serviceName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â∑•ÂÖ∑Á±ª, Áª¥Êä§‰∫Ü‰∏Ä‰∏™ÈùôÊÄÅÁöÑ <code>ConcurrentHashMap&lt;String, Class&lt;?&gt;&gt;</code> Áî®‰∫éÂ≠òÂÇ® Provider Êèê‰æõÁöÑÊúçÂä°ÂêçÂíåÂØπÂ∫îÂÆûÁé∞Á±ªÁöÑClassÁ±ª</p>
<h3 id="‰ª£ÁêÜÁªÑ‰ª∂-com-ypy-pyrpc-proxy"><a href="#‰ª£ÁêÜÁªÑ‰ª∂-com-ypy-pyrpc-proxy" class="headerlink" title="‰ª£ÁêÜÁªÑ‰ª∂ com.ypy.pyrpc.proxy"></a>‰ª£ÁêÜÁªÑ‰ª∂ <code>com.ypy.pyrpc.proxy</code></h3><p>Ëøô‰∏ÄÈÉ®ÂàÜÊòØ Consumer ÂèëÈÄÅ RPC ËØ∑Ê±ÇÁöÑÊ†∏ÂøÉ</p>
<p><strong>:star:Ê∂àË¥πËÄÖÊúçÂä°‰ª£ÁêÜ <code>ServiceProxy</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serviceName</span> <span class="operator">=</span> method.getDeclaringClass().getName();</span><br><span class="line">        <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> RpcRequest.builder()</span><br><span class="line">                .serviceName(serviceName)</span><br><span class="line">                .methodName(method.getName())</span><br><span class="line">                .parameterTypes(method.getParameterTypes())</span><br><span class="line">                .args(args)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> RegistryFactory.getInstance(RpcApplication.getRpcConfig().getRegistryConfig().getRegistry());</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">serviceNameVer</span> <span class="operator">=</span> ServiceMetaInfo.serviceNameVer(serviceName, RpcConstant.DEFAULT_SERVICE_VERSION);</span><br><span class="line">        List&lt;ServiceMetaInfo&gt; serviceMetaInfoList = registry.serviceDiscovery(serviceNameVer);</span><br><span class="line"></span><br><span class="line">        <span class="type">Loadbalancer</span> <span class="variable">loadbalancer</span> <span class="operator">=</span> LoadbalancerFactory.getInstance(RpcApplication.getRpcConfig().getLoadbalancer());</span><br><span class="line">        Map&lt;String, Object&gt; context = Map.of(<span class="string">&quot;serviceNameVer&quot;</span>, serviceNameVer);</span><br><span class="line">        <span class="type">ServiceMetaInfo</span> <span class="variable">serviceMetaInfo</span> <span class="operator">=</span> loadbalancer.select(serviceMetaInfoList, context);</span><br><span class="line"></span><br><span class="line">        <span class="type">RpcClient</span> <span class="variable">rpcClient</span> <span class="operator">=</span> RpcClientFactory.getInstance(RpcApplication.getRpcConfig().getServerType());</span><br><span class="line">        RpcResponse rpcResponse;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Retry</span> <span class="variable">retry</span> <span class="operator">=</span> RetryFactory.getInstance(RpcApplication.getRpcConfig().getRetry());</span><br><span class="line">            rpcResponse = retry.retry(() -&gt; rpcClient.request(rpcRequest, serviceMetaInfo));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">Tolerance</span> <span class="variable">tolerance</span> <span class="operator">=</span> ToleranceFactory.getInstance(RpcApplication.getRpcConfig().getTolerance());</span><br><span class="line">            rpcResponse = tolerance.tolerate(e, context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rpcResponse.getData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ëøô‰∏™Á±ªÂèØ‰ª•ËØ¥ÊòØ‰∏∫ Consumer ÂèëÈÄÅRPCËØ∑Ê±ÇÁöÑÊ†∏ÂøÉ, ‰ª£Á†ÅÁöÑ‰∏ªË¶ÅÈÄªËæëÊòØ:</p>
<ul>
<li>ÊääÁî±ÂèÇÊï∞Ëé∑ÂèñÁöÑÊúçÂä°Êé•Âè£Âêç, ÊúçÂä°ÊñπÊ≥ïÂêç, ÂèÇÊï∞Á±ªÂûãÂèäÂèÇÊï∞Â∞ÅË£ÖËøõÂÖ•<code>rpcRequest</code></li>
<li>Ê†πÊçÆÂÖ®Â±ÄÈùôÊÄÅÈÖçÁΩÆ‰ø°ÊÅØËé∑ÂèñÊ≥®ÂÜå‰∏≠ÂøÉ (<code>registry</code>) Âπ∂ÈÄöËøáÊ≥®ÂÜå‰∏≠ÂøÉÊ†πÊçÆÊúçÂä°ÂêçÂíåÁâàÊú¨‰ø°ÊÅØÂèëÁé∞ÊúçÂä°</li>
<li>Ê†πÊçÆÂÖ®Â±ÄÈùôÊÄÅÈÖçÁΩÆ‰ø°ÊÅØËé∑ÂèñË¥üËΩΩÂùáË°°Âô® (<code>loadbalancer</code>) Âπ∂ÈÄöËøáË¥üËΩΩÂùáË°°Âô®ÈÄâÊã©ÈÄÇÂêàÁöÑÊúçÂä° Provider ËäÇÁÇπ</li>
<li>‰ΩøÁî® <code>RpcClient.request()</code> ÈùôÊÄÅÊñπÊ≥ïÂèëÈÄÅ RPC ËØ∑Ê±Ç (ËøôÈáåÁöÑÈÄªËæëÂú® RPC Server ÈÉ®ÂàÜËß£Èáä)</li>
<li>Ê†πÊçÆÂÖ®Â±ÄÈùôÊÄÅÈÖçÁΩÆ‰ø°ÊÅØËé∑ÂèñÈáçËØïÂíåÂÆπÈîôÂô®, Âú®Âá∫Áé∞ÈóÆÈ¢òËøõË°åÁõ∏Â∫îÁöÑÂ§ÑÁêÜÊ≠•È™§</li>
<li>Ëé∑Âæó <code>rpcResonse</code> ËøîÂõûÂÖ∂ <code>data</code> ÈÉ®ÂàÜ</li>
</ul>
<p><strong>:star:MockÊúçÂä°‰ª£ÁêÜ <code>MockServiceProxy</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        Class&lt;?&gt; methodReturnType = method.getReturnType();</span><br><span class="line">        log.info(<span class="string">&quot;mock invoke &#123;&#125;&quot;</span>, method.getName());</span><br><span class="line">        <span class="keyword">return</span> getDefaultObject(methodReturnType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getDefaultObject</span><span class="params">(Class&lt;?&gt; type)</span> &#123;</span><br><span class="line">        <span class="comment">// 8 primitive type</span></span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">boolean</span>.class || type == Boolean.class) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">byte</span>.class || type == Byte.class) <span class="keyword">return</span> (<span class="type">byte</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">short</span>.class || type == Short.class) <span class="keyword">return</span> (<span class="type">short</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">char</span>.class || type == Character.class) <span class="keyword">return</span> (<span class="type">char</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">int</span>.class || type == Integer.class) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">long</span>.class || type == Long.class) <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">float</span>.class || type == Float.class) <span class="keyword">return</span> <span class="number">0.0f</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">double</span>.class || type == Double.class) <span class="keyword">return</span> <span class="number">0.0d</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// handle common type</span></span><br><span class="line">        <span class="keyword">if</span> (type == String.class) <span class="keyword">return</span> <span class="string">&quot;&lt;mock&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == List.class) <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        <span class="keyword">if</span> (type == Map.class) <span class="keyword">return</span> Collections.emptyMap();</span><br><span class="line">        <span class="keyword">if</span> (type == Set.class) <span class="keyword">return</span> Collections.emptySet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// handle self-defined class</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> type.getDeclaredConstructor().newInstance();</span><br><span class="line">            Field[] fields = type.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                Class&lt;?&gt; fieldType = field.getType();</span><br><span class="line">                field.set(instance, getDefaultObject(fieldType)); <span class="comment">// recursion</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Failed to create mock object for type: &#123;&#125;&quot;</span>, type.getName(), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‰∏∫ÂºÄÂèëËÄÖÊèê‰æõÁîüÊàêÂÅáÊï∞ÊçÆÁöÑÊúçÂä°‰ª£ÁêÜ, ÂΩì Consumer ÂºÄÂèëËÄÖÂú®‰∏çÂ≠òÂú® Provider ÁöÑÊÉÖÂÜµ‰∏ã, ‰πüËÉΩË∞ÉÁî®ÂÅáÊúçÂä°, Ëé∑ÂèñÂÅáÊï∞ÊçÆ</p>
<p><strong>:star:‰ª£ÁêÜÊúçÂä°Â∑•ÂéÇ <code>ServiceProxyFactory</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProxyFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getProxy</span><span class="params">(Class&lt;T&gt; serviceInterface)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (RpcApplication.getRpcConfig().isMock()) <span class="keyword">return</span> getMockProxy(serviceInterface);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(</span><br><span class="line">                serviceInterface.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceInterface&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ServiceProxy</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getMockProxy</span><span class="params">(Class&lt;T&gt; serviceInterface)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(</span><br><span class="line">                serviceInterface.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceInterface&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MockServiceProxy</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Proxy.newProxyInstance</code> ÊòØ JDK Êèê‰æõÁöÑÂä®ÊÄÅ‰ª£ÁêÜÂ∑•ÂÖ∑ÊñπÊ≥ï, ÂÆÉÈúÄË¶Å‰∏â‰∏™ÂèÇÊï∞: <ul>
<li><code>ClassLoader</code>: Áî®‰∫éÂä†ËΩΩ‰ª£ÁêÜÁ±ªÁöÑÁ±ªÂä†ËΩΩÂô®</li>
<li><code>Class&lt;?&gt;[]</code>: ‰ª£ÁêÜÁ±ªÈúÄË¶ÅÂÆûÁé∞ÁöÑÊé•Âè£ÂàóË°®</li>
<li><code>InvocationHandler</code>: ‰ª£ÁêÜÁ±ªÁöÑË∞ÉÁî®Â§ÑÁêÜÂô®, Ë¥üË¥£Êã¶Êà™ÊñπÊ≥ïË∞ÉÁî®Âπ∂ÊâßË°åËá™ÂÆö‰πâÈÄªËæë</li>
</ul>
</li>
<li>Âú®ËøôÈáå, <code>ServiceProxy</code> Âíå <code>MockServiceProxy</code> ÈÉΩÂÆûÁé∞‰∫Ü <code>InvocationHandler</code> Êé•Âè£, ÂàÜÂà´Áî®‰∫éÂ§ÑÁêÜÁúüÂÆûÁöÑ RPC Ë∞ÉÁî®Âíå Mock Ë∞ÉÁî®</li>
</ul>
<h3 id="ÊúçÂä°Âô®ÁªÑ‰ª∂-com-ypy-pyrpc-server"><a href="#ÊúçÂä°Âô®ÁªÑ‰ª∂-com-ypy-pyrpc-server" class="headerlink" title="ÊúçÂä°Âô®ÁªÑ‰ª∂ com.ypy.pyrpc.server"></a>ÊúçÂä°Âô®ÁªÑ‰ª∂ <code>com.ypy.pyrpc.server</code></h3><p>Ëøô‰∏ÄÈÉ®ÂàÜÊòØ Provider Â§ÑÁêÜ RPC ËØ∑Ê±ÇÁöÑÈáçÁÇπ, ‰πüÊòØ RPC ÈÄö‰ø°ÁöÑÈáçÁÇπ. ËØ•ÂåÖ‰∏≠Êúâ‰∏§‰∏™ÈáçË¶ÅÁöÑÊé•Âè£: <code>RpcClient</code> Âíå <code>RpcServer</code>. </p>
<p><code>RpcClient</code> Âè™Êúâ‰∏Ä‰∏™ÊñπÊ≥ï <code>RpcResponse request(RpcRequest rpcRequest, ServiceMetaInfo serviceMetaInfo) throws Exception;</code>. ÂÆÉÊòØÂèëÈÄÅ RPC ËØ∑Ê±ÇÁöÑÊ†∏ÂøÉ. Ê≥®ÊÑè, ËøôÈáåÁöÑÂèëÈÄÅËØ∑Ê±Ç‰∏çÊòØ <code>ServiceProxy</code> ÁöÑÊôÆÈÄö‰∏öÂä°ÈÄªËæë. ËøôÈáåÁöÑ‰∏ªË¶ÅÊòØË¶ÅÂÆûÁé∞Â∫èÂàóÂåñ&#x2F;ÂèçÂ∫èÂàóÂåñ, ‰ª•Âèä‰ΩøÁî®TCPÂçèËÆÆÂèëÈÄÅËØ∑Ê±Ç. </p>
<p><code>RpcServer</code> ‰πüÂè™Êúâ‰∏Ä‰∏™ÊñπÊ≥ï <code>void start(int port);</code>. ÂÆÉ.Â∏ÆÂä© Provider Âú®Áõ∏Â∫îÁ´ØÂè£ÊûÑÈÄ† Web ÊúçÂä°, Âπ∂Â§ÑÁêÜ RPC ËØ∑Ê±Ç.</p>
<p>ÂêåÊó∂, ÂÆÉ‰ª¨ÈÉΩÊúâÂêÑËá™ÂØπÂ∫îÁöÑÂ∑•ÂéÇÁ±ª (<code>RpcClientFactory</code> &amp; <code>RpcServerFactory</code>), ‰ª• <code>RpcClientFactory</code> ‰∏∫‰æã:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcClientFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, RpcClient&gt; clientMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        clientMap.put(RpcServerTypeKeys.TCP, <span class="keyword">new</span> <span class="title class_">TcpClient</span>());</span><br><span class="line">        clientMap.put(RpcServerTypeKeys.HTTP, <span class="keyword">new</span> <span class="title class_">HttpClient</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RpcClient <span class="title function_">getInstance</span><span class="params">(String implClassKey)</span> &#123; <span class="keyword">return</span> clientMap.get(implClassKey); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Áî±‰∫éÊàë‰ª¨‰∏çËÉΩÊØèÂèë‰∏ÄÊ¨° RPC ËØ∑Ê±ÇÂ∞± new ‰∏Ä‰∏™ <code>TcpClient</code> Êàñ <code>HttpClient</code> ÂÆûÁé∞Á±ª, ‰∫éÊòØÊàë‰ª¨ÈÄâÊã©‰ΩøÁî®Â∑•ÂéÇÊ®°Âºè, Áª¥Êä§‰∏Ä‰∏™ÈùôÊÄÅÁöÑMap, Â≠òÂÇ®‰∫ÜÂØπÂ∫îÁöÑ <code>RpcClient</code> ÁöÑÂÆûÁé∞Á±ª, ‰ºöÊ†πÊçÆÂØπÂ∫îÁöÑ key ËøîÂõûÁõ∏Â∫îÁöÑÂÆûÁé∞Á±ª. <code>RpcServerFactory</code> ÂêåÁêÜ. ËøôÊ†∑Âç≥ÈÅøÂÖç‰∫ÜÈáçÂ§ç new ÂØπË±°, ÂêåÊó∂‰πüÂÖÅËÆ∏ÂºÄÂèëËÄÖÈÖçÁΩÆËá™Â∑±ÂñúÊ¨¢ÁöÑÂ∫ïÂ±ÇÈÄö‰ø°ÂçèËÆÆ (TCP or HTTP).</p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨‰∏ªË¶ÅÁúãÁúã‰ΩøÁî® TCP ÂçèËÆÆ‰Ωú‰∏∫Â∫ïÂ±ÇÂçèËÆÆ, ÊòØÂ¶Ç‰ΩïÂÆûÁé∞ <code>RpcClient</code> Âíå <code>RpcServer</code> ÁöÑ:</p>
<h4 id="ÂçèËÆÆÊï∞ÊçÆÁªìÊûÑÁªÑ‰ª∂-com-ypy-pyrpc-server-tcp-protocol"><a href="#ÂçèËÆÆÊï∞ÊçÆÁªìÊûÑÁªÑ‰ª∂-com-ypy-pyrpc-server-tcp-protocol" class="headerlink" title="ÂçèËÆÆÊï∞ÊçÆÁªìÊûÑÁªÑ‰ª∂ com.ypy.pyrpc.server.tcp.protocol"></a>ÂçèËÆÆÊï∞ÊçÆÁªìÊûÑÁªÑ‰ª∂ <code>com.ypy.pyrpc.server.tcp.protocol</code></h4><p>ËøôÈáå‰∏ªË¶ÅÂÆö‰πâ‰∫ÜËá™ÂÆö‰πâÂçèËÆÆÁöÑÁªìÊûÑ (<code>Protocol</code>):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Protocol</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Header</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> magic;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> version;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> serializer;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> type;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> status;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> requestId;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> bodyLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Header header;</span><br><span class="line">    <span class="keyword">private</span> T body; <span class="comment">// body: RpcRequest or RpcResponse, will be serialized into bytes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‰ª•ÂèäÂÖ∂ÂÆÉÂçèËÆÆÂ∏∏Èáè‰ª•ÂèäÊûö‰∏æ</p>
<h4 id="TCP-ÊúçÂä°Âô®ÂÆûÁé∞ÁªÑ‰ª∂-com-ypy-pyrpc-server-tcp"><a href="#TCP-ÊúçÂä°Âô®ÂÆûÁé∞ÁªÑ‰ª∂-com-ypy-pyrpc-server-tcp" class="headerlink" title="TCP ÊúçÂä°Âô®ÂÆûÁé∞ÁªÑ‰ª∂ com.ypy.pyrpc.server.tcp"></a>TCP ÊúçÂä°Âô®ÂÆûÁé∞ÁªÑ‰ª∂ <code>com.ypy.pyrpc.server.tcp</code></h4><p><strong>:star:TCP ÊúçÂä°Âô®ÂÆûÁé∞ <code>TcpServer</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpServer</span> <span class="keyword">implements</span> <span class="title class_">RpcServer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx();</span><br><span class="line">        <span class="type">NetServer</span> <span class="variable">server</span> <span class="operator">=</span> vertx.createNetServer();</span><br><span class="line">        server.connectHandler(<span class="keyword">new</span> <span class="title class_">TcpServerHandler</span>());</span><br><span class="line">        server.listen(port, netServerAsyncResult -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (netServerAsyncResult.succeeded()) System.out.println(<span class="string">&quot;TcpServer started on port &quot;</span> + port);</span><br><span class="line">            <span class="keyword">else</span> System.out.println(<span class="string">&quot;TcpServer failed to start on port &quot;</span> + port);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‰ª£Á†ÅÁöÑÈ¶ñÂÖà‰ΩøÁî® <code>Vertx</code> ÊûÑÈÄ†‰∏Ä‰∏™ Web ÊúçÂä°Âô®: ËøôÈáåÁöÑ <code>vertx</code> ËôΩÁÑ∂‰∏çÊòØ<code>static</code> ÁöÑ, ‰ΩÜÊòØÂõ†‰∏∫Êï¥‰∏™ <code>TcpServcer</code> ‰ºöË¢´‰ª•Âçï‰æãÁöÑÂΩ¢ÂºèÂ≠òÂÇ®Âú®Â∑•ÂéÇÁ±ªÁöÑÈùôÊÄÅÂèòÈáè‰∏≠, Âπ∂‰∏î <code>start</code> ÊñπÊ≥ïÂè™‰ºöÂú® Provider ÂàùÂßãÂåñ‰∏≠Ë¢´Ë∞ÉÁî®‰∏ÄÊ¨°, Âõ†Ê≠§‰∏çÂ≠òÂú®ÈáçÂ§çÂÆû‰æãÂåñÂØπË±° (<code>Vertx</code> ÂÆû‰æã) ÁöÑÈóÆÈ¢ò. ‰πüÂ∞±ÊòØËØ¥, Êï¥‰∏™ Provider ‰∏≠, Âè™‰ºöÂ≠òÂú®‰∏Ä‰∏™ <code>Vertx</code> ÂÆû‰æã. ‰ΩÜÊòØ, ËøôÂπ∂‰∏çÂΩ±ÂìçRPCËØ∑Ê±ÇÁöÑÂπ∂ÂèëÂ§ÑÁêÜ, Âõ†‰∏∫:</p>
<ul>
<li><strong><code>Vert.x</code> ÁöÑÁâπÊÄß</strong>Ôºö<br><code>Vert.x</code> ÊòØ‰∏Ä‰∏™‰∫ã‰ª∂È©±Âä®ÁöÑÊ°ÜÊû∂, ÂÆÉÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØ<strong>ÈùûÈòªÂ°û I&#x2F;O</strong> Âíå<strong>‰∫ã‰ª∂Âæ™ÁéØ</strong>. ÂΩì‰Ω†Âú® <code>TcpServer</code> ‰∏≠‰ΩøÁî® <code>Vert.x</code> ÁöÑ <code>NetServer</code> Êó∂Ôºå<code>Vert.x</code> ‰ºöËá™Âä®Â§ÑÁêÜÂ§ö‰∏™Âπ∂ÂèëËøûÊé•, Âπ∂‰∏îÊØè‰∏™ËøûÊé•ÁöÑÂ§ÑÁêÜÊòØÈùûÈòªÂ°ûÁöÑ. ËøôÊÑèÂë≥ÁùÄ: <ul>
<li>Â§ö‰∏™ Consumer ÂèëÈÄÅÁöÑËØ∑Ê±Ç‰ºöË¢´ <code>Vert.x</code> Âπ∂ÂèëÂ§ÑÁêÜÔºåËÄå‰∏çÊòØÈ°∫Ê¨°Â§ÑÁêÜ. </li>
<li><code>Vert.x</code> ÁöÑ‰∫ã‰ª∂Âæ™ÁéØÊú∫Âà∂‰ºöÁ°Æ‰øùÈ´òÂπ∂ÂèëËØ∑Ê±ÇÁöÑÈ´òÊïàÂ§ÑÁêÜ.</li>
</ul>
</li>
<li><strong>Provider ‰∏≠ÁöÑ <code>RpcServer</code> ÂÆû‰æã</strong>Ôºö<br>Âú® Provider ‰∏≠Âè™ÂêØÂä®‰∫Ü‰∏Ä‰∏™ <code>RpcServer</code> ÂÆû‰æã (‰æãÂ¶Ç <code>TcpServer</code>), ‰ΩÜÁî±‰∫é <code>Vert.x</code> ÁöÑÂºÇÊ≠•ÂíåÈùûÈòªÂ°ûÁâπÊÄß, Ëøô‰∏™ÂÆû‰æãÂèØ‰ª•ÂêåÊó∂Â§ÑÁêÜÂ§ö‰∏™ Consumer ÁöÑËØ∑Ê±Ç. ÊØè‰∏™ËØ∑Ê±ÇÈÉΩ‰ºöÁî± <code>Vert.x</code> ÁöÑ‰∫ã‰ª∂Âæ™ÁéØÂàÜÈÖçÂà∞‰∏çÂêåÁöÑÁ∫øÁ®ã (Êàñ‰∫ã‰ª∂Âæ™ÁéØÁ∫øÁ®ã) ‰∏≠Â§ÑÁêÜ.</li>
</ul>
<p>ÊúÄÂêé, ‰ΩøÁî® <code>.connectHandler()</code> ÊñπÊ≥ïÁªëÂÆöÂ§ÑÁêÜÂô®.</p>
<p><strong>:star:TCP Â§ÑÁêÜÂô® <code>TcpServerHandler</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpServerHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;NetSocket&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(NetSocket netSocket)</span> &#123;</span><br><span class="line">        <span class="type">TcpBufferHandlerWrapper</span> <span class="variable">bufferHandlerWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TcpBufferHandlerWrapper</span>(buffer -&gt; &#123;</span><br><span class="line">            Protocol&lt;RpcRequest&gt; protocol;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                protocol = (Protocol&lt;RpcRequest&gt;) ProtocolUtils.decode(buffer);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Decode Err&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> protocol.getBody();</span><br><span class="line">            <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RpcResponse</span>();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class&lt;?&gt; serviceImpl = RpcLocalRegistry.getServiceImpl(rpcRequest.getServiceName());</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> serviceImpl.getMethod(rpcRequest.getMethodName(), rpcRequest.getParameterTypes());</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(serviceImpl.newInstance(), rpcRequest.getArgs());</span><br><span class="line"></span><br><span class="line">                rpcResponse.setData(result);</span><br><span class="line">                rpcResponse.setDataType(method.getReturnType());</span><br><span class="line">                rpcResponse.setMsg(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                rpcResponse.setMsg(e.getMessage());</span><br><span class="line">                rpcResponse.setException(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Protocol.<span class="type">Header</span> <span class="variable">header</span> <span class="operator">=</span> protocol.getHeader();</span><br><span class="line">            header.setType(ProtocolTypeEnum.RESPONSE.getCode());</span><br><span class="line">            Protocol&lt;RpcResponse&gt; responseProtocol = <span class="keyword">new</span> <span class="title class_">Protocol</span>&lt;&gt;(header, rpcResponse);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Buffer</span> <span class="variable">encodeBuffer</span> <span class="operator">=</span> ProtocolUtils.encode(responseProtocol);</span><br><span class="line">                netSocket.write(encodeBuffer);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Encode Err&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        netSocket.handler(bufferHandlerWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Âú® Handler ‰∏≠, <code>netSocket.handler()</code> ‰º†ÂÖ•‰∏Ä‰∏™ <code>Handler&lt;Buffer&gt;</code> ÂØπË±°, Áî®‰∫éÂ§ÑÁêÜÈÄö‰ø°ÁöÑÂ≠óËäÇÊµÅ.</p>
<p>‰ΩøÁî® <code>TcpBufferHandlerWrapper</code> ÂåÖË£π, ‰ª•Ëß£ÂÜ≥ÂçäÂåÖ&#x2F;Á≤òÂåÖÈóÆÈ¢ò.</p>
<p>Â§ÑÁêÜÁöÑ‰∏ª‰ΩìÈÄªËæëÊòØ:</p>
<ul>
<li>ÈÄöËøáÂÖ®Â±ÄÈÖçÁΩÆËé∑ÂèñÂ∫èÂàóÂåñÂô®, ‰ΩøÁî®Â∫èÂàóÂåñÂô®Â∞Ü‰º†ÂÖ•ÁöÑ buffer ÂèçÂ∫èÂàóÂåñÊàê <code>Protocol&lt;RpcRequest&gt; requestProtocol</code> , Ëé∑ÂèñÂÖ∂ <code>body</code>, Â∞±ÊòØ <code>rpcRequest</code></li>
<li>Âú® <code>rpcRequest</code> ‰∏≠Ëé∑ÂèñË¶ÅË∞ÉÁî®ÊúçÂä°ÁöÑ‰ø°ÊÅØ (ÊúçÂä°Êé•Âè£Âêç, ÊñπÊ≥ïÂêç, ÂèÇÊï∞Á±ªÂûãÂèäÂèÇÊï∞ÂàóË°®), ÈÄöËøá <code>RpcLocalRegistry</code> Ëé∑ÂèñÊúçÂä°ÂÆûÁé∞Á±ªÁöÑ Class ÂØπË±°, Âπ∂‰ΩøÁî® <code>invoke</code> Ë∞ÉÁî®Ëé∑ÂèñÊñπÊ≥ïËøîÂõûÁªìÊûú <code>result</code></li>
<li>Â∞ÜÁªìÊûúÂ∞ÅË£ÖËøõÂÖ• <code>rpcResponse</code>, Â∞Ü <code>rpcResponse</code> Â∞ÅË£ÖËøõÂÖ• <code>Protocol&lt;RpcResponse&gt; responseProtocol</code></li>
<li>ÈÄöËøá‰πãÂâçÁöÑÂ∫èÂàóÂåñÂô®Â∫èÂàóÂåñ <code>responseProtocol</code>, Âπ∂‰ΩøÁî® <code>netSocket.write(encodeBuffer);</code> Â∞Ü buffer ÂÜôÂÖ•socket</li>
</ul>
<p><strong>:star:TCP ÂÆ¢Êà∑Á´ØÂÆûÁé∞ <code>TcpClient</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpClient</span> <span class="keyword">implements</span> <span class="title class_">RpcClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx(); <span class="comment">// signal instance</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">NetClient</span> <span class="variable">netClient</span> <span class="operator">=</span> vertx.createNetClient(<span class="keyword">new</span> <span class="title class_">NetClientOptions</span>()); <span class="comment">// signal instance</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RpcResponse <span class="title function_">request</span><span class="params">(RpcRequest rpcRequest, ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        CompletableFuture&lt;RpcResponse&gt; responseCompletableFuture = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        netClient.connect(</span><br><span class="line">                serviceMetaInfo.getServicePost(),</span><br><span class="line">                serviceMetaInfo.getServiceHost(),</span><br><span class="line">                netSocketAsyncResult -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!netSocketAsyncResult.succeeded()) &#123;</span><br><span class="line">                        System.err.println(netSocketAsyncResult.cause().getMessage());</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="type">NetSocket</span> <span class="variable">netSocket</span> <span class="operator">=</span> netSocketAsyncResult.result();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// make date</span></span><br><span class="line">                    Protocol.<span class="type">Header</span> <span class="variable">header</span> <span class="operator">=</span> Protocol.Header.builder()</span><br><span class="line">                            .magic(ProtocolConst.MAGIC)</span><br><span class="line">                            .version(ProtocolConst.VERSION)</span><br><span class="line">                            .serializer(ProtocolSerializerEnum.getByKey(RpcApplication.getRpcConfig().getSerializer()).getCode())</span><br><span class="line">                            .type(ProtocolTypeEnum.REQUEST.getCode())</span><br><span class="line">                            .requestId(IdUtil.getSnowflakeNextId())</span><br><span class="line">                            .build();</span><br><span class="line">                    Protocol&lt;RpcRequest&gt; rpcRequestProtocol = <span class="keyword">new</span> <span class="title class_">Protocol</span>&lt;&gt;(header, rpcRequest);</span><br><span class="line">                    rpcRequestProtocol.setHeader(header);</span><br><span class="line">                    rpcRequestProtocol.setBody(rpcRequest);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// send data</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="type">Buffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ProtocolUtils.encode(rpcRequestProtocol);</span><br><span class="line">                        netSocket.write(buffer);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Encode failed&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// get response data</span></span><br><span class="line">                    <span class="type">TcpBufferHandlerWrapper</span> <span class="variable">bufferHandlerWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TcpBufferHandlerWrapper</span>(buffer -&gt; &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            Protocol&lt;RpcResponse&gt; responseProtocol =</span><br><span class="line">                                    (Protocol&lt;RpcResponse&gt;) ProtocolUtils.decode(buffer);</span><br><span class="line">                            responseCompletableFuture.complete(responseProtocol.getBody());</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Decode failed&quot;</span>, e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    netSocket.handler(bufferHandlerWrapper);</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> responseCompletableFuture.get();</span><br><span class="line">        <span class="keyword">return</span> rpcResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TcpClient</code> ÁöÑÂÆû‰æãË¢´Â≠òÂÇ®Âú®Â∑•ÂéÇÁ±ª‰∏≠, ‰ΩÜÊòØ, Áî±‰∫é Consumer Ë¶ÅÂ§öÊ¨°Ë∞ÉÁî® <code>request</code> ÊñπÊ≥ï, Âõ†Ê≠§ÈÄâÊã©Êää <code>Vertx</code> Âíå <code>NetClient</code> ÂÆû‰æã‰Ωú‰∏∫ÈùôÊÄÅÂèòÈáè, ÈÅøÂÖçÊØèÊ¨°Ë∞ÉÁî® <code>request</code> ÁöÑÊó∂ÂÄôÈÉΩÂàõÂª∫ËøûÊé•.</p>
<p>Â∞Ü‰ª•‰∏äÁöÑ <code>RpcServer</code> Âíå <code>RpcClient</code> ÂàÜÂºÄÊûÑÂª∫ÁöÑÂéüÂõ†ÊòØ: ‰∏∫‰∫ÜÊª°Ë∂≥‰∏Ä‰∏™ËäÇÁÇπ‰Ωú‰∏∫ Consumer ÁöÑÂêåÊó∂‰πüÊèê‰æõÊúçÂä°, ‰Ωú‰∏∫ Provider. </p>
<p><strong>:star:Ëß£ÂÜ≥ÂçäÂåÖÁ≤òÂåÖÂ§ÑÁêÜÂô® <code>TcpBufferHandlerWrapper</code></strong></p>
<p>‰∏∫‰∫ÜËß£ÂÜ≥ TCP ‰º†Ëæì‰∏≠ÁöÑÂçäÂåÖÁ≤òÂåÖÈóÆÈ¢ò, ÊûÑÈÄ†‰∏Ä‰∏™Â§ÑÁêÜÂô®, ÂÆÉÂÆûÁé∞Âπ∂Â¢ûÂº∫ <code>Handler&lt;Buffer&gt;</code> Êé•Âè£. ËøôÁßçÂÅöÊ≥ïÊòØËÆæËÆ°Ê®°Âºè‰∏≠ÁöÑ <strong>Ë£ÖÈ•∞ËÄÖÊ®°Âºè</strong>, ‰ΩøÁî® <code>RecordParser</code> ÂØπÂéüÊúâÁöÑ <code>Buffer</code> Â§ÑÁêÜÂô®ÁöÑËÉΩÂäõËøõË°åÂ¢ûÂº∫. Ë£ÖÈ•∞ËÄÖÊ®°ÂºèÂèØ‰ª•ÁÆÄÂçïÁêÜËß£‰∏∫ÁªôÂØπË±°Á©øË£ÖÂ§á, Â¢ûÂº∫ÂØπË±°ÁöÑËÉΩÂäõ. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpBufferHandlerWrapper</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;Buffer&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RecordParser recordParser;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RecordParser <span class="title function_">initRecordParser</span><span class="params">(Handler&lt;Buffer&gt; bufferHandler)</span> &#123;</span><br><span class="line">        <span class="type">RecordParser</span> <span class="variable">parser</span> <span class="operator">=</span> RecordParser.newFixed(ProtocolConst.HEADER_LENGTH);</span><br><span class="line">        parser.setOutput(<span class="keyword">new</span> <span class="title class_">Handler</span>&lt;Buffer&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bodyLength</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="type">Buffer</span> <span class="variable">resultBuffer</span> <span class="operator">=</span> Buffer.buffer();</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (-<span class="number">1</span> == bodyLength) &#123;</span><br><span class="line">                    <span class="comment">// 1. È¶ñÂÖàËß£Êûê HeaderÔºàÂõ∫ÂÆöÈïøÂ∫¶ 17 Â≠óËäÇÔºâ</span></span><br><span class="line">                    bodyLength = buffer.getInt(<span class="number">13</span>); <span class="comment">// Ëé∑Âèñ Body ÁöÑÈïøÂ∫¶ÔºåÂÅáËÆæHeaderÁöÑÁ¥¢Âºï 13..=16 Â≠óËäÇË°®Á§∫ BodyLength</span></span><br><span class="line">                    parser.fixedSizeMode(bodyLength); <span class="comment">// Ê†πÊçÆBodyÁöÑÈïøÂ∫¶ËÆæÁΩÆÊé•‰∏ãÊù•ÁöÑËß£ÊûêÊ®°Âºè</span></span><br><span class="line">                    resultBuffer.appendBuffer(buffer); <span class="comment">// Â∞ÜHeaderÊï∞ÊçÆÁºìÂ≠òËµ∑Êù•</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 2. Êé•Êî∂ Body Êï∞ÊçÆ</span></span><br><span class="line">                    resultBuffer.appendBuffer(buffer); <span class="comment">// Â∞ÜÊé•Êî∂Âà∞ÁöÑBodyÊï∞ÊçÆÊ∑ªÂä†Âà∞ÁºìÂ≠ò‰∏≠</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (resultBuffer.length() &gt;= bodyLength + ProtocolConst.HEADER_LENGTH) &#123;</span><br><span class="line">                        bufferHandler.handle(resultBuffer); <span class="comment">// Ë∞ÉÁî®Â§ñÈÉ®‰º†ÂÖ•ÁöÑÂõûË∞ÉÔºåÂ§ÑÁêÜÂÆåÊï¥ÁöÑÊ∂àÊÅØ</span></span><br><span class="line">                        <span class="comment">// 4. Â§ÑÁêÜÂÆåÂêéÔºåÈáçÁΩÆÁä∂ÊÄÅÔºåÂáÜÂ§áÂ§ÑÁêÜ‰∏ã‰∏Ä‰∏™Êï∞ÊçÆÂåÖ</span></span><br><span class="line">                        parser.fixedSizeMode(ProtocolConst.HEADER_LENGTH);</span><br><span class="line">                        bodyLength = -<span class="number">1</span>; <span class="comment">// ÈáçÁΩÆBodyÈïøÂ∫¶</span></span><br><span class="line">                        resultBuffer = Buffer.buffer(); <span class="comment">// ÈáçÁΩÆÁºìÂ≠ò</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> parser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TcpBufferHandlerWrapper</span><span class="params">(Handler&lt;Buffer&gt; bufferHandler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.recordParser = initRecordParser(bufferHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">        recordParser.handle(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SPI-ÁªÑ‰ª∂-com-ypy-pyrpc-spi"><a href="#SPI-ÁªÑ‰ª∂-com-ypy-pyrpc-spi" class="headerlink" title="SPI ÁªÑ‰ª∂ com.ypy.pyrpc.spi"></a>SPI ÁªÑ‰ª∂ <code>com.ypy.pyrpc.spi</code></h3><p>**SPI (Service Provider Interface) ** ÊòØ‰∏ÄÁßçÊúçÂä°ÂèëÁé∞Êú∫Âà∂, Áî®‰∫éÂú®ËøêË°åÊó∂Âä®ÊÄÅÂä†ËΩΩÂÆûÁé∞Á±ª. ÂÆÉÊòØ Java Êèê‰æõÁöÑ‰∏ÄÁßçÊ†áÂáÜÊâ©Â±ïÁÇπÊú∫Âà∂, ÂÖÅËÆ∏Ê°ÜÊû∂ÊàñÂ∫ìÂÆö‰πâÊé•Âè£, Âπ∂Áî±Á¨¨‰∏âÊñπÊèê‰æõÂÆûÁé∞. SPI ÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØ <strong>Ëß£ËÄ¶Êé•Âè£‰∏éÂÆûÁé∞</strong>, ‰ΩøÂæóÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•Âú®‰∏ç‰øÆÊîπ‰ª£Á†ÅÁöÑÊÉÖÂÜµ‰∏ãÊâ©Â±ïÂäüËÉΩ. ËØ¥ÁôΩ‰∫Ü, Â∞±ÊòØSDK‰∏≠Êèê‰æõ‰∏Ä‰∫õÊé•Âè£ÂíåÈªòËÆ§ÂÆûÁé∞Á±ª, ÂΩìÂºÄÂèëËÄÖ‰∏çÊÉ≥‰ΩøÁî®SDKÊèê‰æõÁöÑÂÆûÁé∞Á±ªÊó∂, ‰ªñ‰ª¨ÂèØ‰ª•Ëá™Â∑±ÂÜô‰∏Ä‰∏™ÂÆûÁé∞Á±ª, Âπ∂ÈÄöËøáÈÖçÁΩÆËÆ©SDK‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑÂÆûÁé∞Á±ª.</p>
<p><strong>:star:SPIÂØºÂÖ•Âô®<code>SpiLoader</code>‚Äã</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpiLoader</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * store the class that has been load, &#123;interfaceName: &#123;implClassKey: implClass&#125;&#125;</span></span><br><span class="line"><span class="comment">     * className means full name, e.g. com.ypy.pyrpc.spi.serializer.Serializer</span></span><br><span class="line"><span class="comment">     * classKey means a short key, representing some implClass, e.g. jdk=JdkSerializer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Map&lt;String, Class&lt;?&gt;&gt;&gt; spiMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * cache of instance, avoid repeat &quot;new&quot;</span></span><br><span class="line"><span class="comment">     * &#123;implClassName: implClassInstance&#125;</span></span><br><span class="line"><span class="comment">     * full-name, not a key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Object&gt; implClassInstanceCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RPC_SYSTEM_SPI_DIR</span> <span class="operator">=</span> <span class="string">&quot;META-INF/pyrpc/system/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RPC_CUSTOM_SPI_DIR</span> <span class="operator">=</span> <span class="string">&quot;META-INF/pyrpc/custom/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] SCAN_DIRS = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;RPC_SYSTEM_SPI_DIR, RPC_CUSTOM_SPI_DIR&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Class&lt;?&gt;&gt; load(Class&lt;?&gt; interfaceClass) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">interfaceName</span> <span class="operator">=</span> interfaceClass.getName();</span><br><span class="line">        Map&lt;String, Class&lt;?&gt;&gt; implKey2implClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); <span class="comment">// &#123;implClassKey: implClass&#125;</span></span><br><span class="line">        <span class="keyword">for</span> (String dir : SCAN_DIRS) &#123;</span><br><span class="line">            List&lt;URL&gt; resources = ResourceUtil.getResources(dir + interfaceName);</span><br><span class="line">            <span class="keyword">for</span> (URL resource : resources) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(resource.openStream());</span><br><span class="line">                    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                        String[] split = line.split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (split.length == <span class="number">2</span>) &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">implClassKey</span> <span class="operator">=</span> split[<span class="number">0</span>];</span><br><span class="line">                            <span class="type">String</span> <span class="variable">implClassName</span> <span class="operator">=</span> split[<span class="number">1</span>];</span><br><span class="line">                            implKey2implClassMap.put(implClassKey, Class.forName(implClassName));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;spi resource load error&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        spiMap.put(interfaceName, implKey2implClassMap);</span><br><span class="line">        <span class="keyword">return</span> implKey2implClassMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getInstance</span><span class="params">(Class&lt;T&gt; interfaceClass, String implClassKey)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">interfaceName</span> <span class="operator">=</span> interfaceClass.getName();</span><br><span class="line">        Map&lt;String, Class&lt;?&gt;&gt; implKey2implClassMap = spiMap.get(interfaceName);</span><br><span class="line">        <span class="keyword">if</span> (implKey2implClassMap == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Interface &quot;</span> + interfaceName + <span class="string">&quot; has no implement classes&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!implKey2implClassMap.containsKey(implClassKey)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Interface &quot;</span> + interfaceName + <span class="string">&quot; has no implement &quot;</span> + implClassKey);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; implClass = implKey2implClassMap.get(implClassKey);</span><br><span class="line">        <span class="keyword">if</span> (!implClassInstanceCache.containsKey(implClass.getName())) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                implClassInstanceCache.put(implClass.getName(), implClass.newInstance());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Write &quot;</span> + implClass.getName() + <span class="string">&quot; into cache failed&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) implClassInstanceCache.get(implClass.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‰ΩøÁî®‰∏§‰∏™<code>ConcurrentHashMap</code>Â≠òË¥ÆÂäüËÉΩÊé•Âè£ÂíåÂÆûÁé∞Á±ªÁöÑ‰ø°ÊÅØ, Âπ∂ÂºïÂÖ•ÁºìÂ≠òÊú∫Âà∂:</p>
<ul>
<li><code>spiMap</code> ÁöÑÂ≠òÂÇ®Ê®°ÂºèÊòØ: <code>&#123;interfaceName: &#123;implClassKey: implClass&#125;&#125;</code>, ‰æãÂ¶Ç <code>&#123;&quot;Registry&quot; : &#123;&quot;jdk&quot;: Class&lt;JdkRegistry&gt;, &quot;json&quot;: Class&lt;JsonRegistry&gt;&#125;&#125;</code></li>
<li><code>implClassInstanceCache</code> ÁöÑÂ≠òÂÇ®Ê®°ÂºèÊòØ: <code>&#123;implClassName: implClassInstance&#125;</code>, ‰æãÂ¶Ç <code>&#123;&quot;JdkRegistry&quot;: JdkRegistry&#125;</code>. ‰Ωú‰∏∫ÂØπË±°ÁºìÂ≠ò, ÈÅøÂÖçÈáçÂ§çnewÂØπË±°</li>
</ul>
<p>‰ΩøÁî®SPIÊú∫Âà∂, ‰∏∫‰ª•‰∏ãÂõõ‰∏™ÂäüËÉΩÊ®°ÂùóÊèê‰æõ‰∫ÜÂèØÂÆöÂà∂ÂåñÈÄâÊã©: 1) Ê≥®ÂÜå‰∏≠ÂøÉ; 2) Â∫èÂàóÂåñÂô®; 3) Ë¥üËΩΩÂùáË°°Âô®; 4) ÈáçËØïÂíåÂÆπÈîôÂô®. ÂÆÉ‰ª¨ÊúâÂØπÂ∫îÁöÑÂ∑•ÂéÇÁ±ª, ‰æãÂ¶Ç</p>
<p><strong>:stars:<code>RegistryFactory</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegistryFactory</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123; SpiLoader.load(Registry.class); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title function_">getInstance</span><span class="params">(String implClassKey)</span> &#123; <span class="keyword">return</span> SpiLoader.getInstance(Registry.class, implClassKey); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂΩìÈ°πÁõÆÂä†ËΩΩÊó∂, Â∑•ÂéÇÁ±ªÁöÑ <code>static</code> ÈÉ®ÂàÜ‰ºöË∞ÉÁî® <code>loader</code> ÊñπÊ≥ï, Â∞ÜÈªòËÆ§ÂÆûÁé∞Á±ªÂíåÁî®Êà∑ÂÆûÁé∞Á±ªÂä†ÂÖ• <code>SpiLoader</code> ‰∏≠ÁöÑÂ≠óÂÖ∏ÂÆπÂô®, ÂêåÊó∂, Áî±‰∫éÊòØÂÖàËΩΩÂÖ•Ê°ÜÊû∂ÈªòËÆ§ÂÆûÁé∞Á±ªÂêéËΩΩÂÖ•Áî®Êà∑Ëá™ÂÆö‰πâÂÆûÁé∞Á±ª, Âõ†Ê≠§Áî®Êà∑Ëá™ÂÆö‰πâÁöÑkey‰ºöË¶ÜÁõñÊ°ÜÊû∂ÈªòËÆ§ÁöÑkey, ËøôÊ†∑ÊòØÊõ¥Âä†ÂêàÁêÜÁöÑ. </p>
<p>‰∏ãÈù¢ÂàÜÂà´‰ªãÁªç‰∏Ä‰∏ãÊ°ÜÊû∂‰∏≠ÁöÑÈªòËÆ§ÂÆûÁé∞Á±ª.</p>
<h4 id="Â∫èÂàóÂåñÂô®ÁªÑ‰ª∂-com-ypy-pyrpc-spi-serializer"><a href="#Â∫èÂàóÂåñÂô®ÁªÑ‰ª∂-com-ypy-pyrpc-spi-serializer" class="headerlink" title="Â∫èÂàóÂåñÂô®ÁªÑ‰ª∂ com.ypy.pyrpc.spi.serializer"></a>Â∫èÂàóÂåñÂô®ÁªÑ‰ª∂ <code>com.ypy.pyrpc.spi.serializer</code></h4><p><strong>:star:<code>Serializer</code> Êé•Âè£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializer</span> &#123;</span><br><span class="line">    &lt;T&gt; <span class="type">byte</span>[] serialize(T obj) <span class="keyword">throws</span> IOException;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] data, Class&lt;T&gt; type)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ê°ÜÊû∂Êèê‰æõÁöÑÈªòËÆ§ÂÆûÁé∞Á±ªÂú® <code>impl</code> ÂåÖ‰∏≠, Êúâ JDK, JSON, KRYO ‰∏âÁßçÂ∫èÂàóÂåñÂô®. </p>
<h4 id="Ê≥®ÂÜå‰∏≠ÂøÉÁªÑ‰ª∂-com-ypy-pyrpc-spi-registry"><a href="#Ê≥®ÂÜå‰∏≠ÂøÉÁªÑ‰ª∂-com-ypy-pyrpc-spi-registry" class="headerlink" title="Ê≥®ÂÜå‰∏≠ÂøÉÁªÑ‰ª∂ com.ypy.pyrpc.spi.registry"></a>Ê≥®ÂÜå‰∏≠ÂøÉÁªÑ‰ª∂ <code>com.ypy.pyrpc.spi.registry</code></h4><p><strong>:smile:ÂΩ¢Ë±°ÁöÑ‰æãÂ≠ê</strong></p>
<p>È£üÂÆ¢ - ÁÇπÈ§êÂπ≥Âè∞ (ÁæéÂõ¢) - È•≠È¶Ü: È£üÂÆ¢ &#x3D; Consumer, ÁæéÂõ¢ &#x3D; Ê≥®ÂÜå‰∏≠ÂøÉ, È§êÈ¶Ü &#x3D; Provider. </p>
<p>È£üÂÆ¢‰ªéÁæéÂõ¢‰∏çÊòØÂéªÂêÉËèú (Ë∞ÉÁî®ÊúçÂä°), ËÄåÊòØËé∑ÂèñÈ§êÈ¶ÜÂíåËèúÂìÅ‰ø°ÊÅØ, ÁÑ∂ÂêéÂÜçÂéªÈ§êÈ¶ÜÂêÉËèú (ÂèëËµ∑ RPC ËØ∑Ê±Ç). </p>
<p>È§êÈ¶Ü (Provider) Ë¶ÅÂÖàÂÅöËèú (ÊääÊèê‰æõÁöÑÊúçÂä°Â≠òÂÖ•Êú¨Âú∞Ê≥®ÂÜå‰∏≠ÂøÉ <code>RpcLocalRegistry</code>) ÂÜçÊääÁõ∏Â∫îÁöÑËèúÂìÅ‰ø°ÊÅØÂ≠òÂÖ•ÁæéÂõ¢ (ÊääÊèê‰æõÁöÑÊúçÂä°ÁöÑ‰ø°ÊÅØÊèê‰∫§Áªô <code>Registry</code>, <code>Registry</code> Êää‰ø°ÊÅØÂ≠òÂÖ• ETCD), ËøôÊ†∑È°æÂÆ¢ÊâçËÉΩÂèëÁé∞ËèúÂìÅ. </p>
<p>ÊâÄË∞ìÊúçÂä°ÂèëÁé∞ÁºìÂ≠ò, ÂÆûÈôÖÂ∞±ÊòØ, ÂΩì‰∏Ä‰∏™È£üÂÆ¢ÁªèÂ∏∏ÂéªÊüêÈ§êÈ¶ÜÂêÉÈ•≠, ‰ªñÂéªÂ§ö‰∫Ü, ‰πüÂ∞±Ê≤°ÊúâÂøÖË¶ÅÊ¨°Ê¨°ÈÉΩÂéªÂà∞ÁæéÂõ¢‰∏äÊü•ÁúãÂÖ≥‰∫éÈ§êÈ¶ÜÁöÑ‰ø°ÊÅØ (‰æãÂ¶ÇÂú®Âì™Èáå, ÊúâÂì™‰∫õËèúÂìÅ). </p>
<p><strong>:star:<code>Registry</code>‚Äã Êé•Âè£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Registry</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * initialize registry for both PROVIDER and CONSUMER</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registryConfig</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(RpcConfig.RegistryConfig registryConfig)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help PROVIDER to register their service (info) into registry</span></span><br><span class="line"><span class="comment">     * and these services should also be registered and managed by LocalRegistry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceMetaInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help PROVIDER to unregister service</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceMetaInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unregister</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help CONSUMER to search a group of service meta info by ServiceNameVersion</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceNameVer: &quot;serviceName:serviceVersion&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;ServiceMetaInfo&gt; <span class="title function_">serviceDiscovery</span><span class="params">(String serviceNameVer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * when a PROVIDER offline, clear correlative service info it provided in registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * send update message to registry, confirming PROVIDED alive</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">heartBeat</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help CONSUMER to watch PROVIDER, when a Provider offline (actively or passively), it will update local cache info of CONSUMER</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fullRegistryServiceKey: /[RPC_ROOT_PATH]/[ServiceName]:[ServiceVersion]/[ServiceAddr]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">(String fullRegistryServiceKey, String serviceNameVer)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ê≥®ÂÜå‰∏≠ÂøÉÊé•Âè£ÊúâÂÖ≠‰∏™ÊñπÊ≥ï, ÂàÜÂà´ÊòØÊ≥®ÂÜå‰∏≠ÂøÉÂàùÂßãÂåñ, ÊúçÂä°Ê≥®ÂÜå, ÊúçÂä°Ê≥®ÈîÄ, ÊúçÂä°ÂèëÁé∞, ËäÇÁÇπÂÖ≥Èó≠, ÂøÉË∑≥Ê£ÄÊµã, ‰ª•ÂèäËäÇÁÇπÁõëËßÜ. </p>
<p>Âú® <code>impl</code> ÂåÖ‰∏≠, Êèê‰æõ‰∫Ü ETCD ÁöÑÈªòËÆ§ÂÆûÁé∞ (<code>com.ypy.pyrpc.spi.registry.impl.EtcdRegistry</code>), ‰ª•ÂèäÊó†Ê≥®ÂÜå‰∏≠ÂøÉÁöÑÂÆûÁé∞ <code>NoRegistry</code>. </p>
<p>ÂÆûÁé∞‰∏Ä‰∏™Ê≥®ÂÜå‰∏≠ÂøÉÊòØ‰∏Ä‰∏™ÈöæÁÇπ, Êàë‰ª¨ËØ¶ÁªÜËØ¥‰∏Ä‰∏ã:</p>
<p><strong>:stars:<code>EtcdRegistry</code>‚Äã ETCD Ê≥®ÂÜå‰∏≠ÂøÉ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EtcdRegistry</span> <span class="keyword">implements</span> <span class="title class_">Registry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Client cli;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> KV kvCli;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ETCD_ROOT_PATH</span> <span class="operator">=</span> <span class="string">&quot;/pyrpc/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fullRegistryServiceKey: /pyrpc/com.....UserService:1.0.0/http://127.0.0.1:8080</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * this collection stores data for PROVIDER</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; loaclFullRegistryServiceKeySet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key is serviceNameVersion</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * this collection stores data for CONSUMER, make convenience through cache ServiceNameVer and their MetaInfo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;ServiceMetaInfo&gt;&gt; serviceNameVerCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; watchingNodeKeySet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(RpcConfig.RegistryConfig registryConfig)</span> &#123;</span><br><span class="line">        cli = Client.builder()</span><br><span class="line">                .endpoints(registryConfig.getAddr())</span><br><span class="line">                .connectTimeout(Duration.ofMillis(registryConfig.getTimeout()))</span><br><span class="line">                .build();</span><br><span class="line">        kvCli = cli.getKVClient();</span><br><span class="line">        heartBeat();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Lease</span> <span class="variable">leaseCli</span> <span class="operator">=</span> cli.getLeaseClient();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">leaseId</span> <span class="operator">=</span> leaseCli.grant(<span class="number">30L</span>).get().getID();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fullRegistryServiceKey</span> <span class="operator">=</span> ETCD_ROOT_PATH + serviceMetaInfo.getServiceNameVerAddr();</span><br><span class="line">        <span class="type">ByteSequence</span> <span class="variable">k</span> <span class="operator">=</span> ByteSequence.from(fullRegistryServiceKey, StandardCharsets.UTF_8);</span><br><span class="line">        <span class="type">ByteSequence</span> <span class="variable">v</span> <span class="operator">=</span> ByteSequence.from(JSONUtil.toJsonStr(serviceMetaInfo), StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">        <span class="type">PutOption</span> <span class="variable">putOption</span> <span class="operator">=</span> PutOption.builder().withLeaseId(leaseId).build();</span><br><span class="line">        kvCli.put(k, v, putOption).get();</span><br><span class="line">        loaclFullRegistryServiceKeySet.add(fullRegistryServiceKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unregister</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fullRegistryServiceKey</span> <span class="operator">=</span> ETCD_ROOT_PATH + serviceMetaInfo.getServiceNameVerAddr();</span><br><span class="line">        kvCli.delete(ByteSequence.from(fullRegistryServiceKey, StandardCharsets.UTF_8));</span><br><span class="line">        loaclFullRegistryServiceKeySet.remove(serviceMetaInfo.getServiceNameVerAddr());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ServiceMetaInfo&gt; <span class="title function_">serviceDiscovery</span><span class="params">(String serviceNameVer)</span> &#123;</span><br><span class="line">        List&lt;ServiceMetaInfo&gt; cachedServiceMetaInfos = serviceNameVerCache.get(serviceNameVer);</span><br><span class="line">        <span class="keyword">if</span> (cachedServiceMetaInfos != <span class="literal">null</span>) <span class="keyword">return</span> cachedServiceMetaInfos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// search in etcd</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">searchPrefix</span> <span class="operator">=</span> ETCD_ROOT_PATH + serviceNameVer + <span class="string">&quot;/&quot;</span>; <span class="comment">// add &quot;/&quot; means search for group</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">GetOption</span> <span class="variable">getOption</span> <span class="operator">=</span> GetOption.builder().isPrefix(<span class="literal">true</span>).build();</span><br><span class="line">            List&lt;KeyValue&gt; kvs = kvCli.get(</span><br><span class="line">                    ByteSequence.from(searchPrefix, StandardCharsets.UTF_8),</span><br><span class="line">                    getOption</span><br><span class="line">            ).get().getKvs();</span><br><span class="line"></span><br><span class="line">            List&lt;ServiceMetaInfo&gt; serviceMetaInfoList = kvs.stream()</span><br><span class="line">                    .map(kv -&gt; &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">fullRegistryServiceKey</span> <span class="operator">=</span> kv.getKey().toString(StandardCharsets.UTF_8);</span><br><span class="line">                        watch(fullRegistryServiceKey, serviceNameVer);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> kv.getValue().toString(StandardCharsets.UTF_8);</span><br><span class="line">                        <span class="keyword">return</span> JSONUtil.toBean(val, ServiceMetaInfo.class);</span><br><span class="line">                    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            serviceNameVerCache.put(serviceNameVer, serviceMetaInfoList);</span><br><span class="line">            <span class="keyword">return</span> serviceMetaInfoList;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Get service list failed&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String key : loaclFullRegistryServiceKeySet) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                kvCli.delete(ByteSequence.from(key, StandardCharsets.UTF_8));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(key + <span class="string">&quot;: delete etcd node failed&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (kvCli != <span class="literal">null</span>) kvCli.close();</span><br><span class="line">        <span class="keyword">if</span> (cli != <span class="literal">null</span>) cli.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Destroy Current Node&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">heartBeat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// every 10 seconds, update lease for all services provided by current Provider</span></span><br><span class="line">        CronUtil.schedule(<span class="string">&quot;*/10 * * * * *&quot;</span>, <span class="keyword">new</span> <span class="title class_">Task</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (String key : loaclFullRegistryServiceKeySet) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        List&lt;KeyValue&gt; kvs = kvCli.get(ByteSequence.from(key, StandardCharsets.UTF_8))</span><br><span class="line">                                .get()</span><br><span class="line">                                .getKvs();</span><br><span class="line">                        <span class="keyword">if</span> (kvs.isEmpty()) <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="type">KeyValue</span> <span class="variable">kv</span> <span class="operator">=</span> kvs.get(<span class="number">0</span>);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> kv.getValue().toString(StandardCharsets.UTF_8);</span><br><span class="line">                        <span class="type">ServiceMetaInfo</span> <span class="variable">serviceMetaInfo</span> <span class="operator">=</span> JSONUtil.toBean(val, ServiceMetaInfo.class);</span><br><span class="line">                        register(serviceMetaInfo);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(key + <span class="string">&quot;: updating lease failed&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        CronUtil.setMatchSecond(<span class="literal">true</span>);</span><br><span class="line">        CronUtil.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">(String fullRegistryServiceKey, String serviceNameVer)</span> &#123;</span><br><span class="line">        <span class="type">Watch</span> <span class="variable">watchCli</span> <span class="operator">=</span> cli.getWatchClient();</span><br><span class="line">        <span class="keyword">if</span> (watchingNodeKeySet.add(fullRegistryServiceKey)) &#123;</span><br><span class="line">            watchCli.watch(ByteSequence.from(fullRegistryServiceKey, StandardCharsets.UTF_8), watchResponse -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (WatchEvent event : watchResponse.getEvents()) &#123;</span><br><span class="line">                    <span class="keyword">switch</span> (event.getEventType()) &#123;</span><br><span class="line">                        <span class="keyword">case</span> DELETE:</span><br><span class="line">                            serviceNameVerCache.remove(serviceNameVer);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> PUT:</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂÖàÁúãÊàêÂëòÂèòÈáè: Áî±‰∫é <code>EtcdRegistry</code> ÂÆû‰æãÊòØË¢´‰øùÂ≠òÂú® <code>SpiLoader</code> ‰∏≠, Âõ†Ê≠§ÊØèÊ¨°Ëé∑ÂèñÂÆû‰æãÊó∂Âπ∂‰∏ç‰ºöÈáçÂ§çÂàõÂª∫ÂÆû‰æã, ÊâÄ‰ª•ÂÖ∂‰∏≠ÁöÑÊàêÂëòÂèòÈáèÈÉΩ‰∏çÈúÄË¶ÅËÆæÁΩÆ‰∏∫ <code>static</code>.</p>
<ul>
<li><code>Client cli</code> ÊòØ <code>jetcd</code> ‰∏≠, Êìç‰Ωú ETCD ÁöÑÂÆ¢Êà∑Á´Ø, <code>jectd</code> ÊòØ‰∏ìÈó®‰∏∫ Java Êìç‰Ωú ECTD ÁöÑ SDK, Áõ∏ÂΩì‰∫é Jedis &#x2F; Redission ‰πã‰∫é Redis</li>
<li><code>kvCli</code> ÊòØÁî± <code>cli</code> ÁîüÊàêÁöÑÊìç‰ΩúÈîÆÂÄºÂØπÁöÑÂÆ¢Êà∑Á´Ø</li>
<li><code>ETCD_ROOT_PATH</code> ÊòØÂ≠òÂÇ®Âú® ETCD Êï∞ÊçÆÂ∫ì‰∏≠Êú¨È°πÁõÆÁöÑÊ†áËØÜÂâçÁºÄ, Áî®Êù•‰∏éÂÖ∂ÂÆÉÈ°πÁõÆÂå∫ÂàÜ</li>
<li><code>Set&lt;String&gt; loaclFullRegistryServiceKeySet</code> ÊòØÂ≠òÂÇ®Êú¨Âú∞ (‰πüÂ∞±ÊòØÂΩìÂâç Provider) ‰∏≠Êèê‰æõÁöÑÊúçÂä°‰ø°ÊÅØ, ÂÆÉÈáåÈù¢Â≠òÁöÑÊòØÊúçÂä°ÁöÑÂÖ®ÈÉ®‰ø°ÊÅØ, ÂÖ∂ÁªìÊûÑ‰∏∫ <code>/pyrpc/com.....UserService:1.0.0/http://127.0.0.1:8080</code> Âç≥ÂâçÁºÄ + ÊúçÂä°Êé•Âè£Âêç + ÁâàÊú¨Âè∑ + Provider Âú∞ÂùÄ</li>
<li><code>Map&lt;String, List&lt;ServiceMetaInfo&gt;&gt; serviceNameVerCache</code> ÊòØ‰∏∫ <strong>Consumer</strong> Êèê‰æõÁöÑÊúçÂä°ÂèëÁé∞ÁºìÂ≠ò, Âõ†‰∏∫ Consumer ÂèëÈÄÅ RPC ËØ∑Ê±ÇÊòØÂæàÈ¢ëÁπÅÁöÑ, Êàë‰ª¨Ê≤°ÊúâÂøÖË¶ÅÊØè‰∏ÄÊ¨°ÈÉΩÂêë ETCD ËØ∑Ê±ÇÊúçÂä°‰ø°ÊÅØ, ËÄåÊòØÈÄâÊã©ÊääÂØπÂ∫îÁöÑ‰ø°ÊÅØÁºìÂ≠òËµ∑Êù•, ËøôÊ†∑ Consumer Â∞±ÂèØ‰ª•Êõ¥Âä†È´òÊïàÁöÑËé∑ÂèñÊúçÂä°‰ø°ÊÅØ, ÂÜçÊèê‰æõ‰ø°ÊÅØÂèëÈÄÅRPCËØ∑Ê±Ç‰∫Ü. Áî±‰∫éÂèëÁé∞ÊúçÂä°ÊòØ Consumer Êèê‰æõÊúçÂä°Êé•Âè£ÂêçÂíåÁâàÊú¨Âè∑, Âõ†Ê≠§ <code>serviceNameVerCache</code> ÁöÑ key ÁªìÊûÑ‰∏∫ <code>com.....UserService:1.0.0</code></li>
<li><code>Set&lt;String&gt; watchingNodeKeySet</code> ÊòØ‰∏∫ Consumer Êèê‰æõÁöÑÁõëËßÜÊú∫Âà∂, ÂÆÉÂ≠òÂÇ®‰∫ÜÊ≠£Âú®ÁõëËßÜÁöÑÁªìÁÇπ, ÈáåÈù¢Â≠òÂÇ®ÁöÑÊòØ <code>fullRegistryServiceKey</code>, ‰πüÂ∞±ÊòØÂâçÁºÄ + ÊúçÂä°Êé•Âè£Âêç + ÁâàÊú¨Âè∑ + Provider Âú∞ÂùÄÁöÑÂÖ®ÈÉ®‰ø°ÊÅØ</li>
</ul>
<p>ÂÜçÊù•ÁúãÊñπÊ≥ïÂÆûÁé∞:</p>
<ul>
<li><code>init</code> ÊòØÂàùÂßãÂåñÊñπÊ≥ï, ÂåÖÊã¨ÂàõÂª∫Áõ∏Â∫îÁöÑ Java ETCD ÂÆ¢Êà∑Á´Ø</li>
<li><code>register</code> ÊòØÊúçÂä°Ê≥®ÂÜå, ‰∏ªË¶ÅÂÆåÊàêÂÜôÂÖ•‰ø°ÊÅØÂà∞ ETDC ÂíåÂÜôÂÖ•‰ø°ÊÅØÂà∞Êú¨Âú∞ <code>loaclFullRegistryServiceKeySet</code></li>
<li><code>serviceDiscovery</code> ÊòØÈÄöËøáÊúçÂä°Êé•Âè£ÂêçÂíåÁâàÊú¨Âè∑Êù•ÂèëÁé∞ÊúçÂä°, ÂÖàÊü•ÁúãÁºìÂ≠ò, ÁºìÂ≠òÊ≤°ÊúâÂÜçÂêë ETCD ÊãâÂèñ, ÂêåÊó∂Â≠òÂÖ•ÁºìÂ≠ò. Â≠òÂÖ•ÁºìÂ≠òÁöÑÊúçÂä°ÈúÄË¶ÅÁõëËßÜÂÖ∂ËäÇÁÇπ, ‰∫éÊòØË¶ÅË∞ÉÁî® <code>watch(fullRegistryServiceKey, serviceNameVer);</code> ÊñπÊ≥ï</li>
<li><code>destroy</code> ÊòØ Provider Á´ØÁöÑ‰∏ªÂä®‰∏ãÁ∫øÊú∫Âà∂, ÂΩì‰∏Ä‰∏™ Provider ÂÅúÊú∫‰∫Ü, ‰ºöÂ∞ÜÊÉÖÂÜµÂÖàË°å‰∏äÊä•Áªô ETCD ‰ª•ÈÅøÂÖç Consumer ÁöÑÈîôËØØË∞ÉÁî®</li>
<li><code>heartBeat</code> ÊòØ Provider Á´ØÁöÑË¢´Âä®‰∏ãÁ∫øÊú∫Âà∂, ÂΩì‰∏Ä‰∏™ Provider Âõ†‰∏∫ÂºÇÂ∏∏ÂÅúÊú∫, ‰æãÂ¶ÇÊñ≠Áîµ, ËøôÊó∂ÂÄôÂ∞±Êó†Ê≥ïÊâßË°å <code>destroy</code> ‰∫Ü. ÂøÉË∑≥Ê£ÄÊµãÁöÑÂéüÁêÜÊòØ Provider ÂÆöÊó∂ (10 s) ÂêëÊ≥®ÂÜå‰∏≠ÂøÉÊõ¥Êñ∞‰∏ÄÊ¨°ÊúçÂä°‰ø°ÊÅØ, ETCD ÂàôÂØπÊØè‰∏Ä‰∏™ËäÇÁÇπÁöÑ‰ø°ÊÅØËÆæÁΩÆ‰∏Ä‰∏™Á®çÈïøÁöÑËøáÊúüÊó∂Èó¥ (30 s). ÂΩì Provider Âõ†‰∏∫ÂºÇÂ∏∏ÂÅúÊú∫, ÂÖ∂ÂØπÂ∫îÁöÑËäÇÁÇπÂ∞±‰ºöÂõ†‰∏∫Êó†Ê≥ïÁª≠ÊúüËÄåË¢´ ETCD Âà†Èô§. Âõ†Ê≠§ÂºÇÂ∏∏ÂÅúÊú∫ÈÄ†ÊàêÁöÑÂΩ±ÂìçÊúÄÂ§öÊåÅÁª≠ 30 s.</li>
<li><code>watch</code> ÊòØ‰∏∫ Consumer Ê£ÄÊµã Provider Áä∂ÊÄÅÁöÑ, ÂΩì‰∏Ä‰∏™ Provider ‰∏ãÁ∫ø (‰∏ªÂä®ÊàñË¢´Âä®), Consumer Â∞±‰ºöÊî∂Âà∞ ETCD ÁöÑÁõ∏Â∫î, Âπ∂Âà†Èô§ÂØπÂ∫îÁöÑÊúçÂä°‰ø°ÊÅØÁºìÂ≠ò</li>
</ul>
<p>‰ª•‰∏äÁöÑÂÅöÊ≥ïÁª¥Êä§‰∫Ü: </p>
<ul>
<li>Êï∞ÊçÆ‰∏ÄËá¥ÊÄß: ÂΩìÊüê‰∏™ Provider ‰∏ãÁ∫ø‰∫Ü, Ê≥®ÂÜå‰∏≠ÂøÉÈúÄË¶ÅÂç≥Êó∂ÂâîÈô§ÂÆÉÁöÑÁªìÁÇπÊúçÂä°‰ø°ÊÅØ.</li>
<li>ÊÄßËÉΩ‰ºòÂåñ: Consumer ÊØèÊ¨°ÈÉΩË¶Å‰ªéÊ≥®ÂÜå‰∏≠ÂøÉËé∑ÂèñÊúçÂä°, ÂèØ‰ª•‰ΩøÁî®ÁºìÂ≠òËøõË°å‰ºòÂåñ. </li>
<li>È´òÂèØÁî®ÊÄß: ‰øùËØÅÊ≥®ÂÜå‰∏≠ÂøÉ‰∏ç‰ºöÂÆïÊú∫. </li>
<li>È´òÊâ©Â±ïÊÄß: Êèê‰æõ‰∏çÂêåÁöÑÊ≥®ÂÜå‰∏≠ÂøÉÂÆûÁé∞Á±ª, Âπ∂‰ΩøÁî® SPI Êú∫Âà∂ËøêË°åÁî®Êà∑Ëá™ÂÆö‰πâÊ≥®ÂÜå‰∏≠ÂøÉÂÆûÁé∞Á±ª.</li>
</ul>
<h4 id="Ë¥üËΩΩÂùáË°°ÁªÑ‰ª∂-com-ypy-pyrpc-spi-loadbalancer"><a href="#Ë¥üËΩΩÂùáË°°ÁªÑ‰ª∂-com-ypy-pyrpc-spi-loadbalancer" class="headerlink" title="Ë¥üËΩΩÂùáË°°ÁªÑ‰ª∂ com.ypy.pyrpc.spi.loadbalancer"></a>Ë¥üËΩΩÂùáË°°ÁªÑ‰ª∂ <code>com.ypy.pyrpc.spi.loadbalancer</code></h4><p>‰∏∫ Consumer ‰ªé‰ºóÂ§öÂÜÖÂÆπÁõ∏Âêå‰ΩÜ Provider ‰∏çÂêåÁöÑÊúçÂä°ÁªìÁÇπ‰∏≠, ‰æùÊçÆÊüêÁßçÁÆóÊ≥ïÈÄâÊã©ÊÅ∞ÂΩìÁöÑÊúçÂä°ËäÇÁÇπ, ËøôÊ†∑ÂèØ‰ª•ÂêàÁêÜÂàÜÈÖç Provider Á´ØÁöÑÂéãÂäõ. </p>
<p><strong>:stars:<code>Loadbalancer</code> Êé•Âè£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Loadbalancer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceMetaInfoList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context: Provide additional contextual information for load balancing algorithms to more intelligently select service instances.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ServiceMetaInfo <span class="title function_">select</span><span class="params">(List&lt;ServiceMetaInfo&gt; serviceMetaInfoList, Map&lt;String, Object&gt; context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‰ΩøÁî®ËΩÆËØ¢, ÈöèÊú∫, Âíå‰∏ÄËá¥ÂìàÂ∏åÁ≠âÊñπÊ≥ïÂÆûÁé∞‰∫ÜÈªòËÆ§ÁöÑ‰∏âÁßçÂ∫èÂàóÂåñÂô®ÂÆûÁé∞</p>
<h4 id="ÈáçËØïÂíåÂÆπÈîôÁªÑ‰ª∂-com-ypy-pyrpc-spi-retry-com-ypy-pyrpc-spi-tolerance"><a href="#ÈáçËØïÂíåÂÆπÈîôÁªÑ‰ª∂-com-ypy-pyrpc-spi-retry-com-ypy-pyrpc-spi-tolerance" class="headerlink" title="ÈáçËØïÂíåÂÆπÈîôÁªÑ‰ª∂ com.ypy.pyrpc.spi.retry &amp; com.ypy.pyrpc.spi.tolerance"></a>ÈáçËØïÂíåÂÆπÈîôÁªÑ‰ª∂ <code>com.ypy.pyrpc.spi.retry</code> &amp; <code>com.ypy.pyrpc.spi.tolerance</code></h4><p>Ëøô‰∏ÄÈÉ®ÂàÜÂè™ÂÅö‰∫ÜÁÆÄÂçïÁöÑÂÆûÁé∞ÂíåÂç†‰Ωç, ÂºÄÂèëËÄÖÂèØ‰ª•‰ΩøÁî®SPIÊú∫Âà∂Ëá™ÂÆö‰πâÂÆûÁé∞</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/01/lang/mykotlin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/01/lang/mykotlin/" class="post-title-link" itemprop="url">My Kotlin</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-12-01 00:00:00" itemprop="dateCreated datePublished" datetime="2024-12-01T00:00:00+08:00">2024-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/lang/" itemprop="url" rel="index"><span itemprop="name">lang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h2 id="Ëá™ÂÆö‰πâËßÑÂàôÊéíÂ∫è"><a href="#Ëá™ÂÆö‰πâËßÑÂàôÊéíÂ∫è" class="headerlink" title="Ëá™ÂÆö‰πâËßÑÂàôÊéíÂ∫è"></a>Ëá™ÂÆö‰πâËßÑÂàôÊéíÂ∫è</h2><h3 id="1-‰ΩøÁî®-sortedWith-Âíå-Comparator"><a href="#1-‰ΩøÁî®-sortedWith-Âíå-Comparator" class="headerlink" title="1. ‰ΩøÁî® sortedWith Âíå Comparator"></a>1. ‰ΩøÁî® <code>sortedWith</code> Âíå <code>Comparator</code></h3><p><code>sortedWith</code> ÊñπÊ≥ïÈúÄË¶Å‰º†ÂÖ•‰∏Ä‰∏™ <code>Comparator</code> ÂØπË±°ÔºåÂÆö‰πâ‰Ω†ÁöÑÊéíÂ∫èËßÑÂàô„ÄÇ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ëá™ÂÆö‰πâÊéíÂ∫èËßÑÂàôÔºöÊåâÊï∞Â≠óÁöÑÂ•áÂÅ∂ÊÄßÊéíÂ∫èÔºåÂ•áÊï∞ÊéíÂú®ÂâçÔºåÂÅ∂Êï∞ÊéíÂú®ÂêéÔºåÂ•áÊï∞ÂíåÂ•áÊï∞ÊåâÂçáÂ∫èÔºåÂÅ∂Êï∞ÂíåÂÅ∂Êï∞ÊåâÂçáÂ∫è</span></span><br><span class="line">    <span class="keyword">val</span> sortedArray = array.sortedWith(compareBy(</span><br><span class="line">        &#123; it % <span class="number">2</span> == <span class="number">0</span> &#125;, <span class="comment">// Â•áÂÅ∂ÊÄßÔºåÂ•áÊï∞ (false) Âú®ÂâçÔºåÂÅ∂Êï∞ (true) Âú®Âêé</span></span><br><span class="line">        &#123; it &#125;           <span class="comment">// Âêå‰∏∫Â•áÊï∞ÊàñÂÅ∂Êï∞Êó∂ÊåâÂçáÂ∫èÊéíÂ∫è</span></span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line">    println(sortedArray) <span class="comment">// ËæìÂá∫: [1, 3, 5, 2, 8]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-‰ΩøÁî®-sortWith-ÊñπÊ≥ïÂØπÂéüÊï∞ÁªÑÊéíÂ∫è"><a href="#2-‰ΩøÁî®-sortWith-ÊñπÊ≥ïÂØπÂéüÊï∞ÁªÑÊéíÂ∫è" class="headerlink" title="2. ‰ΩøÁî® sortWith ÊñπÊ≥ïÂØπÂéüÊï∞ÁªÑÊéíÂ∫è"></a>2. ‰ΩøÁî® <code>sortWith</code> ÊñπÊ≥ïÂØπÂéüÊï∞ÁªÑÊéíÂ∫è</h3><p>Â¶ÇÊûúÈúÄË¶ÅÂØπÂéüÊï∞ÁªÑËøõË°åÊéíÂ∫èËÄå‰∏çÊòØÁîüÊàê‰∏Ä‰∏™Êñ∞Êï∞ÁªÑÔºåÂèØ‰ª•‰ΩøÁî® <code>sortWith</code> ÊñπÊ≥ï„ÄÇ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ëá™ÂÆö‰πâÊéíÂ∫èËßÑÂàôÔºöÊåâÈôçÂ∫èÊéíÂ∫è</span></span><br><span class="line">    array.sortWith(Comparator &#123; a, b -&gt; b - a &#125;)</span><br><span class="line"></span><br><span class="line">    println(array.joinToString(<span class="string">&quot;, &quot;</span>)) <span class="comment">// ËæìÂá∫: 8, 5, 3, 2, 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-‰ΩøÁî®-lambda-Ë°®ËææÂºèÂÆö‰πâÁÆÄÂçïÁöÑÊØîËæÉËßÑÂàô"><a href="#3-‰ΩøÁî®-lambda-Ë°®ËææÂºèÂÆö‰πâÁÆÄÂçïÁöÑÊØîËæÉËßÑÂàô" class="headerlink" title="3. ‰ΩøÁî® lambda Ë°®ËææÂºèÂÆö‰πâÁÆÄÂçïÁöÑÊØîËæÉËßÑÂàô"></a>3. ‰ΩøÁî® <code>lambda</code> Ë°®ËææÂºèÂÆö‰πâÁÆÄÂçïÁöÑÊØîËæÉËßÑÂàô</h3><p>Kotlin ÊîØÊåÅÁõ¥Êé•‰ΩøÁî® lambda Ë°®ËææÂºèÊù•ÂÆö‰πâÊØîËæÉËßÑÂàô„ÄÇ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ÊåâÊï∞Â≠óÁöÑÁªùÂØπÂÄºÂçáÂ∫èÊéíÂ∫è</span></span><br><span class="line">    <span class="keyword">val</span> sortedArray = array.sortedWith &#123; a, b -&gt; </span><br><span class="line">        a.absoluteValue - b.absoluteValue</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(sortedArray) <span class="comment">// ËæìÂá∫: [1, 2, 3, 5, 8]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ÁªºÂêà‰ΩøÁî®-compareBy-ÂíåÂ§öÊù°‰ª∂ÊéíÂ∫è"><a href="#4-ÁªºÂêà‰ΩøÁî®-compareBy-ÂíåÂ§öÊù°‰ª∂ÊéíÂ∫è" class="headerlink" title="4. ÁªºÂêà‰ΩøÁî® compareBy ÂíåÂ§öÊù°‰ª∂ÊéíÂ∫è"></a>4. ÁªºÂêà‰ΩøÁî® <code>compareBy</code> ÂíåÂ§öÊù°‰ª∂ÊéíÂ∫è</h3><p><code>compareBy</code> ÂèØ‰ª•ÈìæÂºèË∞ÉÁî®Â§ö‰∏™Êù°‰ª∂ËøõË°åÊéíÂ∫èÔºå‰ºòÈõÖÂú∞ÂÆö‰πâÂ§çÊùÇËßÑÂàô„ÄÇ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(Pair(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>), Pair(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>), Pair(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ‰ºòÂÖàÊåâÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÊéíÂ∫èÔºåËã•Á¨¨‰∏Ä‰∏™ÂÖÉÁ¥†Áõ∏ÂêåÔºåÂàôÊåâÁ¨¨‰∫å‰∏™ÂÖÉÁ¥†ÊéíÂ∫è</span></span><br><span class="line">    <span class="keyword">val</span> sortedArray = array.sortedWith(compareBy(&#123; it.first &#125;, &#123; it.second &#125;))</span><br><span class="line"></span><br><span class="line">    println(sortedArray) <span class="comment">// ËæìÂá∫: [(Apple, 1), (Apple, 2), (Banana, 1)]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Ê≥®ÊÑè‰∫ãÈ°π"><a href="#Ê≥®ÊÑè‰∫ãÈ°π" class="headerlink" title="Ê≥®ÊÑè‰∫ãÈ°π"></a>Ê≥®ÊÑè‰∫ãÈ°π</h3><ol>
<li>Â¶ÇÊûúÂØπÂ§ßÊï∞ÊçÆÈáèÊéíÂ∫èÔºåËØ∑Á°Æ‰øùÊéíÂ∫èËßÑÂàô‰∏ç‰ºöÂºïÂèëÊÄßËÉΩÁì∂È¢à„ÄÇ</li>
<li><code>sortedWith</code> ‰ºöËøîÂõû‰∏Ä‰∏™Êñ∞ÁöÑÊï∞ÁªÑÔºå‰∏ç‰ºö‰øÆÊîπÂéüÊï∞ÁªÑ„ÄÇ</li>
<li>Ëã•ÈúÄË¶ÅÈÄÜÂ∫èÔºåÂèØ‰ª•ÁªìÂêà <code>reversed</code> ÊñπÊ≥ïÊàñ‰ΩøÁî® <code>compareByDescending</code>„ÄÇ</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/01/lang/myrust/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/01/lang/myrust/" class="post-title-link" itemprop="url">My Rust</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-11-01 00:00:00" itemprop="dateCreated datePublished" datetime="2024-11-01T00:00:00+08:00">2024-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/lang/" itemprop="url" rel="index"><span itemprop="name">lang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="MyRust"><a href="#MyRust" class="headerlink" title="MyRust"></a>MyRust</h1><h2 id="Rust-‰ºòÁßÄÁöÑÁ≠æÂêçËÆæËÆ°"><a href="#Rust-‰ºòÁßÄÁöÑÁ≠æÂêçËÆæËÆ°" class="headerlink" title="Rust ‰ºòÁßÄÁöÑÁ≠æÂêçËÆæËÆ°"></a>Rust ‰ºòÁßÄÁöÑÁ≠æÂêçËÆæËÆ°</h2><blockquote>
<p>ÊàëÊ≥®ÊÑèÂà∞‰∏Ä‰∏™ÂÜô‰ª£Á†Å‰∏≠ÁöÑÈóÆÈ¢ò: </p>
<p>‰æãÂ¶Ç <code>int[] plusOne(int[] arr)</code> Ëøô‰∏™ÂáΩÊï∞Á≠æÂêçÊó†Ê≥ïÁ°Æ‰øùÁ®ãÂ∫èÂëòÊòØÂú® arr ‰∏äÂéüÂú∞‰øÆÊîπÁöÑ, ËøòÊòØÊääarr clone ‰∫Ü‰∏Ä‰ªΩ</p>
<p>ËÄårust ÂàôÂèØ‰ª•ÈÄöËøáÂØπÂáΩÊï∞Á≠æÂêçÁöÑË¶ÅÊ±ÇÊòéÁ°ÆË°®Á§∫Âá∫Ëøô‰∏ÄÁÇπ</p>
<p>‰æãÂ¶Ç</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(arr: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; <span class="comment">// arr Ëµ∞Âá∫ÂáΩÊï∞‰æø‰∏çÂÜçÂèØÁî®` </span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(arr: &amp;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;` </span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(arr: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;)`</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>Rust ÂáΩÊï∞Á≠æÂêçËÆæËÆ°ÁöÑ‰∏Ä‰∏™Ê†∏ÂøÉ‰ºòÂäø</strong>Ôºö<strong>ÈÄöËøáÂáΩÊï∞Á≠æÂêçÊ∏ÖÊô∞Ë°®Ëææ‰∫ÜÊï∞ÊçÆÁöÑÊâÄÊúâÊùÉ„ÄÅÂÄüÁî®Âíå‰øÆÊîπÂÖ≥Á≥ª</strong>„ÄÇ</p>
<p>Âú®ÂæàÂ§öËØ≠Ë®ÄÔºàÂ¶Ç C++„ÄÅJavaÔºâ‰∏≠Ôºå<strong>Êó†Ê≥ï‰ªÖÈÄöËøáÂáΩÊï∞Á≠æÂêçÊù•Âà§Êñ≠</strong>‰∏Ä‰∏™Êï∞ÁªÑÔºàÊàñÂàóË°®ÔºâÊòØÂê¶ÊòØ<strong>ÂéüÂú∞‰øÆÊîπÁöÑ</strong>Ôºå<strong>ËøòÊòØÂÖãÈöÜ‰∫Ü‰∏Ä‰ªΩÊñ∞Êï∞ÁªÑ</strong>„ÄÇ‰ΩÜÂú® Rust ‰∏≠Ôºå<strong>ÂáΩÊï∞Á≠æÂêçÊú¨Ë∫´Â∞±ÊòéÁ°Æ‰∫ÜËøô‰∏ÄÁÇπ</strong>ÔºåÂõ†‰∏∫ Rust Âº∫Âà∂Ë¶ÅÊ±ÇÂºÄÂèëËÄÖ<strong>ÊòæÂºèÂ£∞ÊòéÊâÄÊúâÊùÉÂíåÂèØÂèòÊÄß</strong>„ÄÇ</p>
<p>Rust ‰∏âÊùÉÂàÜÁ´ã: ÊâÄÊúâÊùÉ, ËØªÊùÉ, ÂÜôÊùÉ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Eq, Clone, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> val: <span class="type">i32</span>,</span><br><span class="line">    <span class="keyword">pub</span> next: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(val: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        ListNode &#123; val, next: <span class="literal">None</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_one_node</span>(head: &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt;, value: <span class="type">i32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span>: &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt; = head; <span class="comment">// p ÊòØ head ÁöÑÂèØÂèòÂºïÁî®</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = p &#123;</span><br><span class="line">        p = &amp;<span class="keyword">mut</span> node.next; <span class="comment">// ‰∏çÊñ≠ÂêëÈìæË°®Â∞æÈÉ®ÁßªÂä®</span></span><br><span class="line">    &#125;</span><br><span class="line">    *p = <span class="title function_ invoke__">Some</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(ListNode::<span class="title function_ invoke__">new</span>(value))); <span class="comment">// Âú®Â∞æÈÉ®ÊèíÂÖ•Êñ∞ËäÇÁÇπ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">show_list</span>(head: &amp;<span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt;) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span>: &amp;<span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt; = head; <span class="comment">// p ÊòØ &amp;Option&lt;Box&lt;ListNode&gt;&gt;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = p &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125; -&gt; &quot;</span>, node.val); <span class="comment">// ÊâìÂç∞ÂΩìÂâçËäÇÁÇπÁöÑÂÄº</span></span><br><span class="line">        p = &amp;node.next; <span class="comment">// Âêë‰∏ã‰∏Ä‰∏™ËäÇÁÇπÁßªÂä®Ôºåp ÁöÑÁ±ªÂûãÊòØ &amp;Option&lt;Box&lt;ListNode&gt;&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;None&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">head</span>: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt; = <span class="title function_ invoke__">Some</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(ListNode::<span class="title function_ invoke__">new</span>(<span class="number">1</span>)));</span><br><span class="line">    <span class="title function_ invoke__">add_one_node</span>(&amp;<span class="keyword">mut</span> head, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">add_one_node</span>(&amp;<span class="keyword">mut</span> head, <span class="number">3</span>);</span><br><span class="line">    <span class="title function_ invoke__">add_one_node</span>(&amp;<span class="keyword">mut</span> head, <span class="number">4</span>); <span class="comment">// 1 -&gt; 2 -&gt; 3 -&gt; 4</span></span><br><span class="line">    <span class="title function_ invoke__">show_list</span>(&amp;head);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Tip-for-x-in-y"><a href="#Tip-for-x-in-y" class="headerlink" title="Tip: for x in y"></a>Tip: <code>for x in y</code></h2><table>
<thead>
<tr>
<th><code>y</code> Á±ªÂûã</th>
<th>Ë∞ÉÁî®ÁöÑËø≠‰ª£Âô®</th>
<th><code>x</code> ÁöÑÁ±ªÂûã</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td><code>Vec&lt;T&gt;</code></td>
<td><code>.into_iter()</code></td>
<td><code>T</code></td>
<td>Ê∂àËÄóÈõÜÂêàÔºåËΩ¨ÁßªÊâÄÊúâÊùÉ</td>
</tr>
<tr>
<td><code>&amp;Vec&lt;T&gt;</code></td>
<td><code>.iter()</code></td>
<td><code>&amp;T</code></td>
<td>‰∏çÂèØÂèòÂºïÁî®Ëø≠‰ª£Âô®Ôºå‰∏çÊ∂àËÄóÈõÜÂêà</td>
</tr>
<tr>
<td><code>&amp;mut Vec&lt;T&gt;</code></td>
<td><code>.iter_mut()</code></td>
<td><code>&amp;mut T</code></td>
<td>ÂèØÂèòÂºïÁî®Ëø≠‰ª£Âô®ÔºåÂÖÅËÆ∏‰øÆÊîπÈõÜÂêà</td>
</tr>
<tr>
<td><code>[T; N]</code></td>
<td><code>.iter()</code></td>
<td><code>&amp;T</code></td>
<td>Âõ∫ÂÆöÊï∞ÁªÑËΩ¨‰∏∫ÂàáÁâáÁöÑ‰∏çÂèØÂèòÂºïÁî®</td>
</tr>
<tr>
<td><code>&amp;[T]</code></td>
<td><code>.iter()</code></td>
<td><code>&amp;T</code></td>
<td>ÂàáÁâáÁöÑ‰∏çÂèØÂèòÂºïÁî®</td>
</tr>
<tr>
<td><code>&amp;mut [T]</code></td>
<td><code>.iter_mut()</code></td>
<td><code>&amp;mut T</code></td>
<td>ÂàáÁâáÁöÑÂèØÂèòÂºïÁî®</td>
</tr>
</tbody></table>
<p>ÈÄöËøáËøô‰∫õËßÑÂàôÔºåÂèØ‰ª•Ê†πÊçÆ <code>y</code> ÁöÑÁ±ªÂûãÂø´ÈÄüÂà§Êñ≠ <code>x</code> ÁöÑÁ±ªÂûãÔºå‰ª•ÂèäÊòØÂê¶ÂèëÁîüÊâÄÊúâÊùÉËΩ¨ÁßªÔºÅ</p>
<h2 id="Tip-let-Some-x-y"><a href="#Tip-let-Some-x-y" class="headerlink" title="Tip: let Some(x) = y"></a>Tip: <code>let Some(x) = y</code></h2><table>
<thead>
<tr>
<th>Y Type</th>
<th>X Type</th>
<th>equals</th>
<th>DEsc</th>
</tr>
</thead>
<tbody><tr>
<td><code>Option&lt;T&gt;</code></td>
<td><code>T</code></td>
<td><code>x = y.unwrap()</code></td>
<td>x ‰ºöÂèñÂæóÊï∞ÊçÆÁöÑÊâÄÊúâÊùÉ</td>
</tr>
<tr>
<td><code>&amp;Option&lt;T&gt;</code></td>
<td><code>&amp;T</code></td>
<td><code>x = y.as_ref().unwrap()</code></td>
<td>x Âè™ÊòØËØªÂÄüÁî®, ‰∏ç‰ºöÂèñÂæóÊâÄÊúâÊùÉ</td>
</tr>
<tr>
<td><code>&amp;mut Option&lt;T&gt;</code></td>
<td><code>&amp;mut T</code></td>
<td><code>x = y.as_mut().unwrap()</code></td>
<td>x ÊòØÂÜôÂÄüÁî®, ‰∏ç‰ºöÂèñÂæóÊâÄÊúâÊùÉ</td>
</tr>
</tbody></table>
<p>ÁâπÂà´Âú∞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ÂΩì y: Option&lt;T&gt;</span><br><span class="line">while let Some(x) = &amp;y =&gt; x: &amp;T</span><br><span class="line">if let Some(x) = &amp;mut y =&gt; x: &amp;mut T</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/13/algorithm/15-bitwise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/13/algorithm/15-bitwise/" class="post-title-link" itemprop="url">Bitwise Operate</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-13 00:00:00" itemprop="dateCreated datePublished" datetime="2024-09-13T00:00:00+08:00">2024-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="Âü∫Êú¨Ê¶ÇÂøµ"><a href="#Âü∫Êú¨Ê¶ÇÂøµ" class="headerlink" title="Âü∫Êú¨Ê¶ÇÂøµ"></a>Âü∫Êú¨Ê¶ÇÂøµ</h1><p>Java ‰∏≠ÁöÑ <code>int</code> Á±ªÂûãÊòØ‰∏Ä‰∏™ 32 ‰ΩçÁöÑÊúâÁ¨¶Âè∑Êï¥Êï∞Ôºå‰ΩøÁî®Ë°•Á†ÅÔºàtwo‚Äôs complementÔºâË°®Á§∫Ê≥ïÊù•Â≠òÂÇ®„ÄÇ‰∫ÜËß£ <code>int</code> Á±ªÂûãÁöÑ bit Ë°®Á§∫Âíå‰ΩçËøêÁÆóÊòØÊ∑±ÂÖ•ÁêÜËß£ Java ‰∏≠Êï¥Êï∞Êìç‰ΩúÁöÑÈáçË¶ÅÂü∫Á°Ä„ÄÇ</p>
<h3 id="1-int-Á±ªÂûãÁöÑ‰∫åËøõÂà∂Ë°®Á§∫"><a href="#1-int-Á±ªÂûãÁöÑ‰∫åËøõÂà∂Ë°®Á§∫" class="headerlink" title="1. int Á±ªÂûãÁöÑ‰∫åËøõÂà∂Ë°®Á§∫"></a>1. <code>int</code> Á±ªÂûãÁöÑ‰∫åËøõÂà∂Ë°®Á§∫</h3><p>Âú® Java ‰∏≠Ôºå<code>int</code> Á±ªÂûãÊòØ‰∏Ä‰∏™ 32 ‰ΩçÁöÑÊúâÁ¨¶Âè∑Êï¥Êï∞ÔºåÂ≠òÂÇ®ËåÉÂõ¥‰ªé <code>-2^31</code> Âà∞ <code>2^31 - 1</code>ÔºåÂç≥‰ªé <code>-2147483648</code> Âà∞ <code>2147483647</code>„ÄÇÂÖ∑‰ΩìÁöÑ‰∫åËøõÂà∂Ë°®Á§∫ÊòØ‰ΩøÁî® <strong>Ë°•Á†Å</strong> ÊñπÂºè„ÄÇË°•Á†ÅË°®Á§∫Ê≥ïÁöÑÁâπÁÇπÊòØË¥üÊï∞ÁöÑË°®Á§∫ÊòØÂÖ∂ÁªùÂØπÂÄºÁöÑ‰∫åËøõÂà∂Ë°®Á§∫ÂèñÂèçÂä†‰∏Ä„ÄÇ</p>
<h4 id="Ê≠£Êï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫"><a href="#Ê≠£Êï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫" class="headerlink" title="Ê≠£Êï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫"></a>Ê≠£Êï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫</h4><ul>
<li><p>Ê≠£Êï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫Â∞±ÊòØÂÆÉÁöÑÁªùÂØπÂÄºÁöÑ‰∫åËøõÂà∂ÂΩ¢ÂºèÔºåÊúÄÈ´ò‰Ωç‰∏∫ 0ÔºàË°®Á§∫Ê≠£Êï∞Ôºâ„ÄÇ</p>
<p>‰æãÂ¶ÇÔºå5 Âú® 32 ‰ΩçÁöÑ‰∫åËøõÂà∂Ë°®Á§∫‰∏∫Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 00000101</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Ë¥üÊï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫"><a href="#Ë¥üÊï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫" class="headerlink" title="Ë¥üÊï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫"></a>Ë¥üÊï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫</h4><ul>
<li><p>Ë¥üÊï∞ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫ÊòØÂÖ∂ÁªùÂØπÂÄºÁöÑ‰∫åËøõÂà∂Ë°®Á§∫ÂèñÂèçÂÜçÂä†‰∏ÄÔºåÊúÄÈ´ò‰Ωç‰∏∫ 1ÔºàË°®Á§∫Ë¥üÊï∞Ôºâ„ÄÇ</p>
<p>‰æãÂ¶ÇÔºå-5 ÁöÑË°•Á†ÅË°®Á§∫Ôºö</p>
<ol>
<li>ÂÖàÂÜôÂá∫ <code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li>ÂèñÂèçÔºö <code>11111111 11111111 11111111 11111010</code></li>
<li>Âä†‰∏ÄÔºö <code>11111111 11111111 11111111 11111011</code>ÔºåÂç≥ <code>-5</code> ÁöÑË°•Á†ÅË°®Á§∫Ôºö</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11111111 11111111 11111111 11111011</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ÁâπÊÆäÂÄºÔºö"><a href="#ÁâπÊÆäÂÄºÔºö" class="headerlink" title="ÁâπÊÆäÂÄºÔºö"></a>ÁâπÊÆäÂÄºÔºö</h4><ul>
<li><p>0 ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫‰∏∫Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 00000000</span><br></pre></td></tr></table></figure>
</li>
<li><p>ÊúÄÂ§ßÂÄº 2147483647 (2^31 - 1) ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫‰∏∫Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">01111111 11111111 11111111 11111111</span><br></pre></td></tr></table></figure>
</li>
<li><p>ÊúÄÂ∞èÂÄº -2147483648 (-2^31) ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫‰∏∫Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10000000 00000000 00000000 00000000</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-‰ΩçËøêÁÆó"><a href="#2-‰ΩçËøêÁÆó" class="headerlink" title="2. ‰ΩçËøêÁÆó"></a>2. ‰ΩçËøêÁÆó</h3><p>‰ΩçËøêÁÆóÊòØÁõ¥Êé•ÂØπÊï¥Êï∞ÁöÑ‰∫åËøõÂà∂‰ΩçËøõË°åÊìç‰ΩúÁöÑËøêÁÆóÔºåÂ∏∏ËßÅÁöÑ‰ΩçËøêÁÆóÂåÖÊã¨ AND (<code>&amp;</code>)„ÄÅOR (<code>|</code>)„ÄÅXOR (<code>^</code>)„ÄÅNOT (<code>~</code>)„ÄÅÂ∑¶Áßª (<code>&lt;&lt;</code>)„ÄÅÂè≥Áßª (<code>&gt;&gt;</code>)„ÄÅÊó†Á¨¶Âè∑Âè≥Áßª (<code>&gt;&gt;&gt;</code>) Á≠â„ÄÇ</p>
<h4 id="2-1-‰Ωç‰∏éËøêÁÆó"><a href="#2-1-‰Ωç‰∏éËøêÁÆó" class="headerlink" title="2.1. ‰Ωç‰∏éËøêÁÆó (&amp;)"></a>2.1. ‰Ωç‰∏éËøêÁÆó (<code>&amp;</code>)</h4><ul>
<li><p><code>&amp;</code> ÊòØÊåâ‰Ωç‰∏éËøêÁÆóÁ¨¶Ôºå‰∏§‰∏™ÂØπÂ∫îÁöÑ‰∫åËøõÂà∂‰ΩçÈÉΩ‰∏∫ <code>1</code> Êó∂ÔºåÁªìÊûúÊâç‰∏∫ <code>1</code>ÔºåÂê¶Âàô‰∏∫ <code>0</code>„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>5 &amp; 3</code>Ôºö</p>
<ul>
<li><code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li><code>3</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000011</code></li>
<li>ÁªìÊûúÔºö <code>00000000 00000000 00000000 00000001</code>ÔºàÂç≥ <code>1</code>Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-2-‰ΩçÊàñËøêÁÆó"><a href="#2-2-‰ΩçÊàñËøêÁÆó" class="headerlink" title="2.2. ‰ΩçÊàñËøêÁÆó (|)"></a>2.2. ‰ΩçÊàñËøêÁÆó (<code>|</code>)</h4><ul>
<li><p><code>|</code> ÊòØÊåâ‰ΩçÊàñËøêÁÆóÁ¨¶Ôºå‰∏§‰∏™ÂØπÂ∫îÁöÑ‰∫åËøõÂà∂‰ΩçËá≥Â∞ëÊúâ‰∏Ä‰∏™‰∏∫ <code>1</code> Êó∂ÔºåÁªìÊûú‰∏∫ <code>1</code>„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>5 | 3</code>Ôºö</p>
<ul>
<li><code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li><code>3</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000011</code></li>
<li>ÁªìÊûúÔºö <code>00000000 00000000 00000000 00000111</code>ÔºàÂç≥ <code>7</code>Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-3-‰ΩçÂºÇÊàñËøêÁÆó"><a href="#2-3-‰ΩçÂºÇÊàñËøêÁÆó" class="headerlink" title="2.3. ‰ΩçÂºÇÊàñËøêÁÆó (^)"></a>2.3. ‰ΩçÂºÇÊàñËøêÁÆó (<code>^</code>)</h4><ul>
<li><p><code>^</code> ÊòØÊåâ‰ΩçÂºÇÊàñËøêÁÆóÁ¨¶Ôºå‰∏§‰∏™ÂØπÂ∫îÁöÑ‰∫åËøõÂà∂‰ΩçÁõ∏ÂºÇÊó∂ÔºåÁªìÊûú‰∏∫ <code>1</code>ÔºåÂê¶Âàô‰∏∫ <code>0</code>„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>5 ^ 3</code>Ôºö</p>
<ul>
<li><code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li><code>3</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000011</code></li>
<li>ÁªìÊûúÔºö <code>00000000 00000000 00000000 00000110</code>ÔºàÂç≥ <code>6</code>Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-4-‰ΩçÂèñÂèçËøêÁÆó"><a href="#2-4-‰ΩçÂèñÂèçËøêÁÆó" class="headerlink" title="2.4. ‰ΩçÂèñÂèçËøêÁÆó (~)"></a>2.4. ‰ΩçÂèñÂèçËøêÁÆó (<code>~</code>)</h4><ul>
<li><p><code>~</code> ÊòØÊåâ‰ΩçÂèñÂèçËøêÁÆóÁ¨¶Ôºå0 ÂèòÊàê 1Ôºå1 ÂèòÊàê 0„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>~5</code>Ôºö</p>
<ul>
<li><code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li>ÁªìÊûúÔºö <code>11111111 11111111 11111111 11111010</code>ÔºàÂç≥ <code>-6</code>Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-5-Â∑¶ÁßªËøêÁÆó"><a href="#2-5-Â∑¶ÁßªËøêÁÆó" class="headerlink" title="2.5. Â∑¶ÁßªËøêÁÆó (&lt;&lt;)"></a>2.5. Â∑¶ÁßªËøêÁÆó (<code>&lt;&lt;</code>)</h4><ul>
<li><p><code>&lt;&lt;</code> ÊòØÂ∑¶ÁßªËøêÁÆóÁ¨¶ÔºåÊìç‰ΩúÊï∞ÁöÑÊØè‰∏Ä‰ΩçÈÉΩ‰ºöÂêëÂ∑¶ÁßªÂä®ÊåáÂÆöÁöÑ‰ΩçÊï∞ÔºåÂè≥‰æßÁ©∫Âá∫ÁöÑ‰ΩçÁΩÆÁî® <code>0</code> Â°´ÂÖÖ„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>5 &lt;&lt; 1</code>Ôºö</p>
<ul>
<li><code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li>ÁªìÊûúÔºö <code>00000000 00000000 00000000 00001010</code>ÔºàÂç≥ <code>10</code>Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-6-Âè≥ÁßªËøêÁÆó"><a href="#2-6-Âè≥ÁßªËøêÁÆó" class="headerlink" title="2.6. Âè≥ÁßªËøêÁÆó (&gt;&gt;)"></a>2.6. Âè≥ÁßªËøêÁÆó (<code>&gt;&gt;</code>)</h4><ul>
<li><p><code>&gt;&gt;</code> ÊòØÁÆóÊúØÂè≥ÁßªËøêÁÆóÁ¨¶ÔºåÊìç‰ΩúÊï∞ÁöÑÊØè‰∏Ä‰ΩçÈÉΩ‰ºöÂêëÂè≥ÁßªÂä®ÊåáÂÆöÁöÑ‰ΩçÊï∞ÔºåÂ∑¶‰æßÁöÑÁ©∫‰ΩçÊ†πÊçÆÁ¨¶Âè∑‰ΩçÂ°´ÂÖÖÔºàÂ¶ÇÊûúÊòØÊ≠£Êï∞ÔºåÁî® <code>0</code> Â°´ÂÖÖÔºõÂ¶ÇÊûúÊòØË¥üÊï∞ÔºåÁî® <code>1</code> Â°´ÂÖÖÔºâ„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>5 &gt;&gt; 1</code>Ôºö</p>
<ul>
<li><code>5</code> ÁöÑ‰∫åËøõÂà∂Ôºö <code>00000000 00000000 00000000 00000101</code></li>
<li>ÁªìÊûúÔºö <code>00000000 00000000 00000000 00000010</code>ÔºàÂç≥ <code>2</code>Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-7-Êó†Á¨¶Âè∑Âè≥ÁßªËøêÁÆó"><a href="#2-7-Êó†Á¨¶Âè∑Âè≥ÁßªËøêÁÆó" class="headerlink" title="2.7. Êó†Á¨¶Âè∑Âè≥ÁßªËøêÁÆó (&gt;&gt;&gt;)"></a>2.7. Êó†Á¨¶Âè∑Âè≥ÁßªËøêÁÆó (<code>&gt;&gt;&gt;</code>)</h4><ul>
<li><p><code>&gt;&gt;&gt;</code> ÊòØÊó†Á¨¶Âè∑Âè≥ÁßªËøêÁÆóÁ¨¶ÔºåÊìç‰ΩúÊï∞ÁöÑÊØè‰∏Ä‰ΩçÈÉΩ‰ºöÂêëÂè≥ÁßªÂä®ÊåáÂÆöÁöÑ‰ΩçÊï∞ÔºåÂ∑¶‰æßÁ©∫‰ΩçÊÄªÊòØÂ°´ÂÖÖ <code>0</code>ÔºåÂç≥‰ΩøÊòØË¥üÊï∞Ôºå‰πü‰∏ç‰ΩøÁî®Á¨¶Âè∑Êâ©Â±ï„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>-5 &gt;&gt;&gt; 1</code>Ôºö</p>
<ul>
<li><code>-5</code> ÁöÑ‰∫åËøõÂà∂Ë°•Á†ÅË°®Á§∫‰∏∫Ôºö <code>11111111 11111111 11111111 11111011</code></li>
<li>ÁªìÊûúÔºö <code>01111111 11111111 11111111 11111101</code>ÔºàÂç≥ <code>2147483642</code>Ôºâ</li>
</ul>
</li>
</ul>
<h3 id="3-‰ΩçËøêÁÆóÂ∫îÁî®"><a href="#3-‰ΩçËøêÁÆóÂ∫îÁî®" class="headerlink" title="3. ‰ΩçËøêÁÆóÂ∫îÁî®"></a>3. ‰ΩçËøêÁÆóÂ∫îÁî®</h3><p>‰ΩçËøêÁÆóÂ∏∏Â∏∏Áî®‰∫éÈ´òÊïàÁöÑÊï∞ÂÄºËÆ°ÁÆóÂíå‰∏Ä‰∫õ‰ºòÂåñÈóÆÈ¢ò‰∏≠Ôºå‰ª•‰∏ãÊòØÂá†‰∏™Â∏∏ËßÅÁöÑÂ∫îÁî®Ôºö</p>
<h4 id="3-1-Ê£ÄÊü•‰∏Ä‰∏™Êï∞ÁöÑÂ•áÂÅ∂ÊÄß"><a href="#3-1-Ê£ÄÊü•‰∏Ä‰∏™Êï∞ÁöÑÂ•áÂÅ∂ÊÄß" class="headerlink" title="3.1. Ê£ÄÊü•‰∏Ä‰∏™Êï∞ÁöÑÂ•áÂÅ∂ÊÄß"></a>3.1. Ê£ÄÊü•‰∏Ä‰∏™Êï∞ÁöÑÂ•áÂÅ∂ÊÄß</h4><p>ÈÄöËøáÊ£ÄÊü•ÊúÄ‰Ωé‰ΩçÊù•Âà§Êñ≠‰∏Ä‰∏™Êï∞ÊòØÂê¶‰∏∫ÂÅ∂Êï∞ÊàñÂ•áÊï∞Ôºö</p>
<ul>
<li><code>n &amp; 1 == 0</code> Ë°®Á§∫ <code>n</code> ÊòØÂÅ∂Êï∞</li>
<li><code>n &amp; 1 == 1</code> Ë°®Á§∫ <code>n</code> ÊòØÂ•áÊï∞</li>
</ul>
<h4 id="3-2-ËÆæÁΩÆ„ÄÅÊ∏ÖÈô§„ÄÅÂàáÊç¢Êüê‰∏Ä‰Ωç"><a href="#3-2-ËÆæÁΩÆ„ÄÅÊ∏ÖÈô§„ÄÅÂàáÊç¢Êüê‰∏Ä‰Ωç" class="headerlink" title="3.2. ËÆæÁΩÆ„ÄÅÊ∏ÖÈô§„ÄÅÂàáÊç¢Êüê‰∏Ä‰Ωç"></a>3.2. ËÆæÁΩÆ„ÄÅÊ∏ÖÈô§„ÄÅÂàáÊç¢Êüê‰∏Ä‰Ωç</h4><ul>
<li>ËÆæÁΩÆÊüê‰∏Ä‰ΩçÔºö<code>n |= (1 &lt;&lt; k)</code>ÔºåÂ∞ÜÁ¨¨ <code>k</code> ‰ΩçËÆæÁΩÆ‰∏∫ 1„ÄÇ</li>
<li>Ê∏ÖÈô§Êüê‰∏Ä‰ΩçÔºö<code>n &amp;= ~(1 &lt;&lt; k)</code>ÔºåÂ∞ÜÁ¨¨ <code>k</code> ‰ΩçËÆæÁΩÆ‰∏∫ 0„ÄÇ</li>
<li>ÂàáÊç¢Êüê‰∏Ä‰ΩçÔºö<code>n ^= (1 &lt;&lt; k)</code>ÔºåÂ∞ÜÁ¨¨ <code>k</code> ‰ΩçÁöÑÂÄºÂèñÂèç„ÄÇ</li>
</ul>
<h4 id="3-3-Âà§Êñ≠‰∏Ä‰∏™Êï∞ÊòØÂê¶‰∏∫-2-ÁöÑÂπÇ"><a href="#3-3-Âà§Êñ≠‰∏Ä‰∏™Êï∞ÊòØÂê¶‰∏∫-2-ÁöÑÂπÇ" class="headerlink" title="3.3. Âà§Êñ≠‰∏Ä‰∏™Êï∞ÊòØÂê¶‰∏∫ 2 ÁöÑÂπÇ"></a>3.3. Âà§Êñ≠‰∏Ä‰∏™Êï∞ÊòØÂê¶‰∏∫ 2 ÁöÑÂπÇ</h4><ul>
<li>‰∏Ä‰∏™Êï∞ÊòØ 2 ÁöÑÂπÇÂΩì‰∏î‰ªÖÂΩìÂÆÉÁöÑ‰∫åËøõÂà∂Ë°®Á§∫Âè™Êúâ‰∏Ä‰∏™ <code>1</code>ÔºåÂèØ‰ª•‰ΩøÁî® <code>(n &amp; (n - 1)) == 0</code> Êù•Âà§Êñ≠„ÄÇ</li>
</ul>
<h3 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h3><p>‰ΩçËøêÁÆóÂú® Java ‰∏≠ÈùûÂ∏∏È´òÊïàÔºåÂõ†‰∏∫ÂÆÉÁõ¥Êé•Êìç‰Ωú‰∫åËøõÂà∂‰ΩçÔºåÈÄöÂ∏∏ÊØîÂ∏∏ËßÑÁöÑÁÆóÊúØËøêÁÆóÂíåÈÄªËæëËøêÁÆóÊõ¥Âø´„ÄÇÁêÜËß£ <code>int</code> ÁöÑ‰∫åËøõÂà∂Ë°®Á§∫Âíå‰ΩçËøêÁÆóÁöÑÁü•ËØÜÂØπ‰∫éËß£ÂÜ≥ÂæàÂ§öÁºñÁ®ãÈóÆÈ¢òÔºåÁâπÂà´ÊòØÁÆóÊ≥ïÂíå‰ºòÂåñÈóÆÈ¢òÈùûÂ∏∏ÊúâÂ∏ÆÂä©„ÄÇ</p>
<h1 id="Â∏∏Áî®ÊñπÊ≥ï"><a href="#Â∏∏Áî®ÊñπÊ≥ï" class="headerlink" title="Â∏∏Áî®ÊñπÊ≥ï"></a>Â∏∏Áî®ÊñπÊ≥ï</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Â∑¶Áßª( &lt;&lt; )</span><br><span class="line">Âè≥Áßª( &gt;&gt; )  // Ê≠£Êï∞Áî® 0 Ë°•‰Ωç, Ë¥üÊï∞Áî® 1 Ë°•‰Ωç</span><br><span class="line">Êó†Á¨¶Âè∑Âè≥Áßª( &gt;&gt;&gt; )  // ‰∏çÁÆ°Ê≠£Êï∞Ë¥üÊï∞, ÁªüÁªüÁî® 0 Ë°•‰Ωç</span><br><span class="line">‰Ωç‰∏é( &amp; )</span><br><span class="line">‰ΩçÊàñ( | )</span><br><span class="line">‰ΩçÈùû( ~ )</span><br><span class="line">‰ΩçÂºÇÊàñ( ^ )</span><br><span class="line">Èô§‰∫Ü‰ΩçÈùû( ~ )ÊòØ‰∏ÄÂÖÉÊìç‰ΩúÁ¨¶Â§ñ, ÂÖ∂ÂÆÉÁöÑÈÉΩÊòØ‰∫åÂÖÉÊìç‰ΩúÁ¨¶. </span><br><span class="line">ÂØπ‰∫é int n, n != 0, n ‰∏é -n ÁöÑ 1 ‰πãÂíå‰∏∫ 33</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BitOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Solution</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Solution</span>();</span><br><span class="line">        System.out.println(s.showBits(<span class="number">5</span>));</span><br><span class="line">        System.out.println(s.showBits(-<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">showBits</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            sb.append(num &amp; <span class="number">1</span>);</span><br><span class="line">            num &gt;&gt;&gt;= <span class="number">1</span>;  <span class="comment">// ËøôÈáåÂøÖÈ°ª‰ΩøÁî®Êó†Á¨¶Âè∑Âè≥Áßª</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.reverse().toString();  <span class="comment">// ËÆ∞ÂæóÁøªËΩ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">countBits</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((num &amp; <span class="number">1</span>) <span class="comment">/* &amp; ËøêÁÆóÁöÑÊã¨Âè∑‰∏çËÉΩÂ∞ë */</span> == <span class="number">1</span>) cnt ++;</span><br><span class="line">            num &gt;&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">countBits1</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            num &amp;= (num - <span class="number">1</span>);  <span class="comment">// Ê∏ÖÈô§ÊúÄ‰Ωé‰ΩçÁöÑ 1</span></span><br><span class="line">            cnt ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="‰æãÈ¢ò"><a href="#‰æãÈ¢ò" class="headerlink" title="‰æãÈ¢ò"></a>‰æãÈ¢ò</h1><h2 id="1356-Sort-Integers-by-The-Number-of-1-Bits"><a href="#1356-Sort-Integers-by-The-Number-of-1-Bits" class="headerlink" title="1356. Sort Integers by The Number of 1 Bits"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/sort-integers-by-the-number-of-1-bits/">1356. Sort Integers by The Number of 1 Bits</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortByBits(<span class="type">int</span>[] arr) &#123;</span><br><span class="line">        Integer[] arr1 = Arrays.stream(arr).boxed().toArray(Integer[]::<span class="keyword">new</span>);</span><br><span class="line">        Arrays.sort(arr1, (x, y) -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">xbs</span> <span class="operator">=</span> cntBits(x), ybs = cntBits(y);</span><br><span class="line">            <span class="keyword">if</span> (xbs != ybs) <span class="keyword">return</span> xbs - ybs;</span><br><span class="line">            <span class="keyword">return</span> x - y;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(arr1).mapToInt(Integer::intValue).toArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">cntBits</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            cnt += (n &amp; <span class="number">1</span>);</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Arrays.sort()</code> Ëã•Ë¶Å‰ΩøÁî® Lambda Ë°®ËææÂºè, ÂøÖÈ°ªÂÖàË£ÖÁÆ±</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/08/23/algorithm/14-simulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/08/23/algorithm/14-simulation/" class="post-title-link" itemprop="url">Simulate</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-08-23 00:00:00" itemprop="dateCreated datePublished" datetime="2024-08-23T00:00:00+08:00">2024-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><h2 id="657-Robot-Return-to-Origin"><a href="#657-Robot-Return-to-Origin" class="headerlink" title="657. Robot Return to Origin"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/robot-return-to-origin/">657. Robot Return to Origin</a></h2><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judgeCircle</span><span class="params">(String moves)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">xOffset</span> <span class="operator">=</span> <span class="number">0</span>, yOffset = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> move : moves.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (move) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;U&#x27;</span>: yOffset ++; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: yOffset --; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>: xOffset ++; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>: xOffset --; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> xOffset == <span class="number">0</span> &amp;&amp; yOffset == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">judge_circle</span>(moves: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x_offset</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">y_offset</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">ch</span> <span class="keyword">in</span> moves.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">            <span class="keyword">match</span> ch &#123;</span><br><span class="line">                <span class="string">&#x27;U&#x27;</span> =&gt; y_offset += <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;D&#x27;</span> =&gt; y_offset -= <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;R&#x27;</span> =&gt; x_offset += <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;L&#x27;</span> =&gt; x_offset -= <span class="number">1</span>,</span><br><span class="line">                _ =&gt; (),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        x_offset == <span class="number">0</span> &amp;&amp; y_offset == <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="31-Next-Permutation"><a href="#31-Next-Permutation" class="headerlink" title="31. Next Permutation"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/next-permutation/">31. Next Permutation</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> nums[i]; nums[i] = nums[j]; nums[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            swap(nums, i, j); i ++; j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nextPermutation</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ËÆ°ÁÆó breakIdx</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">breakIdx</span> <span class="operator">=</span> len - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (breakIdx &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[breakIdx] &lt; nums[breakIdx + <span class="number">1</span>]) <span class="keyword">break</span>;</span><br><span class="line">            breakIdx --;</span><br><span class="line">        &#125;  <span class="comment">// breakIdx ÂÆö‰πâ: ‰ªéÂ∞æÂà∞Â§¥, ‰∏ÄÊ¨°Âá∫Áé∞ nums[i] &lt; nums[i + 1] ÁöÑ‰ΩçÁΩÆ (i)</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment">// ÂΩì breakIdx == -1, ‰πüÂ∞±ÊòØÊï∞ÂàóÊòØÂçïË∞ÉÈÄíÂáèÊó∂, Áõ¥Êé•reverse breakIdx Âè≥ËæπÁöÑÈÉ®ÂàÜ (Êï¥‰∏™Êï∞Âàó)</span></span><br><span class="line">        <span class="keyword">if</span> (breakIdx == -<span class="number">1</span>) &#123;</span><br><span class="line">            reverse(nums, <span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// ÂΩì breakIdx&gt;-1, ÂØªÊâæbreakIdxÂè≥Ëæπ &gt;breakVal ÁöÑÊúÄÂ∞èÂÄºÁöÑ‰ΩçÁΩÆ (swapIdx), ‰∫§Êç¢‰∫åËÄÖÁöÑ‰ΩçÁΩÆ, ÂÜçÁøªËΩ¨ breakIdx Âè≥Ëæπ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">breakVal</span> <span class="operator">=</span> nums[breakIdx];</span><br><span class="line">        <span class="type">int</span> <span class="variable">swapIdx</span> <span class="operator">=</span> breakIdx + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">swapVal</span> <span class="operator">=</span> nums[swapIdx];  <span class="comment">// Ê†πÊçÆ breakIdx ÂÆö‰πâ, ÂΩìÂâç swapVal ‰∏ÄÂÆö &gt; breakVal</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> breakIdx + <span class="number">1</span>; i &lt; len; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= breakVal) <span class="keyword">continue</span>; <span class="comment">// breakVal ÂâçÊèêË¶Å &gt; breakVal ÊâçËÄÉËôë</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= swapVal) &#123;  <span class="comment">// Ë¶Å‰ΩøÁî® &lt;= , swapIdx Ë¶ÅÂ∞ΩÈáèÈù†ËøëÂ∞æÈÉ®</span></span><br><span class="line">                swapIdx = i;</span><br><span class="line">                swapVal = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums, breakIdx, swapIdx);</span><br><span class="line">        reverse(nums, breakIdx + <span class="number">1</span>, len - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="463-Island-Perimeter"><a href="#463-Island-Perimeter" class="headerlink" title="463. Island Perimeter"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/island-perimeter/">463. Island Perimeter</a></h2><h4 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">delta</span><span class="params">(<span class="type">int</span>[][] grid, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> grid.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cols</span> <span class="operator">=</span> grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>      || grid[i-<span class="number">1</span>][j] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">if</span> (i == rows-<span class="number">1</span> || grid[i+<span class="number">1</span>][j] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">if</span> (j == <span class="number">0</span>      || grid[i][j-<span class="number">1</span>] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">if</span> (j == cols-<span class="number">1</span> || grid[i][j+<span class="number">1</span>] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">islandPerimeter</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; grid.length; i ++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; grid[<span class="number">0</span>].length; j ++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                cnt += delta(grid, i, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Rust-1"><a href="#Rust-1" class="headerlink" title="Rust"></a>Rust</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">island_perimeter</span>(grid: <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;&gt;) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">m</span> = grid.<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">n</span> = grid[<span class="number">0</span>].<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cnt</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..m &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">j</span> <span class="keyword">in</span> <span class="number">0</span>..n &#123;</span><br><span class="line">                <span class="keyword">if</span> grid[i][j] == <span class="number">1</span> &#123;</span><br><span class="line">                    cnt += </span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">as</span> <span class="type">i32</span> - <span class="number">1</span> == -<span class="number">1</span> || grid[i - <span class="number">1</span>][j] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125; + </span><br><span class="line">                    <span class="keyword">if</span> i + <span class="number">1</span> == m || grid[i + <span class="number">1</span>][j] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125; + </span><br><span class="line">                    <span class="keyword">if</span> j <span class="keyword">as</span> <span class="type">i32</span> - <span class="number">1</span> == -<span class="number">1</span> || grid[i][j - <span class="number">1</span>] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125; + </span><br><span class="line">                    <span class="keyword">if</span> j + <span class="number">1</span> == n || grid[i][j + <span class="number">1</span>] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Perry Yao"
      src="https://avatars.githubusercontent.com/u/126999663?v=4">
  <p class="site-author-name" itemprop="name">Perry Yao</p>
  <div class="site-description" itemprop="description">...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/PerryYao-GitHub" title="GitHub ‚Üí https:&#x2F;&#x2F;github.com&#x2F;PerryYao-GitHub" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:peiyouyao@gmail.com" title="E-Mail ‚Üí mailto:peiyouyao@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Perry Yao</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
