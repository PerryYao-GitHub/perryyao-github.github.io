<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="...">
<meta property="og:type" content="website">
<meta property="og:title" content="Perry&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Perry&#39;s Blog">
<meta property="og:description" content="...">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Perry Yao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Perry's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Perry's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">tech & muse & sleep</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/16/tech/swagger/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/16/tech/swagger/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-05-16 18:27:15" itemprop="dateCreated datePublished" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ğŸ“-Swagger-åŒç™»å½•æ¨¡å¼è°ƒè¯•æ“ä½œç¬”è®°ï¼ˆCookie-JWTï¼‰"><a href="#ğŸ“-Swagger-åŒç™»å½•æ¨¡å¼è°ƒè¯•æ“ä½œç¬”è®°ï¼ˆCookie-JWTï¼‰" class="headerlink" title="ğŸ“ Swagger åŒç™»å½•æ¨¡å¼è°ƒè¯•æ“ä½œç¬”è®°ï¼ˆCookie + JWTï¼‰"></a>ğŸ“ Swagger åŒç™»å½•æ¨¡å¼è°ƒè¯•æ“ä½œç¬”è®°ï¼ˆCookie + JWTï¼‰</h1><h2 id="âœ…-ä¸€ã€é…ç½®-Swagger-æ”¯æŒ-Cookie-å’Œ-JWT"><a href="#âœ…-ä¸€ã€é…ç½®-Swagger-æ”¯æŒ-Cookie-å’Œ-JWT" class="headerlink" title="âœ… ä¸€ã€é…ç½® Swagger æ”¯æŒ Cookie å’Œ JWT"></a>âœ… ä¸€ã€é…ç½® Swagger æ”¯æŒ Cookie å’Œ JWT</h2><p>åœ¨ä½ çš„ Spring Boot é¡¹ç›®ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.Components;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.OpenAPI;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.info.Info;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.security.SecurityRequirement;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.security.SecurityScheme;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">customOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Cookie è®¤è¯ï¼šJSESSIONID</span></span><br><span class="line">        <span class="type">SecurityScheme</span> <span class="variable">cookieScheme</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityScheme</span>()</span><br><span class="line">                .type(SecurityScheme.Type.APIKEY)</span><br><span class="line">                .in(SecurityScheme.In.COOKIE)</span><br><span class="line">                .name(<span class="string">&quot;JSESSIONID&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// JWT Bearer Token è®¤è¯</span></span><br><span class="line">        <span class="type">SecurityScheme</span> <span class="variable">bearerScheme</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityScheme</span>()</span><br><span class="line">                .type(SecurityScheme.Type.HTTP)</span><br><span class="line">                .scheme(<span class="string">&quot;bearer&quot;</span>)</span><br><span class="line">                .bearerFormat(<span class="string">&quot;JWT&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">                .info(<span class="keyword">new</span> <span class="title class_">Info</span>().title(<span class="string">&quot;PYOJ åå°æ¥å£æ–‡æ¡£&quot;</span>).version(<span class="string">&quot;v1.0&quot;</span>))</span><br><span class="line">                .components(<span class="keyword">new</span> <span class="title class_">Components</span>()</span><br><span class="line">                        .addSecuritySchemes(<span class="string">&quot;cookieAuth&quot;</span>, cookieScheme)</span><br><span class="line">                        .addSecuritySchemes(<span class="string">&quot;bearerAuth&quot;</span>, bearerScheme))</span><br><span class="line">                .addSecurityItem(<span class="keyword">new</span> <span class="title class_">SecurityRequirement</span>()</span><br><span class="line">                        .addList(<span class="string">&quot;cookieAuth&quot;</span>)</span><br><span class="line">                        .addList(<span class="string">&quot;bearerAuth&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ…-äºŒã€ç™»å½•æ¥å£å‡†å¤‡"><a href="#âœ…-äºŒã€ç™»å½•æ¥å£å‡†å¤‡" class="headerlink" title="âœ… äºŒã€ç™»å½•æ¥å£å‡†å¤‡"></a>âœ… äºŒã€ç™»å½•æ¥å£å‡†å¤‡</h2><p>ä½ çš„é¡¹ç›®ä¸­åº”è¯¥æœ‰ç±»ä¼¼ä»¥ä¸‹ä¸¤ä¸ªç™»å½•æ¥å£ï¼š</p>
<ul>
<li><p><strong>Session ç™»å½•æ¥å£</strong>ï¼ˆè®¾ç½® Cookieï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /api/user/login</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>JWT ç™»å½•æ¥å£</strong>ï¼ˆè¿”å› tokenï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="âœ…-ä¸‰ã€Swagger-è°ƒè¯•æ“ä½œæ­¥éª¤"><a href="#âœ…-ä¸‰ã€Swagger-è°ƒè¯•æ“ä½œæ­¥éª¤" class="headerlink" title="âœ… ä¸‰ã€Swagger è°ƒè¯•æ“ä½œæ­¥éª¤"></a>âœ… ä¸‰ã€Swagger è°ƒè¯•æ“ä½œæ­¥éª¤</h2><h3 id="ğŸª-æ–¹å¼ä¸€ï¼šä½¿ç”¨-Cookie-ç™»å½•"><a href="#ğŸª-æ–¹å¼ä¸€ï¼šä½¿ç”¨-Cookie-ç™»å½•" class="headerlink" title="ğŸª æ–¹å¼ä¸€ï¼šä½¿ç”¨ Cookie ç™»å½•"></a>ğŸª æ–¹å¼ä¸€ï¼šä½¿ç”¨ Cookie ç™»å½•</h3><ol>
<li><p>æ‰“å¼€ Swagger é¡µé¢ï¼ˆå¦‚ <a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui.html%EF%BC%89">http://localhost:8080/swagger-ui.htmlï¼‰</a></p>
</li>
<li><p>è°ƒç”¨ <code>/api/user/login</code> æˆåŠŸåï¼Œå¤åˆ¶å“åº”å¤´ä¸­çš„ <code>Set-Cookie</code>ï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: JSESSIONID=xxxxxxx; Path=/; HttpOnly</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç‚¹å‡»é¡µé¢å³ä¸Šè§’ <strong>Authorize</strong> æŒ‰é’®</p>
</li>
<li><p>åœ¨ cookie è¾“å…¥æ¡†ä¸­å¡«å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSESSIONID=xxxxxxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç‚¹å‡» <strong>Authorize â†’ Close</strong></p>
</li>
<li><p>æ¥ä¸‹æ¥è¯·æ±‚æ‰€æœ‰éœ€è¦ç™»å½•çŠ¶æ€çš„æ¥å£ï¼ˆå¦‚ <code>/user/update</code>ï¼‰å°±ä¼šè‡ªåŠ¨å¸¦ä¸Š cookie</p>
</li>
</ol>
<hr>
<h3 id="ğŸ”-æ–¹å¼äºŒï¼šä½¿ç”¨-JWT-ç™»å½•"><a href="#ğŸ”-æ–¹å¼äºŒï¼šä½¿ç”¨-JWT-ç™»å½•" class="headerlink" title="ğŸ” æ–¹å¼äºŒï¼šä½¿ç”¨ JWT ç™»å½•"></a>ğŸ” æ–¹å¼äºŒï¼šä½¿ç”¨ JWT ç™»å½•</h3><ol>
<li><p>è°ƒç”¨ <code>/api/user/jwt-login</code> è·å– tokenï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOi...&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç‚¹å‡» Swagger é¡µé¢å³ä¸Šè§’ <strong>Authorize</strong></p>
</li>
<li><p>åœ¨ Bearer Token æ¡†ä¸­å¡«å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bearer eyJhbGciOi...</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç‚¹å‡» <strong>Authorize â†’ Close</strong></p>
</li>
<li><p>æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£ä¼šè‡ªåŠ¨æºå¸¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer eyJhbGciOi...</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="âœ…-å››ã€å»ºè®®å®è·µ"><a href="#âœ…-å››ã€å»ºè®®å®è·µ" class="headerlink" title="âœ… å››ã€å»ºè®®å®è·µ"></a>âœ… å››ã€å»ºè®®å®è·µ</h2><ul>
<li>å‰æœŸå¼€å‘å¯ä»¥ä¿ç•™ä¸¤ä¸ªæ¥å£ï¼Œä¾¿äºå¯¹æ¯”è°ƒè¯•</li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®é€‰æ‹©ä¸€ç§ç™»å½•æ–¹å¼å¹¶ç»Ÿä¸€è®¤è¯é€»è¾‘</li>
<li>Swagger UI æœ¬èº«ä¸ä¼šè‡ªåŠ¨ä¿å­˜ Cookieï¼Œå¼€å‘ä¸­è°ƒè¯•éœ€æ‰‹åŠ¨å¤åˆ¶</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/23/tech/wsl2_docker_install_guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/23/tech/wsl2_docker_install_guide/" class="post-title-link" itemprop="url">Install Docker in WSL2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-23T00:00:00+08:00">2025-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="ğŸ³-WSL2-ä¸­å®‰è£…-Docker-å…¨æµç¨‹ç¬”è®°ï¼ˆçº¯äºŒè¿›åˆ¶å®‰è£…æ–¹å¼ï¼‰"><a href="#ğŸ³-WSL2-ä¸­å®‰è£…-Docker-å…¨æµç¨‹ç¬”è®°ï¼ˆçº¯äºŒè¿›åˆ¶å®‰è£…æ–¹å¼ï¼‰" class="headerlink" title="ğŸ³ WSL2 ä¸­å®‰è£… Docker å…¨æµç¨‹ç¬”è®°ï¼ˆçº¯äºŒè¿›åˆ¶å®‰è£…æ–¹å¼ï¼‰"></a>ğŸ³ WSL2 ä¸­å®‰è£… Docker å…¨æµç¨‹ç¬”è®°ï¼ˆçº¯äºŒè¿›åˆ¶å®‰è£…æ–¹å¼ï¼‰</h1><blockquote>
<p>æœ¬æ–‡è®°å½•äº†åœ¨ WSL2ï¼ˆUbuntu 20.04ï¼‰ç¯å¢ƒä¸‹ï¼Œé€šè¿‡<strong>äºŒè¿›åˆ¶æ–¹å¼</strong>å®‰è£… Docker çš„å®Œæ•´æ­¥éª¤åŠç›¸å…³æ¦‚å¿µè§£æã€‚é€‚ç”¨äºæ— éœ€ä¾èµ– Docker Desktopï¼Œæ‰“é€ è½»é‡ã€é«˜æ•ˆçš„å¼€å‘ç¯å¢ƒã€‚</p>
</blockquote>
<hr>
<h2 id="ğŸ“¦-ä¸€ã€å®‰è£…æµç¨‹æ¦‚è¿°"><a href="#ğŸ“¦-ä¸€ã€å®‰è£…æµç¨‹æ¦‚è¿°" class="headerlink" title="ğŸ“¦ ä¸€ã€å®‰è£…æµç¨‹æ¦‚è¿°"></a>ğŸ“¦ ä¸€ã€å®‰è£…æµç¨‹æ¦‚è¿°</h2><h3 id="1ï¸âƒ£-ä¸‹è½½å®‰è£…åŒ…"><a href="#1ï¸âƒ£-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="1ï¸âƒ£ ä¸‹è½½å®‰è£…åŒ…"></a>1ï¸âƒ£ ä¸‹è½½å®‰è£…åŒ…</h3><ul>
<li>è®¿é—®é˜¿é‡Œäº‘é•œåƒç«™ä¸‹è½½ Docker äºŒè¿›åˆ¶åŒ…ï¼š</li>
<li>åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/">https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/docker-24.0.7.tgz</span><br></pre></td></tr></table></figure>

<h3 id="2ï¸âƒ£-è§£å‹å¹¶å®‰è£…"><a href="#2ï¸âƒ£-è§£å‹å¹¶å®‰è£…" class="headerlink" title="2ï¸âƒ£ è§£å‹å¹¶å®‰è£…"></a>2ï¸âƒ£ è§£å‹å¹¶å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf docker-24.0.7.tgz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> docker/* /usr/local/bin/</span><br></pre></td></tr></table></figure>

<p>æ­¤æ­¥éª¤å°† <code>docker</code> å’Œ <code>dockerd</code> ç­‰æ ¸å¿ƒå¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿè·¯å¾„ä¸‹ã€‚</p>
<hr>
<h2 id="âš™ï¸-äºŒã€é…ç½®é•œåƒåŠ é€Ÿå™¨"><a href="#âš™ï¸-äºŒã€é…ç½®é•œåƒåŠ é€Ÿå™¨" class="headerlink" title="âš™ï¸ äºŒã€é…ç½®é•œåƒåŠ é€Ÿå™¨"></a>âš™ï¸ äºŒã€é…ç½®é•œåƒåŠ é€Ÿå™¨</h2><p>åˆ›å»ºé…ç½®æ–‡ä»¶ <code>/etc/docker/daemon.json</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [&quot;https://&lt;ä½ çš„é˜¿é‡Œäº‘ID&gt;.mirror.aliyuncs.com&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½œç”¨ï¼šåŠ é€Ÿæ‹‰å– Docker é•œåƒï¼Œè§£å†³å›½å†…ç½‘ç»œé—®é¢˜ã€‚</p>
</blockquote>
<p>ACRä¼šä¸ºæ¯ä¸€ä¸ªè´¦å·ï¼ˆé˜¿é‡Œäº‘è´¦å·æˆ–RAMç”¨æˆ·ï¼‰ç”Ÿæˆä¸€ä¸ªé•œåƒåŠ é€Ÿå™¨åœ°å€ï¼Œé…ç½®é•œåƒåŠ é€Ÿå™¨å‰ï¼Œæ‚¨éœ€è¦è·å–é•œåƒåŠ é€Ÿå™¨åœ°å€ã€‚</p>
<ol>
<li>ç™»å½•<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/?spm=a2c4g.11186623.0.0.75121d82E0FDn8">å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å°</a>ã€‚</li>
<li>åœ¨å·¦ä¾§å¯¼èˆªæ é€‰æ‹©<em><strong>*é•œåƒå·¥å…·** &gt; **é•œåƒåŠ é€Ÿå™¨*</strong></em></li>
<li>åœ¨<strong>é•œåƒåŠ é€Ÿå™¨</strong>é¡µé¢è·å–<strong>åŠ é€Ÿå™¨åœ°å€</strong>ã€‚</li>
</ol>
<hr>
<h2 id="ğŸš€-ä¸‰ã€å¯åŠ¨-Docker-å®ˆæŠ¤è¿›ç¨‹"><a href="#ğŸš€-ä¸‰ã€å¯åŠ¨-Docker-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="ğŸš€ ä¸‰ã€å¯åŠ¨ Docker å®ˆæŠ¤è¿›ç¨‹"></a>ğŸš€ ä¸‰ã€å¯åŠ¨ Docker å®ˆæŠ¤è¿›ç¨‹</h2><p>ç”±äº WSL2 é»˜è®¤æ—  systemdï¼Œéœ€æ‰‹åŠ¨å¯åŠ¨ <code>dockerd</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dockerd &gt; /tmp/dockerd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç¼–å†™å¯åŠ¨è„šæœ¬ <code>start-docker.sh</code> æ–¹ä¾¿ä½¿ç”¨ã€‚</p>
<hr>
<h2 id="ğŸ‘¤-å››ã€é…ç½®ç”¨æˆ·æƒé™"><a href="#ğŸ‘¤-å››ã€é…ç½®ç”¨æˆ·æƒé™" class="headerlink" title="ğŸ‘¤ å››ã€é…ç½®ç”¨æˆ·æƒé™"></a>ğŸ‘¤ å››ã€é…ç½®ç”¨æˆ·æƒé™</h2><p>é¿å…æ¯æ¬¡è¿è¡Œ Docker å‘½ä»¤éƒ½éœ€è¦ sudoï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"><span class="built_in">exec</span> su -l <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ…-äº”ã€éªŒè¯-Docker-æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#âœ…-äº”ã€éªŒè¯-Docker-æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="âœ… äº”ã€éªŒè¯ Docker æ˜¯å¦å®‰è£…æˆåŠŸ"></a>âœ… äº”ã€éªŒè¯ Docker æ˜¯å¦å®‰è£…æˆåŠŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§ -å…­ã€å…³é”®æ¦‚å¿µè§£æ"><a href="#ğŸ§ -å…­ã€å…³é”®æ¦‚å¿µè§£æ" class="headerlink" title="ğŸ§  å…­ã€å…³é”®æ¦‚å¿µè§£æ"></a>ğŸ§  å…­ã€å…³é”®æ¦‚å¿µè§£æ</h2><h3 id="1ï¸âƒ£-dockerd-â€”â€”-Docker-Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰"><a href="#1ï¸âƒ£-dockerd-â€”â€”-Docker-Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰" class="headerlink" title="1ï¸âƒ£ dockerd â€”â€” Docker Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰"></a>1ï¸âƒ£ <code>dockerd</code> â€”â€” Docker Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰</h3><ul>
<li>è´Ÿè´£ç®¡ç†å®¹å™¨ã€é•œåƒã€ç½‘ç»œç­‰æ‰€æœ‰åå°æœåŠ¡</li>
<li>å¿…é¡»è¿è¡Œ <code>dockerd</code>ï¼Œå®¢æˆ·ç«¯ <code>docker</code> å‘½ä»¤æ‰èƒ½å·¥ä½œ</li>
</ul>
<h3 id="2ï¸âƒ£-var-run-docker-sock"><a href="#2ï¸âƒ£-var-run-docker-sock" class="headerlink" title="2ï¸âƒ£ /var/run/docker.sock"></a>2ï¸âƒ£ <code>/var/run/docker.sock</code></h3><ul>
<li>Docker å®¢æˆ·ç«¯ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡çš„ Unix Socket æ–‡ä»¶</li>
<li>æƒé™ä¸è¶³ä¼šå¯¼è‡´ <code>permission denied</code> é”™è¯¯</li>
</ul>
<h3 id="3ï¸âƒ£-daemon-json"><a href="#3ï¸âƒ£-daemon-json" class="headerlink" title="3ï¸âƒ£ daemon.json"></a>3ï¸âƒ£ <code>daemon.json</code></h3><ul>
<li>Docker çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºè®¾ç½®é•œåƒåŠ é€Ÿå™¨ã€æ—¥å¿—é©±åŠ¨ç­‰</li>
<li>ä½ç½®ï¼š<code>/etc/docker/daemon.json</code></li>
</ul>
<h3 id="4ï¸âƒ£-é•œåƒåŠ é€Ÿå™¨"><a href="#4ï¸âƒ£-é•œåƒåŠ é€Ÿå™¨" class="headerlink" title="4ï¸âƒ£ é•œåƒåŠ é€Ÿå™¨"></a>4ï¸âƒ£ é•œåƒåŠ é€Ÿå™¨</h3><ul>
<li>å›½å†…è®¿é—® Docker Hub ç¼“æ…¢ï¼Œé€šè¿‡é˜¿é‡Œäº‘ã€ç½‘æ˜“ç­‰æä¾›çš„åŠ é€ŸæœåŠ¡ï¼Œå¤§å¹…æå‡é•œåƒæ‹‰å–é€Ÿåº¦</li>
</ul>
<hr>
<h2 id="ğŸ“Œ-ä¸ƒã€å¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#ğŸ“Œ-ä¸ƒã€å¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="ğŸ“Œ ä¸ƒã€å¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>ğŸ“Œ ä¸ƒã€å¸¸ç”¨å‘½ä»¤æ€»ç»“</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>sudo dockerd &amp;</code></td>
<td>å¯åŠ¨ Docker åå°æœåŠ¡</td>
</tr>
<tr>
<td><code>docker ps</code></td>
<td>æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</td>
</tr>
<tr>
<td><code>docker images</code></td>
<td>æŸ¥çœ‹æœ¬åœ°é•œåƒ</td>
</tr>
<tr>
<td><code>docker run hello-world</code></td>
<td>æµ‹è¯• Docker æ˜¯å¦æ­£å¸¸è¿è¡Œ</td>
</tr>
<tr>
<td><code>docker stop &lt;å®¹å™¨ID&gt;</code></td>
<td>åœæ­¢å®¹å™¨</td>
</tr>
<tr>
<td><code>docker rm &lt;å®¹å™¨ID&gt;</code></td>
<td>åˆ é™¤å®¹å™¨</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>æœ¬æ–‡æ¡£é€‚ç”¨äºä¸ªäººå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç»“åˆ systemd æˆ–ä½¿ç”¨ Docker Desktopã€‚</p>
</blockquote>
<h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p><code>docker_start.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dockerd &gt; /tmp/dockerd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>



<p>æ³¨: ä¸€ä¸‹è„šæœ¬ä¸åˆé€‚å›½å†…ç½‘ç»œç¯å¢ƒ, APT getä¸åˆ°, å…¶ä¸­å®‰è£…çš„å¤šä¸ªåº”ç”¨:</p>
<p><code>docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></p>
<p>å‡æ¶µç›–åœ¨é˜¿é‡Œäº‘é•œåƒçš„äºŒè¿›åˆ¶ç¨‹åºå‹ç¼©åŒ…ä¸­</p>
<p><code>wsl2_docker_install.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># WSL2 å®‰è£… Docker Engine è„šæœ¬ (é€‚ç”¨äº Ubuntu)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸš¨ æ¸…ç†æ—§ç‰ˆæœ¬ Docker...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge -y docker.io docker-doc docker-compose docker-compose-v2 docker-engine docker containerd runc</span><br><span class="line"><span class="built_in">sudo</span> apt autoremove -y</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âœ… å®‰è£…ä¾èµ–...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y ca-certificates curl gnupg lsb-release</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ”‘ æ·»åŠ  Docker å®˜æ–¹ GPG å¯†é’¥...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ“¦ æ·»åŠ  Docker APT æº...&quot;</span></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸš€ å¼€å§‹å®‰è£… Docker Engine...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âœ… Docker å®‰è£…å®Œæˆï¼&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âš¡ é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨...&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [&quot;https://&lt;ä½ çš„é˜¿é‡Œäº‘ID&gt;.mirror.aliyuncs.com&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸš¨ æ³¨æ„ï¼šWSL2 æ— æ³•ä½¿ç”¨ systemd å¯åŠ¨ Docker æœåŠ¡&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ‘‰ è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰‹åŠ¨å¯åŠ¨ Docker å®ˆæŠ¤è¿›ç¨‹ï¼š&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sudo dockerd &gt; /tmp/dockerd.log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ’¡ å¯åŠ¨åï¼Œä½¿ç”¨ &#x27;docker ps&#x27; è¿›è¡ŒéªŒè¯&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/12/tech/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/12/tech/linux/" class="post-title-link" itemprop="url">Linux Common Operations</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-12T00:00:00+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="ğŸ§-Linux-å¸¸è§æ“ä½œå¯¹ç…§æ‰‹å†Œï¼ˆç±»æ¯”-Windows-ç³»ç»Ÿï¼‰"><a href="#ğŸ§-Linux-å¸¸è§æ“ä½œå¯¹ç…§æ‰‹å†Œï¼ˆç±»æ¯”-Windows-ç³»ç»Ÿï¼‰" class="headerlink" title="ğŸ§ Linux å¸¸è§æ“ä½œå¯¹ç…§æ‰‹å†Œï¼ˆç±»æ¯” Windows ç³»ç»Ÿï¼‰"></a>ğŸ§ Linux å¸¸è§æ“ä½œå¯¹ç…§æ‰‹å†Œï¼ˆç±»æ¯” Windows ç³»ç»Ÿï¼‰</h1><blockquote>
<p>æœ¬æ–‡æ—¨åœ¨å¸®åŠ©ç†Ÿæ‚‰ Windows ç³»ç»Ÿçš„ç”¨æˆ·å¿«é€ŸæŒæ¡ Linux ä¸­çš„å¸¸ç”¨ç³»ç»Ÿæ“ä½œï¼ŒåŒæ—¶è¡¥å……å¸¸ç”¨å‘½ä»¤çš„å«ä¹‰ä¾¿äºè®°å¿†ã€‚</p>
</blockquote>
<hr>
<h2 id="ğŸ§ -åŸºç¡€ä¿¡æ¯æŸ¥çœ‹"><a href="#ğŸ§ -åŸºç¡€ä¿¡æ¯æŸ¥çœ‹" class="headerlink" title="ğŸ§  åŸºç¡€ä¿¡æ¯æŸ¥çœ‹"></a>ğŸ§  åŸºç¡€ä¿¡æ¯æŸ¥çœ‹</h2><h3 id="æŸ¥çœ‹å½“å‰ç”¨æˆ·åï¼ˆwhoami-â†’-who-am-iï¼‰"><a href="#æŸ¥çœ‹å½“å‰ç”¨æˆ·åï¼ˆwhoami-â†’-who-am-iï¼‰" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”¨æˆ·åï¼ˆwhoami â†’ who am iï¼‰"></a>æŸ¥çœ‹å½“å‰ç”¨æˆ·åï¼ˆwhoami â†’ who am iï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">whoami</span>  <span class="comment"># æ˜¾ç¤ºå½“å‰ç™»å½•ç”¨æˆ·ï¼ˆwho am Iï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹å½“å‰æ‰€åœ¨è·¯å¾„ï¼ˆpwd-â†’-print-working-directoryï¼‰"><a href="#æŸ¥çœ‹å½“å‰æ‰€åœ¨è·¯å¾„ï¼ˆpwd-â†’-print-working-directoryï¼‰" class="headerlink" title="æŸ¥çœ‹å½“å‰æ‰€åœ¨è·¯å¾„ï¼ˆpwd â†’ print working directoryï¼‰"></a>æŸ¥çœ‹å½“å‰æ‰€åœ¨è·¯å¾„ï¼ˆpwd â†’ print working directoryï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span>  <span class="comment"># æ˜¾ç¤ºå½“å‰æ‰€åœ¨çš„ç»å¯¹è·¯å¾„</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼ˆuname-â†’-unix-nameï¼‰"><a href="#æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼ˆuname-â†’-unix-nameï¼‰" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼ˆuname â†’ unix nameï¼‰"></a>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼ˆuname â†’ unix nameï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -a         <span class="comment"># æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ã€æ¶æ„</span></span><br><span class="line">lsb_release -a   <span class="comment"># æŸ¥çœ‹å‘è¡Œç‰ˆä¿¡æ¯</span></span><br><span class="line">hostnamectl      <span class="comment"># æ˜¾ç¤ºä¸»æœºåå’Œç³»ç»Ÿç‰ˆæœ¬ç­‰ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“-æ–‡ä»¶ä¸ç›®å½•æ“ä½œ"><a href="#ğŸ“-æ–‡ä»¶ä¸ç›®å½•æ“ä½œ" class="headerlink" title="ğŸ“ æ–‡ä»¶ä¸ç›®å½•æ“ä½œ"></a>ğŸ“ æ–‡ä»¶ä¸ç›®å½•æ“ä½œ</h2><h3 id="æŸ¥çœ‹ç›®å½•å†…å®¹ï¼ˆls-â†’-list-segmentsï¼‰"><a href="#æŸ¥çœ‹ç›®å½•å†…å®¹ï¼ˆls-â†’-list-segmentsï¼‰" class="headerlink" title="æŸ¥çœ‹ç›®å½•å†…å®¹ï¼ˆls â†’ list segmentsï¼‰"></a>æŸ¥çœ‹ç›®å½•å†…å®¹ï¼ˆls â†’ list segmentsï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -lh      <span class="comment"># åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¸¦å•ä½å’Œæ—¶é—´</span></span><br><span class="line"><span class="built_in">ls</span> -a       <span class="comment"># æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼ˆä»¥.å¼€å¤´ï¼‰</span></span><br><span class="line"><span class="built_in">ls</span> -R       <span class="comment"># é€’å½’åˆ—å‡ºæ‰€æœ‰å­ç›®å½•å†…å®¹</span></span><br></pre></td></tr></table></figure>

<h3 id="å¤åˆ¶-ç§»åŠ¨-åˆ é™¤-æ–‡ä»¶"><a href="#å¤åˆ¶-ç§»åŠ¨-åˆ é™¤-æ–‡ä»¶" class="headerlink" title="å¤åˆ¶ &#x2F; ç§»åŠ¨ &#x2F; åˆ é™¤ æ–‡ä»¶"></a>å¤åˆ¶ &#x2F; ç§»åŠ¨ &#x2F; åˆ é™¤ æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> file1 file2       <span class="comment"># cp â†’ copyï¼Œå¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cp</span> -r dir1 dir2      <span class="comment"># é€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•</span></span><br><span class="line"><span class="built_in">mv</span> file newname      <span class="comment"># mv â†’ moveï¼Œç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">rm</span> file.txt          <span class="comment"># rm â†’ removeï¼Œåˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">rm</span> -r folder/        <span class="comment"># é€’å½’åˆ é™¤æ–‡ä»¶å¤¹</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆchmod-â†’-change-modeï¼‰"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆchmod-â†’-change-modeï¼‰" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆchmod â†’ change modeï¼‰"></a>ä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆchmod â†’ change modeï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x run.sh      <span class="comment"># å¢åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> 644 file.txt   <span class="comment"># è®¾å®šå…·ä½“æƒé™ï¼ˆrw-r--r--ï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="7-ä¿®æ”¹å½’å±ç”¨æˆ·å’Œç»„ï¼ˆchown-â†’-change-ownerï¼‰"><a href="#7-ä¿®æ”¹å½’å±ç”¨æˆ·å’Œç»„ï¼ˆchown-â†’-change-ownerï¼‰" class="headerlink" title="7. ä¿®æ”¹å½’å±ç”¨æˆ·å’Œç»„ï¼ˆchown â†’ change ownerï¼‰"></a>7. ä¿®æ”¹å½’å±ç”¨æˆ·å’Œç»„ï¼ˆchown â†’ change ownerï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> yifan file.txt  <span class="comment"># æŠŠæ–‡ä»¶å½’å±æ›´æ”¹ä¸º yifan</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“‹-æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘"><a href="#ğŸ“‹-æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘" class="headerlink" title="ğŸ“‹ æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘"></a>ğŸ“‹ æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘</h2><h3 id="å¿«é€ŸæŸ¥çœ‹æ–‡ä»¶å†…å®¹"><a href="#å¿«é€ŸæŸ¥çœ‹æ–‡ä»¶å†…å®¹" class="headerlink" title="å¿«é€ŸæŸ¥çœ‹æ–‡ä»¶å†…å®¹"></a>å¿«é€ŸæŸ¥çœ‹æ–‡ä»¶å†…å®¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> file.txt         <span class="comment"># cat â†’ concatenateï¼Œä¸€æ¬¡æ€§æŸ¥çœ‹å…¨éƒ¨å†…å®¹</span></span><br><span class="line">less file.txt        <span class="comment"># åˆ†é¡µæŸ¥çœ‹ï¼Œå¯ä¸Šä¸‹ç¿»é¡µ</span></span><br><span class="line"><span class="built_in">head</span> -n 10 file.txt  <span class="comment"># æ˜¾ç¤ºå‰ 10 è¡Œ</span></span><br><span class="line"><span class="built_in">tail</span> -n 10 file.txt  <span class="comment"># æ˜¾ç¤ºå 10 è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> $(find dir1 dir2 -<span class="built_in">type</span> f) <span class="comment"># æ‰“å°å‡º dir1 dir2 ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹ (é€’å½’è¿›è¡Œ)</span></span><br><span class="line"></span><br><span class="line">find dir1 dir2 -<span class="built_in">type</span> f | <span class="keyword">while</span> <span class="built_in">read</span> file; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===== <span class="variable">$file</span> =====&quot;</span></span><br><span class="line">  <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> <span class="comment"># åœ¨æ–‡ä»¶ä¸æ–‡ä»¶ä¹‹é—´åŠ ä¸Š ===== æ–‡ä»¶å =====</span></span><br><span class="line"></span><br><span class="line">find dir1 dir2 -<span class="built_in">type</span> f -name <span class="string">&quot;*.java&quot;</span> | <span class="keyword">while</span> <span class="built_in">read</span> file; <span class="keyword">do</span> <span class="comment"># é™åˆ¶æ–‡ä»¶ç±»å‹</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===== <span class="variable">$file</span> =====&quot;</span></span><br><span class="line">  <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘æ–‡ä»¶"><a href="#ç¼–è¾‘æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘æ–‡ä»¶"></a>ç¼–è¾‘æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nano file.txt        <span class="comment"># ç»ˆç«¯å†…ç®€å•ç¼–è¾‘å™¨</span></span><br><span class="line">vim file.txt         <span class="comment"># é«˜çº§ç¼–è¾‘å™¨ï¼ˆvi improvedï¼‰</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ’»-ç³»ç»Ÿèµ„æºç®¡ç†"><a href="#ğŸ’»-ç³»ç»Ÿèµ„æºç®¡ç†" class="headerlink" title="ğŸ’» ç³»ç»Ÿèµ„æºç®¡ç†"></a>ğŸ’» ç³»ç»Ÿèµ„æºç®¡ç†</h2><h3 id="æŸ¥çœ‹è¿›ç¨‹ï¼ˆtop-â†’-table-of-processesï¼‰"><a href="#æŸ¥çœ‹è¿›ç¨‹ï¼ˆtop-â†’-table-of-processesï¼‰" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹ï¼ˆtop â†’ table of processesï¼‰"></a>æŸ¥çœ‹è¿›ç¨‹ï¼ˆtop â†’ table of processesï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top        <span class="comment"># å®æ—¶æ˜¾ç¤ºç³»ç»Ÿè¿›ç¨‹å’Œèµ„æºå ç”¨</span></span><br><span class="line">htop       <span class="comment"># æ›´å‹å¥½ã€å›¾å½¢åŒ–çš„ top</span></span><br><span class="line">ps aux     <span class="comment"># æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹è¯¦ç»†ä¿¡æ¯ï¼ˆps â†’ process statusï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹ç«¯å£å’Œè¿æ¥ï¼ˆss-â†’-socket-statisticsï¼‰"><a href="#æŸ¥çœ‹ç«¯å£å’Œè¿æ¥ï¼ˆss-â†’-socket-statisticsï¼‰" class="headerlink" title="æŸ¥çœ‹ç«¯å£å’Œè¿æ¥ï¼ˆss â†’ socket statisticsï¼‰"></a>æŸ¥çœ‹ç«¯å£å’Œè¿æ¥ï¼ˆss â†’ socket statisticsï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ss -tulnp</span><br><span class="line"><span class="comment"># -p: è¡¨ç¤ºæ˜¾ç¤º ç›‘å¬è¯¥ç«¯å£çš„è¿›ç¨‹ï¼ˆPID/åç§°ï¼‰</span></span><br><span class="line"><span class="comment"># -nï¼šä¸è§£ææœåŠ¡åç§°ï¼ˆä¾‹å¦‚æ˜¾ç¤º 3306 è€Œä¸æ˜¯ mysqlï¼‰</span></span><br><span class="line"><span class="comment"># -lï¼šåªæ˜¾ç¤ºç›‘å¬çŠ¶æ€ï¼ˆListenï¼‰</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ss -tuln           <span class="comment"># æ˜¾ç¤ºç›‘å¬çš„ TCP/UDP ç«¯å£</span></span><br><span class="line">lsof -i:8080       <span class="comment"># æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹å ç”¨ç«¯å£ï¼ˆlsof â†’ list open filesï¼‰</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ’¿-ç£ç›˜ä¸ç©ºé—´"><a href="#ğŸ’¿-ç£ç›˜ä¸ç©ºé—´" class="headerlink" title="ğŸ’¿ ç£ç›˜ä¸ç©ºé—´"></a>ğŸ’¿ ç£ç›˜ä¸ç©ºé—´</h2><h3 id="æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆdf-â†’-disk-freeï¼‰"><a href="#æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆdf-â†’-disk-freeï¼‰" class="headerlink" title="æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆdf â†’ disk freeï¼‰"></a>æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆdf â†’ disk freeï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h  <span class="comment"># æŸ¥çœ‹æ¯ä¸ªæŒ‚è½½ç‚¹çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹ç›®å½•å¤§å°ï¼ˆdu-â†’-disk-usageï¼‰"><a href="#æŸ¥çœ‹ç›®å½•å¤§å°ï¼ˆdu-â†’-disk-usageï¼‰" class="headerlink" title="æŸ¥çœ‹ç›®å½•å¤§å°ï¼ˆdu â†’ disk usageï¼‰"></a>æŸ¥çœ‹ç›®å½•å¤§å°ï¼ˆdu â†’ disk usageï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -sh .    <span class="comment"># å½“å‰ç›®å½•æ€»å¤§å°</span></span><br><span class="line"><span class="built_in">du</span> -sh *    <span class="comment"># å½“å‰ç›®å½•ä¸‹å„æ–‡ä»¶/ç›®å½•å¤§å°</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h  <span class="comment"># æ˜¾ç¤ºå†…å­˜å’Œ swap ä½¿ç”¨æƒ…å†µ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§©-è½¯ä»¶åŒ…ç®¡ç†"><a href="#ğŸ§©-è½¯ä»¶åŒ…ç®¡ç†" class="headerlink" title="ğŸ§© è½¯ä»¶åŒ…ç®¡ç†"></a>ğŸ§© è½¯ä»¶åŒ…ç®¡ç†</h2><h3 id="å®‰è£…ç¨‹åºï¼ˆapt-â†’-advanced-package-toolï¼‰"><a href="#å®‰è£…ç¨‹åºï¼ˆapt-â†’-advanced-package-toolï¼‰" class="headerlink" title="å®‰è£…ç¨‹åºï¼ˆapt â†’ advanced package toolï¼‰"></a>å®‰è£…ç¨‹åºï¼ˆapt â†’ advanced package toolï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install &lt;è½¯ä»¶å&gt;</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶"><a href="#æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶" class="headerlink" title="æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶"></a>æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l  <span class="comment"># åˆ—å‡ºæ‰€æœ‰å®‰è£…çš„è½¯ä»¶åŒ…</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸è½½ç¨‹åº"><a href="#å¸è½½ç¨‹åº" class="headerlink" title="å¸è½½ç¨‹åº"></a>å¸è½½ç¨‹åº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove &lt;è½¯ä»¶å&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âš™ï¸-æœåŠ¡ä¸å¯åŠ¨é¡¹ç®¡ç†"><a href="#âš™ï¸-æœåŠ¡ä¸å¯åŠ¨é¡¹ç®¡ç†" class="headerlink" title="âš™ï¸ æœåŠ¡ä¸å¯åŠ¨é¡¹ç®¡ç†"></a>âš™ï¸ æœåŠ¡ä¸å¯åŠ¨é¡¹ç®¡ç†</h2><h3 id="æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼ˆsystemctl-â†’-system-controlï¼‰"><a href="#æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼ˆsystemctl-â†’-system-controlï¼‰" class="headerlink" title="æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼ˆsystemctl â†’ system controlï¼‰"></a>æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼ˆsystemctl â†’ system controlï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status mysql</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨-åœæ­¢-é‡å¯æœåŠ¡"><a href="#å¯åŠ¨-åœæ­¢-é‡å¯æœåŠ¡" class="headerlink" title="å¯åŠ¨ &#x2F; åœæ­¢ &#x2F; é‡å¯æœåŠ¡"></a>å¯åŠ¨ &#x2F; åœæ­¢ &#x2F; é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart redis</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸŒ-ç½‘ç»œç›¸å…³"><a href="#ğŸŒ-ç½‘ç»œç›¸å…³" class="headerlink" title="ğŸŒ ç½‘ç»œç›¸å…³"></a>ğŸŒ ç½‘ç»œç›¸å…³</h2><h3 id="æŸ¥çœ‹-IP-åœ°å€"><a href="#æŸ¥çœ‹-IP-åœ°å€" class="headerlink" title="æŸ¥çœ‹ IP åœ°å€"></a>æŸ¥çœ‹ IP åœ°å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip a           <span class="comment"># æŸ¥çœ‹è¯¦ç»† IP ä¿¡æ¯</span></span><br><span class="line">hostname -I    <span class="comment"># å¿«é€ŸæŸ¥çœ‹ä¸»æœº IP</span></span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•ç½‘ç»œè¿æ¥"><a href="#æµ‹è¯•ç½‘ç»œè¿æ¥" class="headerlink" title="æµ‹è¯•ç½‘ç»œè¿æ¥"></a>æµ‹è¯•ç½‘ç»œè¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br><span class="line">curl -I https://google.com</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ…-æ¨èå·¥å…·æ±‡æ€»"><a href="#âœ…-æ¨èå·¥å…·æ±‡æ€»" class="headerlink" title="âœ… æ¨èå·¥å…·æ±‡æ€»"></a>âœ… æ¨èå·¥å…·æ±‡æ€»</h2><table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>htop</td>
<td><code>sudo apt install htop</code></td>
<td>è¿›ç¨‹æŸ¥çœ‹å™¨ï¼Œæ›¿ä»£ top</td>
</tr>
<tr>
<td>ncdu</td>
<td><code>sudo apt install ncdu</code></td>
<td>å›¾å½¢åŒ–æŸ¥çœ‹ç›®å½•å¤§å°</td>
</tr>
<tr>
<td>tree</td>
<td><code>sudo apt install tree</code></td>
<td>ä»¥æ ‘å½¢ç»“æ„æ˜¾ç¤ºç›®å½•</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>æœ¬æ–‡ç”± ChatGPT æ•´ç†ç”Ÿæˆï¼Œé€‚åˆåˆä¸­é«˜çº§ Linux ä½¿ç”¨è€…ç±»æ¯” Windows ç†Ÿç»ƒæŒæ¡ç³»ç»Ÿå¸¸è§æ“ä½œã€‚</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/12/tech/vmware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/12/tech/vmware/" class="post-title-link" itemprop="url">VMware</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-12T00:00:00+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h2 id="ğŸ§±-ä¸€ã€å®‰è£…è™šæ‹Ÿæœº"><a href="#ğŸ§±-ä¸€ã€å®‰è£…è™šæ‹Ÿæœº" class="headerlink" title="ğŸ§± ä¸€ã€å®‰è£…è™šæ‹Ÿæœº"></a>ğŸ§± ä¸€ã€å®‰è£…è™šæ‹Ÿæœº</h2><p>ä½ é€‰æ‹©ä½¿ç”¨ <strong>VMware Workstation Pro</strong>ï¼ˆç°å·²å…è´¹ï¼‰ï¼Œä½œä¸ºè¿è¡Œè™šæ‹Ÿç³»ç»Ÿçš„å·¥å…·ï¼š</p>
<ul>
<li>âœ… VMware æ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„è™šæ‹Ÿæœºç®¡ç†å¹³å°</li>
<li>âœ… æ”¯æŒå®‰è£…åœ¨ D ç›˜ï¼ˆä½ å·²ç»å®Œæˆï¼‰</li>
<li>âœ… è™šæ‹Ÿç³»ç»Ÿï¼ˆå¦‚ Ubuntuï¼‰çš„é•œåƒå’Œæ–‡ä»¶å¯ä»¥ç‹¬ç«‹æ”¾ç½®ï¼ˆå¦‚ D:\VMs\Ubuntu18-devï¼‰</li>
<li>âœ… æˆåŠŸä» <a target="_blank" rel="noopener" href="https://releases.ubuntu.com/">Ubuntu Releases</a> ä¸‹è½½å¹¶ä½¿ç”¨ ISO å®‰è£… Ubuntu 18.04</li>
</ul>
<hr>
<h2 id="âš™ï¸-äºŒã€è™šæ‹Ÿæœºé…ç½®"><a href="#âš™ï¸-äºŒã€è™šæ‹Ÿæœºé…ç½®" class="headerlink" title="âš™ï¸ äºŒã€è™šæ‹Ÿæœºé…ç½®"></a>âš™ï¸ äºŒã€è™šæ‹Ÿæœºé…ç½®</h2><p>ä½ å®Œæˆå¹¶äº†è§£äº†ä»¥ä¸‹é…ç½®æ“ä½œï¼š</p>
<ul>
<li>âœ… å®‰è£… Ubuntu 18.04 ç³»ç»Ÿï¼Œå¹¶äº†è§£è™šæ‹Ÿç¡¬ä»¶ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰é…ç½®å»ºè®®ï¼š<ul>
<li>ä½ æœ¬æœºä¸º 8 æ ¸ï¼Œè™šæ‹Ÿæœºåˆ†é… 2~4 æ ¸è¾ƒä¸ºåˆç†</li>
</ul>
</li>
<li>âœ… å®‰è£… VMware Toolsï¼Œå®ç°åˆ†è¾¨ç‡è‡ªé€‚åº”ã€æ‹–æ‹½å¤åˆ¶ã€å…±äº«å‰ªè´´æ¿ç­‰</li>
<li>âœ… å­¦ä¼šä½¿ç”¨ GUI è®¾ç½®å›¾æ ‡å¤§å°ã€å¯ç”¨ fractional scaling æ”¹å˜ UI ç¼©æ”¾æ¯”ä¾‹</li>
<li>âœ… å­¦ä¼šå®‰å…¨å…³æœºå’Œä¿®æ”¹è™šæ‹Ÿæœº CPU é…ç½®ï¼ˆéœ€å…³æœºåè®¾ç½®ï¼‰</li>
</ul>
<hr>
<h2 id="ğŸ‘¤-ä¸‰ã€Linux-ç³»ç»Ÿç”¨æˆ·é—®é¢˜"><a href="#ğŸ‘¤-ä¸‰ã€Linux-ç³»ç»Ÿç”¨æˆ·é—®é¢˜" class="headerlink" title="ğŸ‘¤ ä¸‰ã€Linux ç³»ç»Ÿç”¨æˆ·é—®é¢˜"></a>ğŸ‘¤ ä¸‰ã€Linux ç³»ç»Ÿç”¨æˆ·é—®é¢˜</h2><p>ä½ æå‡ºäº†éå¸¸æ ¸å¿ƒçš„é—®é¢˜ï¼Œç†è§£äº† Linux ä¸ Windows åœ¨ç”¨æˆ·ç®¡ç†ä¸Šçš„å·®å¼‚ï¼š</p>
<ul>
<li>âœ… æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ç‹¬ç«‹çš„ home ç›®å½•ï¼ˆå¦‚ <code>/home/ypy</code>ï¼‰</li>
<li>âœ… æ™®é€šç”¨æˆ·éœ€ä½¿ç”¨ <code>sudo</code> æ¥æ‰§è¡Œç³»ç»Ÿçº§ä»»åŠ¡ï¼ˆå¦‚å®‰è£…è½¯ä»¶ï¼‰</li>
<li>âœ… root æ˜¯æœ€é«˜æƒé™ç”¨æˆ·ï¼Œä½† Ubuntu é»˜è®¤ç¦ç”¨ root å¯†ç ï¼Œæ¨èä½¿ç”¨ <code>sudo -i</code> è¿›å…¥ root shell</li>
<li>âœ… ä½¿ç”¨ <code>whoami</code>, <code>id</code>, <code>cat /etc/passwd</code> æ¥æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</li>
<li>âœ… è½¯ä»¶å®‰è£…é€šå¸¸æ˜¯â€œå…¨å±€ä¸€æ¬¡å®‰è£…ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«â€ï¼Œéæ¯äººå®‰è£…ä¸€ä»½</li>
</ul>
<hr>
<h2 id="ğŸ“-å››ã€Linux-ç³»ç»Ÿå¸¸ç”¨ï¼ˆé‡è¦ï¼‰æ–‡ä»¶å¤¹"><a href="#ğŸ“-å››ã€Linux-ç³»ç»Ÿå¸¸ç”¨ï¼ˆé‡è¦ï¼‰æ–‡ä»¶å¤¹" class="headerlink" title="ğŸ“ å››ã€Linux ç³»ç»Ÿå¸¸ç”¨ï¼ˆé‡è¦ï¼‰æ–‡ä»¶å¤¹"></a>ğŸ“ å››ã€Linux ç³»ç»Ÿå¸¸ç”¨ï¼ˆé‡è¦ï¼‰æ–‡ä»¶å¤¹</h2><p>ä½ å¤ä¹ å¹¶ç†è§£äº† Linux æ–‡ä»¶ç³»ç»Ÿçš„æ ‘çŠ¶ç»“æ„ï¼Œä»¥ <code>/</code> ä¸ºæ ¹ï¼š</p>
<table>
<thead>
<tr>
<th>ç›®å½•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>/home</code></td>
<td>ç”¨æˆ·ä¸»ç›®å½•ï¼Œå¼€å‘è€…æ—¥å¸¸ä½¿ç”¨åŒºåŸŸ</td>
</tr>
<tr>
<td><code>/usr/bin</code></td>
<td>å¯æ‰§è¡Œç¨‹åºä½ç½®</td>
</tr>
<tr>
<td><code>/etc</code></td>
<td>é…ç½®æ–‡ä»¶ä½ç½®</td>
</tr>
<tr>
<td><code>/var/lib</code></td>
<td>åº”ç”¨æ•°æ®ï¼ˆå¦‚æ•°æ®åº“ï¼‰</td>
</tr>
<tr>
<td><code>/tmp</code></td>
<td>ä¸´æ—¶æ–‡ä»¶</td>
</tr>
<tr>
<td><code>/root</code></td>
<td>root ç”¨æˆ·çš„ home ç›®å½•</td>
</tr>
<tr>
<td><code>/opt</code></td>
<td>å¯é€‰å®‰è£…ç›®å½•ï¼ˆç¬¬ä¸‰æ–¹ç¨‹åºï¼‰</td>
</tr>
</tbody></table>
<p>ä½ ä¹Ÿå­¦ä¼šäº†åœ¨ <strong>å›¾å½¢ç•Œé¢ä¸­è®¿é—®æ ¹ç›®å½•</strong>ï¼ˆç‚¹å‡»â€œå…¶ä»–ä½ç½®â€ â†’ â€œComputerâ€ï¼‰ã€‚</p>
<hr>
<h2 id="ğŸ§°-äº”ã€Linux-å®‰è£…è½¯ä»¶é—®é¢˜"><a href="#ğŸ§°-äº”ã€Linux-å®‰è£…è½¯ä»¶é—®é¢˜" class="headerlink" title="ğŸ§° äº”ã€Linux å®‰è£…è½¯ä»¶é—®é¢˜"></a>ğŸ§° äº”ã€Linux å®‰è£…è½¯ä»¶é—®é¢˜</h2><p>ä½ éå¸¸æ·±å…¥åœ°æ¢è®¨äº† Ubuntu å¦‚ä½•é¿å… Windows ä¸­â€œå¸è½½ä¸å¹²å‡€â€çš„é—®é¢˜ï¼Œå¹¶ç†è§£äº†ï¼š</p>
<ul>
<li><p>âœ… Ubuntu ä½¿ç”¨ <code>apt</code> åŒ…ç®¡ç†å™¨è¿›è¡Œè½¯ä»¶å®‰è£…ä¸å¸è½½</p>
</li>
<li><p>âœ… æ‰€æœ‰ç¨‹åºä¼šç»Ÿä¸€è£…å…¥æ ‡å‡†ç›®å½•ï¼ˆæ— ä¹±æ”¾ã€æ— æ³¨å†Œè¡¨ï¼‰</p>
</li>
<li><p>âœ… å¸è½½è½¯ä»¶å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove è½¯ä»¶å      <span class="comment"># å¸è½½ç¨‹åºä½†ä¿ç•™é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> apt purge è½¯ä»¶å       <span class="comment"># è¿é…ç½®ä¸€å¹¶æ¸…é™¤</span></span><br><span class="line"><span class="built_in">sudo</span> apt autoremove         <span class="comment"># æ¸…é™¤æ— ç”¨ä¾èµ–</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>âœ… ä½ äº²æ‰‹å®Œæˆäº†ï¼š</p>
<ul>
<li>å¸è½½ Firefox</li>
<li>å®‰è£… Google Chromeï¼ˆé€šè¿‡å®˜ç½‘ <code>.deb</code> å®‰è£…åŒ…æˆ– <code>wget + dpkg</code>ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸ”§-å…­ã€é…ç½®-Gitï¼ˆè¿æ¥-GitHubï¼‰"><a href="#ğŸ”§-å…­ã€é…ç½®-Gitï¼ˆè¿æ¥-GitHubï¼‰" class="headerlink" title="ğŸ”§ å…­ã€é…ç½® Gitï¼ˆè¿æ¥ GitHubï¼‰"></a>ğŸ”§ å…­ã€é…ç½® Gitï¼ˆè¿æ¥ GitHubï¼‰</h2><p>ä½ ç†è§£äº†è¿œç¨‹å¼€å‘ä¸­ Git çš„é‡è¦æ€§ï¼Œå¹¶åœ¨è™šæ‹Ÿæœºä¸­å®Œæˆäº†ä»¥ä¸‹é…ç½®ï¼š</p>
<ul>
<li><p>âœ… å®‰è£… Gitï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install git</span><br></pre></td></tr></table></figure>
</li>
<li><p>âœ… è®¾ç½® Git ç”¨æˆ·ä¿¡æ¯ï¼ˆæäº¤ç”¨ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;peiyouyao&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;peiyouyao@gmail.com&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>âœ… ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆed25519ï¼‰ï¼Œç”¨äºè¿æ¥ GitHubï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;ä½ çš„é‚®ç®±&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>âœ… æˆåŠŸå°†å…¬é’¥æ·»åŠ åˆ° GitHubï¼ˆSettings â†’ SSH Keysï¼‰</p>
</li>
<li><p>âœ… æµ‹è¯•è¿æ¥æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>âœ… æ”¯æŒåœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ SSH å…‹éš†ã€æäº¤ã€æ¨é€ GitHub ä»“åº“</p>
</li>
</ul>
<h2 id="å®‰è£…SSHæœåŠ¡"><a href="#å®‰è£…SSHæœåŠ¡" class="headerlink" title="å®‰è£…SSHæœåŠ¡"></a>å®‰è£…SSHæœåŠ¡</h2><table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>å‘½ä»¤ï¼ˆåœ¨è™šæ‹Ÿæœºä¸­ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>æ£€æŸ¥ IP</td>
<td><code>ip a</code></td>
</tr>
<tr>
<td>å®‰è£… SSH æœåŠ¡</td>
<td><code>sudo apt install openssh-server</code></td>
</tr>
<tr>
<td>å¯åŠ¨æœåŠ¡</td>
<td><code>sudo systemctl start ssh</code></td>
</tr>
<tr>
<td>è®¾ç½®å¼€æœºå¯åŠ¨</td>
<td><code>sudo systemctl enable ssh</code></td>
</tr>
<tr>
<td>æ£€æŸ¥çŠ¶æ€</td>
<td><code>sudo systemctl status ssh</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/12/tech/wsl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/12/tech/wsl/" class="post-title-link" itemprop="url">WSL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-12T00:00:00+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="ğŸ§-WSL-å®‰è£…ä¸é…ç½®ç¬”è®°"><a href="#ğŸ§-WSL-å®‰è£…ä¸é…ç½®ç¬”è®°" class="headerlink" title="ğŸ§ WSL å®‰è£…ä¸é…ç½®ç¬”è®°"></a>ğŸ§ WSL å®‰è£…ä¸é…ç½®ç¬”è®°</h1><hr>
<h2 id="âœ…-ä¸€ã€WSL-çš„å®‰è£…ä¸è¯´æ˜"><a href="#âœ…-ä¸€ã€WSL-çš„å®‰è£…ä¸è¯´æ˜" class="headerlink" title="âœ… ä¸€ã€WSL çš„å®‰è£…ä¸è¯´æ˜"></a>âœ… ä¸€ã€WSL çš„å®‰è£…ä¸è¯´æ˜</h2><h3 id="ğŸ“Œ-ä¸ºä»€ä¹ˆä½¿ç”¨-WSLï¼š"><a href="#ğŸ“Œ-ä¸ºä»€ä¹ˆä½¿ç”¨-WSLï¼š" class="headerlink" title="ğŸ“Œ ä¸ºä»€ä¹ˆä½¿ç”¨ WSLï¼š"></a>ğŸ“Œ ä¸ºä»€ä¹ˆä½¿ç”¨ WSLï¼š</h3><ul>
<li>å®˜æ–¹é›†æˆï¼Œèµ„æºè½»ï¼Œå ç”¨å°‘ï¼Œå¯åŠ¨å¿«</li>
<li>å…¼å®¹å¤§éƒ¨åˆ† Linux å‘½ä»¤ã€å¼€å‘å·¥å…·</li>
<li>æ”¯æŒ GUIï¼ˆWSLgï¼‰ï¼Œå¯è¿è¡Œ Linux å›¾å½¢ç¨‹åº</li>
<li>å¯ç›´æ¥è®¿é—® Windows æ–‡ä»¶ç³»ç»Ÿï¼ˆ<code>/mnt/c/...</code>ï¼‰</li>
</ul>
<h3 id="ğŸ“¦-å®‰è£…å‘½ä»¤ï¼ˆç®¡ç†å‘˜-PowerShellï¼‰ï¼š"><a href="#ğŸ“¦-å®‰è£…å‘½ä»¤ï¼ˆç®¡ç†å‘˜-PowerShellï¼‰ï¼š" class="headerlink" title="ğŸ“¦ å®‰è£…å‘½ä»¤ï¼ˆç®¡ç†å‘˜ PowerShellï¼‰ï¼š"></a>ğŸ“¦ å®‰è£…å‘½ä»¤ï¼ˆç®¡ç†å‘˜ PowerShellï¼‰ï¼š</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--install</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤å®‰è£… Ubuntuï¼ˆæœ€æ–°ç‰ˆï¼‰+ WSL2 å¹³å°ã€‚</p>
<hr>
<h2 id="âœ…-äºŒã€å®‰è£…-Ubuntu-è™šæ‹Ÿæœºè‡³-D-ç›˜"><a href="#âœ…-äºŒã€å®‰è£…-Ubuntu-è™šæ‹Ÿæœºè‡³-D-ç›˜" class="headerlink" title="âœ… äºŒã€å®‰è£… Ubuntu è™šæ‹Ÿæœºè‡³ D ç›˜"></a>âœ… äºŒã€å®‰è£… Ubuntu è™šæ‹Ÿæœºè‡³ D ç›˜</h2><blockquote>
<p>ä¸ºèŠ‚çœç©ºé—´ï¼Œé¿å…é»˜è®¤å®‰è£…åœ¨ C:\Users\AppData</p>
</blockquote>
<h3 id="ğŸ§©-æ­¥éª¤ï¼š"><a href="#ğŸ§©-æ­¥éª¤ï¼š" class="headerlink" title="ğŸ§© æ­¥éª¤ï¼š"></a>ğŸ§© æ­¥éª¤ï¼š</h3><ol>
<li>ä¸‹è½½ Ubuntu Appx å®‰è£…åŒ…ï¼š<ul>
<li><a target="_blank" rel="noopener" href="https://aka.ms/wslubuntu2004">https://aka.ms/wslubuntu2004</a></li>
</ul>
</li>
<li>è§£å‹å¹¶æ‰‹åŠ¨æ³¨å†Œï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† .appx æ”¹åä¸º .zip å¹¶è§£å‹</span></span><br><span class="line">Rename-Item .\Ubuntu_*.appx ubuntu.zip</span><br><span class="line">Expand-Archive .\ubuntu.zip .\</span><br><span class="line">.\ubuntu.exe</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç”¨æˆ·åå¯†ç ï¼Œå³åˆå§‹åŒ–æˆåŠŸã€‚</p>
<hr>
<h2 id="âœ…-ä¸‰ã€WSL-è™šæ‹Ÿæœºåˆå§‹åŒ–é…ç½®ï¼ˆæ¨èå®‰è£…è„šæœ¬ï¼‰"><a href="#âœ…-ä¸‰ã€WSL-è™šæ‹Ÿæœºåˆå§‹åŒ–é…ç½®ï¼ˆæ¨èå®‰è£…è„šæœ¬ï¼‰" class="headerlink" title="âœ… ä¸‰ã€WSL è™šæ‹Ÿæœºåˆå§‹åŒ–é…ç½®ï¼ˆæ¨èå®‰è£…è„šæœ¬ï¼‰"></a>âœ… ä¸‰ã€WSL è™šæ‹Ÿæœºåˆå§‹åŒ–é…ç½®ï¼ˆæ¨èå®‰è£…è„šæœ¬ï¼‰</h2><h3 id="âš™ï¸-æ›´æ–°-åŸºç¡€å·¥å…·å®‰è£…ï¼š"><a href="#âš™ï¸-æ›´æ–°-åŸºç¡€å·¥å…·å®‰è£…ï¼š" class="headerlink" title="âš™ï¸ æ›´æ–° &amp; åŸºç¡€å·¥å…·å®‰è£…ï¼š"></a>âš™ï¸ æ›´æ–° &amp; åŸºç¡€å·¥å…·å®‰è£…ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y git curl wget unzip vim net-tools htop</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ…-å››ã€Git-SSH-é…ç½®"><a href="#âœ…-å››ã€Git-SSH-é…ç½®" class="headerlink" title="âœ… å››ã€Git + SSH é…ç½®"></a>âœ… å››ã€Git + SSH é…ç½®</h2><h3 id="1ï¸âƒ£-Git-å®‰è£…ä¸å…¨å±€é…ç½®ï¼š"><a href="#1ï¸âƒ£-Git-å®‰è£…ä¸å…¨å±€é…ç½®ï¼š" class="headerlink" title="1ï¸âƒ£ Git å®‰è£…ä¸å…¨å±€é…ç½®ï¼š"></a>1ï¸âƒ£ Git å®‰è£…ä¸å…¨å±€é…ç½®ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install git -y</span><br><span class="line"></span><br><span class="line">git config --global user.name <span class="string">&quot;xxx&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line">git config --global core.editor <span class="string">&quot;vim&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2ï¸âƒ£-SSH-å¯†é’¥ç”Ÿæˆä¸é…ç½®ï¼š"><a href="#2ï¸âƒ£-SSH-å¯†é’¥ç”Ÿæˆä¸é…ç½®ï¼š" class="headerlink" title="2ï¸âƒ£ SSH å¯†é’¥ç”Ÿæˆä¸é…ç½®ï¼š"></a>2ï¸âƒ£ SSH å¯†é’¥ç”Ÿæˆä¸é…ç½®ï¼š</h3><h4 id="ç”Ÿæˆ-SSH-å¯†é’¥ï¼ˆæœ¬åœ°å’Œ-WSL-å„è‡ªç”Ÿæˆï¼‰ï¼š"><a href="#ç”Ÿæˆ-SSH-å¯†é’¥ï¼ˆæœ¬åœ°å’Œ-WSL-å„è‡ªç”Ÿæˆï¼‰ï¼š" class="headerlink" title="ç”Ÿæˆ SSH å¯†é’¥ï¼ˆæœ¬åœ°å’Œ WSL å„è‡ªç”Ÿæˆï¼‰ï¼š"></a>ç”Ÿæˆ SSH å¯†é’¥ï¼ˆæœ¬åœ°å’Œ WSL å„è‡ªç”Ÿæˆï¼‰ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>æŒ‰æç¤ºä¸€è·¯å›è½¦ï¼Œé»˜è®¤ä¿å­˜åœ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/.ssh/id_ed25519</span><br><span class="line">~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>

<h4 id="å°†å…¬é’¥æ·»åŠ åˆ°-GitHubï¼š"><a href="#å°†å…¬é’¥æ·»åŠ åˆ°-GitHubï¼š" class="headerlink" title="å°†å…¬é’¥æ·»åŠ åˆ° GitHubï¼š"></a>å°†å…¬é’¥æ·»åŠ åˆ° GitHubï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>

<p>å¤åˆ¶ç²˜è´´è‡³ GitHub â†’ <code>Settings &gt; SSH and GPG Keys &gt; New Key</code></p>
<hr>
<h3 id="3ï¸âƒ£-åœ¨-Windows-ä¸»æœºé…ç½®-SSH-è¿æ¥-Ubuntu-è™šæ‹Ÿæœº"><a href="#3ï¸âƒ£-åœ¨-Windows-ä¸»æœºé…ç½®-SSH-è¿æ¥-Ubuntu-è™šæ‹Ÿæœº" class="headerlink" title="3ï¸âƒ£ åœ¨ Windows ä¸»æœºé…ç½® SSH è¿æ¥ Ubuntu è™šæ‹Ÿæœº"></a>3ï¸âƒ£ åœ¨ Windows ä¸»æœºé…ç½® SSH è¿æ¥ Ubuntu è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘ C:\Users\&lt;ä½ &gt;\.ssh\config</span></span><br><span class="line">Host ubuntu-wsl</span><br><span class="line">    HostName 172.27.xxx.xxx         <span class="comment"># ç”¨ `ip addr show eth0` è·å–</span></span><br><span class="line">    User ypy</span><br><span class="line">    IdentityFile C:/Users/&lt;ä½ &gt;/.ssh/id_ed25519</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ…-äº”ã€è¿œç¨‹-VSCode-å¼€å‘æ¨èåšæ³•"><a href="#âœ…-äº”ã€è¿œç¨‹-VSCode-å¼€å‘æ¨èåšæ³•" class="headerlink" title="âœ… äº”ã€è¿œç¨‹ VSCode å¼€å‘æ¨èåšæ³•"></a>âœ… äº”ã€è¿œç¨‹ VSCode å¼€å‘æ¨èåšæ³•</h2><ul>
<li>å®‰è£… VSCode</li>
<li>å®‰è£…æ‰©å±•ï¼š<code>Remote - SSH</code> + <code>WSL</code></li>
<li>ç”¨ <code>ssh ubuntu-wsl</code> æµ‹è¯•è¿æ¥</li>
<li>æˆåŠŸè¿æ¥åï¼Œä½¿ç”¨ VSCode çš„ Remote SSH è‡ªåŠ¨åŒæ­¥å¼€å‘ç¯å¢ƒ</li>
</ul>
<hr>
<h2 id="âœ…-å…­ã€SSH-æœåŠ¡å¯åŠ¨å‘½ä»¤ï¼ˆä¸ä½¿ç”¨-systemctlï¼‰"><a href="#âœ…-å…­ã€SSH-æœåŠ¡å¯åŠ¨å‘½ä»¤ï¼ˆä¸ä½¿ç”¨-systemctlï¼‰" class="headerlink" title="âœ… å…­ã€SSH æœåŠ¡å¯åŠ¨å‘½ä»¤ï¼ˆä¸ä½¿ç”¨ systemctlï¼‰"></a>âœ… å…­ã€SSH æœåŠ¡å¯åŠ¨å‘½ä»¤ï¼ˆä¸ä½¿ç”¨ systemctlï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install openssh-server -y</span><br><span class="line"><span class="built_in">sudo</span> service ssh start    <span class="comment"># å¯åŠ¨ sshd</span></span><br><span class="line">ps -ef | grep sshd        <span class="comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“-é™„ï¼šå¸¸ç”¨è·¯å¾„å°æŠ„"><a href="#ğŸ“-é™„ï¼šå¸¸ç”¨è·¯å¾„å°æŠ„" class="headerlink" title="ğŸ“ é™„ï¼šå¸¸ç”¨è·¯å¾„å°æŠ„"></a>ğŸ“ é™„ï¼šå¸¸ç”¨è·¯å¾„å°æŠ„</h2><table>
<thead>
<tr>
<th>è·¯å¾„</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><code>~/.ssh/authorized_keys</code></td>
<td>å­˜å‚¨å…è®¸ç™»å½•çš„å…¬é’¥</td>
</tr>
<tr>
<td><code>/mnt/c/...</code></td>
<td>è®¿é—® Windows C ç›˜</td>
</tr>
<tr>
<td><code>\\wsl$\Ubuntu</code></td>
<td>Windows è®¿é—® Linux æ–‡ä»¶ç³»ç»Ÿ</td>
</tr>
<tr>
<td><code>~/WorkStation/...</code></td>
<td>ä½ çš„å¼€å‘å·¥ä½œåŒºç›®å½•</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/01/tech/rpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/01/tech/rpc/" class="post-title-link" itemprop="url">PyRPC Framework</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-02-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-02-01T00:00:00+08:00">2025-02-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<blockquote>
<p>In this blog, I will give an elaborate instruction to the process of how to construct a whole RPC framework with Java. </p>
<p>It is also a record of project <a target="_blank" rel="noopener" href="https://github.com/PerryYao-GitHub/demo-pyrpc">demo-pyrpc</a> and <a target="_blank" rel="noopener" href="https://github.com/PerryYao-GitHub/demo-rpc">demo-rpc</a>, the former one is an update on the last one.</p>
</blockquote>
<h1 id="pyRPC-Framework"><a href="#pyRPC-Framework" class="headerlink" title="pyRPC Framework"></a>pyRPC Framework</h1><h2 id="What-is-RPC"><a href="#What-is-RPC" class="headerlink" title="What is RPC?"></a>What is RPC?</h2><p>RPC (Remote Procedure Call) è¿œç¨‹è¿‡ç¨‹è°ƒç”¨, æ˜¯ä¸€ç§è®¡ç®—æœºé€šä¿¡åè®®, å…è®¸ç¨‹åºåœ¨ä¸åŒè®¡ç®—æœºä¹‹é—´é€šä¿¡å’Œäº¤äº’, å°±åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·.</p>
<h2 id="Consumer-Provider-Model"><a href="#Consumer-Provider-Model" class="headerlink" title="Consumer &#x2F; Provider Model"></a>Consumer &#x2F; Provider Model</h2><p>RPC æ¡†æ¶æœ¬èº«ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„æœåŠ¡, è€Œæ˜¯ä¸€ä¸ªè¢« Consumer (è°ƒç”¨æ–¹) å’Œ Provider (æœåŠ¡æä¾›æ–¹) å¼•å…¥çš„åº“ (SDK). RPC æ¡†æ¶çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºå¼€å‘è€…æä¾›è¿œç¨‹æœåŠ¡è°ƒç”¨çš„èƒ½åŠ›; åŒæ—¶æŠ½è±¡ç½‘ç»œé€šä¿¡, åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ç­‰åº•å±‚ç»†èŠ‚. </p>
<p>RPC å®Œæˆé€šä¿¡çš„ä¸»è¦è¿‡ç¨‹ä¸º:</p>
<h3 id="å…±äº«æ¨¡å—-common-example"><a href="#å…±äº«æ¨¡å—-common-example" class="headerlink" title="å…±äº«æ¨¡å— (common-example)"></a>å…±äº«æ¨¡å— (common-example)</h3><ul>
<li>å…±äº«æ¨¡å— (SDK), ä¸åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ, ç»™å„ä¸ªå¼€å‘ç»„ä»¶æä¾›è§„èŒƒåŒ–çš„æ•°æ®ç±»å‹å’Œæ¥å£</li>
<li>æœ‰ä¸¤ä¸ªå®ä½“ç±»: <code>User</code> and <code>Music</code>, å«æœ‰åŸºæœ¬æ•°æ®ç±»å‹å’Œé›†åˆæ•°æ®ç±»å‹</li>
<li>è§„å®šä¸¤ä¸ªæ¥å£: <code>UserService</code> and <code>MusicService</code>, åŒ…å« <code>getUserById</code> and <code>getMusicById</code> æ–¹æ³•</li>
</ul>
<h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><ul>
<li>éœ€å¼•å…¥ common-example &amp; pyrpc</li>
<li>æ¨¡æ‹ŸæœåŠ¡æ¶ˆè´¹è€…, è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Š</li>
</ul>
<h4 id="zero-åˆå§‹åŒ–-Consumer-ç«¯é…ç½®"><a href="#zero-åˆå§‹åŒ–-Consumer-ç«¯é…ç½®" class="headerlink" title=":zero:åˆå§‹åŒ– Consumer ç«¯é…ç½®"></a>:zero:åˆå§‹åŒ– Consumer ç«¯é…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RpcApplication.init();</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯è¯»å– Consumer ç«¯çš„é…ç½®ä¿¡æ¯. </p>
<h4 id="one-Consumer-ä½¿ç”¨åŠ¨æ€ä»£ç†å·¥å‚-ServiceProxyFactory-è·å–ä»£ç†å¯¹è±¡"><a href="#one-Consumer-ä½¿ç”¨åŠ¨æ€ä»£ç†å·¥å‚-ServiceProxyFactory-è·å–ä»£ç†å¯¹è±¡" class="headerlink" title=":one:Consumer ä½¿ç”¨åŠ¨æ€ä»£ç†å·¥å‚ ServiceProxyFactory è·å–ä»£ç†å¯¹è±¡"></a>:one:Consumer ä½¿ç”¨åŠ¨æ€ä»£ç†å·¥å‚ <code>ServiceProxyFactory</code> è·å–ä»£ç†å¯¹è±¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserService userService = ServiceProxyFactory.getProxy(UserService.class);</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥å¯¹ <code>userService</code> åƒåœ¨æœ¬åœ°ä¸€æ ·è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•.</p>
<p>å…¶ä¸­ <code>ServiceProxyFactory</code> å†…éƒ¨å­˜å‚¨äº† <code>ServiceProxy</code> çš„å®ä¾‹ (ä½¿ç”¨ static çš„å•ä¾‹å­˜å‚¨, é¿å…è¿‡å¤šçš„å¯¹è±¡åˆ›å»º). </p>
<h4 id="two-ServiceProxy-å¸®åŠ©-Consumer-å®Œæˆå¯¹è¯·æ±‚çš„å°è£…-å‘é€-å¹¶æ¥å—å“åº”"><a href="#two-ServiceProxy-å¸®åŠ©-Consumer-å®Œæˆå¯¹è¯·æ±‚çš„å°è£…-å‘é€-å¹¶æ¥å—å“åº”" class="headerlink" title=":two:ServiceProxy å¸®åŠ© Consumer å®Œæˆå¯¹è¯·æ±‚çš„å°è£…, å‘é€, å¹¶æ¥å—å“åº”"></a>:two:<code>ServiceProxy</code> å¸®åŠ© Consumer å®Œæˆå¯¹è¯·æ±‚çš„å°è£…, å‘é€, å¹¶æ¥å—å“åº”</h4><p>åœ¨ <code>ServiceProxy</code> ä¸­, æ‰§è¡Œäº†ä»¥ä¸‹å…³é”®å†…å®¹:</p>
<ol>
<li><p>å°†è°ƒç”¨è€…è°ƒç”¨çš„æ–¹æ³•, ä¼ å…¥çš„å‚æ•°å°è£…æˆæ ‡å‡†åŒ–çš„ <code>RpcRequest rpcRequest</code></p>
</li>
<li><p>ä½¿ç”¨åºåˆ—åŒ–å™¨åºåˆ—åŒ– <code>rpcRequest</code></p>
</li>
<li><p>å‘ Provider çš„çš„ RPC æœåŠ¡ç«¯ç‚¹å‘é€è¯·æ±‚</p>
</li>
<li><p>å¾…è·å– RPC çš„å“åº”æ•°æ®å, ååºåˆ—åŒ–å®ƒ, å°†å…¶è½¬åŒ–æˆ <code>RpcResponse rpcResponse</code>, å¹¶æŠ½å–å…¶ä¸­çš„æ•°æ®å­—æ®µ (è¿™æ‰æ˜¯ Consumer çœŸæ­£æƒ³æ‹¿åˆ°çš„ä¸œè¥¿)</p>
</li>
</ol>
<h3 id="Provider-provider-example"><a href="#Provider-provider-example" class="headerlink" title="Provider (provider-example)"></a>Provider (provider-example)</h3><ul>
<li>éœ€å¼•å…¥ common-example &amp; pyrpc</li>
<li>æ¨¡æ‹ŸæœåŠ¡æä¾›è€…, è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Š</li>
<li>å®ƒå®ç°äº†å…±äº«æ¨¡å—ä¸­çš„ <code>UserService</code> and <code>MusicService</code></li>
</ul>
<h4 id="zero-Provider-çš„åˆå§‹åŒ–æµç¨‹"><a href="#zero-Provider-çš„åˆå§‹åŒ–æµç¨‹" class="headerlink" title=":zero:Provider çš„åˆå§‹åŒ–æµç¨‹"></a>:zero:Provider çš„åˆå§‹åŒ–æµç¨‹</h4><ol>
<li><p>è¯»å…¥é…ç½®ä¿¡æ¯</p>
</li>
<li><p>æŠŠè‡ªå·±æƒ³æä¾›çš„æœåŠ¡æ³¨å†Œåˆ° <code>RpcLocalRegistry</code> (æœ¬åœ°æ³¨å†Œä¸­å¿ƒ)</p>
</li>
<li><p>å¼€å¯ä¸€ä¸ªWeb æœåŠ¡å™¨, ç›‘å¬ RPC è¯·æ±‚</p>
</li>
</ol>
<h4 id="one-RpcServerå¸®åŠ©-Provider-å®Œæˆå¯¹è¯·æ±‚çš„æ¥æ”¶-è§£æ-å¹¶å‘é€å“åº”"><a href="#one-RpcServerå¸®åŠ©-Provider-å®Œæˆå¯¹è¯·æ±‚çš„æ¥æ”¶-è§£æ-å¹¶å‘é€å“åº”" class="headerlink" title=":one:RpcServerå¸®åŠ© Provider å®Œæˆå¯¹è¯·æ±‚çš„æ¥æ”¶, è§£æ, å¹¶å‘é€å“åº”"></a>:one:<code>RpcServer</code>å¸®åŠ© Provider å®Œæˆå¯¹è¯·æ±‚çš„æ¥æ”¶, è§£æ, å¹¶å‘é€å“åº”</h4><p>RPC æ¡†æ¶å¸®åŠ© Provider æ¥å—å¹¶å¤„ç†è¯·æ±‚çš„æ ¸å¿ƒé€»è¾‘åœ¨ <code>server</code> åŒ…ä¸­, å³å¼€å¯ä¸€ä¸ª Web æœåŠ¡å™¨æ¥å¤„ç†å‘é€è¿‡æ¥çš„ RPC è¯·æ±‚, å¹¶æŠŠç»“æœå‘é€å›å»; è€Œå…¶ä¸­çš„å¤„ç†è¯·æ±‚çš„é€»è¾‘, åˆ™å•ç‹¬å°è£…åœ¨ <code>ServerHandler</code> ä¸­. </p>
<p><code>RpcServer</code> ä¸­çš„é€»è¾‘æ˜¯ä¸€ä¸ªå¼‚æ­¥å¤„ç†æ¨¡å‹. å½“æœ‰è¯·æ±‚è¿‡æ¥æ—¶, éµå¾ªä»¥ä¸‹æ­¥éª¤: è¯·æ±‚è§£æ -&gt; æœåŠ¡æ–¹æ³•è°ƒç”¨ -&gt; ç»“æœå°è£… -&gt; å“åº”è¿”å›. </p>
<h3 id="RPC-pyrpc"><a href="#RPC-pyrpc" class="headerlink" title="RPC (pyrpc)"></a>RPC (pyrpc)</h3><p>è¿æ¥ Consumer å’Œ Provider é€šä¿¡çš„æ¢çº½, æ¥ä¸‹æ¥é‡ç‚¹ä»‹ç».</p>
<h2 id="Main-Components-in-pyRPC"><a href="#Main-Components-in-pyRPC" class="headerlink" title="Main Components in pyRPC"></a>Main Components in pyRPC</h2><h3 id="æ•°æ®ç»„ä»¶å’Œé…ç½®ç»„ä»¶-com-ypy-pyrpc-model-com-ypy-pyrpc-config"><a href="#æ•°æ®ç»„ä»¶å’Œé…ç½®ç»„ä»¶-com-ypy-pyrpc-model-com-ypy-pyrpc-config" class="headerlink" title="æ•°æ®ç»„ä»¶å’Œé…ç½®ç»„ä»¶: com.ypy.pyrpc.model &amp; com.ypy.pyrpc.config"></a>æ•°æ®ç»„ä»¶å’Œé…ç½®ç»„ä»¶: <code>com.ypy.pyrpc.model</code> &amp; <code>com.ypy.pyrpc.config</code></h3><p>å…¶ä¸­å®šä¹‰äº† <code>RpcRequest</code>, <code>RpcResponse</code>, <code>ServiceMetaInfo</code>, <code>ServiceRegisterInfo</code> ç­‰åŸºæœ¬æ•°æ®ç±»å‹.</p>
<p>ä»¥åŠRPCæ¡†æ¶çš„é…ç½®æ•°æ®ç±»å‹ (<code>RpcConfig</code> and <code>RpcConfig.RegistryConfig</code>) å’Œä¸€ä¸ªç”¨äºè¯»å–é…ç½®æ–‡ä»¶çš„å·¥å…·ç±» (<code>RpcConfigReader</code>).</p>
<p>æœ¬æ¡†æ¶çš„é…ç½®ä¿¡æ¯å¯ä»¥å†™å…¥<code>resources/application.properties</code>, å®Œæ•´çš„é…ç½®ä¿¡æ¯å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pyrpc.serverHost=127.0.0.1</span><br><span class="line">pyrpc.serverPort=8081</span><br><span class="line">pyrpc.serverType=http || tcp</span><br><span class="line">pyrpc.mock=false || true</span><br><span class="line">pyrpc.registry.registry=no || etcd</span><br><span class="line">pyrpc.registry.addr=http://127.0.0.1:2375</span><br><span class="line">pyrpc.registry.username=xxx</span><br><span class="line">pyrpc.registry.password=yyy</span><br><span class="line">pyrpc.registry.timeout=10000</span><br><span class="line">pyrpc.serializer=jdk || json || kryo</span><br><span class="line">pyrpc.loadbalancer=round-robin || random || consistent-hash</span><br><span class="line">pyrpc.retry=no || fixed-interval</span><br><span class="line">pyrpc.tolerance=fail-fast || fail-safe</span><br></pre></td></tr></table></figure>

<p><em>*å…¶ä¸­ || åˆ†å‰²äº†å¯ä¾›é€‰æ‹©çš„é»˜è®¤å®ç°ç±»çš„ key</em></p>
<p>åœ¨ <code>resources/META-INF/prrpc/</code> ä¸­, æœ‰ <code>custom/</code> å’Œ <code>system/</code> ä¸¤ä¸ªç›®å½•, å…¶ä¸­ <code>system/</code> ä¸­çš„æ–‡ä»¶å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com.ypy.pyrpc.spi.loadbalancer.Loadbalancer</span><br><span class="line">com.ypy.pyrpc.spi.registry.Registry</span><br><span class="line">com.ypy.pyrpc.spi.retry.Retry</span><br><span class="line">com.ypy.pyrpc.spi.serializer.Serializer</span><br><span class="line">com.ypy.pyrpc.spi.tolerance.Tolerance</span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«å¯¹åº”äº†æä¾› SPI è‡ªå®šä¹‰åŠŸèƒ½å®ç°ç±»çš„æ¥å£å, åœ¨ç›¸å¯¹åº”çš„æ–‡ä»¶å†…, å¯ä»¥å†™å…¥åŠŸèƒ½å®ç°ç±»ä»¥åŠå…¶å¯¹åº”çš„ key. æ¡†æ¶ä¸­çš„é»˜è®¤å®ç°ç±»ä»¥åŠ key å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">round-robin=com.ypy.pyrpc.spi.loadbalancer.impl.RoundRobinLoadbalancer</span><br><span class="line">random=com.ypy.pyrpc.spi.loadbalancer.impl.RandomLoadbalancer</span><br><span class="line">consistent-hash=com.ypy.pyrpc.spi.loadbalancer.impl.ConsistentHashLoadbalancer</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no=com.ypy.pyrpc.spi.registry.impl.NoRegistry</span><br><span class="line">etcd=com.ypy.pyrpc.spi.registry.impl.EtcdRegistry</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no=com.ypy.pyrpc.spi.retry.impl.NoRetry</span><br><span class="line">fixed-interval=com.ypy.pyrpc.spi.retry.impl.FixedIntervalRetry</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdk=com.ypy.pyrpc.spi.serializer.impl.JdkSerializer</span><br><span class="line">json=com.ypy.pyrpc.spi.serializer.impl.JsonSerializer</span><br><span class="line">kryo=com.ypy.pyrpc.spi.serializer.impl.KryoSerializer</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fail-fast=com.ypy.pyrpc.spi.tolerance.impl.FailFastTolerance</span><br><span class="line">fail-safe=com.ypy.pyrpc.spi.tolerance.impl.FailSafeTolerance</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨ç»„ä»¶-com-ypy-pyrpc-bootstrap"><a href="#å¯åŠ¨ç»„ä»¶-com-ypy-pyrpc-bootstrap" class="headerlink" title="å¯åŠ¨ç»„ä»¶ com.ypy.pyrpc.bootstrap"></a>å¯åŠ¨ç»„ä»¶ <code>com.ypy.pyrpc.bootstrap</code></h3><p><strong>:star:Consumer å¯åŠ¨ç±» <code>ConsumerBootstrap</code></strong></p>
<p>å¸®åŠ© Consumer åˆå§‹åŒ–, å…¶åŸºæœ¬é€»è¾‘æ˜¯è°ƒç”¨ <code>com.ypy.pyrpc.app.RpcApplication</code>, æ¥å®Œæˆå¯¹é…ç½®ä¿¡æ¯çš„è¯»å–. æœ¬è´¨ä¸Šåªæ˜¯å¯¹ <code>com.ypy.pyrpc.app.RpcApplication</code> è¿›è¡Œäº†ä¸€å±‚å°è£…, è§„èŒƒäº†ä»£ç ç»“æ„.</p>
<p><strong>:star:Provider å¯åŠ¨ç±» <code>ProviderBoostrap</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderBootstrap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(List&lt;ServiceRegisterInfo&gt; serviceRegisterInfoList)</span> &#123;</span><br><span class="line">        RpcApplication.init();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">RpcConfig</span> <span class="variable">rpcConfig</span> <span class="operator">=</span> RpcApplication.getRpcConfig();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ServiceRegisterInfo&lt;?&gt; serviceRegisterInfo : serviceRegisterInfoList) &#123;</span><br><span class="line">            RpcLocalRegistry.register(serviceRegisterInfo.getServiceInterfaceName(), serviceRegisterInfo.getServiceImplClass());</span><br><span class="line"></span><br><span class="line">            RpcConfig.<span class="type">RegistryConfig</span> <span class="variable">registryConfig</span> <span class="operator">=</span> rpcConfig.getRegistryConfig();</span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> RegistryFactory.getInstance(registryConfig.getRegistry());</span><br><span class="line">            <span class="type">ServiceMetaInfo</span> <span class="variable">serviceMetaInfo</span> <span class="operator">=</span> ServiceMetaInfo.builder()</span><br><span class="line">                    .serviceName(serviceRegisterInfo.getServiceInterfaceName())</span><br><span class="line">                    .serviceVersion(RpcConstant.DEFAULT_SERVICE_VERSION) <span class="comment">// todo</span></span><br><span class="line">                    .serviceHost(rpcConfig.getServerHost())</span><br><span class="line">                    .servicePost(rpcConfig.getServerPort())</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                registry.register(serviceMetaInfo);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(serviceRegisterInfo.getServiceInterfaceName() + <span class="string">&quot; register failed&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">RpcServer</span> <span class="variable">rpcServer</span> <span class="operator">=</span> RpcServerFactory.getInstance(RpcApplication.getRpcConfig().getServerType());</span><br><span class="line">        rpcServer.start(rpcConfig.getServerPort());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>RpcApplication.init()</code> åˆå§‹åŒ– RPC æ¡†æ¶, è¯»å–é…ç½®ä¿¡æ¯</li>
<li>æŠŠ <code>serviceRegisterInfoList</code> ä¸­çš„æœåŠ¡æ³¨å†Œåˆ°æœ¬åœ°æ³¨å†Œä¸­å¿ƒ (<code>RpcLocalRegistry</code>)</li>
<li>æ ¹æ®å…¨å±€é…ç½®, é€šè¿‡æ³¨å†Œä¸­å¿ƒä»£ç†å·¥å‚ (<code>RegistryFactory</code>) è·å–ç›¸å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒå¯¹è±¡, æŠŠæœåŠ¡å†™å…¥æ³¨å†Œä¸­å¿ƒ</li>
<li>å¼€å¯PRC Web æœåŠ¡å™¨, åœ¨ç›¸åº”çš„ç«¯å£ä¸“é—¨å¤„ç†RPCè¯·æ±‚</li>
</ul>
<p><em>æ³¨æ„: æŠŠæœåŠ¡æ³¨å†Œåˆ°æœ¬åœ°å’ŒæŠŠæœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒæ˜¯ä¸åŒçš„</em></p>
<ul>
<li>æœ¬åœ°æ³¨å†Œ: æŠŠæœåŠ¡æ¥å£ä¿¡æ¯å’ŒæœåŠ¡å®ç°ç±»ä»¥å•ä¾‹æ¨¡å¼å­˜å…¥ <code>RpcLocalRegistry</code>, æ–¹ä¾¿å¤„ç†RPCè¯·æ±‚æ—¶è°ƒç”¨</li>
<li>æ³¨å†Œä¸­å¿ƒ: æŠŠæœåŠ¡çš„ä¿¡æ¯ (<code>com.ypy.pyrpc.model.ServiceMetaInfo</code>, ä¸»è¦åŒ…å«æœåŠ¡åå’ŒæœåŠ¡æä¾›è€…çš„åœ°å€) å­˜å…¥ä¸€ä¸ªé”®å€¼å‹æ•°æ®åº“ (ä¾‹å¦‚ ETCD æˆ– Redis), è¿™ä¸ªæ•°æ®åº“æœåŠ¡æ˜¯ç‹¬ç«‹ä¸æ‰€æœ‰ Provider çš„, å› æ­¤ä½†ä¸åŒçš„ Provider æä¾›ä¸åŒçš„æœåŠ¡æ—¶, æ³¨å†Œä¸­å¿ƒå……å½“äº†ä¸€ä¸ª â€œä¿¡æ¯é›†æ•£åœ°â€: RPC æ¡†æ¶å¸®åŠ© Consumer åœ¨æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡çš„åœ°å€, å¹¶æŒ‘é€‰åˆé€‚çš„æœåŠ¡èŠ‚ç‚¹; å½“å…è®¸å¤šä¸ª Provider æä¾›ç›¸åŒæœåŠ¡æ—¶, å¯ä»¥ä½¿ç”¨è´Ÿè½½å‡è¡¡å‡å°‘æœåŠ¡å™¨å‹åŠ›</li>
</ul>
<h3 id="å…¨å±€ç»„ä»¶-com-ypy-pyrpc-app"><a href="#å…¨å±€ç»„ä»¶-com-ypy-pyrpc-app" class="headerlink" title="å…¨å±€ç»„ä»¶ com.ypy.pyrpc.app"></a>å…¨å±€ç»„ä»¶ <code>com.ypy.pyrpc.app</code></h3><p><strong>:star:RPCåˆå§‹åŒ–å·¥å…·ç±»<code>RpcApplication</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcApplication</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RpcConfig rpcConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init RpcConfig</span></span><br><span class="line"><span class="comment">     * and Registry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newRpcConfig</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(RpcConfig newRpcConfig)</span> &#123;</span><br><span class="line">        <span class="comment">// config</span></span><br><span class="line">        rpcConfig = newRpcConfig;</span><br><span class="line">        log.info(<span class="string">&quot;RpcApplication initialized with config: &#123;&#125;&quot;</span>, rpcConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// registry</span></span><br><span class="line">        RpcConfig.<span class="type">RegistryConfig</span> <span class="variable">registryConfig</span> <span class="operator">=</span> rpcConfig.getRegistryConfig();</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> RegistryFactory.getInstance(registryConfig.getRegistry());</span><br><span class="line">        registry.init(registryConfig);</span><br><span class="line">        log.info(<span class="string">&quot;Registry initialized with config: &#123;&#125;&quot;</span>, registryConfig);</span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> <span class="title class_">Thread</span>(registry::destroy));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        RpcConfig newRpcConfig;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            newRpcConfig = RpcConfigReader.loadConfig(RpcConstant.DEFAULT_CONFIG_PREFIX);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Failed to load configuration file. Using default config.&quot;</span>, e);</span><br><span class="line">            newRpcConfig = <span class="keyword">new</span> <span class="title class_">RpcConfig</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        init(newRpcConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RpcConfig <span class="title function_">getRpcConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rpcConfig == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (RpcApplication.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (rpcConfig == <span class="literal">null</span>) init();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rpcConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å·¥å…·ç±», æ˜¯RPCæ¡†æ¶åˆå§‹åŒ–çš„å…¬å…±é€»è¾‘, å…¶ä¸­éƒ½æ˜¯é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜å˜é‡. ç»´æŠ¤äº†ä¸€ä¸ªé™æ€çš„ <code>RpcConfig</code> å®ä¾‹, å®ƒåŒ…å«äº† RPC çš„å…¨éƒ¨é…ç½®ä¿¡æ¯. ä»£ç ä¸­ä½¿ç”¨å·¥å…·ç±» <code>com.ypy.pyrpc.config.RpcConfigReader</code> ä¸­çš„é™æ€æ–¹æ³•<code>loadConfig</code> è¯»å–ç¨‹åºå‘˜åœ¨é¡¹ç›® <code>/resourses/application.properties</code> ä¸­å†™çš„é…ç½®ä¿¡æ¯. </p>
<p><strong>:star:æœ¬åœ°æ³¨å†Œä¸­å¿ƒ <code>RpcLocalRegistry</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcLocalRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Class&lt;?&gt;&gt; registeredServiceImpl = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Class&lt;?&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String serviceName, Class&lt;?&gt; serviceImpl)</span> &#123;</span><br><span class="line">        registeredServiceImpl.put(serviceName, serviceImpl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; getServiceImpl(String serviceName) &#123;</span><br><span class="line">        <span class="keyword">return</span> registeredServiceImpl.get(serviceName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeService</span><span class="params">(String serviceName)</span> &#123;</span><br><span class="line">        registeredServiceImpl.remove(serviceName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å·¥å…·ç±», ç»´æŠ¤äº†ä¸€ä¸ªé™æ€çš„ <code>ConcurrentHashMap&lt;String, Class&lt;?&gt;&gt;</code> ç”¨äºå­˜å‚¨ Provider æä¾›çš„æœåŠ¡åå’Œå¯¹åº”å®ç°ç±»çš„Classç±»</p>
<h3 id="ä»£ç†ç»„ä»¶-com-ypy-pyrpc-proxy"><a href="#ä»£ç†ç»„ä»¶-com-ypy-pyrpc-proxy" class="headerlink" title="ä»£ç†ç»„ä»¶ com.ypy.pyrpc.proxy"></a>ä»£ç†ç»„ä»¶ <code>com.ypy.pyrpc.proxy</code></h3><p>è¿™ä¸€éƒ¨åˆ†æ˜¯ Consumer å‘é€ RPC è¯·æ±‚çš„æ ¸å¿ƒ</p>
<p><strong>:star:æ¶ˆè´¹è€…æœåŠ¡ä»£ç† <code>ServiceProxy</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serviceName</span> <span class="operator">=</span> method.getDeclaringClass().getName();</span><br><span class="line">        <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> RpcRequest.builder()</span><br><span class="line">                .serviceName(serviceName)</span><br><span class="line">                .methodName(method.getName())</span><br><span class="line">                .parameterTypes(method.getParameterTypes())</span><br><span class="line">                .args(args)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> RegistryFactory.getInstance(RpcApplication.getRpcConfig().getRegistryConfig().getRegistry());</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">serviceNameVer</span> <span class="operator">=</span> ServiceMetaInfo.serviceNameVer(serviceName, RpcConstant.DEFAULT_SERVICE_VERSION);</span><br><span class="line">        List&lt;ServiceMetaInfo&gt; serviceMetaInfoList = registry.serviceDiscovery(serviceNameVer);</span><br><span class="line"></span><br><span class="line">        <span class="type">Loadbalancer</span> <span class="variable">loadbalancer</span> <span class="operator">=</span> LoadbalancerFactory.getInstance(RpcApplication.getRpcConfig().getLoadbalancer());</span><br><span class="line">        Map&lt;String, Object&gt; context = Map.of(<span class="string">&quot;serviceNameVer&quot;</span>, serviceNameVer);</span><br><span class="line">        <span class="type">ServiceMetaInfo</span> <span class="variable">serviceMetaInfo</span> <span class="operator">=</span> loadbalancer.select(serviceMetaInfoList, context);</span><br><span class="line"></span><br><span class="line">        <span class="type">RpcClient</span> <span class="variable">rpcClient</span> <span class="operator">=</span> RpcClientFactory.getInstance(RpcApplication.getRpcConfig().getServerType());</span><br><span class="line">        RpcResponse rpcResponse;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Retry</span> <span class="variable">retry</span> <span class="operator">=</span> RetryFactory.getInstance(RpcApplication.getRpcConfig().getRetry());</span><br><span class="line">            rpcResponse = retry.retry(() -&gt; rpcClient.request(rpcRequest, serviceMetaInfo));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">Tolerance</span> <span class="variable">tolerance</span> <span class="operator">=</span> ToleranceFactory.getInstance(RpcApplication.getRpcConfig().getTolerance());</span><br><span class="line">            rpcResponse = tolerance.tolerate(e, context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rpcResponse.getData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç±»å¯ä»¥è¯´æ˜¯ä¸º Consumer å‘é€RPCè¯·æ±‚çš„æ ¸å¿ƒ, ä»£ç çš„ä¸»è¦é€»è¾‘æ˜¯:</p>
<ul>
<li>æŠŠç”±å‚æ•°è·å–çš„æœåŠ¡æ¥å£å, æœåŠ¡æ–¹æ³•å, å‚æ•°ç±»å‹åŠå‚æ•°å°è£…è¿›å…¥<code>rpcRequest</code></li>
<li>æ ¹æ®å…¨å±€é™æ€é…ç½®ä¿¡æ¯è·å–æ³¨å†Œä¸­å¿ƒ (<code>registry</code>) å¹¶é€šè¿‡æ³¨å†Œä¸­å¿ƒæ ¹æ®æœåŠ¡åå’Œç‰ˆæœ¬ä¿¡æ¯å‘ç°æœåŠ¡</li>
<li>æ ¹æ®å…¨å±€é™æ€é…ç½®ä¿¡æ¯è·å–è´Ÿè½½å‡è¡¡å™¨ (<code>loadbalancer</code>) å¹¶é€šè¿‡è´Ÿè½½å‡è¡¡å™¨é€‰æ‹©é€‚åˆçš„æœåŠ¡ Provider èŠ‚ç‚¹</li>
<li>ä½¿ç”¨ <code>RpcClient.request()</code> é™æ€æ–¹æ³•å‘é€ RPC è¯·æ±‚ (è¿™é‡Œçš„é€»è¾‘åœ¨ RPC Server éƒ¨åˆ†è§£é‡Š)</li>
<li>æ ¹æ®å…¨å±€é™æ€é…ç½®ä¿¡æ¯è·å–é‡è¯•å’Œå®¹é”™å™¨, åœ¨å‡ºç°é—®é¢˜è¿›è¡Œç›¸åº”çš„å¤„ç†æ­¥éª¤</li>
<li>è·å¾— <code>rpcResonse</code> è¿”å›å…¶ <code>data</code> éƒ¨åˆ†</li>
</ul>
<p><strong>:star:MockæœåŠ¡ä»£ç† <code>MockServiceProxy</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        Class&lt;?&gt; methodReturnType = method.getReturnType();</span><br><span class="line">        log.info(<span class="string">&quot;mock invoke &#123;&#125;&quot;</span>, method.getName());</span><br><span class="line">        <span class="keyword">return</span> getDefaultObject(methodReturnType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getDefaultObject</span><span class="params">(Class&lt;?&gt; type)</span> &#123;</span><br><span class="line">        <span class="comment">// 8 primitive type</span></span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">boolean</span>.class || type == Boolean.class) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">byte</span>.class || type == Byte.class) <span class="keyword">return</span> (<span class="type">byte</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">short</span>.class || type == Short.class) <span class="keyword">return</span> (<span class="type">short</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">char</span>.class || type == Character.class) <span class="keyword">return</span> (<span class="type">char</span>) <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">int</span>.class || type == Integer.class) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">long</span>.class || type == Long.class) <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">float</span>.class || type == Float.class) <span class="keyword">return</span> <span class="number">0.0f</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="type">double</span>.class || type == Double.class) <span class="keyword">return</span> <span class="number">0.0d</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// handle common type</span></span><br><span class="line">        <span class="keyword">if</span> (type == String.class) <span class="keyword">return</span> <span class="string">&quot;&lt;mock&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (type == List.class) <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        <span class="keyword">if</span> (type == Map.class) <span class="keyword">return</span> Collections.emptyMap();</span><br><span class="line">        <span class="keyword">if</span> (type == Set.class) <span class="keyword">return</span> Collections.emptySet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// handle self-defined class</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> type.getDeclaredConstructor().newInstance();</span><br><span class="line">            Field[] fields = type.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                Class&lt;?&gt; fieldType = field.getType();</span><br><span class="line">                field.set(instance, getDefaultObject(fieldType)); <span class="comment">// recursion</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Failed to create mock object for type: &#123;&#125;&quot;</span>, type.getName(), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºå¼€å‘è€…æä¾›ç”Ÿæˆå‡æ•°æ®çš„æœåŠ¡ä»£ç†, å½“ Consumer å¼€å‘è€…åœ¨ä¸å­˜åœ¨ Provider çš„æƒ…å†µä¸‹, ä¹Ÿèƒ½è°ƒç”¨å‡æœåŠ¡, è·å–å‡æ•°æ®</p>
<p><strong>:star:ä»£ç†æœåŠ¡å·¥å‚ <code>ServiceProxyFactory</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProxyFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getProxy</span><span class="params">(Class&lt;T&gt; serviceInterface)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (RpcApplication.getRpcConfig().isMock()) <span class="keyword">return</span> getMockProxy(serviceInterface);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(</span><br><span class="line">                serviceInterface.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceInterface&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ServiceProxy</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getMockProxy</span><span class="params">(Class&lt;T&gt; serviceInterface)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(</span><br><span class="line">                serviceInterface.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceInterface&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MockServiceProxy</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Proxy.newProxyInstance</code> æ˜¯ JDK æä¾›çš„åŠ¨æ€ä»£ç†å·¥å…·æ–¹æ³•, å®ƒéœ€è¦ä¸‰ä¸ªå‚æ•°: <ul>
<li><code>ClassLoader</code>: ç”¨äºåŠ è½½ä»£ç†ç±»çš„ç±»åŠ è½½å™¨</li>
<li><code>Class&lt;?&gt;[]</code>: ä»£ç†ç±»éœ€è¦å®ç°çš„æ¥å£åˆ—è¡¨</li>
<li><code>InvocationHandler</code>: ä»£ç†ç±»çš„è°ƒç”¨å¤„ç†å™¨, è´Ÿè´£æ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘</li>
</ul>
</li>
<li>åœ¨è¿™é‡Œ, <code>ServiceProxy</code> å’Œ <code>MockServiceProxy</code> éƒ½å®ç°äº† <code>InvocationHandler</code> æ¥å£, åˆ†åˆ«ç”¨äºå¤„ç†çœŸå®çš„ RPC è°ƒç”¨å’Œ Mock è°ƒç”¨</li>
</ul>
<h3 id="æœåŠ¡å™¨ç»„ä»¶-com-ypy-pyrpc-server"><a href="#æœåŠ¡å™¨ç»„ä»¶-com-ypy-pyrpc-server" class="headerlink" title="æœåŠ¡å™¨ç»„ä»¶ com.ypy.pyrpc.server"></a>æœåŠ¡å™¨ç»„ä»¶ <code>com.ypy.pyrpc.server</code></h3><p>è¿™ä¸€éƒ¨åˆ†æ˜¯ Provider å¤„ç† RPC è¯·æ±‚çš„é‡ç‚¹, ä¹Ÿæ˜¯ RPC é€šä¿¡çš„é‡ç‚¹. è¯¥åŒ…ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¥å£: <code>RpcClient</code> å’Œ <code>RpcServer</code>. </p>
<p><code>RpcClient</code> åªæœ‰ä¸€ä¸ªæ–¹æ³• <code>RpcResponse request(RpcRequest rpcRequest, ServiceMetaInfo serviceMetaInfo) throws Exception;</code>. å®ƒæ˜¯å‘é€ RPC è¯·æ±‚çš„æ ¸å¿ƒ. æ³¨æ„, è¿™é‡Œçš„å‘é€è¯·æ±‚ä¸æ˜¯ <code>ServiceProxy</code> çš„æ™®é€šä¸šåŠ¡é€»è¾‘. è¿™é‡Œçš„ä¸»è¦æ˜¯è¦å®ç°åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–, ä»¥åŠä½¿ç”¨TCPåè®®å‘é€è¯·æ±‚. </p>
<p><code>RpcServer</code> ä¹Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³• <code>void start(int port);</code>. å®ƒ.å¸®åŠ© Provider åœ¨ç›¸åº”ç«¯å£æ„é€  Web æœåŠ¡, å¹¶å¤„ç† RPC è¯·æ±‚.</p>
<p>åŒæ—¶, å®ƒä»¬éƒ½æœ‰å„è‡ªå¯¹åº”çš„å·¥å‚ç±» (<code>RpcClientFactory</code> &amp; <code>RpcServerFactory</code>), ä»¥ <code>RpcClientFactory</code> ä¸ºä¾‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcClientFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, RpcClient&gt; clientMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        clientMap.put(RpcServerTypeKeys.TCP, <span class="keyword">new</span> <span class="title class_">TcpClient</span>());</span><br><span class="line">        clientMap.put(RpcServerTypeKeys.HTTP, <span class="keyword">new</span> <span class="title class_">HttpClient</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RpcClient <span class="title function_">getInstance</span><span class="params">(String implClassKey)</span> &#123; <span class="keyword">return</span> clientMap.get(implClassKey); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºæˆ‘ä»¬ä¸èƒ½æ¯å‘ä¸€æ¬¡ RPC è¯·æ±‚å°± new ä¸€ä¸ª <code>TcpClient</code> æˆ– <code>HttpClient</code> å®ç°ç±», äºæ˜¯æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨å·¥å‚æ¨¡å¼, ç»´æŠ¤ä¸€ä¸ªé™æ€çš„Map, å­˜å‚¨äº†å¯¹åº”çš„ <code>RpcClient</code> çš„å®ç°ç±», ä¼šæ ¹æ®å¯¹åº”çš„ key è¿”å›ç›¸åº”çš„å®ç°ç±». <code>RpcServerFactory</code> åŒç†. è¿™æ ·å³é¿å…äº†é‡å¤ new å¯¹è±¡, åŒæ—¶ä¹Ÿå…è®¸å¼€å‘è€…é…ç½®è‡ªå·±å–œæ¬¢çš„åº•å±‚é€šä¿¡åè®® (TCP or HTTP).</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸»è¦çœ‹çœ‹ä½¿ç”¨ TCP åè®®ä½œä¸ºåº•å±‚åè®®, æ˜¯å¦‚ä½•å®ç° <code>RpcClient</code> å’Œ <code>RpcServer</code> çš„:</p>
<h4 id="åè®®æ•°æ®ç»“æ„ç»„ä»¶-com-ypy-pyrpc-server-tcp-protocol"><a href="#åè®®æ•°æ®ç»“æ„ç»„ä»¶-com-ypy-pyrpc-server-tcp-protocol" class="headerlink" title="åè®®æ•°æ®ç»“æ„ç»„ä»¶ com.ypy.pyrpc.server.tcp.protocol"></a>åè®®æ•°æ®ç»“æ„ç»„ä»¶ <code>com.ypy.pyrpc.server.tcp.protocol</code></h4><p>è¿™é‡Œä¸»è¦å®šä¹‰äº†è‡ªå®šä¹‰åè®®çš„ç»“æ„ (<code>Protocol</code>):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Protocol</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Header</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> magic;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> version;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> serializer;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> type;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span> status;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> requestId;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> bodyLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Header header;</span><br><span class="line">    <span class="keyword">private</span> T body; <span class="comment">// body: RpcRequest or RpcResponse, will be serialized into bytes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠå…¶å®ƒåè®®å¸¸é‡ä»¥åŠæšä¸¾</p>
<h4 id="TCP-æœåŠ¡å™¨å®ç°ç»„ä»¶-com-ypy-pyrpc-server-tcp"><a href="#TCP-æœåŠ¡å™¨å®ç°ç»„ä»¶-com-ypy-pyrpc-server-tcp" class="headerlink" title="TCP æœåŠ¡å™¨å®ç°ç»„ä»¶ com.ypy.pyrpc.server.tcp"></a>TCP æœåŠ¡å™¨å®ç°ç»„ä»¶ <code>com.ypy.pyrpc.server.tcp</code></h4><p><strong>:star:TCP æœåŠ¡å™¨å®ç° <code>TcpServer</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpServer</span> <span class="keyword">implements</span> <span class="title class_">RpcServer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx();</span><br><span class="line">        <span class="type">NetServer</span> <span class="variable">server</span> <span class="operator">=</span> vertx.createNetServer();</span><br><span class="line">        server.connectHandler(<span class="keyword">new</span> <span class="title class_">TcpServerHandler</span>());</span><br><span class="line">        server.listen(port, netServerAsyncResult -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (netServerAsyncResult.succeeded()) System.out.println(<span class="string">&quot;TcpServer started on port &quot;</span> + port);</span><br><span class="line">            <span class="keyword">else</span> System.out.println(<span class="string">&quot;TcpServer failed to start on port &quot;</span> + port);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç çš„é¦–å…ˆä½¿ç”¨ <code>Vertx</code> æ„é€ ä¸€ä¸ª Web æœåŠ¡å™¨: è¿™é‡Œçš„ <code>vertx</code> è™½ç„¶ä¸æ˜¯<code>static</code> çš„, ä½†æ˜¯å› ä¸ºæ•´ä¸ª <code>TcpServcer</code> ä¼šè¢«ä»¥å•ä¾‹çš„å½¢å¼å­˜å‚¨åœ¨å·¥å‚ç±»çš„é™æ€å˜é‡ä¸­, å¹¶ä¸” <code>start</code> æ–¹æ³•åªä¼šåœ¨ Provider åˆå§‹åŒ–ä¸­è¢«è°ƒç”¨ä¸€æ¬¡, å› æ­¤ä¸å­˜åœ¨é‡å¤å®ä¾‹åŒ–å¯¹è±¡ (<code>Vertx</code> å®ä¾‹) çš„é—®é¢˜. ä¹Ÿå°±æ˜¯è¯´, æ•´ä¸ª Provider ä¸­, åªä¼šå­˜åœ¨ä¸€ä¸ª <code>Vertx</code> å®ä¾‹. ä½†æ˜¯, è¿™å¹¶ä¸å½±å“RPCè¯·æ±‚çš„å¹¶å‘å¤„ç†, å› ä¸º:</p>
<ul>
<li><strong><code>Vert.x</code> çš„ç‰¹æ€§</strong>ï¼š<br><code>Vert.x</code> æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„æ¡†æ¶, å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>éé˜»å¡ I&#x2F;O</strong> å’Œ<strong>äº‹ä»¶å¾ªç¯</strong>. å½“ä½ åœ¨ <code>TcpServer</code> ä¸­ä½¿ç”¨ <code>Vert.x</code> çš„ <code>NetServer</code> æ—¶ï¼Œ<code>Vert.x</code> ä¼šè‡ªåŠ¨å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥, å¹¶ä¸”æ¯ä¸ªè¿æ¥çš„å¤„ç†æ˜¯éé˜»å¡çš„. è¿™æ„å‘³ç€: <ul>
<li>å¤šä¸ª Consumer å‘é€çš„è¯·æ±‚ä¼šè¢« <code>Vert.x</code> å¹¶å‘å¤„ç†ï¼Œè€Œä¸æ˜¯é¡ºæ¬¡å¤„ç†. </li>
<li><code>Vert.x</code> çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ä¼šç¡®ä¿é«˜å¹¶å‘è¯·æ±‚çš„é«˜æ•ˆå¤„ç†.</li>
</ul>
</li>
<li><strong>Provider ä¸­çš„ <code>RpcServer</code> å®ä¾‹</strong>ï¼š<br>åœ¨ Provider ä¸­åªå¯åŠ¨äº†ä¸€ä¸ª <code>RpcServer</code> å®ä¾‹ (ä¾‹å¦‚ <code>TcpServer</code>), ä½†ç”±äº <code>Vert.x</code> çš„å¼‚æ­¥å’Œéé˜»å¡ç‰¹æ€§, è¿™ä¸ªå®ä¾‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ª Consumer çš„è¯·æ±‚. æ¯ä¸ªè¯·æ±‚éƒ½ä¼šç”± <code>Vert.x</code> çš„äº‹ä»¶å¾ªç¯åˆ†é…åˆ°ä¸åŒçš„çº¿ç¨‹ (æˆ–äº‹ä»¶å¾ªç¯çº¿ç¨‹) ä¸­å¤„ç†.</li>
</ul>
<p>æœ€å, ä½¿ç”¨ <code>.connectHandler()</code> æ–¹æ³•ç»‘å®šå¤„ç†å™¨.</p>
<p><strong>:star:TCP å¤„ç†å™¨ <code>TcpServerHandler</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpServerHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;NetSocket&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(NetSocket netSocket)</span> &#123;</span><br><span class="line">        <span class="type">TcpBufferHandlerWrapper</span> <span class="variable">bufferHandlerWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TcpBufferHandlerWrapper</span>(buffer -&gt; &#123;</span><br><span class="line">            Protocol&lt;RpcRequest&gt; protocol;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                protocol = (Protocol&lt;RpcRequest&gt;) ProtocolUtils.decode(buffer);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Decode Err&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> protocol.getBody();</span><br><span class="line">            <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RpcResponse</span>();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class&lt;?&gt; serviceImpl = RpcLocalRegistry.getServiceImpl(rpcRequest.getServiceName());</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> serviceImpl.getMethod(rpcRequest.getMethodName(), rpcRequest.getParameterTypes());</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(serviceImpl.newInstance(), rpcRequest.getArgs());</span><br><span class="line"></span><br><span class="line">                rpcResponse.setData(result);</span><br><span class="line">                rpcResponse.setDataType(method.getReturnType());</span><br><span class="line">                rpcResponse.setMsg(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                rpcResponse.setMsg(e.getMessage());</span><br><span class="line">                rpcResponse.setException(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Protocol.<span class="type">Header</span> <span class="variable">header</span> <span class="operator">=</span> protocol.getHeader();</span><br><span class="line">            header.setType(ProtocolTypeEnum.RESPONSE.getCode());</span><br><span class="line">            Protocol&lt;RpcResponse&gt; responseProtocol = <span class="keyword">new</span> <span class="title class_">Protocol</span>&lt;&gt;(header, rpcResponse);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Buffer</span> <span class="variable">encodeBuffer</span> <span class="operator">=</span> ProtocolUtils.encode(responseProtocol);</span><br><span class="line">                netSocket.write(encodeBuffer);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Encode Err&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        netSocket.handler(bufferHandlerWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Handler ä¸­, <code>netSocket.handler()</code> ä¼ å…¥ä¸€ä¸ª <code>Handler&lt;Buffer&gt;</code> å¯¹è±¡, ç”¨äºå¤„ç†é€šä¿¡çš„å­—èŠ‚æµ.</p>
<p>ä½¿ç”¨ <code>TcpBufferHandlerWrapper</code> åŒ…è£¹, ä»¥è§£å†³åŠåŒ…&#x2F;ç²˜åŒ…é—®é¢˜.</p>
<p>å¤„ç†çš„ä¸»ä½“é€»è¾‘æ˜¯:</p>
<ul>
<li>é€šè¿‡å…¨å±€é…ç½®è·å–åºåˆ—åŒ–å™¨, ä½¿ç”¨åºåˆ—åŒ–å™¨å°†ä¼ å…¥çš„ buffer ååºåˆ—åŒ–æˆ <code>Protocol&lt;RpcRequest&gt; requestProtocol</code> , è·å–å…¶ <code>body</code>, å°±æ˜¯ <code>rpcRequest</code></li>
<li>åœ¨ <code>rpcRequest</code> ä¸­è·å–è¦è°ƒç”¨æœåŠ¡çš„ä¿¡æ¯ (æœåŠ¡æ¥å£å, æ–¹æ³•å, å‚æ•°ç±»å‹åŠå‚æ•°åˆ—è¡¨), é€šè¿‡ <code>RpcLocalRegistry</code> è·å–æœåŠ¡å®ç°ç±»çš„ Class å¯¹è±¡, å¹¶ä½¿ç”¨ <code>invoke</code> è°ƒç”¨è·å–æ–¹æ³•è¿”å›ç»“æœ <code>result</code></li>
<li>å°†ç»“æœå°è£…è¿›å…¥ <code>rpcResponse</code>, å°† <code>rpcResponse</code> å°è£…è¿›å…¥ <code>Protocol&lt;RpcResponse&gt; responseProtocol</code></li>
<li>é€šè¿‡ä¹‹å‰çš„åºåˆ—åŒ–å™¨åºåˆ—åŒ– <code>responseProtocol</code>, å¹¶ä½¿ç”¨ <code>netSocket.write(encodeBuffer);</code> å°† buffer å†™å…¥socket</li>
</ul>
<p><strong>:star:TCP å®¢æˆ·ç«¯å®ç° <code>TcpClient</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpClient</span> <span class="keyword">implements</span> <span class="title class_">RpcClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx(); <span class="comment">// signal instance</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">NetClient</span> <span class="variable">netClient</span> <span class="operator">=</span> vertx.createNetClient(<span class="keyword">new</span> <span class="title class_">NetClientOptions</span>()); <span class="comment">// signal instance</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RpcResponse <span class="title function_">request</span><span class="params">(RpcRequest rpcRequest, ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        CompletableFuture&lt;RpcResponse&gt; responseCompletableFuture = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        netClient.connect(</span><br><span class="line">                serviceMetaInfo.getServicePost(),</span><br><span class="line">                serviceMetaInfo.getServiceHost(),</span><br><span class="line">                netSocketAsyncResult -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!netSocketAsyncResult.succeeded()) &#123;</span><br><span class="line">                        System.err.println(netSocketAsyncResult.cause().getMessage());</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="type">NetSocket</span> <span class="variable">netSocket</span> <span class="operator">=</span> netSocketAsyncResult.result();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// make date</span></span><br><span class="line">                    Protocol.<span class="type">Header</span> <span class="variable">header</span> <span class="operator">=</span> Protocol.Header.builder()</span><br><span class="line">                            .magic(ProtocolConst.MAGIC)</span><br><span class="line">                            .version(ProtocolConst.VERSION)</span><br><span class="line">                            .serializer(ProtocolSerializerEnum.getByKey(RpcApplication.getRpcConfig().getSerializer()).getCode())</span><br><span class="line">                            .type(ProtocolTypeEnum.REQUEST.getCode())</span><br><span class="line">                            .requestId(IdUtil.getSnowflakeNextId())</span><br><span class="line">                            .build();</span><br><span class="line">                    Protocol&lt;RpcRequest&gt; rpcRequestProtocol = <span class="keyword">new</span> <span class="title class_">Protocol</span>&lt;&gt;(header, rpcRequest);</span><br><span class="line">                    rpcRequestProtocol.setHeader(header);</span><br><span class="line">                    rpcRequestProtocol.setBody(rpcRequest);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// send data</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="type">Buffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ProtocolUtils.encode(rpcRequestProtocol);</span><br><span class="line">                        netSocket.write(buffer);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Encode failed&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// get response data</span></span><br><span class="line">                    <span class="type">TcpBufferHandlerWrapper</span> <span class="variable">bufferHandlerWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TcpBufferHandlerWrapper</span>(buffer -&gt; &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            Protocol&lt;RpcResponse&gt; responseProtocol =</span><br><span class="line">                                    (Protocol&lt;RpcResponse&gt;) ProtocolUtils.decode(buffer);</span><br><span class="line">                            responseCompletableFuture.complete(responseProtocol.getBody());</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Decode failed&quot;</span>, e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    netSocket.handler(bufferHandlerWrapper);</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> responseCompletableFuture.get();</span><br><span class="line">        <span class="keyword">return</span> rpcResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TcpClient</code> çš„å®ä¾‹è¢«å­˜å‚¨åœ¨å·¥å‚ç±»ä¸­, ä½†æ˜¯, ç”±äº Consumer è¦å¤šæ¬¡è°ƒç”¨ <code>request</code> æ–¹æ³•, å› æ­¤é€‰æ‹©æŠŠ <code>Vertx</code> å’Œ <code>NetClient</code> å®ä¾‹ä½œä¸ºé™æ€å˜é‡, é¿å…æ¯æ¬¡è°ƒç”¨ <code>request</code> çš„æ—¶å€™éƒ½åˆ›å»ºè¿æ¥.</p>
<p>å°†ä»¥ä¸Šçš„ <code>RpcServer</code> å’Œ <code>RpcClient</code> åˆ†å¼€æ„å»ºçš„åŸå› æ˜¯: ä¸ºäº†æ»¡è¶³ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸º Consumer çš„åŒæ—¶ä¹Ÿæä¾›æœåŠ¡, ä½œä¸º Provider. </p>
<p><strong>:star:è§£å†³åŠåŒ…ç²˜åŒ…å¤„ç†å™¨ <code>TcpBufferHandlerWrapper</code></strong></p>
<p>ä¸ºäº†è§£å†³ TCP ä¼ è¾“ä¸­çš„åŠåŒ…ç²˜åŒ…é—®é¢˜, æ„é€ ä¸€ä¸ªå¤„ç†å™¨, å®ƒå®ç°å¹¶å¢å¼º <code>Handler&lt;Buffer&gt;</code> æ¥å£. è¿™ç§åšæ³•æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„ <strong>è£…é¥°è€…æ¨¡å¼</strong>, ä½¿ç”¨ <code>RecordParser</code> å¯¹åŸæœ‰çš„ <code>Buffer</code> å¤„ç†å™¨çš„èƒ½åŠ›è¿›è¡Œå¢å¼º. è£…é¥°è€…æ¨¡å¼å¯ä»¥ç®€å•ç†è§£ä¸ºç»™å¯¹è±¡ç©¿è£…å¤‡, å¢å¼ºå¯¹è±¡çš„èƒ½åŠ›. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TcpBufferHandlerWrapper</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;Buffer&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RecordParser recordParser;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RecordParser <span class="title function_">initRecordParser</span><span class="params">(Handler&lt;Buffer&gt; bufferHandler)</span> &#123;</span><br><span class="line">        <span class="type">RecordParser</span> <span class="variable">parser</span> <span class="operator">=</span> RecordParser.newFixed(ProtocolConst.HEADER_LENGTH);</span><br><span class="line">        parser.setOutput(<span class="keyword">new</span> <span class="title class_">Handler</span>&lt;Buffer&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bodyLength</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="type">Buffer</span> <span class="variable">resultBuffer</span> <span class="operator">=</span> Buffer.buffer();</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (-<span class="number">1</span> == bodyLength) &#123;</span><br><span class="line">                    <span class="comment">// 1. é¦–å…ˆè§£æ Headerï¼ˆå›ºå®šé•¿åº¦ 17 å­—èŠ‚ï¼‰</span></span><br><span class="line">                    bodyLength = buffer.getInt(<span class="number">13</span>); <span class="comment">// è·å– Body çš„é•¿åº¦ï¼Œå‡è®¾Headerçš„ç´¢å¼• 13..=16 å­—èŠ‚è¡¨ç¤º BodyLength</span></span><br><span class="line">                    parser.fixedSizeMode(bodyLength); <span class="comment">// æ ¹æ®Bodyçš„é•¿åº¦è®¾ç½®æ¥ä¸‹æ¥çš„è§£ææ¨¡å¼</span></span><br><span class="line">                    resultBuffer.appendBuffer(buffer); <span class="comment">// å°†Headeræ•°æ®ç¼“å­˜èµ·æ¥</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 2. æ¥æ”¶ Body æ•°æ®</span></span><br><span class="line">                    resultBuffer.appendBuffer(buffer); <span class="comment">// å°†æ¥æ”¶åˆ°çš„Bodyæ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (resultBuffer.length() &gt;= bodyLength + ProtocolConst.HEADER_LENGTH) &#123;</span><br><span class="line">                        bufferHandler.handle(resultBuffer); <span class="comment">// è°ƒç”¨å¤–éƒ¨ä¼ å…¥çš„å›è°ƒï¼Œå¤„ç†å®Œæ•´çš„æ¶ˆæ¯</span></span><br><span class="line">                        <span class="comment">// 4. å¤„ç†å®Œåï¼Œé‡ç½®çŠ¶æ€ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªæ•°æ®åŒ…</span></span><br><span class="line">                        parser.fixedSizeMode(ProtocolConst.HEADER_LENGTH);</span><br><span class="line">                        bodyLength = -<span class="number">1</span>; <span class="comment">// é‡ç½®Bodyé•¿åº¦</span></span><br><span class="line">                        resultBuffer = Buffer.buffer(); <span class="comment">// é‡ç½®ç¼“å­˜</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> parser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TcpBufferHandlerWrapper</span><span class="params">(Handler&lt;Buffer&gt; bufferHandler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.recordParser = initRecordParser(bufferHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">        recordParser.handle(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SPI-ç»„ä»¶-com-ypy-pyrpc-spi"><a href="#SPI-ç»„ä»¶-com-ypy-pyrpc-spi" class="headerlink" title="SPI ç»„ä»¶ com.ypy.pyrpc.spi"></a>SPI ç»„ä»¶ <code>com.ypy.pyrpc.spi</code></h3><p>**SPI (Service Provider Interface) ** æ˜¯ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶, ç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å®ç°ç±». å®ƒæ˜¯ Java æä¾›çš„ä¸€ç§æ ‡å‡†æ‰©å±•ç‚¹æœºåˆ¶, å…è®¸æ¡†æ¶æˆ–åº“å®šä¹‰æ¥å£, å¹¶ç”±ç¬¬ä¸‰æ–¹æä¾›å®ç°. SPI çš„æ ¸å¿ƒæ€æƒ³æ˜¯ <strong>è§£è€¦æ¥å£ä¸å®ç°</strong>, ä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹æ‰©å±•åŠŸèƒ½. è¯´ç™½äº†, å°±æ˜¯SDKä¸­æä¾›ä¸€äº›æ¥å£å’Œé»˜è®¤å®ç°ç±», å½“å¼€å‘è€…ä¸æƒ³ä½¿ç”¨SDKæä¾›çš„å®ç°ç±»æ—¶, ä»–ä»¬å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªå®ç°ç±», å¹¶é€šè¿‡é…ç½®è®©SDKä½¿ç”¨è‡ªå®šä¹‰çš„å®ç°ç±».</p>
<p><strong>:star:SPIå¯¼å…¥å™¨<code>SpiLoader</code>â€‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpiLoader</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * store the class that has been load, &#123;interfaceName: &#123;implClassKey: implClass&#125;&#125;</span></span><br><span class="line"><span class="comment">     * className means full name, e.g. com.ypy.pyrpc.spi.serializer.Serializer</span></span><br><span class="line"><span class="comment">     * classKey means a short key, representing some implClass, e.g. jdk=JdkSerializer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Map&lt;String, Class&lt;?&gt;&gt;&gt; spiMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * cache of instance, avoid repeat &quot;new&quot;</span></span><br><span class="line"><span class="comment">     * &#123;implClassName: implClassInstance&#125;</span></span><br><span class="line"><span class="comment">     * full-name, not a key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Object&gt; implClassInstanceCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RPC_SYSTEM_SPI_DIR</span> <span class="operator">=</span> <span class="string">&quot;META-INF/pyrpc/system/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RPC_CUSTOM_SPI_DIR</span> <span class="operator">=</span> <span class="string">&quot;META-INF/pyrpc/custom/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] SCAN_DIRS = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;RPC_SYSTEM_SPI_DIR, RPC_CUSTOM_SPI_DIR&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Class&lt;?&gt;&gt; load(Class&lt;?&gt; interfaceClass) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">interfaceName</span> <span class="operator">=</span> interfaceClass.getName();</span><br><span class="line">        Map&lt;String, Class&lt;?&gt;&gt; implKey2implClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); <span class="comment">// &#123;implClassKey: implClass&#125;</span></span><br><span class="line">        <span class="keyword">for</span> (String dir : SCAN_DIRS) &#123;</span><br><span class="line">            List&lt;URL&gt; resources = ResourceUtil.getResources(dir + interfaceName);</span><br><span class="line">            <span class="keyword">for</span> (URL resource : resources) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(resource.openStream());</span><br><span class="line">                    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                        String[] split = line.split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (split.length == <span class="number">2</span>) &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">implClassKey</span> <span class="operator">=</span> split[<span class="number">0</span>];</span><br><span class="line">                            <span class="type">String</span> <span class="variable">implClassName</span> <span class="operator">=</span> split[<span class="number">1</span>];</span><br><span class="line">                            implKey2implClassMap.put(implClassKey, Class.forName(implClassName));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;spi resource load error&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        spiMap.put(interfaceName, implKey2implClassMap);</span><br><span class="line">        <span class="keyword">return</span> implKey2implClassMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getInstance</span><span class="params">(Class&lt;T&gt; interfaceClass, String implClassKey)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">interfaceName</span> <span class="operator">=</span> interfaceClass.getName();</span><br><span class="line">        Map&lt;String, Class&lt;?&gt;&gt; implKey2implClassMap = spiMap.get(interfaceName);</span><br><span class="line">        <span class="keyword">if</span> (implKey2implClassMap == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Interface &quot;</span> + interfaceName + <span class="string">&quot; has no implement classes&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!implKey2implClassMap.containsKey(implClassKey)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Interface &quot;</span> + interfaceName + <span class="string">&quot; has no implement &quot;</span> + implClassKey);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; implClass = implKey2implClassMap.get(implClassKey);</span><br><span class="line">        <span class="keyword">if</span> (!implClassInstanceCache.containsKey(implClass.getName())) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                implClassInstanceCache.put(implClass.getName(), implClass.newInstance());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Write &quot;</span> + implClass.getName() + <span class="string">&quot; into cache failed&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) implClassInstanceCache.get(implClass.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä¸¤ä¸ª<code>ConcurrentHashMap</code>å­˜è´®åŠŸèƒ½æ¥å£å’Œå®ç°ç±»çš„ä¿¡æ¯, å¹¶å¼•å…¥ç¼“å­˜æœºåˆ¶:</p>
<ul>
<li><code>spiMap</code> çš„å­˜å‚¨æ¨¡å¼æ˜¯: <code>&#123;interfaceName: &#123;implClassKey: implClass&#125;&#125;</code>, ä¾‹å¦‚ <code>&#123;&quot;Registry&quot; : &#123;&quot;jdk&quot;: Class&lt;JdkRegistry&gt;, &quot;json&quot;: Class&lt;JsonRegistry&gt;&#125;&#125;</code></li>
<li><code>implClassInstanceCache</code> çš„å­˜å‚¨æ¨¡å¼æ˜¯: <code>&#123;implClassName: implClassInstance&#125;</code>, ä¾‹å¦‚ <code>&#123;&quot;JdkRegistry&quot;: JdkRegistry&#125;</code>. ä½œä¸ºå¯¹è±¡ç¼“å­˜, é¿å…é‡å¤newå¯¹è±¡</li>
</ul>
<p>ä½¿ç”¨SPIæœºåˆ¶, ä¸ºä»¥ä¸‹å››ä¸ªåŠŸèƒ½æ¨¡å—æä¾›äº†å¯å®šåˆ¶åŒ–é€‰æ‹©: 1) æ³¨å†Œä¸­å¿ƒ; 2) åºåˆ—åŒ–å™¨; 3) è´Ÿè½½å‡è¡¡å™¨; 4) é‡è¯•å’Œå®¹é”™å™¨. å®ƒä»¬æœ‰å¯¹åº”çš„å·¥å‚ç±», ä¾‹å¦‚</p>
<p><strong>:stars:<code>RegistryFactory</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegistryFactory</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123; SpiLoader.load(Registry.class); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title function_">getInstance</span><span class="params">(String implClassKey)</span> &#123; <span class="keyword">return</span> SpiLoader.getInstance(Registry.class, implClassKey); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“é¡¹ç›®åŠ è½½æ—¶, å·¥å‚ç±»çš„ <code>static</code> éƒ¨åˆ†ä¼šè°ƒç”¨ <code>loader</code> æ–¹æ³•, å°†é»˜è®¤å®ç°ç±»å’Œç”¨æˆ·å®ç°ç±»åŠ å…¥ <code>SpiLoader</code> ä¸­çš„å­—å…¸å®¹å™¨, åŒæ—¶, ç”±äºæ˜¯å…ˆè½½å…¥æ¡†æ¶é»˜è®¤å®ç°ç±»åè½½å…¥ç”¨æˆ·è‡ªå®šä¹‰å®ç°ç±», å› æ­¤ç”¨æˆ·è‡ªå®šä¹‰çš„keyä¼šè¦†ç›–æ¡†æ¶é»˜è®¤çš„key, è¿™æ ·æ˜¯æ›´åŠ åˆç†çš„. </p>
<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹æ¡†æ¶ä¸­çš„é»˜è®¤å®ç°ç±».</p>
<h4 id="åºåˆ—åŒ–å™¨ç»„ä»¶-com-ypy-pyrpc-spi-serializer"><a href="#åºåˆ—åŒ–å™¨ç»„ä»¶-com-ypy-pyrpc-spi-serializer" class="headerlink" title="åºåˆ—åŒ–å™¨ç»„ä»¶ com.ypy.pyrpc.spi.serializer"></a>åºåˆ—åŒ–å™¨ç»„ä»¶ <code>com.ypy.pyrpc.spi.serializer</code></h4><p><strong>:star:<code>Serializer</code> æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializer</span> &#123;</span><br><span class="line">    &lt;T&gt; <span class="type">byte</span>[] serialize(T obj) <span class="keyword">throws</span> IOException;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] data, Class&lt;T&gt; type)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¡†æ¶æä¾›çš„é»˜è®¤å®ç°ç±»åœ¨ <code>impl</code> åŒ…ä¸­, æœ‰ JDK, JSON, KRYO ä¸‰ç§åºåˆ—åŒ–å™¨. </p>
<h4 id="æ³¨å†Œä¸­å¿ƒç»„ä»¶-com-ypy-pyrpc-spi-registry"><a href="#æ³¨å†Œä¸­å¿ƒç»„ä»¶-com-ypy-pyrpc-spi-registry" class="headerlink" title="æ³¨å†Œä¸­å¿ƒç»„ä»¶ com.ypy.pyrpc.spi.registry"></a>æ³¨å†Œä¸­å¿ƒç»„ä»¶ <code>com.ypy.pyrpc.spi.registry</code></h4><p><strong>:smile:å½¢è±¡çš„ä¾‹å­</strong></p>
<p>é£Ÿå®¢ - ç‚¹é¤å¹³å° (ç¾å›¢) - é¥­é¦†: é£Ÿå®¢ &#x3D; Consumer, ç¾å›¢ &#x3D; æ³¨å†Œä¸­å¿ƒ, é¤é¦† &#x3D; Provider. </p>
<p>é£Ÿå®¢ä»ç¾å›¢ä¸æ˜¯å»åƒèœ (è°ƒç”¨æœåŠ¡), è€Œæ˜¯è·å–é¤é¦†å’Œèœå“ä¿¡æ¯, ç„¶åå†å»é¤é¦†åƒèœ (å‘èµ· RPC è¯·æ±‚). </p>
<p>é¤é¦† (Provider) è¦å…ˆåšèœ (æŠŠæä¾›çš„æœåŠ¡å­˜å…¥æœ¬åœ°æ³¨å†Œä¸­å¿ƒ <code>RpcLocalRegistry</code>) å†æŠŠç›¸åº”çš„èœå“ä¿¡æ¯å­˜å…¥ç¾å›¢ (æŠŠæä¾›çš„æœåŠ¡çš„ä¿¡æ¯æäº¤ç»™ <code>Registry</code>, <code>Registry</code> æŠŠä¿¡æ¯å­˜å…¥ ETCD), è¿™æ ·é¡¾å®¢æ‰èƒ½å‘ç°èœå“. </p>
<p>æ‰€è°“æœåŠ¡å‘ç°ç¼“å­˜, å®é™…å°±æ˜¯, å½“ä¸€ä¸ªé£Ÿå®¢ç»å¸¸å»æŸé¤é¦†åƒé¥­, ä»–å»å¤šäº†, ä¹Ÿå°±æ²¡æœ‰å¿…è¦æ¬¡æ¬¡éƒ½å»åˆ°ç¾å›¢ä¸ŠæŸ¥çœ‹å…³äºé¤é¦†çš„ä¿¡æ¯ (ä¾‹å¦‚åœ¨å“ªé‡Œ, æœ‰å“ªäº›èœå“). </p>
<p><strong>:star:<code>Registry</code>â€‹ æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Registry</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * initialize registry for both PROVIDER and CONSUMER</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registryConfig</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(RpcConfig.RegistryConfig registryConfig)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help PROVIDER to register their service (info) into registry</span></span><br><span class="line"><span class="comment">     * and these services should also be registered and managed by LocalRegistry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceMetaInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help PROVIDER to unregister service</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceMetaInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unregister</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help CONSUMER to search a group of service meta info by ServiceNameVersion</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceNameVer: &quot;serviceName:serviceVersion&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;ServiceMetaInfo&gt; <span class="title function_">serviceDiscovery</span><span class="params">(String serviceNameVer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * when a PROVIDER offline, clear correlative service info it provided in registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * send update message to registry, confirming PROVIDED alive</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">heartBeat</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * help CONSUMER to watch PROVIDER, when a Provider offline (actively or passively), it will update local cache info of CONSUMER</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fullRegistryServiceKey: /[RPC_ROOT_PATH]/[ServiceName]:[ServiceVersion]/[ServiceAddr]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">(String fullRegistryServiceKey, String serviceNameVer)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œä¸­å¿ƒæ¥å£æœ‰å…­ä¸ªæ–¹æ³•, åˆ†åˆ«æ˜¯æ³¨å†Œä¸­å¿ƒåˆå§‹åŒ–, æœåŠ¡æ³¨å†Œ, æœåŠ¡æ³¨é”€, æœåŠ¡å‘ç°, èŠ‚ç‚¹å…³é—­, å¿ƒè·³æ£€æµ‹, ä»¥åŠèŠ‚ç‚¹ç›‘è§†. </p>
<p>åœ¨ <code>impl</code> åŒ…ä¸­, æä¾›äº† ETCD çš„é»˜è®¤å®ç° (<code>com.ypy.pyrpc.spi.registry.impl.EtcdRegistry</code>), ä»¥åŠæ— æ³¨å†Œä¸­å¿ƒçš„å®ç° <code>NoRegistry</code>. </p>
<p>å®ç°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒæ˜¯ä¸€ä¸ªéš¾ç‚¹, æˆ‘ä»¬è¯¦ç»†è¯´ä¸€ä¸‹:</p>
<p><strong>:stars:<code>EtcdRegistry</code>â€‹ ETCD æ³¨å†Œä¸­å¿ƒ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EtcdRegistry</span> <span class="keyword">implements</span> <span class="title class_">Registry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Client cli;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> KV kvCli;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ETCD_ROOT_PATH</span> <span class="operator">=</span> <span class="string">&quot;/pyrpc/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fullRegistryServiceKey: /pyrpc/com.....UserService:1.0.0/http://127.0.0.1:8080</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * this collection stores data for PROVIDER</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; loaclFullRegistryServiceKeySet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key is serviceNameVersion</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * this collection stores data for CONSUMER, make convenience through cache ServiceNameVer and their MetaInfo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;ServiceMetaInfo&gt;&gt; serviceNameVerCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; watchingNodeKeySet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(RpcConfig.RegistryConfig registryConfig)</span> &#123;</span><br><span class="line">        cli = Client.builder()</span><br><span class="line">                .endpoints(registryConfig.getAddr())</span><br><span class="line">                .connectTimeout(Duration.ofMillis(registryConfig.getTimeout()))</span><br><span class="line">                .build();</span><br><span class="line">        kvCli = cli.getKVClient();</span><br><span class="line">        heartBeat();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Lease</span> <span class="variable">leaseCli</span> <span class="operator">=</span> cli.getLeaseClient();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">leaseId</span> <span class="operator">=</span> leaseCli.grant(<span class="number">30L</span>).get().getID();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fullRegistryServiceKey</span> <span class="operator">=</span> ETCD_ROOT_PATH + serviceMetaInfo.getServiceNameVerAddr();</span><br><span class="line">        <span class="type">ByteSequence</span> <span class="variable">k</span> <span class="operator">=</span> ByteSequence.from(fullRegistryServiceKey, StandardCharsets.UTF_8);</span><br><span class="line">        <span class="type">ByteSequence</span> <span class="variable">v</span> <span class="operator">=</span> ByteSequence.from(JSONUtil.toJsonStr(serviceMetaInfo), StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">        <span class="type">PutOption</span> <span class="variable">putOption</span> <span class="operator">=</span> PutOption.builder().withLeaseId(leaseId).build();</span><br><span class="line">        kvCli.put(k, v, putOption).get();</span><br><span class="line">        loaclFullRegistryServiceKeySet.add(fullRegistryServiceKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unregister</span><span class="params">(ServiceMetaInfo serviceMetaInfo)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fullRegistryServiceKey</span> <span class="operator">=</span> ETCD_ROOT_PATH + serviceMetaInfo.getServiceNameVerAddr();</span><br><span class="line">        kvCli.delete(ByteSequence.from(fullRegistryServiceKey, StandardCharsets.UTF_8));</span><br><span class="line">        loaclFullRegistryServiceKeySet.remove(serviceMetaInfo.getServiceNameVerAddr());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ServiceMetaInfo&gt; <span class="title function_">serviceDiscovery</span><span class="params">(String serviceNameVer)</span> &#123;</span><br><span class="line">        List&lt;ServiceMetaInfo&gt; cachedServiceMetaInfos = serviceNameVerCache.get(serviceNameVer);</span><br><span class="line">        <span class="keyword">if</span> (cachedServiceMetaInfos != <span class="literal">null</span>) <span class="keyword">return</span> cachedServiceMetaInfos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// search in etcd</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">searchPrefix</span> <span class="operator">=</span> ETCD_ROOT_PATH + serviceNameVer + <span class="string">&quot;/&quot;</span>; <span class="comment">// add &quot;/&quot; means search for group</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">GetOption</span> <span class="variable">getOption</span> <span class="operator">=</span> GetOption.builder().isPrefix(<span class="literal">true</span>).build();</span><br><span class="line">            List&lt;KeyValue&gt; kvs = kvCli.get(</span><br><span class="line">                    ByteSequence.from(searchPrefix, StandardCharsets.UTF_8),</span><br><span class="line">                    getOption</span><br><span class="line">            ).get().getKvs();</span><br><span class="line"></span><br><span class="line">            List&lt;ServiceMetaInfo&gt; serviceMetaInfoList = kvs.stream()</span><br><span class="line">                    .map(kv -&gt; &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">fullRegistryServiceKey</span> <span class="operator">=</span> kv.getKey().toString(StandardCharsets.UTF_8);</span><br><span class="line">                        watch(fullRegistryServiceKey, serviceNameVer);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> kv.getValue().toString(StandardCharsets.UTF_8);</span><br><span class="line">                        <span class="keyword">return</span> JSONUtil.toBean(val, ServiceMetaInfo.class);</span><br><span class="line">                    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            serviceNameVerCache.put(serviceNameVer, serviceMetaInfoList);</span><br><span class="line">            <span class="keyword">return</span> serviceMetaInfoList;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Get service list failed&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String key : loaclFullRegistryServiceKeySet) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                kvCli.delete(ByteSequence.from(key, StandardCharsets.UTF_8));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(key + <span class="string">&quot;: delete etcd node failed&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (kvCli != <span class="literal">null</span>) kvCli.close();</span><br><span class="line">        <span class="keyword">if</span> (cli != <span class="literal">null</span>) cli.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Destroy Current Node&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">heartBeat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// every 10 seconds, update lease for all services provided by current Provider</span></span><br><span class="line">        CronUtil.schedule(<span class="string">&quot;*/10 * * * * *&quot;</span>, <span class="keyword">new</span> <span class="title class_">Task</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (String key : loaclFullRegistryServiceKeySet) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        List&lt;KeyValue&gt; kvs = kvCli.get(ByteSequence.from(key, StandardCharsets.UTF_8))</span><br><span class="line">                                .get()</span><br><span class="line">                                .getKvs();</span><br><span class="line">                        <span class="keyword">if</span> (kvs.isEmpty()) <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="type">KeyValue</span> <span class="variable">kv</span> <span class="operator">=</span> kvs.get(<span class="number">0</span>);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> kv.getValue().toString(StandardCharsets.UTF_8);</span><br><span class="line">                        <span class="type">ServiceMetaInfo</span> <span class="variable">serviceMetaInfo</span> <span class="operator">=</span> JSONUtil.toBean(val, ServiceMetaInfo.class);</span><br><span class="line">                        register(serviceMetaInfo);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(key + <span class="string">&quot;: updating lease failed&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        CronUtil.setMatchSecond(<span class="literal">true</span>);</span><br><span class="line">        CronUtil.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">(String fullRegistryServiceKey, String serviceNameVer)</span> &#123;</span><br><span class="line">        <span class="type">Watch</span> <span class="variable">watchCli</span> <span class="operator">=</span> cli.getWatchClient();</span><br><span class="line">        <span class="keyword">if</span> (watchingNodeKeySet.add(fullRegistryServiceKey)) &#123;</span><br><span class="line">            watchCli.watch(ByteSequence.from(fullRegistryServiceKey, StandardCharsets.UTF_8), watchResponse -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (WatchEvent event : watchResponse.getEvents()) &#123;</span><br><span class="line">                    <span class="keyword">switch</span> (event.getEventType()) &#123;</span><br><span class="line">                        <span class="keyword">case</span> DELETE:</span><br><span class="line">                            serviceNameVerCache.remove(serviceNameVer);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> PUT:</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹æˆå‘˜å˜é‡: ç”±äº <code>EtcdRegistry</code> å®ä¾‹æ˜¯è¢«ä¿å­˜åœ¨ <code>SpiLoader</code> ä¸­, å› æ­¤æ¯æ¬¡è·å–å®ä¾‹æ—¶å¹¶ä¸ä¼šé‡å¤åˆ›å»ºå®ä¾‹, æ‰€ä»¥å…¶ä¸­çš„æˆå‘˜å˜é‡éƒ½ä¸éœ€è¦è®¾ç½®ä¸º <code>static</code>.</p>
<ul>
<li><code>Client cli</code> æ˜¯ <code>jetcd</code> ä¸­, æ“ä½œ ETCD çš„å®¢æˆ·ç«¯, <code>jectd</code> æ˜¯ä¸“é—¨ä¸º Java æ“ä½œ ECTD çš„ SDK, ç›¸å½“äº Jedis &#x2F; Redission ä¹‹äº Redis</li>
<li><code>kvCli</code> æ˜¯ç”± <code>cli</code> ç”Ÿæˆçš„æ“ä½œé”®å€¼å¯¹çš„å®¢æˆ·ç«¯</li>
<li><code>ETCD_ROOT_PATH</code> æ˜¯å­˜å‚¨åœ¨ ETCD æ•°æ®åº“ä¸­æœ¬é¡¹ç›®çš„æ ‡è¯†å‰ç¼€, ç”¨æ¥ä¸å…¶å®ƒé¡¹ç›®åŒºåˆ†</li>
<li><code>Set&lt;String&gt; loaclFullRegistryServiceKeySet</code> æ˜¯å­˜å‚¨æœ¬åœ° (ä¹Ÿå°±æ˜¯å½“å‰ Provider) ä¸­æä¾›çš„æœåŠ¡ä¿¡æ¯, å®ƒé‡Œé¢å­˜çš„æ˜¯æœåŠ¡çš„å…¨éƒ¨ä¿¡æ¯, å…¶ç»“æ„ä¸º <code>/pyrpc/com.....UserService:1.0.0/http://127.0.0.1:8080</code> å³å‰ç¼€ + æœåŠ¡æ¥å£å + ç‰ˆæœ¬å· + Provider åœ°å€</li>
<li><code>Map&lt;String, List&lt;ServiceMetaInfo&gt;&gt; serviceNameVerCache</code> æ˜¯ä¸º <strong>Consumer</strong> æä¾›çš„æœåŠ¡å‘ç°ç¼“å­˜, å› ä¸º Consumer å‘é€ RPC è¯·æ±‚æ˜¯å¾ˆé¢‘ç¹çš„, æˆ‘ä»¬æ²¡æœ‰å¿…è¦æ¯ä¸€æ¬¡éƒ½å‘ ETCD è¯·æ±‚æœåŠ¡ä¿¡æ¯, è€Œæ˜¯é€‰æ‹©æŠŠå¯¹åº”çš„ä¿¡æ¯ç¼“å­˜èµ·æ¥, è¿™æ · Consumer å°±å¯ä»¥æ›´åŠ é«˜æ•ˆçš„è·å–æœåŠ¡ä¿¡æ¯, å†æä¾›ä¿¡æ¯å‘é€RPCè¯·æ±‚äº†. ç”±äºå‘ç°æœåŠ¡æ˜¯ Consumer æä¾›æœåŠ¡æ¥å£åå’Œç‰ˆæœ¬å·, å› æ­¤ <code>serviceNameVerCache</code> çš„ key ç»“æ„ä¸º <code>com.....UserService:1.0.0</code></li>
<li><code>Set&lt;String&gt; watchingNodeKeySet</code> æ˜¯ä¸º Consumer æä¾›çš„ç›‘è§†æœºåˆ¶, å®ƒå­˜å‚¨äº†æ­£åœ¨ç›‘è§†çš„ç»“ç‚¹, é‡Œé¢å­˜å‚¨çš„æ˜¯ <code>fullRegistryServiceKey</code>, ä¹Ÿå°±æ˜¯å‰ç¼€ + æœåŠ¡æ¥å£å + ç‰ˆæœ¬å· + Provider åœ°å€çš„å…¨éƒ¨ä¿¡æ¯</li>
</ul>
<p>å†æ¥çœ‹æ–¹æ³•å®ç°:</p>
<ul>
<li><code>init</code> æ˜¯åˆå§‹åŒ–æ–¹æ³•, åŒ…æ‹¬åˆ›å»ºç›¸åº”çš„ Java ETCD å®¢æˆ·ç«¯</li>
<li><code>register</code> æ˜¯æœåŠ¡æ³¨å†Œ, ä¸»è¦å®Œæˆå†™å…¥ä¿¡æ¯åˆ° ETDC å’Œå†™å…¥ä¿¡æ¯åˆ°æœ¬åœ° <code>loaclFullRegistryServiceKeySet</code></li>
<li><code>serviceDiscovery</code> æ˜¯é€šè¿‡æœåŠ¡æ¥å£åå’Œç‰ˆæœ¬å·æ¥å‘ç°æœåŠ¡, å…ˆæŸ¥çœ‹ç¼“å­˜, ç¼“å­˜æ²¡æœ‰å†å‘ ETCD æ‹‰å–, åŒæ—¶å­˜å…¥ç¼“å­˜. å­˜å…¥ç¼“å­˜çš„æœåŠ¡éœ€è¦ç›‘è§†å…¶èŠ‚ç‚¹, äºæ˜¯è¦è°ƒç”¨ <code>watch(fullRegistryServiceKey, serviceNameVer);</code> æ–¹æ³•</li>
<li><code>destroy</code> æ˜¯ Provider ç«¯çš„ä¸»åŠ¨ä¸‹çº¿æœºåˆ¶, å½“ä¸€ä¸ª Provider åœæœºäº†, ä¼šå°†æƒ…å†µå…ˆè¡Œä¸ŠæŠ¥ç»™ ETCD ä»¥é¿å… Consumer çš„é”™è¯¯è°ƒç”¨</li>
<li><code>heartBeat</code> æ˜¯ Provider ç«¯çš„è¢«åŠ¨ä¸‹çº¿æœºåˆ¶, å½“ä¸€ä¸ª Provider å› ä¸ºå¼‚å¸¸åœæœº, ä¾‹å¦‚æ–­ç”µ, è¿™æ—¶å€™å°±æ— æ³•æ‰§è¡Œ <code>destroy</code> äº†. å¿ƒè·³æ£€æµ‹çš„åŸç†æ˜¯ Provider å®šæ—¶ (10 s) å‘æ³¨å†Œä¸­å¿ƒæ›´æ–°ä¸€æ¬¡æœåŠ¡ä¿¡æ¯, ETCD åˆ™å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯è®¾ç½®ä¸€ä¸ªç¨é•¿çš„è¿‡æœŸæ—¶é—´ (30 s). å½“ Provider å› ä¸ºå¼‚å¸¸åœæœº, å…¶å¯¹åº”çš„èŠ‚ç‚¹å°±ä¼šå› ä¸ºæ— æ³•ç»­æœŸè€Œè¢« ETCD åˆ é™¤. å› æ­¤å¼‚å¸¸åœæœºé€ æˆçš„å½±å“æœ€å¤šæŒç»­ 30 s.</li>
<li><code>watch</code> æ˜¯ä¸º Consumer æ£€æµ‹ Provider çŠ¶æ€çš„, å½“ä¸€ä¸ª Provider ä¸‹çº¿ (ä¸»åŠ¨æˆ–è¢«åŠ¨), Consumer å°±ä¼šæ”¶åˆ° ETCD çš„ç›¸åº”, å¹¶åˆ é™¤å¯¹åº”çš„æœåŠ¡ä¿¡æ¯ç¼“å­˜</li>
</ul>
<p>ä»¥ä¸Šçš„åšæ³•ç»´æŠ¤äº†: </p>
<ul>
<li>æ•°æ®ä¸€è‡´æ€§: å½“æŸä¸ª Provider ä¸‹çº¿äº†, æ³¨å†Œä¸­å¿ƒéœ€è¦å³æ—¶å‰”é™¤å®ƒçš„ç»“ç‚¹æœåŠ¡ä¿¡æ¯.</li>
<li>æ€§èƒ½ä¼˜åŒ–: Consumer æ¯æ¬¡éƒ½è¦ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡, å¯ä»¥ä½¿ç”¨ç¼“å­˜è¿›è¡Œä¼˜åŒ–. </li>
<li>é«˜å¯ç”¨æ€§: ä¿è¯æ³¨å†Œä¸­å¿ƒä¸ä¼šå®•æœº. </li>
<li>é«˜æ‰©å±•æ€§: æä¾›ä¸åŒçš„æ³¨å†Œä¸­å¿ƒå®ç°ç±», å¹¶ä½¿ç”¨ SPI æœºåˆ¶è¿è¡Œç”¨æˆ·è‡ªå®šä¹‰æ³¨å†Œä¸­å¿ƒå®ç°ç±».</li>
</ul>
<h4 id="è´Ÿè½½å‡è¡¡ç»„ä»¶-com-ypy-pyrpc-spi-loadbalancer"><a href="#è´Ÿè½½å‡è¡¡ç»„ä»¶-com-ypy-pyrpc-spi-loadbalancer" class="headerlink" title="è´Ÿè½½å‡è¡¡ç»„ä»¶ com.ypy.pyrpc.spi.loadbalancer"></a>è´Ÿè½½å‡è¡¡ç»„ä»¶ <code>com.ypy.pyrpc.spi.loadbalancer</code></h4><p>ä¸º Consumer ä»ä¼—å¤šå†…å®¹ç›¸åŒä½† Provider ä¸åŒçš„æœåŠ¡ç»“ç‚¹ä¸­, ä¾æ®æŸç§ç®—æ³•é€‰æ‹©æ°å½“çš„æœåŠ¡èŠ‚ç‚¹, è¿™æ ·å¯ä»¥åˆç†åˆ†é… Provider ç«¯çš„å‹åŠ›. </p>
<p><strong>:stars:<code>Loadbalancer</code> æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Loadbalancer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceMetaInfoList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context: Provide additional contextual information for load balancing algorithms to more intelligently select service instances.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ServiceMetaInfo <span class="title function_">select</span><span class="params">(List&lt;ServiceMetaInfo&gt; serviceMetaInfoList, Map&lt;String, Object&gt; context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è½®è¯¢, éšæœº, å’Œä¸€è‡´å“ˆå¸Œç­‰æ–¹æ³•å®ç°äº†é»˜è®¤çš„ä¸‰ç§åºåˆ—åŒ–å™¨å®ç°</p>
<h4 id="é‡è¯•å’Œå®¹é”™ç»„ä»¶-com-ypy-pyrpc-spi-retry-com-ypy-pyrpc-spi-tolerance"><a href="#é‡è¯•å’Œå®¹é”™ç»„ä»¶-com-ypy-pyrpc-spi-retry-com-ypy-pyrpc-spi-tolerance" class="headerlink" title="é‡è¯•å’Œå®¹é”™ç»„ä»¶ com.ypy.pyrpc.spi.retry &amp; com.ypy.pyrpc.spi.tolerance"></a>é‡è¯•å’Œå®¹é”™ç»„ä»¶ <code>com.ypy.pyrpc.spi.retry</code> &amp; <code>com.ypy.pyrpc.spi.tolerance</code></h4><p>è¿™ä¸€éƒ¨åˆ†åªåšäº†ç®€å•çš„å®ç°å’Œå ä½, å¼€å‘è€…å¯ä»¥ä½¿ç”¨SPIæœºåˆ¶è‡ªå®šä¹‰å®ç°</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/01/lang/mykotlin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/01/lang/mykotlin/" class="post-title-link" itemprop="url">My Kotlin</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-12-01 00:00:00" itemprop="dateCreated datePublished" datetime="2024-12-01T00:00:00+08:00">2024-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/lang/" itemprop="url" rel="index"><span itemprop="name">lang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h2 id="è‡ªå®šä¹‰è§„åˆ™æ’åº"><a href="#è‡ªå®šä¹‰è§„åˆ™æ’åº" class="headerlink" title="è‡ªå®šä¹‰è§„åˆ™æ’åº"></a>è‡ªå®šä¹‰è§„åˆ™æ’åº</h2><h3 id="1-ä½¿ç”¨-sortedWith-å’Œ-Comparator"><a href="#1-ä½¿ç”¨-sortedWith-å’Œ-Comparator" class="headerlink" title="1. ä½¿ç”¨ sortedWith å’Œ Comparator"></a>1. ä½¿ç”¨ <code>sortedWith</code> å’Œ <code>Comparator</code></h3><p><code>sortedWith</code> æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª <code>Comparator</code> å¯¹è±¡ï¼Œå®šä¹‰ä½ çš„æ’åºè§„åˆ™ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰æ’åºè§„åˆ™ï¼šæŒ‰æ•°å­—çš„å¥‡å¶æ€§æ’åºï¼Œå¥‡æ•°æ’åœ¨å‰ï¼Œå¶æ•°æ’åœ¨åï¼Œå¥‡æ•°å’Œå¥‡æ•°æŒ‰å‡åºï¼Œå¶æ•°å’Œå¶æ•°æŒ‰å‡åº</span></span><br><span class="line">    <span class="keyword">val</span> sortedArray = array.sortedWith(compareBy(</span><br><span class="line">        &#123; it % <span class="number">2</span> == <span class="number">0</span> &#125;, <span class="comment">// å¥‡å¶æ€§ï¼Œå¥‡æ•° (false) åœ¨å‰ï¼Œå¶æ•° (true) åœ¨å</span></span><br><span class="line">        &#123; it &#125;           <span class="comment">// åŒä¸ºå¥‡æ•°æˆ–å¶æ•°æ—¶æŒ‰å‡åºæ’åº</span></span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line">    println(sortedArray) <span class="comment">// è¾“å‡º: [1, 3, 5, 2, 8]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ä½¿ç”¨-sortWith-æ–¹æ³•å¯¹åŸæ•°ç»„æ’åº"><a href="#2-ä½¿ç”¨-sortWith-æ–¹æ³•å¯¹åŸæ•°ç»„æ’åº" class="headerlink" title="2. ä½¿ç”¨ sortWith æ–¹æ³•å¯¹åŸæ•°ç»„æ’åº"></a>2. ä½¿ç”¨ <code>sortWith</code> æ–¹æ³•å¯¹åŸæ•°ç»„æ’åº</h3><p>å¦‚æœéœ€è¦å¯¹åŸæ•°ç»„è¿›è¡Œæ’åºè€Œä¸æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ <code>sortWith</code> æ–¹æ³•ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰æ’åºè§„åˆ™ï¼šæŒ‰é™åºæ’åº</span></span><br><span class="line">    array.sortWith(Comparator &#123; a, b -&gt; b - a &#125;)</span><br><span class="line"></span><br><span class="line">    println(array.joinToString(<span class="string">&quot;, &quot;</span>)) <span class="comment">// è¾“å‡º: 8, 5, 3, 2, 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-ä½¿ç”¨-lambda-è¡¨è¾¾å¼å®šä¹‰ç®€å•çš„æ¯”è¾ƒè§„åˆ™"><a href="#3-ä½¿ç”¨-lambda-è¡¨è¾¾å¼å®šä¹‰ç®€å•çš„æ¯”è¾ƒè§„åˆ™" class="headerlink" title="3. ä½¿ç”¨ lambda è¡¨è¾¾å¼å®šä¹‰ç®€å•çš„æ¯”è¾ƒè§„åˆ™"></a>3. ä½¿ç”¨ <code>lambda</code> è¡¨è¾¾å¼å®šä¹‰ç®€å•çš„æ¯”è¾ƒè§„åˆ™</h3><p>Kotlin æ”¯æŒç›´æ¥ä½¿ç”¨ lambda è¡¨è¾¾å¼æ¥å®šä¹‰æ¯”è¾ƒè§„åˆ™ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‰æ•°å­—çš„ç»å¯¹å€¼å‡åºæ’åº</span></span><br><span class="line">    <span class="keyword">val</span> sortedArray = array.sortedWith &#123; a, b -&gt; </span><br><span class="line">        a.absoluteValue - b.absoluteValue</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(sortedArray) <span class="comment">// è¾“å‡º: [1, 2, 3, 5, 8]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ç»¼åˆä½¿ç”¨-compareBy-å’Œå¤šæ¡ä»¶æ’åº"><a href="#4-ç»¼åˆä½¿ç”¨-compareBy-å’Œå¤šæ¡ä»¶æ’åº" class="headerlink" title="4. ç»¼åˆä½¿ç”¨ compareBy å’Œå¤šæ¡ä»¶æ’åº"></a>4. ç»¼åˆä½¿ç”¨ <code>compareBy</code> å’Œå¤šæ¡ä»¶æ’åº</h3><p><code>compareBy</code> å¯ä»¥é“¾å¼è°ƒç”¨å¤šä¸ªæ¡ä»¶è¿›è¡Œæ’åºï¼Œä¼˜é›…åœ°å®šä¹‰å¤æ‚è§„åˆ™ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> array = arrayOf(Pair(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>), Pair(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>), Pair(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜å…ˆæŒ‰ç¬¬ä¸€ä¸ªå…ƒç´ æ’åºï¼Œè‹¥ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸åŒï¼Œåˆ™æŒ‰ç¬¬äºŒä¸ªå…ƒç´ æ’åº</span></span><br><span class="line">    <span class="keyword">val</span> sortedArray = array.sortedWith(compareBy(&#123; it.first &#125;, &#123; it.second &#125;))</span><br><span class="line"></span><br><span class="line">    println(sortedArray) <span class="comment">// è¾“å‡º: [(Apple, 1), (Apple, 2), (Banana, 1)]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol>
<li>å¦‚æœå¯¹å¤§æ•°æ®é‡æ’åºï¼Œè¯·ç¡®ä¿æ’åºè§„åˆ™ä¸ä¼šå¼•å‘æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li><code>sortedWith</code> ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä¸ä¼šä¿®æ”¹åŸæ•°ç»„ã€‚</li>
<li>è‹¥éœ€è¦é€†åºï¼Œå¯ä»¥ç»“åˆ <code>reversed</code> æ–¹æ³•æˆ–ä½¿ç”¨ <code>compareByDescending</code>ã€‚</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/01/lang/myrust/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/01/lang/myrust/" class="post-title-link" itemprop="url">My Rust</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-11-01 00:00:00" itemprop="dateCreated datePublished" datetime="2024-11-01T00:00:00+08:00">2024-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/lang/" itemprop="url" rel="index"><span itemprop="name">lang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="MyRust"><a href="#MyRust" class="headerlink" title="MyRust"></a>MyRust</h1><h2 id="Rust-ä¼˜ç§€çš„ç­¾åè®¾è®¡"><a href="#Rust-ä¼˜ç§€çš„ç­¾åè®¾è®¡" class="headerlink" title="Rust ä¼˜ç§€çš„ç­¾åè®¾è®¡"></a>Rust ä¼˜ç§€çš„ç­¾åè®¾è®¡</h2><blockquote>
<p>æˆ‘æ³¨æ„åˆ°ä¸€ä¸ªå†™ä»£ç ä¸­çš„é—®é¢˜: </p>
<p>ä¾‹å¦‚ <code>int[] plusOne(int[] arr)</code> è¿™ä¸ªå‡½æ•°ç­¾åæ— æ³•ç¡®ä¿ç¨‹åºå‘˜æ˜¯åœ¨ arr ä¸ŠåŸåœ°ä¿®æ”¹çš„, è¿˜æ˜¯æŠŠarr clone äº†ä¸€ä»½</p>
<p>è€Œrust åˆ™å¯ä»¥é€šè¿‡å¯¹å‡½æ•°ç­¾åçš„è¦æ±‚æ˜ç¡®è¡¨ç¤ºå‡ºè¿™ä¸€ç‚¹</p>
<p>ä¾‹å¦‚</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(arr: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; <span class="comment">// arr èµ°å‡ºå‡½æ•°ä¾¿ä¸å†å¯ç”¨` </span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(arr: &amp;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;` </span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(arr: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;)`</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>Rust å‡½æ•°ç­¾åè®¾è®¡çš„ä¸€ä¸ªæ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š<strong>é€šè¿‡å‡½æ•°ç­¾åæ¸…æ™°è¡¨è¾¾äº†æ•°æ®çš„æ‰€æœ‰æƒã€å€Ÿç”¨å’Œä¿®æ”¹å…³ç³»</strong>ã€‚</p>
<p>åœ¨å¾ˆå¤šè¯­è¨€ï¼ˆå¦‚ C++ã€Javaï¼‰ä¸­ï¼Œ<strong>æ— æ³•ä»…é€šè¿‡å‡½æ•°ç­¾åæ¥åˆ¤æ–­</strong>ä¸€ä¸ªæ•°ç»„ï¼ˆæˆ–åˆ—è¡¨ï¼‰æ˜¯å¦æ˜¯<strong>åŸåœ°ä¿®æ”¹çš„</strong>ï¼Œ<strong>è¿˜æ˜¯å…‹éš†äº†ä¸€ä»½æ–°æ•°ç»„</strong>ã€‚ä½†åœ¨ Rust ä¸­ï¼Œ<strong>å‡½æ•°ç­¾åæœ¬èº«å°±æ˜ç¡®äº†è¿™ä¸€ç‚¹</strong>ï¼Œå› ä¸º Rust å¼ºåˆ¶è¦æ±‚å¼€å‘è€…<strong>æ˜¾å¼å£°æ˜æ‰€æœ‰æƒå’Œå¯å˜æ€§</strong>ã€‚</p>
<p>Rust ä¸‰æƒåˆ†ç«‹: æ‰€æœ‰æƒ, è¯»æƒ, å†™æƒ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Eq, Clone, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> val: <span class="type">i32</span>,</span><br><span class="line">    <span class="keyword">pub</span> next: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(val: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        ListNode &#123; val, next: <span class="literal">None</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_one_node</span>(head: &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt;, value: <span class="type">i32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span>: &amp;<span class="keyword">mut</span> <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt; = head; <span class="comment">// p æ˜¯ head çš„å¯å˜å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = p &#123;</span><br><span class="line">        p = &amp;<span class="keyword">mut</span> node.next; <span class="comment">// ä¸æ–­å‘é“¾è¡¨å°¾éƒ¨ç§»åŠ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    *p = <span class="title function_ invoke__">Some</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(ListNode::<span class="title function_ invoke__">new</span>(value))); <span class="comment">// åœ¨å°¾éƒ¨æ’å…¥æ–°èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">show_list</span>(head: &amp;<span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt;) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span>: &amp;<span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt; = head; <span class="comment">// p æ˜¯ &amp;Option&lt;Box&lt;ListNode&gt;&gt;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = p &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125; -&gt; &quot;</span>, node.val); <span class="comment">// æ‰“å°å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        p = &amp;node.next; <span class="comment">// å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨ï¼Œp çš„ç±»å‹æ˜¯ &amp;Option&lt;Box&lt;ListNode&gt;&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;None&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">head</span>: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;ListNode&gt;&gt; = <span class="title function_ invoke__">Some</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(ListNode::<span class="title function_ invoke__">new</span>(<span class="number">1</span>)));</span><br><span class="line">    <span class="title function_ invoke__">add_one_node</span>(&amp;<span class="keyword">mut</span> head, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">add_one_node</span>(&amp;<span class="keyword">mut</span> head, <span class="number">3</span>);</span><br><span class="line">    <span class="title function_ invoke__">add_one_node</span>(&amp;<span class="keyword">mut</span> head, <span class="number">4</span>); <span class="comment">// 1 -&gt; 2 -&gt; 3 -&gt; 4</span></span><br><span class="line">    <span class="title function_ invoke__">show_list</span>(&amp;head);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Tip-for-x-in-y"><a href="#Tip-for-x-in-y" class="headerlink" title="Tip: for x in y"></a>Tip: <code>for x in y</code></h2><table>
<thead>
<tr>
<th><code>y</code> ç±»å‹</th>
<th>è°ƒç”¨çš„è¿­ä»£å™¨</th>
<th><code>x</code> çš„ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>Vec&lt;T&gt;</code></td>
<td><code>.into_iter()</code></td>
<td><code>T</code></td>
<td>æ¶ˆè€—é›†åˆï¼Œè½¬ç§»æ‰€æœ‰æƒ</td>
</tr>
<tr>
<td><code>&amp;Vec&lt;T&gt;</code></td>
<td><code>.iter()</code></td>
<td><code>&amp;T</code></td>
<td>ä¸å¯å˜å¼•ç”¨è¿­ä»£å™¨ï¼Œä¸æ¶ˆè€—é›†åˆ</td>
</tr>
<tr>
<td><code>&amp;mut Vec&lt;T&gt;</code></td>
<td><code>.iter_mut()</code></td>
<td><code>&amp;mut T</code></td>
<td>å¯å˜å¼•ç”¨è¿­ä»£å™¨ï¼Œå…è®¸ä¿®æ”¹é›†åˆ</td>
</tr>
<tr>
<td><code>[T; N]</code></td>
<td><code>.iter()</code></td>
<td><code>&amp;T</code></td>
<td>å›ºå®šæ•°ç»„è½¬ä¸ºåˆ‡ç‰‡çš„ä¸å¯å˜å¼•ç”¨</td>
</tr>
<tr>
<td><code>&amp;[T]</code></td>
<td><code>.iter()</code></td>
<td><code>&amp;T</code></td>
<td>åˆ‡ç‰‡çš„ä¸å¯å˜å¼•ç”¨</td>
</tr>
<tr>
<td><code>&amp;mut [T]</code></td>
<td><code>.iter_mut()</code></td>
<td><code>&amp;mut T</code></td>
<td>åˆ‡ç‰‡çš„å¯å˜å¼•ç”¨</td>
</tr>
</tbody></table>
<p>é€šè¿‡è¿™äº›è§„åˆ™ï¼Œå¯ä»¥æ ¹æ® <code>y</code> çš„ç±»å‹å¿«é€Ÿåˆ¤æ–­ <code>x</code> çš„ç±»å‹ï¼Œä»¥åŠæ˜¯å¦å‘ç”Ÿæ‰€æœ‰æƒè½¬ç§»ï¼</p>
<h2 id="Tip-let-Some-x-y"><a href="#Tip-let-Some-x-y" class="headerlink" title="Tip: let Some(x) = y"></a>Tip: <code>let Some(x) = y</code></h2><table>
<thead>
<tr>
<th>Y Type</th>
<th>X Type</th>
<th>equals</th>
<th>DEsc</th>
</tr>
</thead>
<tbody><tr>
<td><code>Option&lt;T&gt;</code></td>
<td><code>T</code></td>
<td><code>x = y.unwrap()</code></td>
<td>x ä¼šå–å¾—æ•°æ®çš„æ‰€æœ‰æƒ</td>
</tr>
<tr>
<td><code>&amp;Option&lt;T&gt;</code></td>
<td><code>&amp;T</code></td>
<td><code>x = y.as_ref().unwrap()</code></td>
<td>x åªæ˜¯è¯»å€Ÿç”¨, ä¸ä¼šå–å¾—æ‰€æœ‰æƒ</td>
</tr>
<tr>
<td><code>&amp;mut Option&lt;T&gt;</code></td>
<td><code>&amp;mut T</code></td>
<td><code>x = y.as_mut().unwrap()</code></td>
<td>x æ˜¯å†™å€Ÿç”¨, ä¸ä¼šå–å¾—æ‰€æœ‰æƒ</td>
</tr>
</tbody></table>
<p>ç‰¹åˆ«åœ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å½“ y: Option&lt;T&gt;</span><br><span class="line">while let Some(x) = &amp;y =&gt; x: &amp;T</span><br><span class="line">if let Some(x) = &amp;mut y =&gt; x: &amp;mut T</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/13/algorithm/15-bitwise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/13/algorithm/15-bitwise/" class="post-title-link" itemprop="url">Bitwise Operate</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-13 00:00:00" itemprop="dateCreated datePublished" datetime="2024-09-13T00:00:00+08:00">2024-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p>Java ä¸­çš„ <code>int</code> ç±»å‹æ˜¯ä¸€ä¸ª 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œä½¿ç”¨è¡¥ç ï¼ˆtwoâ€™s complementï¼‰è¡¨ç¤ºæ³•æ¥å­˜å‚¨ã€‚äº†è§£ <code>int</code> ç±»å‹çš„ bit è¡¨ç¤ºå’Œä½è¿ç®—æ˜¯æ·±å…¥ç†è§£ Java ä¸­æ•´æ•°æ“ä½œçš„é‡è¦åŸºç¡€ã€‚</p>
<h3 id="1-int-ç±»å‹çš„äºŒè¿›åˆ¶è¡¨ç¤º"><a href="#1-int-ç±»å‹çš„äºŒè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="1. int ç±»å‹çš„äºŒè¿›åˆ¶è¡¨ç¤º"></a>1. <code>int</code> ç±»å‹çš„äºŒè¿›åˆ¶è¡¨ç¤º</h3><p>åœ¨ Java ä¸­ï¼Œ<code>int</code> ç±»å‹æ˜¯ä¸€ä¸ª 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œå­˜å‚¨èŒƒå›´ä» <code>-2^31</code> åˆ° <code>2^31 - 1</code>ï¼Œå³ä» <code>-2147483648</code> åˆ° <code>2147483647</code>ã€‚å…·ä½“çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ä½¿ç”¨ <strong>è¡¥ç </strong> æ–¹å¼ã€‚è¡¥ç è¡¨ç¤ºæ³•çš„ç‰¹ç‚¹æ˜¯è´Ÿæ•°çš„è¡¨ç¤ºæ˜¯å…¶ç»å¯¹å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºå–ååŠ ä¸€ã€‚</p>
<h4 id="æ­£æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"><a href="#æ­£æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="æ­£æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"></a>æ­£æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º</h4><ul>
<li><p>æ­£æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯å®ƒçš„ç»å¯¹å€¼çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œæœ€é«˜ä½ä¸º 0ï¼ˆè¡¨ç¤ºæ­£æ•°ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ5 åœ¨ 32 ä½çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 00000101</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"><a href="#è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"></a>è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º</h4><ul>
<li><p>è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯å…¶ç»å¯¹å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºå–åå†åŠ ä¸€ï¼Œæœ€é«˜ä½ä¸º 1ï¼ˆè¡¨ç¤ºè´Ÿæ•°ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ-5 çš„è¡¥ç è¡¨ç¤ºï¼š</p>
<ol>
<li>å…ˆå†™å‡º <code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li>å–åï¼š <code>11111111 11111111 11111111 11111010</code></li>
<li>åŠ ä¸€ï¼š <code>11111111 11111111 11111111 11111011</code>ï¼Œå³ <code>-5</code> çš„è¡¥ç è¡¨ç¤ºï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11111111 11111111 11111111 11111011</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ç‰¹æ®Šå€¼ï¼š"><a href="#ç‰¹æ®Šå€¼ï¼š" class="headerlink" title="ç‰¹æ®Šå€¼ï¼š"></a>ç‰¹æ®Šå€¼ï¼š</h4><ul>
<li><p>0 çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 00000000</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€å¤§å€¼ 2147483647 (2^31 - 1) çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">01111111 11111111 11111111 11111111</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€å°å€¼ -2147483648 (-2^31) çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10000000 00000000 00000000 00000000</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-ä½è¿ç®—"><a href="#2-ä½è¿ç®—" class="headerlink" title="2. ä½è¿ç®—"></a>2. ä½è¿ç®—</h3><p>ä½è¿ç®—æ˜¯ç›´æ¥å¯¹æ•´æ•°çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œçš„è¿ç®—ï¼Œå¸¸è§çš„ä½è¿ç®—åŒ…æ‹¬ AND (<code>&amp;</code>)ã€OR (<code>|</code>)ã€XOR (<code>^</code>)ã€NOT (<code>~</code>)ã€å·¦ç§» (<code>&lt;&lt;</code>)ã€å³ç§» (<code>&gt;&gt;</code>)ã€æ— ç¬¦å·å³ç§» (<code>&gt;&gt;&gt;</code>) ç­‰ã€‚</p>
<h4 id="2-1-ä½ä¸è¿ç®—"><a href="#2-1-ä½ä¸è¿ç®—" class="headerlink" title="2.1. ä½ä¸è¿ç®— (&amp;)"></a>2.1. ä½ä¸è¿ç®— (<code>&amp;</code>)</h4><ul>
<li><p><code>&amp;</code> æ˜¯æŒ‰ä½ä¸è¿ç®—ç¬¦ï¼Œä¸¤ä¸ªå¯¹åº”çš„äºŒè¿›åˆ¶ä½éƒ½ä¸º <code>1</code> æ—¶ï¼Œç»“æœæ‰ä¸º <code>1</code>ï¼Œå¦åˆ™ä¸º <code>0</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>5 &amp; 3</code>ï¼š</p>
<ul>
<li><code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li><code>3</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000011</code></li>
<li>ç»“æœï¼š <code>00000000 00000000 00000000 00000001</code>ï¼ˆå³ <code>1</code>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-2-ä½æˆ–è¿ç®—"><a href="#2-2-ä½æˆ–è¿ç®—" class="headerlink" title="2.2. ä½æˆ–è¿ç®— (|)"></a>2.2. ä½æˆ–è¿ç®— (<code>|</code>)</h4><ul>
<li><p><code>|</code> æ˜¯æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼Œä¸¤ä¸ªå¯¹åº”çš„äºŒè¿›åˆ¶ä½è‡³å°‘æœ‰ä¸€ä¸ªä¸º <code>1</code> æ—¶ï¼Œç»“æœä¸º <code>1</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>5 | 3</code>ï¼š</p>
<ul>
<li><code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li><code>3</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000011</code></li>
<li>ç»“æœï¼š <code>00000000 00000000 00000000 00000111</code>ï¼ˆå³ <code>7</code>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-3-ä½å¼‚æˆ–è¿ç®—"><a href="#2-3-ä½å¼‚æˆ–è¿ç®—" class="headerlink" title="2.3. ä½å¼‚æˆ–è¿ç®— (^)"></a>2.3. ä½å¼‚æˆ–è¿ç®— (<code>^</code>)</h4><ul>
<li><p><code>^</code> æ˜¯æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼Œä¸¤ä¸ªå¯¹åº”çš„äºŒè¿›åˆ¶ä½ç›¸å¼‚æ—¶ï¼Œç»“æœä¸º <code>1</code>ï¼Œå¦åˆ™ä¸º <code>0</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>5 ^ 3</code>ï¼š</p>
<ul>
<li><code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li><code>3</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000011</code></li>
<li>ç»“æœï¼š <code>00000000 00000000 00000000 00000110</code>ï¼ˆå³ <code>6</code>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-4-ä½å–åè¿ç®—"><a href="#2-4-ä½å–åè¿ç®—" class="headerlink" title="2.4. ä½å–åè¿ç®— (~)"></a>2.4. ä½å–åè¿ç®— (<code>~</code>)</h4><ul>
<li><p><code>~</code> æ˜¯æŒ‰ä½å–åè¿ç®—ç¬¦ï¼Œ0 å˜æˆ 1ï¼Œ1 å˜æˆ 0ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>~5</code>ï¼š</p>
<ul>
<li><code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li>ç»“æœï¼š <code>11111111 11111111 11111111 11111010</code>ï¼ˆå³ <code>-6</code>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-5-å·¦ç§»è¿ç®—"><a href="#2-5-å·¦ç§»è¿ç®—" class="headerlink" title="2.5. å·¦ç§»è¿ç®— (&lt;&lt;)"></a>2.5. å·¦ç§»è¿ç®— (<code>&lt;&lt;</code>)</h4><ul>
<li><p><code>&lt;&lt;</code> æ˜¯å·¦ç§»è¿ç®—ç¬¦ï¼Œæ“ä½œæ•°çš„æ¯ä¸€ä½éƒ½ä¼šå‘å·¦ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œå³ä¾§ç©ºå‡ºçš„ä½ç½®ç”¨ <code>0</code> å¡«å……ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>5 &lt;&lt; 1</code>ï¼š</p>
<ul>
<li><code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li>ç»“æœï¼š <code>00000000 00000000 00000000 00001010</code>ï¼ˆå³ <code>10</code>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-6-å³ç§»è¿ç®—"><a href="#2-6-å³ç§»è¿ç®—" class="headerlink" title="2.6. å³ç§»è¿ç®— (&gt;&gt;)"></a>2.6. å³ç§»è¿ç®— (<code>&gt;&gt;</code>)</h4><ul>
<li><p><code>&gt;&gt;</code> æ˜¯ç®—æœ¯å³ç§»è¿ç®—ç¬¦ï¼Œæ“ä½œæ•°çš„æ¯ä¸€ä½éƒ½ä¼šå‘å³ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œå·¦ä¾§çš„ç©ºä½æ ¹æ®ç¬¦å·ä½å¡«å……ï¼ˆå¦‚æœæ˜¯æ­£æ•°ï¼Œç”¨ <code>0</code> å¡«å……ï¼›å¦‚æœæ˜¯è´Ÿæ•°ï¼Œç”¨ <code>1</code> å¡«å……ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>5 &gt;&gt; 1</code>ï¼š</p>
<ul>
<li><code>5</code> çš„äºŒè¿›åˆ¶ï¼š <code>00000000 00000000 00000000 00000101</code></li>
<li>ç»“æœï¼š <code>00000000 00000000 00000000 00000010</code>ï¼ˆå³ <code>2</code>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-7-æ— ç¬¦å·å³ç§»è¿ç®—"><a href="#2-7-æ— ç¬¦å·å³ç§»è¿ç®—" class="headerlink" title="2.7. æ— ç¬¦å·å³ç§»è¿ç®— (&gt;&gt;&gt;)"></a>2.7. æ— ç¬¦å·å³ç§»è¿ç®— (<code>&gt;&gt;&gt;</code>)</h4><ul>
<li><p><code>&gt;&gt;&gt;</code> æ˜¯æ— ç¬¦å·å³ç§»è¿ç®—ç¬¦ï¼Œæ“ä½œæ•°çš„æ¯ä¸€ä½éƒ½ä¼šå‘å³ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œå·¦ä¾§ç©ºä½æ€»æ˜¯å¡«å…… <code>0</code>ï¼Œå³ä½¿æ˜¯è´Ÿæ•°ï¼Œä¹Ÿä¸ä½¿ç”¨ç¬¦å·æ‰©å±•ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>-5 &gt;&gt;&gt; 1</code>ï¼š</p>
<ul>
<li><code>-5</code> çš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºä¸ºï¼š <code>11111111 11111111 11111111 11111011</code></li>
<li>ç»“æœï¼š <code>01111111 11111111 11111111 11111101</code>ï¼ˆå³ <code>2147483642</code>ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="3-ä½è¿ç®—åº”ç”¨"><a href="#3-ä½è¿ç®—åº”ç”¨" class="headerlink" title="3. ä½è¿ç®—åº”ç”¨"></a>3. ä½è¿ç®—åº”ç”¨</h3><p>ä½è¿ç®—å¸¸å¸¸ç”¨äºé«˜æ•ˆçš„æ•°å€¼è®¡ç®—å’Œä¸€äº›ä¼˜åŒ–é—®é¢˜ä¸­ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„åº”ç”¨ï¼š</p>
<h4 id="3-1-æ£€æŸ¥ä¸€ä¸ªæ•°çš„å¥‡å¶æ€§"><a href="#3-1-æ£€æŸ¥ä¸€ä¸ªæ•°çš„å¥‡å¶æ€§" class="headerlink" title="3.1. æ£€æŸ¥ä¸€ä¸ªæ•°çš„å¥‡å¶æ€§"></a>3.1. æ£€æŸ¥ä¸€ä¸ªæ•°çš„å¥‡å¶æ€§</h4><p>é€šè¿‡æ£€æŸ¥æœ€ä½ä½æ¥åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºå¶æ•°æˆ–å¥‡æ•°ï¼š</p>
<ul>
<li><code>n &amp; 1 == 0</code> è¡¨ç¤º <code>n</code> æ˜¯å¶æ•°</li>
<li><code>n &amp; 1 == 1</code> è¡¨ç¤º <code>n</code> æ˜¯å¥‡æ•°</li>
</ul>
<h4 id="3-2-è®¾ç½®ã€æ¸…é™¤ã€åˆ‡æ¢æŸä¸€ä½"><a href="#3-2-è®¾ç½®ã€æ¸…é™¤ã€åˆ‡æ¢æŸä¸€ä½" class="headerlink" title="3.2. è®¾ç½®ã€æ¸…é™¤ã€åˆ‡æ¢æŸä¸€ä½"></a>3.2. è®¾ç½®ã€æ¸…é™¤ã€åˆ‡æ¢æŸä¸€ä½</h4><ul>
<li>è®¾ç½®æŸä¸€ä½ï¼š<code>n |= (1 &lt;&lt; k)</code>ï¼Œå°†ç¬¬ <code>k</code> ä½è®¾ç½®ä¸º 1ã€‚</li>
<li>æ¸…é™¤æŸä¸€ä½ï¼š<code>n &amp;= ~(1 &lt;&lt; k)</code>ï¼Œå°†ç¬¬ <code>k</code> ä½è®¾ç½®ä¸º 0ã€‚</li>
<li>åˆ‡æ¢æŸä¸€ä½ï¼š<code>n ^= (1 &lt;&lt; k)</code>ï¼Œå°†ç¬¬ <code>k</code> ä½çš„å€¼å–åã€‚</li>
</ul>
<h4 id="3-3-åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º-2-çš„å¹‚"><a href="#3-3-åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º-2-çš„å¹‚" class="headerlink" title="3.3. åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º 2 çš„å¹‚"></a>3.3. åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º 2 çš„å¹‚</h4><ul>
<li>ä¸€ä¸ªæ•°æ˜¯ 2 çš„å¹‚å½“ä¸”ä»…å½“å®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºåªæœ‰ä¸€ä¸ª <code>1</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>(n &amp; (n - 1)) == 0</code> æ¥åˆ¤æ–­ã€‚</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½è¿ç®—åœ¨ Java ä¸­éå¸¸é«˜æ•ˆï¼Œå› ä¸ºå®ƒç›´æ¥æ“ä½œäºŒè¿›åˆ¶ä½ï¼Œé€šå¸¸æ¯”å¸¸è§„çš„ç®—æœ¯è¿ç®—å’Œé€»è¾‘è¿ç®—æ›´å¿«ã€‚ç†è§£ <code>int</code> çš„äºŒè¿›åˆ¶è¡¨ç¤ºå’Œä½è¿ç®—çš„çŸ¥è¯†å¯¹äºè§£å†³å¾ˆå¤šç¼–ç¨‹é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ç®—æ³•å’Œä¼˜åŒ–é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚</p>
<h1 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å·¦ç§»( &lt;&lt; )</span><br><span class="line">å³ç§»( &gt;&gt; )  // æ­£æ•°ç”¨ 0 è¡¥ä½, è´Ÿæ•°ç”¨ 1 è¡¥ä½</span><br><span class="line">æ— ç¬¦å·å³ç§»( &gt;&gt;&gt; )  // ä¸ç®¡æ­£æ•°è´Ÿæ•°, ç»Ÿç»Ÿç”¨ 0 è¡¥ä½</span><br><span class="line">ä½ä¸( &amp; )</span><br><span class="line">ä½æˆ–( | )</span><br><span class="line">ä½é( ~ )</span><br><span class="line">ä½å¼‚æˆ–( ^ )</span><br><span class="line">é™¤äº†ä½é( ~ )æ˜¯ä¸€å…ƒæ“ä½œç¬¦å¤–, å…¶å®ƒçš„éƒ½æ˜¯äºŒå…ƒæ“ä½œç¬¦. </span><br><span class="line">å¯¹äº int n, n != 0, n ä¸ -n çš„ 1 ä¹‹å’Œä¸º 33</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BitOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Solution</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Solution</span>();</span><br><span class="line">        System.out.println(s.showBits(<span class="number">5</span>));</span><br><span class="line">        System.out.println(s.showBits(-<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">showBits</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            sb.append(num &amp; <span class="number">1</span>);</span><br><span class="line">            num &gt;&gt;&gt;= <span class="number">1</span>;  <span class="comment">// è¿™é‡Œå¿…é¡»ä½¿ç”¨æ— ç¬¦å·å³ç§»</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.reverse().toString();  <span class="comment">// è®°å¾—ç¿»è½¬</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">countBits</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((num &amp; <span class="number">1</span>) <span class="comment">/* &amp; è¿ç®—çš„æ‹¬å·ä¸èƒ½å°‘ */</span> == <span class="number">1</span>) cnt ++;</span><br><span class="line">            num &gt;&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">countBits1</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">            num &amp;= (num - <span class="number">1</span>);  <span class="comment">// æ¸…é™¤æœ€ä½ä½çš„ 1</span></span><br><span class="line">            cnt ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="1356-Sort-Integers-by-The-Number-of-1-Bits"><a href="#1356-Sort-Integers-by-The-Number-of-1-Bits" class="headerlink" title="1356. Sort Integers by The Number of 1 Bits"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/sort-integers-by-the-number-of-1-bits/">1356. Sort Integers by The Number of 1 Bits</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortByBits(<span class="type">int</span>[] arr) &#123;</span><br><span class="line">        Integer[] arr1 = Arrays.stream(arr).boxed().toArray(Integer[]::<span class="keyword">new</span>);</span><br><span class="line">        Arrays.sort(arr1, (x, y) -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">xbs</span> <span class="operator">=</span> cntBits(x), ybs = cntBits(y);</span><br><span class="line">            <span class="keyword">if</span> (xbs != ybs) <span class="keyword">return</span> xbs - ybs;</span><br><span class="line">            <span class="keyword">return</span> x - y;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(arr1).mapToInt(Integer::intValue).toArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">cntBits</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            cnt += (n &amp; <span class="number">1</span>);</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Arrays.sort()</code> è‹¥è¦ä½¿ç”¨ Lambda è¡¨è¾¾å¼, å¿…é¡»å…ˆè£…ç®±</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/08/23/algorithm/14-simulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/126999663?v=4">
      <meta itemprop="name" content="Perry Yao">
      <meta itemprop="description" content="...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Perry's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/08/23/algorithm/14-simulation/" class="post-title-link" itemprop="url">Simulate</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-08-23 00:00:00" itemprop="dateCreated datePublished" datetime="2024-08-23T00:00:00+08:00">2024-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-16 18:27:15" itemprop="dateModified" datetime="2025-05-16T18:27:15+08:00">2025-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><h2 id="657-Robot-Return-to-Origin"><a href="#657-Robot-Return-to-Origin" class="headerlink" title="657. Robot Return to Origin"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/robot-return-to-origin/">657. Robot Return to Origin</a></h2><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judgeCircle</span><span class="params">(String moves)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">xOffset</span> <span class="operator">=</span> <span class="number">0</span>, yOffset = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> move : moves.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (move) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;U&#x27;</span>: yOffset ++; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: yOffset --; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>: xOffset ++; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>: xOffset --; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> xOffset == <span class="number">0</span> &amp;&amp; yOffset == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">judge_circle</span>(moves: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x_offset</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">y_offset</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">ch</span> <span class="keyword">in</span> moves.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">            <span class="keyword">match</span> ch &#123;</span><br><span class="line">                <span class="string">&#x27;U&#x27;</span> =&gt; y_offset += <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;D&#x27;</span> =&gt; y_offset -= <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;R&#x27;</span> =&gt; x_offset += <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;L&#x27;</span> =&gt; x_offset -= <span class="number">1</span>,</span><br><span class="line">                _ =&gt; (),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        x_offset == <span class="number">0</span> &amp;&amp; y_offset == <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="31-Next-Permutation"><a href="#31-Next-Permutation" class="headerlink" title="31. Next Permutation"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/next-permutation/">31. Next Permutation</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> nums[i]; nums[i] = nums[j]; nums[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            swap(nums, i, j); i ++; j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nextPermutation</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®— breakIdx</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">breakIdx</span> <span class="operator">=</span> len - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (breakIdx &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[breakIdx] &lt; nums[breakIdx + <span class="number">1</span>]) <span class="keyword">break</span>;</span><br><span class="line">            breakIdx --;</span><br><span class="line">        &#125;  <span class="comment">// breakIdx å®šä¹‰: ä»å°¾åˆ°å¤´, ä¸€æ¬¡å‡ºç° nums[i] &lt; nums[i + 1] çš„ä½ç½® (i)</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment">// å½“ breakIdx == -1, ä¹Ÿå°±æ˜¯æ•°åˆ—æ˜¯å•è°ƒé€’å‡æ—¶, ç›´æ¥reverse breakIdx å³è¾¹çš„éƒ¨åˆ† (æ•´ä¸ªæ•°åˆ—)</span></span><br><span class="line">        <span class="keyword">if</span> (breakIdx == -<span class="number">1</span>) &#123;</span><br><span class="line">            reverse(nums, <span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// å½“ breakIdx&gt;-1, å¯»æ‰¾breakIdxå³è¾¹ &gt;breakVal çš„æœ€å°å€¼çš„ä½ç½® (swapIdx), äº¤æ¢äºŒè€…çš„ä½ç½®, å†ç¿»è½¬ breakIdx å³è¾¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">breakVal</span> <span class="operator">=</span> nums[breakIdx];</span><br><span class="line">        <span class="type">int</span> <span class="variable">swapIdx</span> <span class="operator">=</span> breakIdx + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">swapVal</span> <span class="operator">=</span> nums[swapIdx];  <span class="comment">// æ ¹æ® breakIdx å®šä¹‰, å½“å‰ swapVal ä¸€å®š &gt; breakVal</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> breakIdx + <span class="number">1</span>; i &lt; len; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= breakVal) <span class="keyword">continue</span>; <span class="comment">// breakVal å‰æè¦ &gt; breakVal æ‰è€ƒè™‘</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= swapVal) &#123;  <span class="comment">// è¦ä½¿ç”¨ &lt;= , swapIdx è¦å°½é‡é è¿‘å°¾éƒ¨</span></span><br><span class="line">                swapIdx = i;</span><br><span class="line">                swapVal = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums, breakIdx, swapIdx);</span><br><span class="line">        reverse(nums, breakIdx + <span class="number">1</span>, len - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="463-Island-Perimeter"><a href="#463-Island-Perimeter" class="headerlink" title="463. Island Perimeter"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/island-perimeter/">463. Island Perimeter</a></h2><h4 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">delta</span><span class="params">(<span class="type">int</span>[][] grid, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> grid.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cols</span> <span class="operator">=</span> grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>      || grid[i-<span class="number">1</span>][j] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">if</span> (i == rows-<span class="number">1</span> || grid[i+<span class="number">1</span>][j] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">if</span> (j == <span class="number">0</span>      || grid[i][j-<span class="number">1</span>] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">if</span> (j == cols-<span class="number">1</span> || grid[i][j+<span class="number">1</span>] == <span class="number">0</span>) res ++;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">islandPerimeter</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; grid.length; i ++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; grid[<span class="number">0</span>].length; j ++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                cnt += delta(grid, i, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Rust-1"><a href="#Rust-1" class="headerlink" title="Rust"></a>Rust</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">island_perimeter</span>(grid: <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;&gt;) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">m</span> = grid.<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">n</span> = grid[<span class="number">0</span>].<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cnt</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..m &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">j</span> <span class="keyword">in</span> <span class="number">0</span>..n &#123;</span><br><span class="line">                <span class="keyword">if</span> grid[i][j] == <span class="number">1</span> &#123;</span><br><span class="line">                    cnt += </span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">as</span> <span class="type">i32</span> - <span class="number">1</span> == -<span class="number">1</span> || grid[i - <span class="number">1</span>][j] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125; + </span><br><span class="line">                    <span class="keyword">if</span> i + <span class="number">1</span> == m || grid[i + <span class="number">1</span>][j] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125; + </span><br><span class="line">                    <span class="keyword">if</span> j <span class="keyword">as</span> <span class="type">i32</span> - <span class="number">1</span> == -<span class="number">1</span> || grid[i][j - <span class="number">1</span>] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125; + </span><br><span class="line">                    <span class="keyword">if</span> j + <span class="number">1</span> == n || grid[i][j + <span class="number">1</span>] == <span class="number">0</span> &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Perry Yao"
      src="https://avatars.githubusercontent.com/u/126999663?v=4">
  <p class="site-author-name" itemprop="name">Perry Yao</p>
  <div class="site-description" itemprop="description">...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/PerryYao-GitHub" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;PerryYao-GitHub" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:peiyouyao@gmail.com" title="E-Mail â†’ mailto:peiyouyao@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Perry Yao</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
